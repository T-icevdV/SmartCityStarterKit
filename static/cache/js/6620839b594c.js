;(function(Wirecloud,utils){"use strict";var id,viewid,tmp,i,current;tmp=document.location.hash.substr(1);tmp=tmp.split("&");for(i=0;i<tmp.length;i++){current=tmp[i];current=current.split("=",2);if(current[0]==="id"){id=decodeURIComponent(current[1]);}else if(current[0]==="workspaceview"){viewid=decodeURIComponent(current[1]);}}
Object.defineProperty(window,'MashupPlatform',{value:{}});var workspaceview=viewid?Wirecloud.UserInterfaceManager.workspaceviews[viewid]:Wirecloud.activeWorkspace.view;MashupPlatform.priv={id:id,workspaceview:workspaceview};var InputEndpoint=function InputEndpoint(real_endpoint,dynamic){privates.set(this,{dynamic:dynamic,real_endpoint:real_endpoint});Object.defineProperty(this,"connected",{get:inputendpoint_get_connected});};var inputendpoint_get_connected=function inputendpoint_get_connected(){return privates.get(this).real_endpoint.inputs.length!==0;};InputEndpoint.prototype.connect=function connect(outputendpoint){var real_inputendpoint,real_outputendpoint;if(outputendpoint==null|| !(outputendpoint instanceof OutputEndpoint)){throw new TypeError("outputendpoint must be an output endpoint instance");}
real_inputendpoint=privates.get(this).real_endpoint;real_outputendpoint=privates.get(outputendpoint).real_endpoint;create_connection(real_outputendpoint,real_inputendpoint);};InputEndpoint.prototype.disconnect=function disconnect(outputendpoint){var connection,index,real_inputendpoint,real_outputendpoint;if(outputendpoint!=null&&!(outputendpoint instanceof OutputEndpoint)){throw new TypeError("outputendpoint must be null or an output endpoint instance");}
real_inputendpoint=privates.get(this).real_endpoint;if(outputendpoint!=null){real_outputendpoint=privates.get(outputendpoint).real_endpoint;index=real_outputendpoint.outputList.indexOf(real_inputendpoint);if(index!==-1){connection=real_outputendpoint.connections[index];remove_connection(connection);}}else{real_inputendpoint.connections.filter(function(connection){return connection.source.component.volatile||connection.target.component.volatile;}).forEach(remove_connection);}};MashupPlatform.priv.InputEndpoint=InputEndpoint;var OutputEndpoint=function OutputEndpoint(real_endpoint,dynamic){privates.set(this,{dynamic:dynamic,real_endpoint:real_endpoint});Object.defineProperty(this,"connected",{get:outputendpoint_get_connected});};var outputendpoint_get_connected=function get_connected(){return privates.get(this).real_endpoint.outputList.length!==0;};OutputEndpoint.prototype.connect=function connect(inputendpoint){var real_inputendpoint,real_outputendpoint;if(inputendpoint==null|| !(inputendpoint instanceof InputEndpoint)){throw new TypeError("inputendpoint must be an input endpoint instance");}
real_inputendpoint=privates.get(inputendpoint).real_endpoint;real_outputendpoint=privates.get(this).real_endpoint;create_connection(real_outputendpoint,real_inputendpoint);};OutputEndpoint.prototype.disconnect=function disconnect(inputendpoint){var connection,index,real_inputendpoint,real_outputendpoint;if(inputendpoint!=null&&!(inputendpoint instanceof InputEndpoint)){throw new TypeError("inputendpoint must be null or an input endpoint instance");}
real_outputendpoint=privates.get(this).real_endpoint;if(inputendpoint!=null){real_inputendpoint=privates.get(inputendpoint).real_endpoint;index=real_outputendpoint.outputList.indexOf(real_inputendpoint);if(index!==-1){connection=real_outputendpoint.connections[index];remove_connection(connection);}}else{real_outputendpoint.connections.filter(function(connection){return connection.source.component.volatile||connection.target.component.volatile;}).forEach(remove_connection);}};OutputEndpoint.prototype.pushEvent=function pushEvent(data){privates.get(this).real_endpoint.propagate(data);};MashupPlatform.priv.OutputEndpoint=OutputEndpoint;var create_connection=function create_connection(output,input){var connection;if(output.component===input.component){throw new TypeError("connections between endpoints of the same component are not allowed");}
connection=workspaceview.model.wiring.createConnection(output,input,{commit:true});};var remove_connection=function remove_connection(connection){connection.remove();};var privates=new WeakMap();})(window.parent.Wirecloud,window.parent.Wirecloud.Utils);;(function(){"use strict";var platform,view,model,IWidgetVariable,endpoint_name,inputs,outputs;platform=window.parent;view=MashupPlatform.priv.workspaceview.findWidget(MashupPlatform.priv.id);model=view.model;MashupPlatform.priv.view=view;MashupPlatform.priv.resource=model;IWidgetVariable=function IWidgetVariable(variable){this.set=function set(value){variable.set(value);};this.get=function get(){return variable.get();};Object.freeze(this);};Object.defineProperty(window.MashupPlatform,'widget',{value:{}});Object.defineProperty(window.MashupPlatform.widget,'id',{value:MashupPlatform.priv.id});Object.defineProperty(window.MashupPlatform.widget,'getVariable',{value:function getVariable(name){var variable=model.properties[name];if(variable!=null){return new IWidgetVariable(variable);}}});Object.defineProperty(window.MashupPlatform.widget,'drawAttention',{value:function drawAttention(){view.workspace.drawAttention(model.id);}});Object.defineProperty(window.MashupPlatform.widget,'context',{value:{}});Object.defineProperty(window.MashupPlatform.widget,'log',{value:function log(msg,level){model.logManager.log(msg,level);}});Object.defineProperty(window.MashupPlatform.widget.context,'getAvailableContext',{value:function getAvailableContext(){return model.contextManager.getAvailableContext();}});Object.defineProperty(window.MashupPlatform.widget.context,'get',{value:function get(name){return model.contextManager.get(name);}});Object.defineProperty(window.MashupPlatform.widget.context,'registerCallback',{value:function registerCallback(callback){if(typeof callback!=="function"){throw new TypeError('callback must be a function');}
model.registerContextAPICallback('iwidget',callback);}});Object.preventExtensions(window.MashupPlatform.widget.context);inputs={};for(endpoint_name in model.inputs){inputs[endpoint_name]=new MashupPlatform.priv.InputEndpoint(model.inputs[endpoint_name],true);}
Object.defineProperty(window.MashupPlatform.widget,'inputs',{value:inputs});outputs={};for(endpoint_name in model.outputs){outputs[endpoint_name]=new MashupPlatform.priv.OutputEndpoint(model.outputs[endpoint_name],true);}
Object.defineProperty(window.MashupPlatform.widget,'outputs',{value:outputs});})();;(function(){"use strict";var platform=window.parent;var Wirecloud=platform.Wirecloud;var workspaceview=MashupPlatform.priv.workspaceview;var resource=MashupPlatform.priv.resource;var componentType=resource instanceof Wirecloud.Widget?"widget":"operator";var guibuilder=new platform.StyledElements.GUIBuilder();Object.defineProperty(window.MashupPlatform,'http',{value:{}});Object.defineProperty(window.MashupPlatform.http,'buildProxyURL',{value:Wirecloud.io.buildProxyURL});Object.defineProperty(window.MashupPlatform.http,'makeRequest',{value:function makeRequest(url,options){url=new platform.URL(url,window.location);if(!options.requestHeaders){options.requestHeaders={};}
options.requestHeaders["wirecloud-component-type"]=componentType;options.requestHeaders["wirecloud-component-id"]=resource.id;return Wirecloud.io.makeRequest(url,options);}});Object.preventExtensions(window.MashupPlatform.http);Object.defineProperty(window.MashupPlatform,'context',{value:{}});Object.defineProperty(window.MashupPlatform.context,'getAvailableContext',{value:function getAvailableContext(){return Wirecloud.contextManager.getAvailableContext();}});Object.defineProperty(window.MashupPlatform.context,'get',{value:function get(name){return Wirecloud.contextManager.get(name);}});Object.defineProperty(window.MashupPlatform.context,'registerCallback',{value:function registerCallback(callback){if(typeof callback!=="function"){throw new TypeError('callback must be a function');}
resource.registerContextAPICallback('platform',callback);}});Object.preventExtensions(window.MashupPlatform.context);Object.defineProperty(window.MashupPlatform,'log',{value:{ERROR:1,WARN:2,INFO:3}});Object.freeze(window.MashupPlatform.log);Object.defineProperty(window.MashupPlatform,'mashup',{value:{}});Object.defineProperty(window.MashupPlatform.mashup,'context',{value:{}});Object.defineProperty(window.MashupPlatform.mashup.context,'getAvailableContext',{value:function getAvailableContext(){return workspaceview.model.contextManager.getAvailableContext();}});Object.defineProperty(window.MashupPlatform.mashup.context,'get',{value:function get(name){return workspaceview.model.contextManager.get(name);}});Object.defineProperty(window.MashupPlatform.mashup.context,'registerCallback',{value:function registerCallback(callback){if(typeof callback!=="function"){throw new TypeError('callback must be a function');}
resource.registerContextAPICallback('mashup',callback);}});Object.preventExtensions(window.MashupPlatform.mashup.context);Object.defineProperty(window.MashupPlatform,'prefs',{value:{}});Object.defineProperty(window.MashupPlatform.prefs,'get',{value:function get(key){if(key in resource.meta.preferences){return resource.preferences[key].value;}else{var exception_msg=platform.interpolate('"%(pref)s" is not a valid preference name',{pref:key},true);throw new MashupPlatform.prefs.PreferenceDoesNotExistError(exception_msg);}}});Object.defineProperty(window.MashupPlatform.prefs,'registerCallback',{value:function registerCallback(callback){if(typeof callback!=="function"){throw new TypeError('callback must be a function');}
resource.registerPrefCallback(callback);}});Object.defineProperty(window.MashupPlatform.prefs,'set',{value:function set(key,value){if(key in resource.meta.preferences){resource.preferences[key].value=value;}else{var exception_msg=platform.interpolate('"%(pref)s" is not a valid preference name',{pref:key},true);throw new MashupPlatform.prefs.PreferenceDoesNotExistError(exception_msg);}}});Object.defineProperty(window.MashupPlatform.prefs,'PreferenceDoesNotExistError',{value:Wirecloud.PreferenceDoesNotExistError});Object.preventExtensions(window.MashupPlatform.prefs);Object.defineProperty(window.MashupPlatform,'wiring',{value:{}});Object.defineProperty(window.MashupPlatform.wiring,'registerCallback',{value:function registerCallback(inputName,callback){if(typeof callback!=="function"){throw new TypeError('callback must be a function');}
if(inputName in resource.inputs){resource.inputs[inputName].callback=callback;}else{var exception_msg=platform.interpolate('"%(endpoint)s" is not a valid input endpoint',{endpoint:inputName},true);throw new MashupPlatform.wiring.EndpointDoesNotExistError(exception_msg);}}});Object.defineProperty(window.MashupPlatform.wiring,'registerStatusCallback',{value:function registerCallback(callback){var wiring;if(typeof callback!=="function"){throw new TypeError('callback must be a function');}
if('wiring'in resource){wiring=resource.wiring;}else{wiring=resource.tab.workspace.wiring;}
wiring.addEventListener('load',callback);}});Object.defineProperty(window.MashupPlatform.wiring,'pushEvent',{value:function pushEvent(outputName,data,options){if(outputName in resource.outputs){resource.outputs[outputName].propagate(data,options);}else{var exception_msg=platform.interpolate('"%(endpoint)s" is not a valid output endpoint',{endpoint:outputName},true);throw new MashupPlatform.wiring.EndpointDoesNotExistError(exception_msg);}}});Object.defineProperty(window.MashupPlatform.wiring,'hasInputConnections',{value:function hasInputConnections(inputName){if(inputName in resource.inputs){return resource.inputs[inputName].inputs.length>0;}else{var exception_msg=platform.interpolate('"%(endpoint)s" is not a valid input endpoint',{endpoint:inputName},true);throw new MashupPlatform.wiring.EndpointDoesNotExistError(exception_msg);}}});Object.defineProperty(window.MashupPlatform.wiring,'hasOutputConnections',{value:function hasOutputConnections(outputName){if(outputName in resource.outputs){return resource.outputs[outputName].outputList.length>0;}else{var exception_msg=platform.interpolate('"%(endpoint)s" is not a valid output endpoint',{endpoint:outputName},true);throw new MashupPlatform.wiring.EndpointDoesNotExistError(exception_msg);}}});Object.defineProperty(window.MashupPlatform.wiring,'getReachableEndpoints',{value:function getReachableEndpoints(outputName){if(outputName in resource.outputs){return resource.outputs[outputName].getReachableEndpoints();}else{var exception_msg=platform.interpolate('"%(endpoint)s" is not a valid output endpoint',{endpoint:outputName},true);throw new MashupPlatform.wiring.EndpointDoesNotExistError(exception_msg);}}});Object.defineProperty(window.MashupPlatform.wiring,'EndpointDoesNotExistError',{value:Wirecloud.wiring.EndpointDoesNotExistError});Object.defineProperty(window.MashupPlatform.wiring,'EndpointTypeError',{value:Wirecloud.wiring.EndpointTypeError});Object.defineProperty(window.MashupPlatform.wiring,'EndpointValueError',{value:Wirecloud.wiring.EndpointValueError});Object.preventExtensions(window.MashupPlatform.wiring);window.onerror=function(message,url,line,column,error){var details;if(error){details=platform.gettext("<ul><li><b>File:</b> <t:file/></li><li><b>Line: </b><t:line/></li></ul><p>See the <a href=\"http://webmasters.stackexchange.com/questions/8525/how-to-open-the-javascript-console-in-different-browsers\" target=\"_blank\">browser console</a> for more details</p>");details=guibuilder.parse(guibuilder.DEFAULT_OPENING+details+guibuilder.DEFAULT_CLOSING,{file:url.replace(resource.meta.base_url,''),line:line});resource.logManager.log(message,{details:details,console:false});}};})();