;var Wirecloud={constants:{WORKSPACE_PREFERENCES:[{"description":"Allow any user to open this workspace (in read-only mode). (default: disabled)","defaultValue":false,"label":"Public","hidden":true,"type":"boolean","name":"public"},{"description":"List of users with access to this workspace. (default: [])","defaultValue":[],"label":"Share list","hidden":true,"type":"layout","name":"sharelist"},{"description":"Default layout for the new widgets.","defaultValue":"Fixed","label":"Default layout","type":"select","initialEntries":[{"value":"Fixed","label":"Base"},{"value":"Free","label":"Free"}],"name":"initiallayout"},{"defaultValue":{"verticalmargin":3,"smart":"false","horizontalmargin":4,"type":"columnlayout","columns":20,"cellheight":12},"type":"layout","name":"baselayout","label":"Base layout"}],FIWARE_PORTALS:[],FIWARE_HOME:"https://lab.fiware.org",AVAILABLE_LANGUAGES:[{"value":"af","label":"Afrikaans"},{"value":"ar","label":"Arabic"},{"value":"ast","label":"Asturian"},{"value":"az","label":"Azerbaijani"},{"value":"bg","label":"Bulgarian"},{"value":"be","label":"Belarusian"},{"value":"bn","label":"Bengali"},{"value":"br","label":"Breton"},{"value":"bs","label":"Bosnian"},{"value":"ca","label":"Catalan"},{"value":"cs","label":"Czech"},{"value":"cy","label":"Welsh"},{"value":"da","label":"Danish"},{"value":"de","label":"German"},{"value":"dsb","label":"Lower Sorbian"},{"value":"el","label":"Greek"},{"value":"en","label":"English"},{"value":"en-au","label":"Australian English"},{"value":"en-gb","label":"British English"},{"value":"eo","label":"Esperanto"},{"value":"es","label":"Spanish"},{"value":"es-ar","label":"Argentinian Spanish"},{"value":"es-co","label":"Colombian Spanish"},{"value":"es-mx","label":"Mexican Spanish"},{"value":"es-ni","label":"Nicaraguan Spanish"},{"value":"es-ve","label":"Venezuelan Spanish"},{"value":"et","label":"Estonian"},{"value":"eu","label":"Basque"},{"value":"fa","label":"Persian"},{"value":"fi","label":"Finnish"},{"value":"fr","label":"French"},{"value":"fy","label":"Frisian"},{"value":"ga","label":"Irish"},{"value":"gd","label":"Scottish Gaelic"},{"value":"gl","label":"Galician"},{"value":"he","label":"Hebrew"},{"value":"hi","label":"Hindi"},{"value":"hr","label":"Croatian"},{"value":"hsb","label":"Upper Sorbian"},{"value":"hu","label":"Hungarian"},{"value":"ia","label":"Interlingua"},{"value":"id","label":"Indonesian"},{"value":"io","label":"Ido"},{"value":"is","label":"Icelandic"},{"value":"it","label":"Italian"},{"value":"ja","label":"Japanese"},{"value":"ka","label":"Georgian"},{"value":"kk","label":"Kazakh"},{"value":"km","label":"Khmer"},{"value":"kn","label":"Kannada"},{"value":"ko","label":"Korean"},{"value":"lb","label":"Luxembourgish"},{"value":"lt","label":"Lithuanian"},{"value":"lv","label":"Latvian"},{"value":"mk","label":"Macedonian"},{"value":"ml","label":"Malayalam"},{"value":"mn","label":"Mongolian"},{"value":"mr","label":"Marathi"},{"value":"my","label":"Burmese"},{"value":"nb","label":"Norwegian Bokm\u00e5l"},{"value":"ne","label":"Nepali"},{"value":"nl","label":"Dutch"},{"value":"nn","label":"Norwegian Nynorsk"},{"value":"os","label":"Ossetic"},{"value":"pa","label":"Punjabi"},{"value":"pl","label":"Polish"},{"value":"pt","label":"Portuguese"},{"value":"pt-br","label":"Brazilian Portuguese"},{"value":"ro","label":"Romanian"},{"value":"ru","label":"Russian"},{"value":"sk","label":"Slovak"},{"value":"sl","label":"Slovenian"},{"value":"sq","label":"Albanian"},{"value":"sr","label":"Serbian"},{"value":"sr-latn","label":"Serbian Latin"},{"value":"sv","label":"Swedish"},{"value":"sw","label":"Swahili"},{"value":"ta","label":"Tamil"},{"value":"te","label":"Telugu"},{"value":"th","label":"Thai"},{"value":"tr","label":"Turkish"},{"value":"tt","label":"Tatar"},{"value":"udm","label":"Udmurt"},{"value":"uk","label":"Ukrainian"},{"value":"ur","label":"Urdu"},{"value":"vi","label":"Vietnamese"},{"value":"zh-hans","label":"Simplified Chinese"},{"value":"zh-hant","label":"Traditional Chinese"}],TAB_PREFERENCES:[{"description":"List of users with access to this workspace. (default: [])","inheritByDefault":true,"defaultValue":[],"label":"Share list","inheritable":true,"hidden":true,"type":"layout","name":"sharelist"},{"description":"Default layout for the new widgets.","inheritByDefault":true,"defaultValue":"Fixed","label":"Default layout","inheritable":true,"type":"select","initialEntries":[{"value":"Fixed","label":"Base"},{"value":"Free","label":"Free"}],"name":"initiallayout"},{"name":"baselayout","inheritByDefault":true,"defaultValue":{"verticalmargin":3,"smart":"false","horizontalmargin":4,"type":"columnlayout","columns":20,"cellheight":12},"label":"Base layout","inheritable":true,"type":"layout"}],CURRENT_MODE:"classic",CURRENT_THEME:"wirecloud.defaulttheme",AVAILABLE_THEMES:[{"value":"wirecloud.defaulttheme","label":"Basic"},{"value":"wirecloud.fiwaretheme","label":"FIWARE Basic"},{"value":"wirecloud.fiwarelabtheme","label":"FIWARE Lab"},{"value":"wirecloud.fiwarelabdarktheme","label":"FIWARE Lab Dark"}]},location:{'domain':document.location.protocol+'//'+document.location.host,'host':document.location.host,'protocol':document.location.protocol.substr(0,document.location.protocol.length-1)},ui:{}};;if(window.StyledElements==null){window.StyledElements={};}
(function(){"use strict";var Utils={};Utils.gettext=function gettext(text){return text;};Utils.ngettext=function ngettext(singular,plural,count){return(count===1)?singular:plural;};Utils.interpolate=function interpolate(pattern,attributes){return pattern.replace(/%\(\w+\)s/g,function(match){return String(attributes[match.slice(2,-2)]);});};Utils.Template=function Template(template){this.template=template;};Utils.Template.prototype.evaluate=function evaluate(context){return Utils.interpolate(this.template,context);};Utils.stopPropagationListener=function stopPropagationListener(e){e.stopPropagation();};Utils.preventDefaultListener=function preventDefaultListener(e){e.preventDefault();};Utils.callCallback=function callCallback(callback,var_args){if(typeof callback==='function'){try{return callback.apply(null,Array.prototype.slice.call(arguments,1));}catch(error){}}};Utils.getFullscreenElement=function getFullscreenElement(){if('fullscreenElement'in document){return document.fullscreenElement;}else if('msFullscreenElement'in document){return document.msFullscreenElement;}else if('mozFullScreenElement'in document){return document.mozFullScreenElement;}else if('webkitFullscreenElement'in document){return document.webkitFullscreenElement;}};Utils.onFullscreenChange=function onFullscreenChange(element,callback){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
element.ownerDocument.addEventListener('fullscreenchange',callback,true);element.ownerDocument.addEventListener('msfullscreenchange',callback,true);element.ownerDocument.addEventListener('mozfullscreenchange',callback,true);element.ownerDocument.addEventListener('webkitfullscreenchange',callback,true);};Utils.removeFullscreenChangeCallback=function removeFullscreenChangeCallback(element,callback){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
element.ownerDocument.removeEventListener('fullscreenchange',callback,true);element.ownerDocument.removeEventListener('msfullscreenchange',callback,true);element.ownerDocument.removeEventListener('mozfullscreenchange',callback,true);element.ownerDocument.removeEventListener('webkitfullscreenchange',callback,true);};Utils.isFullscreenSupported=function isFullscreenSupported(){if('fullscreenEnabled'in document){return document.fullscreenEnabled;}else if('mozFullScreenEnabled'in document){return document.mozFullScreenEnabled;}else if('webkitFullscreenEnabled'in document){return document.webkitFullscreenEnabled;}};Utils.removeWord=function removeWord(text,word){return text.replace(new RegExp("(^\\s*|\\s+)"+word+"(\\s+|\\s*$)","g")," ").trim();};Utils.appendWord=function appendWord(text,word){return Utils.removeWord(text,word)+(" "+word);};Utils.prependWord=function prependWord(text,word){return word+" "+Utils.removeWord(text,word);};Utils.escapeRegExp=function escapeRegExp(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");};var tmp_div=document.createElement('div');Utils.escapeHTML=function escapeHTML(text){tmp_div.textContent=text;return tmp_div.innerHTML;};Utils.getRelativePosition=function getRelativePosition(element1,element2){if(element1===element2){return{x:0,y:0};}
var element1_rect=element1.getBoundingClientRect();var element2_rect=element2.getBoundingClientRect();return{x:element1_rect.left-element2_rect.left,y:element1_rect.top-element2_rect.top};};Utils.clone=function clone(object,deep){var result,key;if(object==null||typeof object!=='object'){return object;}else if(Array.isArray(object)){result=[];}else{result={};}
if(deep){for(key in object){result[key]=Utils.clone(object[key],true);}}else{for(key in object){result[key]=object[key];}}
return result;};Utils.cloneObject=function cloneObject(source){var target={};if(source==null){return target;}
if(!Utils.isPlainObject(source)){throw new TypeError("[error description]");}
for(var name in source){target[name]=cloneProp.call(Utils,source[name]);}
return target;};var cloneProp=function cloneProp(sourceValue){if(sourceValue==null){return null;}
if(Utils.isPlainObject(sourceValue)){return this.cloneObject(sourceValue);}
if(Array.isArray(sourceValue)){return sourceValue.slice();}
return sourceValue;};Utils.hasFocus=function hasFocus(element){return document.activeElement===element;};Utils.updateObject=function updateObject(target,source){target=Utils.cloneObject(target);source=Utils.cloneObject(source);for(var name in source){target[name]=updateProp.call(Utils,target[name],source[name]);}
return target;};Utils.isPlainObject=function isPlainObject(source){if(typeof source!=='object'||source===null){return false;}
if(source.constructor&&!Object.hasOwnProperty.call(source.constructor.prototype,'isPrototypeOf')){return false;}
return true;};var isSubClass=function isSubClass(superClass,childClass){var c1,c2,found=false;if(typeof superClass!=='function'||typeof childClass!=='function'){return found;}
c1=superClass.prototype;c2=childClass.prototype;while(!(found=(c1===c2))){c2=Object.getPrototypeOf(c2);if(c2===null||(c2===Object.prototype&&c1!==c2)){break;}}
return found;};var equalsClass=function equalsClass(target,source){return target.constructor===source.constructor;};var updateProp=function updateProp(targetValue,sourceValue){if(sourceValue==null){if(targetValue==null){targetValue=null;}}else if(typeof sourceValue==='function'){if(targetValue==null||isSubClass(targetValue,sourceValue)){targetValue=sourceValue;}}else if(Utils.isPlainObject(sourceValue)){if(targetValue==null||Utils.isPlainObject(targetValue)){targetValue=this.updateObject(targetValue,sourceValue);}}else if(Array.isArray(sourceValue)){if(targetValue==null){targetValue=[];}
if(Array.isArray(targetValue)){targetValue=targetValue.concat(sourceValue);}}else{if(targetValue==null||equalsClass(targetValue,sourceValue)){targetValue=sourceValue;}}
return targetValue;};Utils.inherit=function inherit(child,parent,members){child.prototype=Object.create(parent.prototype);child.prototype.constructor=child;Utils.merge(child.prototype,members);};Utils.highlight=function highlight(text,substring){return text.replace(new RegExp(substring,'i'),function(match){return'<strong class="text-highlighted">'+match+'</strong>';});};Utils.capitalize=function capitalize(text){return text.charAt(0).toUpperCase()+text.substring(1);};var SIZE_UNITS=['bytes','KiB','MiB','GiB','TiB'];Object.freeze(SIZE_UNITS);Utils.formatSize=function formatSize(size){if(size==null){return Utils.gettext('N/A');}
for(var i=0;i<SIZE_UNITS.length;i++){if(size<1024){break;}
size=size/1024;}
size=Math.round(size*100)/100;return size+' '+SIZE_UNITS[i];};var keyCodeMap={8:'Backspace',9:'Tab',13:'Enter',27:'Escape',32:' ',37:'ArrowLeft',38:'ArrowUp',39:'ArrowRight',40:'ArrowDown',46:'Delete',65:'a',66:'b',67:'c',68:'d',69:'e',70:'f',71:'g',72:'h',73:'i',74:'j',75:'k',76:'l',77:'m',78:'n',79:'o',80:'p',81:'q',82:'r',83:'s',84:'t',85:'u',86:'v',87:'w',88:'x',89:'y',90:'z'};var keyFixes={'Left':'ArrowLeft','Right':'ArrowRight','Up':'ArrowUp','Down':'ArrowDown','Spacebar':' '};Utils.extractModifiers=function extractModifiers(event){return{altKey:event.altKey,ctrlKey:event.ctrlKey,metaKey:event.metaKey,shiftKey:event.shiftKey};};var propagate_keys=['Escape','Enter'];Utils.stopInputKeydownPropagationListener=function stopInputKeydownPropagationListener(event){var modifiers,key;modifiers=Utils.extractModifiers(event);key=Utils.normalizeKey(event);if((!modifiers.altKey&&!modifiers.metaKey&&!modifiers.ctrlKey&&propagate_keys.indexOf(key)===-1)||key==='Backspace'){event.stopPropagation();}};Utils.normalizeKey=function normalizeKey(event){var key;key=event.key;if(event.altKey===false&&key){if(key in keyFixes){key=keyFixes[key];}}else{key='Unidentified';if(event.keyCode in keyCodeMap){key=keyCodeMap[event.keyCode];}}
return key;};Utils.isElement=function isElement(value){return value!=null&&typeof value==='object'&&'ownerDocument'in value&&value instanceof value.ownerDocument.defaultView.HTMLElement;};Utils.appendChild=function appendChild(parentElement,newElement,refElement){var parentNode=getNode(parentElement);var refNode=getLastNode(refElement);if(refNode!=null){refNode=refNode.nextSibling;}
if(typeof newElement==='string'){newElement=document.createTextNode(newElement);}
return getNodes(newElement).map(function(childElement){parentNode.insertBefore(getNode(childElement),refNode);if(parentElement instanceof StyledElements.StyledElement&&childElement instanceof StyledElements.StyledElement){childElement.parentElement=parentElement;}
return childElement;});};Utils.prependChild=function prependChild(parentElement,newElement,refElement){var parentNode=getNode(parentElement);var refNode=getFirstNode(refElement);if(typeof newElement==='string'){newElement=document.createTextNode(newElement);}
return getNodes(newElement).map(function(childElement){parentNode.insertBefore(getNode(childElement),refNode==null?parentNode.firstChild:refNode);if(parentElement instanceof StyledElements.StyledElement&&childElement instanceof StyledElements.StyledElement){childElement.parentElement=parentElement;}
return childElement;});};Utils.removeChild=function removeChild(parentElement,childElement){getNode(parentElement).removeChild(getNode(childElement));if(parentElement instanceof StyledElements.StyledElement&&childElement instanceof StyledElements.StyledElement){childElement.parentElement=null;}};var getNode=function getNode(value){return value instanceof StyledElements.StyledElement?value.get():value;};var getFirstNode=function getFirstNode(value){if(value instanceof StyledElements.Fragment){return value.elements[0];}else{return value instanceof StyledElements.StyledElement?value.get():value;}};var getLastNode=function getLastNode(value){if(value instanceof StyledElements.Fragment){return value.elements[value.elements.length-1];}else{return value instanceof StyledElements.StyledElement?value.get():value;}};var getNodes=function getNodes(value){return(value instanceof StyledElements.StyledElement&&value.get()==null)?value.children:[value];};Utils.isEmpty=function isEmpty(value){return value==null||Object.keys(value).length===0;};Utils.merge=function merge(object){if(object==null||typeof object!=="object"){throw new TypeError("object argument must be an object");}
Array.prototype.slice.call(arguments,1).forEach(function(source){if(source!=null){Object.keys(source).forEach(function(key){object[key]=source[key];});}});return object;};Utils.update=function update(object){if(object==null||typeof object!=="object"){throw new TypeError("object argument must be an object");}
Array.prototype.slice.call(arguments,1).forEach(function(source){if(source!=null){Object.keys(source).forEach(function(key){if(key in object){object[key]=source[key];}});}});return object;};Utils.values=function values(object){var values=[];for(var key in object){values.push(object[key]);}
return values;};Utils.waitTransition=function waitTransition(element){return new Promise(function(fulfill){var listener=function listener(event){element.removeEventListener('transitionend',listener);fulfill();};element.addEventListener('transitionend',listener);});};StyledElements.Utils=Utils;})();;Wirecloud.Utils=StyledElements.Utils;Wirecloud.Utils.gettext=gettext;Wirecloud.Utils.ngettext=ngettext;;Wirecloud.URLs={"IWIDGET_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidgets'),"IWIDGET_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s'),"IWIDGET_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/preferences'),"IWIDGET_PROPERTIES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/properties'),"LOCAL_REPOSITORY":'/',"LOCAL_RESOURCE_COLLECTION":'/api/resources',"LOCAL_RESOURCE_ENTRY":new Wirecloud.Utils.Template('/api/resource/%(vendor)s/%(name)s/%(version)s'),"LOCAL_UNVERSIONED_RESOURCE_ENTRY":new Wirecloud.Utils.Template('/api/resource/%(vendor)s/%(name)s'),"LOGIN_VIEW":'/login',"LOGOUT_VIEW":'/logout',"MAC_BASE_URL":new Wirecloud.Utils.Template('/showcase/media/%(vendor)s/%(name)s/%(version)s/%(file_path)s'),"MARKET_COLLECTION":'/api/markets',"MARKET_ENTRY":new Wirecloud.Utils.Template('/api/market/%(user)s/%(market)s'),"MISSING_WIDGET_CODE_ENTRY":'/api/widget/missing_widget',"OPERATOR_ENTRY":new Wirecloud.Utils.Template('/api/operator/%(vendor)s/%(name)s/%(version)s/html'),"PLATFORM_CONTEXT_COLLECTION":'/api/context',"PLATFORM_PREFERENCES":'/api/preferences/platform',"PROXY":new Wirecloud.Utils.Template('/cdp/%(protocol)s/%(domain)s%(path)s'),"PUBLISH_ON_OTHER_MARKETPLACE":'/api/markets/publish',"ROOT_URL":'/',"SEARCH_SERVICE":'/api/search',"SWITCH_USER_SERVICE":'/api/admin/switchuser',"TAB_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tabs'),"TAB_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s'),"TAB_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/preferences'),"THEME_ENTRY":new Wirecloud.Utils.Template('/api/theme/%(name)s'),"WIRING_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/wiring'),"OPERATOR_VARIABLES_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/operators/%(operator_id)s/variables'),"WORKSPACE_COLLECTION":'/api/workspaces',"WORKSPACE_ENTRY_OWNER_NAME":new Wirecloud.Utils.Template('/api/workspace/%(owner)s/%(name)s'),"WORKSPACE_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s'),"WORKSPACE_MERGE":new Wirecloud.Utils.Template('/api/workspace/%(to_ws_id)s/merge'),"WORKSPACE_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/preferences'),"WORKSPACE_PUBLISH":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/publish'),"WORKSPACE_RESOURCE_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/resources'),"WORKSPACE_VIEW":new Wirecloud.Utils.Template('/%(owner)s/%(name)s'),"DJANGO_ADMIN":'/admin/',"FIWARE_RESOURCES_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/resources'),"FIWARE_OFFERING_ENTRY":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/%(store)s/offering/%(offering_id)s'),"FIWARE_FULL_SEARCH":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/search/%(search_string)s'),"FIWARE_STORE_RESOURCES_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/%(store)s/resources'),"FIWARE_STORE_SEARCH":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/search/%(store)s/%(search_string)s'),"FIWARE_STORE_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/stores'),"FIWARE_STORE_START_PURCHASE":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/store/%(store)s/start_purchase'),};Wirecloud.location.base=Wirecloud.location.domain+Wirecloud.URLs.ROOT_URL;;if(!String.prototype.startsWith){String.prototype.startsWith=function startsWith(searchString,position){position=position||0;return this.substr(position,searchString.length)===searchString;};}
if(!String.prototype.endsWith){String.prototype.endsWith=function endsWith(searchString,position){var subjectString=this.toString();if(typeof position!=='number'||!isFinite(position)||Math.floor(position)!==position||position>subjectString.length){position=subjectString.length;}
position-=searchString.length;var lastIndex=subjectString.indexOf(searchString,position);return lastIndex!==-1&&lastIndex===position;};};(function(view){"use strict";if(!('SVGElement'in view)){return;}
var svg_element=document.createElementNS("http://www.w3.org/2000/svg","svg:path");if('classList'in svg_element){return;}
var DOMEx=function(type,message){this.name=type;this.code=DOMException[type];this.message=message;};DOMEx.prototype=Error.prototype;var checkTokenAndGetIndex=function checkTokenAndGetIndex(classList,token){if(token===""){throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");}
if(/\s/.test(token)){throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");}
return classList.indexOf(token);};var ClassList=function ClassList(elem){var trimmedClasses=(elem.getAttribute("class")||"").trim(),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0;for(;i<classes.length;i++){this.push(classes[i]);}
this._updateClassName=function(){elem.setAttribute("class",this.toString());};};ClassList.prototype=[];ClassList.prototype.item=function item(i){return this[i]||null;};ClassList.prototype.contains=function contains(token){token+="";return checkTokenAndGetIndex(this,token)!==-1;};ClassList.prototype.add=function add(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";if(checkTokenAndGetIndex(this,token)===-1){this.push(token);updated=true;}}while(++i<l);if(updated){this._updateClassName();}};ClassList.prototype.remove=function remove(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";var index=checkTokenAndGetIndex(this,token);if(index!==-1){this.splice(index,1);updated=true;}}while(++i<l);if(updated){this._updateClassName();}};ClassList.prototype.toggle=function toggle(token,force){token+="";var result=this.contains(token),method=result?force!==true&&"remove":force!==false&&"add";if(method){this[method](token);}
return!result;};ClassList.prototype.toString=function toString(){return this.join(" ");};var classListGetter=function(){return new ClassList(this);};Object.defineProperty(view.SVGElement.prototype,"classList",{get:classListGetter});})(window);;(function(){"use strict";var check_basic_requirements=function check_basic_requirements(){var tester={};if(!('addEventListener'in document.documentElement)){throw new Error('Missing basic DOM event support');}
if(!('JSON'in window)){throw new Error('Missing JSON support');}
if(!('freeze'in Object)){throw new Error('Missing Object.freeze support');}
if(!('create'in Object)){throw new Error('Missing Object.create support');}
if(!('defineProperty'in Object)){throw new Error('Missing Object.defineProperty support');}
try{tester={};Object.defineProperty(tester,'property',{});}catch(e){throw new Error('Missing proper Object.defineProperty support');}
if(!('defineProperties'in Object)){throw new Error('Missing Object.defineProperties support');}
if(!('defineProperties'in Object)){throw new Error('Missing Object.defineProperties support');}
if(!('classList'in document.documentElement)){throw new Error('Missing Element.classList support');}
if(window.history==null||typeof window.history.pushState!=='function'||typeof window.history.replaceState!=='function'){throw new Error("Missing HTML5's history API support");}
if(!('pointerEvents'in document.documentElement.style)){throw new Error('Missing pointer-events support for HTML elements');}
if(!('Promise'in window)){throw new Error('Missing Promise support');}
if(!('WeakMap'in window)){throw new Error('Missing WeakMap support');}
try{eval("var bar = (x) => x+1");}catch(e){throw new Error('Missing arrow functions support');}};Wirecloud.check_basic_requirements=check_basic_requirements;})();;(function(window){"use strict";var _internalGetCurrentStyle,cssProperties=[];var useInternalComputedStyle=typeof window.getComputedStyle==="undefined";if(!useInternalComputedStyle){try{var computedStyle,width;computedStyle=document.defaultView.getComputedStyle(document.documentElement,null);width=computedStyle.getPropertyCSSValue('width');width=width.getFloatValue(width.CSS_PX);}catch(e){useInternalComputedStyle=true;cssProperties=computedStyle;var _nativeGetComputedStyle=document.defaultView.getComputedStyle;_internalGetCurrentStyle=function _internalGetCurrentStyle(element,property,ieProperty){var computedStyle=_nativeGetComputedStyle.call(document.defaultView,element,null);return computedStyle.getPropertyValue(property);};}}else{_internalGetCurrentStyle=function _internalGetCurrentStyle(element,property,ieProperty){var value=element.currentStyle[ieProperty];if(value==='auto'){value=element.runtimeStyle[ieProperty];}
return value;};}
if(useInternalComputedStyle){var CSSPrimitiveValue=function CSSPrimitiveValue(element,property,ieProperty){if(arguments.length===0){return;}
this._element=element;this._property=property;this._ieProperty=ieProperty;this.cssText=_internalGetCurrentStyle(this._element,this._property,this._ieProperty);};CSSPrimitiveValue.CSS_PX=1;var _ValueRegExp=new RegExp('(\\d+|\\d+.\\d+)(\\w+)');CSSPrimitiveValue.prototype.getFloatValue=function getFloatValue(unit){var result;if(unit===CSSPrimitiveValue.CSS_PX){if(this.cssText===""){return 0;}
var parentNode=this._element.parentNode;var testElement=this._element.ownerDocument.createElement('div');testElement.style.visibility="hidden";testElement.style.padding="0";testElement.style.margin="0";testElement.style.border="0";var matching=/border-(top|right|bottom|left)-width/.exec(this._property);var side=matching!==null?matching[1]:null;matching=_ValueRegExp.exec(this.cssText);if(matching!=null){var value=matching[1];var units=matching[2];if(units=="px"){return parseInt(value,10);}else{testElement.style.height=this.cssText;}}else if((matching==null)&&(side!=null)){var property='border-'+side+'-style';var ieProperty=ComputedCSSStyleDeclaration.prototype._getIEProperty(property);var borderStyle=_internalGetCurrentStyle(this._element,property,ieProperty);if(borderStyle==="none"){return 0;}
var extraElement=this._element.ownerDocument.createElement('div');testElement.style.fontSize="0";testElement.style.lineHeight="0";extraElement.style.padding="0";extraElement.style.margin="0";extraElement.style.border="0";extraElement.style.width="1px";extraElement.style.borderTopWidth=this.cssText;extraElement.style.borderTopStyle=borderStyle;testElement.appendChild(extraElement);}else{throw new Error();}
parentNode.appendChild(testElement);if(testElement.offsetHeight!=null){result=testElement.offsetHeight;}else{throw new Error();}
parentNode.removeChild(testElement);return result;}else{throw new Error();}};var _rgbaColorParser=new RegExp('rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)');var _rgbColorParser=new RegExp('rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)');var _hexColorParser=new RegExp('#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})','i');var hex2value=function hex2value(hex){hex=hex.toUpperCase();return("0123456789ABCDEF".indexOf(hex.substr(0,1))*16)+"0123456789ABCDEF".indexOf(hex.substr(1,1));};CSSPrimitiveValue.prototype.getRGBColorValue=function getRGBColorValue(){switch(this._property){case'background-color':case'color':var red,green,blue,alpha='1';var matching=_rgbColorParser.exec(this.cssText);if(matching!==null){red=matching[1];green=matching[2];blue=matching[3];}else{matching=_rgbaColorParser.exec(this.cssText);if(matching!==null){red=matching[1];green=matching[2];blue=matching[3];alpha=matching[4];}else{matching=_hexColorParser.exec(this.cssText);if(matching===null){var parentNode=this._element.parentNode;var testElement=this._element.ownerDocument.createElement('table');testElement.setAttribute('bgcolor',this.cssText);testElement.style.visibility="hidden";parentNode.appendChild(testElement);var bgColor=testElement.bgColor;matching=_hexColorParser.exec(bgColor);if(matching===null){throw new Error('Error on getRGBColorValue');}
parentNode.removeChild(testElement);}
red=hex2value(matching[1]);green=hex2value(matching[2]);blue=hex2value(matching[3]);}}
return{red:new CSSColorComponentValue(red),green:new CSSColorComponentValue(green),blue:new CSSColorComponentValue(blue),alpha:new CSSColorComponentValue(alpha)};default:throw new Error();}};var CSSColorComponentValue=function CSSColorComponentValue(value){this.cssText=""+value;};CSSColorComponentValue.prototype=new CSSPrimitiveValue();CSSColorComponentValue.prototype.getFloatValue=function getFloatValue(unit){return parseInt(this.cssText,10);};var ComputedCSSStyleDeclaration=function ComputedCSSStyleDeclaration(element){this._element=element;};if(Object.defineProperty){var _defProp=function(object,property){Object.defineProperty(object,property,{get:function(){return this.getPropertyValue(property);},enumerable:true,configurable:false});};var i;for(i=0;i<cssProperties.length;i+=1){_defProp(ComputedCSSStyleDeclaration.prototype,cssProperties[i]);}}
ComputedCSSStyleDeclaration.prototype._getIEProperty=function _getIEProperty(property){if(property==='float'){return"styleFloat";}else{return property.replace(/-\w/g,function(a){return a.substr(1,1).toUpperCase();});}};ComputedCSSStyleDeclaration.prototype.getPropertyCSSValue=function getPropertyCSSValue(property){return new CSSPrimitiveValue(this._element,property,this._getIEProperty(property));};ComputedCSSStyleDeclaration.prototype.getPropertyValue=function getPropertyValue(property){return _internalGetCurrentStyle(this._element,property,this._getIEProperty(property));};window.CSSPrimitiveValue=CSSPrimitiveValue;window.CSSColorComponentValue=CSSColorComponentValue;window.getComputedStyle=function getComputedStyle(element,context){if(element==null){throw new Error('Operation is not supported');}
return new ComputedCSSStyleDeclaration(element);};if(window.document.defaultView===undefined){window.document.defaultView=window;}}})(window);;(function(utils){"use strict";Wirecloud.constants.LOGGING={ERROR_MSG:1,WARN_MSG:2,INFO_MSG:3,DEBUG_MSG:4};Wirecloud.constants.HTTP_STATUS_DESCRIPTIONS={"0":utils.gettext("Connection Refused"),"400":utils.gettext("Bad Request"),"401":utils.gettext("Unauthorized"),"402":utils.gettext("Payment Required"),"403":utils.gettext("Forbidden"),"404":utils.gettext("Not Found"),"405":utils.gettext("Method Not Allowed"),"406":utils.gettext("Not Acceptable"),"407":utils.gettext("Proxy Authentication Required"),"408":utils.gettext("Request Timeout"),"409":utils.gettext("Conflict"),"410":utils.gettext("Gone"),"411":utils.gettext("Length Required"),"412":utils.gettext("Precondition Failed"),"413":utils.gettext("Request Entity Too Large"),"414":utils.gettext("Request-URI Too Long"),"415":utils.gettext("Unsupported Media Type"),"416":utils.gettext("Requested Range Not Satisfiable"),"417":utils.gettext("Expectation Failed"),"422":utils.gettext("Unprocessable Entity"),"423":utils.gettext("Locked"),"424":utils.gettext("Failed Dependency"),"426":utils.gettext("Upgrade Required"),"500":utils.gettext("Internal Server Error"),"501":utils.gettext("Not Implemented"),"502":utils.gettext("Bad Gateway"),"503":utils.gettext("Service Unavailable"),"504":utils.gettext("Gateway Timeout"),"505":utils.gettext("HTTP Version Not Supported"),"506":utils.gettext("Variant Also Negotiates"),"507":utils.gettext("Insufficient Storage"),"508":utils.gettext("Loop Detected"),"510":utils.gettext("Not Extended")};Wirecloud.constants.UNKNOWN_STATUS_CODE_DESCRIPTION=utils.gettext("Unknown status code");})(Wirecloud.Utils);;(function(se,utils){"use strict";var Event=function Event(context){Object.defineProperties(this,{context:{value:context},handlers:{value:[]}});map.set(this,{dispatching:false});};Event.prototype.addEventListener=function addEventListener(handler){if(typeof handler!=='function'){throw new TypeError('Handlers must be functions');}
this.handlers.push(handler);};Event.prototype.removeEventListener=function removeEventListener(handler){var i;if(typeof handler!=='function'){throw new TypeError('Handlers must be functions');}
for(i=this.handlers.length-1;i>=0;i--){if(this.handlers[i]===handler){if(map.get(this).dispatching){this.handlers[i]=null;}else{this.handlers.splice(i,1);}}}};Event.prototype.clearEventListeners=function clearEventListeners(){if(map.get(this).dispatching){this.handlers.forEach(function(callback,index,array){array[index]=null;});}else{this.handlers.length=0;}};Event.prototype.dispatch=function dispatch(){var i;map.get(this).dispatching=true;for(i=0;i<this.handlers.length;i++){if(this.handlers[i]==null){continue;}
try{this.handlers[i].apply(this.context,arguments);}catch(e){if(window.console!=null&&typeof window.console.error==='function') {window.console.error(e);}}}
for(i=this.handlers.length-1;i>=0;i--){if(this.handlers[i]==null){this.handlers.splice(i,1);}}
map.get(this).dispatching=false;};var map=new WeakMap();StyledElements.Event=Event;})(StyledElements,StyledElements.Utils);;(function(se,utils){"use strict";se.ObjectWithEvents=function ObjectWithEvents(names){this.events={};(Array.isArray(names)?names:[]).forEach(function(name){this.events[name]=new se.Event(this);},this);};se.ObjectWithEvents.prototype={dispatchEvent:function dispatchEvent(name){var handlerArgs;if(!(name in this.events)){throw new Error(utils.interpolate("Unhandled event '%(name)s'",{name:name}));}
handlerArgs=[this].concat(Array.prototype.slice.call(arguments,1));this.events[name].dispatch.apply(this.events[name],handlerArgs);return this;},addEventListener:function addEventListener(name,handler){if(!(name in this.events)){throw new Error(utils.interpolate("Unhandled event '%(name)s'",{name:name}));}
this.events[name].addEventListener(handler);return this;},clearEventListeners:function clearEventListeners(name){if(typeof name!=='string'){for(name in this.events){this.events[name].clearEventListeners();}
return this;}
if(!(name in this.events)){throw new Error(utils.interpolate("Unhandled event '%(name)s'",{name:name}));}
this.events[name].clearEventListeners();return this;},destroy:function destroy(){this.events=null;return this;},removeEventListener:function removeEventListener(name,handler){if(!(name in this.events)){throw new Error(utils.interpolate("Unhandled event '%(name)s'",{name:name}));}
this.events[name].removeEventListener(handler);return this;}};se.ObjectWithEvents.prototype.on=se.ObjectWithEvents.prototype.addEventListener;se.ObjectWithEvents.prototype.off=se.ObjectWithEvents.prototype.removeEventListener;})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var preferencesChanged=function preferencesChanged(preferences,modifiedValues){if('language'in modifiedValues){window.location.reload();}};Object.defineProperty(Wirecloud,'events',{value:{'contextloaded':new StyledElements.Event(Wirecloud),'loaded':new StyledElements.Event(Wirecloud),'activeworkspacechanged':new StyledElements.Event(Wirecloud),'viewcontextchanged':new StyledElements.Event(Wirecloud),'unload':new StyledElements.Event(Wirecloud)}});Object.freeze(Wirecloud.events);Wirecloud.addEventListener=StyledElements.ObjectWithEvents.prototype.addEventListener;Wirecloud.dispatchEvent=StyledElements.ObjectWithEvents.prototype.dispatchEvent;var onCreateWorkspaceSuccess=function onCreateWorkspaceSuccess(response){var workspace=null;if([201,401,403,409,422,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if(response.status===422){try{var error=JSON.parse(response.responseText);}catch(e){return Promise.reject(e);}
return Promise.reject(error);}else if([401,403,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
workspace=JSON.parse(response.responseText);cache_workspace(workspace);return Promise.resolve(workspace);};Wirecloud.init=function init(options){this.workspaceInstances={};this.workspacesByUserAndName={};options=utils.merge({'preventDefault':false},options);Wirecloud.UserInterfaceManager.init();if(options.preventDefault!==true){window.addEventListener("beforeunload",()=>{Wirecloud.UserInterfaceManager.monitorTask(new Wirecloud.Task(gettext('Unloading WireCloud'),()=>{}));Wirecloud.dispatchEvent('unload');},true);}
var contextTask=Wirecloud.io.makeRequest(Wirecloud.URLs.PLATFORM_CONTEXT_COLLECTION,{method:'GET',parameters:{theme:Wirecloud.constants.CURRENT_THEME},requestHeaders:{'Accept':'application/json'}}).then((response)=>{var context_info=JSON.parse(response.responseText);Wirecloud.constants.WORKSPACE_CONTEXT=context_info.workspace;Object.freeze(Wirecloud.constants.WORKSPACE_CONTEXT);Wirecloud.contextManager=new Wirecloud.ContextManager(Wirecloud,context_info.platform);Wirecloud.contextManager.modify({'mode':Wirecloud.constants.CURRENT_MODE});moment.locale(Wirecloud.contextManager.get('language'));return Promise.resolve();}).toTask("Retrieving context information");var themeTask=contextTask.then(()=>{var url=Wirecloud.URLs.THEME_ENTRY.evaluate({name:Wirecloud.contextManager.get('theme')})+"?v="+Wirecloud.contextManager.get('version_hash');return Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'}}).then((response)=>{Wirecloud.currentTheme=new Wirecloud.ui.Theme(JSON.parse(response.responseText));Wirecloud.dispatchEvent('contextloaded');return Promise.resolve();});});var localCatalogueTask=contextTask.then(()=>{return Wirecloud.LocalCatalogue.reload();});var preferencesTask=Wirecloud.io.makeRequest(Wirecloud.URLs.PLATFORM_PREFERENCES,{method:'GET',requestHeaders:{'Accept':'application/json'}}).then((response)=>{var url,values=JSON.parse(response.responseText);Wirecloud.preferences=Wirecloud.PreferenceManager.buildPreferences('platform',values);Wirecloud.preferences.addEventListener('post-commit',preferencesChanged.bind(this));if('WEBSOCKET'in Wirecloud.URLs){url=new URL(Wirecloud.URLs.WEBSOCKET,document.location);url.protocol=url.protocol==='https:'?'wss:':'ws:';var livews=new WebSocket(url);livews.addEventListener('message',function(event){var msg=JSON.parse(event.data);Wirecloud.live.dispatchEvent(msg.category,msg);});var LiveManager=function LiveManager(){StyledElements.ObjectWithEvents.call(this,["workspace","component"]);};utils.inherit(LiveManager,StyledElements.ObjectWithEvents);Wirecloud.live=new LiveManager();}
return Promise.resolve();});var workspaceListTask=Wirecloud.io.makeRequest(Wirecloud.URLs.WORKSPACE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'}}).then((response)=>{var workspaces=JSON.parse(response.responseText);workspaces.forEach(cache_workspace);return Promise.resolve();});var initTask=new Wirecloud.Task(gettext('Retrieving WireCloud code'),function(resolve){resolve();}).then(()=>{return new Wirecloud.Task(gettext('Retrieving initial data'),[themeTask,localCatalogueTask,preferencesTask,workspaceListTask]);});if(options.preventDefault!==true){initTask=initTask.then(()=>{Wirecloud.HistoryManager.init();var state=Wirecloud.HistoryManager.getCurrentState();Wirecloud.UserInterfaceManager.changeCurrentView('workspace',true);Wirecloud.dispatchEvent('loaded');return Wirecloud.changeActiveWorkspace({owner:state.workspace_owner,name:state.workspace_name},{initialtab:state.tab,history:"replace"});},(error)=>{var msg=gettext("Error loading WireCloud");(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();return Promise.reject();});}
initTask.catch((error)=>{Wirecloud.GlobalLogManager.log(error);return Promise.reject();});var task=initTask.toTask(gettext('Loading WireCloud Platform'));if(options.preventDefault!==true){Wirecloud.UserInterfaceManager.monitorTask(task);}
return task;};Wirecloud.logout=function logout(){if(Wirecloud.constants.FIWARE_PORTALS){var promises=[];Wirecloud.constants.FIWARE_PORTALS.forEach((portal)=>{if('logout_path'in portal){promises.push(Wirecloud.io.makeRequest(portal.url+portal.logout_path,{method:'GET',supportsAccessControl:true,withCredentials:true,requestHeaders:{'X-Requested-With':null}}).catch(function(error){}));}});Promise.all(promises).then(()=>{window.location=Wirecloud.URLs.LOGOUT_VIEW;});}else{window.location=Wirecloud.URLs.LOGOUT_VIEW;}};Wirecloud.loadWorkspace=function loadWorkspace(workspace,options){var url;if('id'in workspace){url=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({'workspace_id':workspace.id});}else if('owner'in workspace&&'name'in workspace){url=Wirecloud.URLs.WORKSPACE_ENTRY_OWNER_NAME.evaluate({'owner':workspace.owner,'name':workspace.name});}else{throw TypeError('use the id parameter or the owner/name pair of parameters');}
return Wirecloud.io.makeRequest(url,{method:"GET",requestHeaders:{'Accept':'application/json'}}).renameTask(utils.gettext("Requesting workspace data")).then((response)=>{if(response.status!==200){throw new Error("Unexpected error code");}
return process_workspace_data.call(this,response,options);}).toTask("Downloading workspace");};Wirecloud.changeActiveWorkspace=function changeActiveWorkspace(workspace,options){var workspace_full_name,state;options=utils.merge({initialtab:null,history:"push"},options);if(!('owner'in workspace&&'name'in workspace)&&!('id'in workspace)){throw TypeError('use the id parameter or the owner/name pair of parameters');}
if(!('owner'in workspace)||!('name'in workspace)){workspace=this.workspaceInstances[workspace.id];}
state={workspace_owner:workspace.owner,workspace_name:workspace.name,view:"workspace"};if(options.initialtab!=null){state.tab=options.initialtab;}
workspace_full_name=workspace.owner+'/'+workspace.name;document.title=workspace_full_name;if(options.history==="push"){Wirecloud.HistoryManager.pushState(state);}else if(options.history==="replace"){Wirecloud.HistoryManager.replaceState(state);}
return this.loadWorkspace(workspace,options).then(switch_active_workspace.bind(this)).toTask(gettext("Switching active workspace"));};Wirecloud.createWorkspace=function createWorkspace(options){var body;options=utils.merge({allow_renaming:true,dry_run:false},options);body={allow_renaming:!!options.allow_renaming,dry_run:!!options.dry_run};if(options.mashup==null&&options.workspace==null&&options.name==null&&options.title==null){throw new Error(utils.gettext('Missing name or title parameter'));}else if(options.mashup!=null&&options.workspace!=null){throw new Error(utils.gettext('Workspace and mashup options cannot be used at the same time'));}
if(options.mashup!=null&&options.mashup.trim()!==""){body.mashup=options.mashup;}
if(options.name!=null){body.name=options.name;}
if(options.title!=null){body.title=options.title;}
if(options.preferences!=null){body.preferences=options.preferences;}
if(options.workspace!=null){body.workspace=options.workspace;}
return Wirecloud.io.makeRequest(Wirecloud.URLs.WORKSPACE_COLLECTION,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(body)}).then(onCreateWorkspaceSuccess.bind(this));};Wirecloud.removeWorkspace=function removeWorkspace(workspace){if(workspace.id==null){if(workspace.owner==null||workspace.name==null){throw new TypeError("missing id or owner/name parameters");}
workspace=this.workspacesByUserAndName[workspace.owner][workspace.name];}
var url=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({workspace_id:workspace.id});return Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'}}).then((response)=>{if([204,401,403,404,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,404,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
if(workspace.id in this.workspaceInstances){var stored_workspace=this.workspaceInstances[workspace.id];delete this.workspaceInstances[workspace.id];delete this.workspacesByUserAndName[stored_workspace.owner][stored_workspace.name];}
return Promise.resolve();});};Wirecloud.mergeWorkspace=function mergeWorkspace(target_workspace,options){if(options==null){options={};}
if(target_workspace.id==null){if(target_workspace.owner==null||target_workspace.name==null){throw new TypeError("missing id or owner/name parameters");}
target_workspace=this.workspacesByUserAndName[target_workspace.owner][target_workspace.name];}else{target_workspace=this.workspaceInstances[target_workspace.id];}
if(!("mashup"in options)&&!("workspace"in options)){throw new TypeError('one of the following options must be provided: workspace or mashup');}else if("mashup"in options&&"workspace"in options){throw new TypeError('workspace and mashup options cannot be used at the same time');}
var url=Wirecloud.URLs.WORKSPACE_MERGE.evaluate({to_ws_id:target_workspace.id});return Wirecloud.io.makeRequest(url,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({mashup:options.mashup,workspace:options.workspace})}).then((response)=>{if([204,401,403,404,422,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if(response.status===422){try{var error=JSON.parse(response.responseText);}catch(e){return Promise.reject(utils.gettext("Unexpected response from server"));}
return Promise.reject(error);}else if([401,403,404,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
var workspace={id:target_workspace.id,owner:target_workspace.owner,name:target_workspace.name};cache_workspace(workspace);return Promise.resolve(workspace);});};var process_workspace_data=function process_workspace_data(response,options){var workspace_data=JSON.parse(response.responseText);var workspace_resources=new Wirecloud.WorkspaceCatalogue(workspace_data.id);return workspace_resources.reload().then(function(){return new Wirecloud.Task("Processing workspace data",(resolve,reject,update)=>{var workspace=new Wirecloud.Workspace(workspace_data,workspace_resources);cache_workspace(workspace);resolve(workspace);});});};var switch_active_workspace=function switch_active_workspace(workspace){return new Wirecloud.Task(gettext("Switching active workspace"),(resolve,reject)=>{if(this.activeWorkspace){this.activeWorkspace.unload();this.activeWorkspace=null;}
this.activeWorkspace=workspace;Wirecloud.dispatchEvent('viewcontextchanged');Wirecloud.dispatchEvent('activeworkspacechanged',this.activeWorkspace);resolve(workspace);});};var on_url_get=function on_url_get(){var path=Wirecloud.URLs.WORKSPACE_VIEW.evaluate({owner:encodeURIComponent(this.owner),name:encodeURIComponent(this.name)});return Wirecloud.location.protocol+'://'+Wirecloud.location.host+path;};var cache_workspace=function cache_workspace(workspace){Wirecloud.workspaceInstances[workspace.id]=workspace;if(!(workspace.owner in Wirecloud.workspacesByUserAndName)){Wirecloud.workspacesByUserAndName[workspace.owner]={};}
Wirecloud.workspacesByUserAndName[workspace.owner][workspace.name]=workspace;if(workspace instanceof Wirecloud.Workspace){workspace.addEventListener("change",(workspace,updated_attributes,old_values)=>{if(updated_attributes.indexOf('name')!==-1){delete Wirecloud.workspacesByUserAndName[workspace.owner][old_values.name];Wirecloud.workspacesByUserAndName[workspace.owner][workspace.name]=workspace;}});}else{Object.defineProperty(workspace,'url',{get:on_url_get});}};})(Wirecloud.Utils);;(function(utils){"use strict";var UserInterfaceManager={rootKeydownHandler:null,currentWindowMenu:null,currentPopups:[],workspaceviews:{}};var coverLayerElement=null;var currentTooltip=null;var fadeInCover=function fadeInCover(){coverLayerElement.classList.add('in');};var showCover=function showCover(){coverLayerElement.style.display="block";setTimeout(fadeInCover,0);};var hideCover=function hideCover(){coverLayerElement.classList.remove('in');coverLayerElement.style.display="none";};UserInterfaceManager.init=function init(){if(coverLayerElement!=null){return;}
coverLayerElement=document.createElement('div');coverLayerElement.id='menu_layer';coverLayerElement.className='disabled_background fade';coverLayerElement.style.display='none';document.body.insertBefore(coverLayerElement,document.body.firstChild);document.addEventListener('keydown',function(event){var modifiers,key,consumed;modifiers={altKey:event.altKey,ctrlKey:event.ctrlKey,metaKey:event.metaKey,shiftKey:event.shiftKey};key=utils.normalizeKey(event);if(UserInterfaceManager.currentWindowMenu==null){consumed=utils.callCallback(UserInterfaceManager.rootKeydownHandler,key,modifiers);}else if(key==="Backspace"){consumed=true;}
if(!consumed&&key==="Escape"){UserInterfaceManager.handleEscapeEvent();}
if(consumed){event.preventDefault();}},false);if(document.querySelector('.plain_content')!=null){if('WirecloudHeader'in Wirecloud.ui){this.header=new Wirecloud.ui.WirecloudHeader(this);}
return;}
this.alternatives=new StyledElements.Alternatives({class:'wc-body'});this.alternatives.appendTo(document.querySelector("#wc-body"));if('WirecloudHeader'in Wirecloud.ui){this.header=new Wirecloud.ui.WirecloudHeader(this);this.alternatives.addEventListener('preTransition',function(alternatives,old_alternative,new_alternative){this.header._notifyViewChange();}.bind(this));this.alternatives.addEventListener('postTransition',function(alternatives,old_alternative,new_alternative){this.header._notifyViewChange(new_alternative);}.bind(this));}
this.views={'initial':this.alternatives.createAlternative(),'workspace':this.alternatives.createAlternative({'alternative_constructor':Wirecloud.ui.WorkspaceView}),'wiring':this.alternatives.createAlternative({'alternative_constructor':Wirecloud.ui.WiringEditor}),'marketplace':this.alternatives.createAlternative({'alternative_constructor':Wirecloud.ui.MarketplaceView})};Wirecloud.addEventListener('contextloaded',function(){this.views.myresources=this.alternatives.createAlternative({alternative_constructor:Wirecloud.ui.MyResourcesView});}.bind(this));Wirecloud.addEventListener('activeworkspacechanged',function(Wirecloud,workspace){this.layout.slideOut();if(workspace.emptyparams.length>0){var preferences,preferenceValues,dialog;preferenceValues={};workspace.emptyparams.forEach((emptyparam)=>{if(workspace.preferences[emptyparam]!=null){preferenceValues[emptyparam]=workspace.preferences[emptyparam];}});preferences=Wirecloud.PreferenceManager.buildPreferences('workspace',preferenceValues,workspace,workspace.extraprefs,workspace.emptyparams);preferences.addEventListener('post-commit',function(){setTimeout(function(){Wirecloud.UserInterfaceManager.monitorTask(Wirecloud.changeActiveWorkspace(workspace));},0);}.bind(this));dialog=new Wirecloud.ui.PreferencesWindowMenu('workspace',preferences);dialog.show();return;}
var state=Wirecloud.HistoryManager.getCurrentState();try{this.loadWorkspace(workspace,{initialtab:state.tab});}catch(error){return;}
if(state.tab==null||state.tab_id==null||state.workspace_title==null){if(state.tab==null){state.tab=this.notebook.visibleTab.model.name;}
if(state.tab_id==null){state.tab_id=this.notebook.visibleTab.model.id;}
if(state.workspace_title==null){state.workspace_title=this.model.title;}
Wirecloud.HistoryManager.replaceState(state);}
this.notebook.addEventListener("changed",function(notebook,oldTab,newTab){var currentState=Wirecloud.HistoryManager.getCurrentState();var newState=utils.merge({},currentState,{tab:newTab.model.name,tab_id:newTab.model.id});if(currentState.tab!==newState.tab){Wirecloud.HistoryManager.pushState(newState);}});this._updateWiringErrors=function(entry){var errorCount=workspace.wiring.errorCount;this.wiringButton.setBadge(errorCount?errorCount:null,'danger');}.bind(this);workspace.wiring.logManager.addEventListener('newentry',this._updateWiringErrors);this._updateWiringErrors();Wirecloud.GlobalLogManager.log(utils.gettext('Workspace loaded'),Wirecloud.constants.LOGGING.INFO_MSG);}.bind(this.views.workspace));utils.onFullscreenChange(document.body,on_fullscreen_change.bind(this));window.addEventListener("resize",resizeUI.bind(this),true);document.addEventListener("click",on_click.bind(this),true);};UserInterfaceManager.changeCurrentView=function changeCurrentView(newView,options){if(options===true){options={};}else if(options==null){options={onComplete:function(alternatives,old_alternative,new_alternative){Wirecloud.HistoryManager.pushState(new_alternative.buildStateData());}};}
var main_alts=[this.views.wiring,this.views.workspace];newView=this.views[newView];if(main_alts.indexOf(this.alternatives.visibleAlt)!==-1&&main_alts.indexOf(newView)!==-1){options.effect=StyledElements.Alternatives.HORIZONTAL_SLIDE;}else{options.effect=StyledElements.Alternatives.CROSS_DISSOLVE;}
this.rootKeydownHandler=null;this.alternatives.showAlternative(newView,options);};UserInterfaceManager.handleEscapeEvent=function handleEscapeEvent() {if(this.currentPopups.length>0){this.currentPopups[this.currentPopups.length-1].hide();}};UserInterfaceManager._unregisterRootWindowMenu=function _unregisterRootWindowMenu(window_menu){this._unregisterPopup(window_menu);this.currentWindowMenu=null;hideCover();};UserInterfaceManager._registerRootWindowMenu=function _registerRootWindowMenu(window_menu){if(!(window_menu instanceof Wirecloud.ui.WindowMenu)){throw new TypeError('window_menu must be a WindowMenu instance');}
if(this.currentWindowMenu!=null){this.currentWindowMenu.hide();hideCover();}
this.currentWindowMenu=window_menu;this._registerPopup(window_menu);showCover();};UserInterfaceManager._unregisterTooltip=function _unregisterTooltip(tooltip){if(currentTooltip===tooltip){currentTooltip=null;}};UserInterfaceManager._unregisterPopup=function _unregisterPopup(popup){var index=this.currentPopups.indexOf(popup);if(index!==-1){this.currentPopups.splice(index,1);}};UserInterfaceManager._registerTooltip=function _registerTooltip(tooltip){if(tooltip!=null&&!('hide'in tooltip)){throw new TypeError('invalid tooltip parameter');}
if(currentTooltip!=null){currentTooltip.hide();}
currentTooltip=tooltip;};UserInterfaceManager._registerPopup=function _registerPopup(popup){if(popup!=null&&!('hide'in popup)){throw new TypeError('invalid popup parameter');}
this._unregisterPopup(popup);this.currentPopups.push(popup);};UserInterfaceManager.monitorTask=function monitorTask(task){var element=document.getElementById("loading-window");element.classList.add("in");element.classList.add("fade");if(task instanceof Wirecloud.TaskContinuation){task=task.toTask();}
task.addEventListener('progress',updateTaskProgress);task.addEventListener('fail',notifyPlatformReady);task.addEventListener('finish',notifyPlatformReady);updateTaskProgress(task,0);return this;};UserInterfaceManager.onHistoryChange=function onHistoryChange(state){this.changeCurrentView(state.view,{onComplete:function(alternatives,oldView,nextView){if('onHistoryChange'in nextView){nextView.onHistoryChange(state);}}});};var updateTaskProgress=function updateTaskProgress(task,progress){var msg;msg=utils.gettext("%(task)s %(percentage)s%");msg=utils.interpolate(msg,{task:task.title,percentage:Math.round(progress)},true);document.getElementById("loading-task-title").textContent=msg;var list=document.createElement('ul');task.subtasks.forEach(function(subtask){if(subtask.type==="then"){if(subtask.subtasks.length===0){return;}
subtask=subtask.subtasks[0];}
if(subtask.title!==""){var msg=utils.interpolate(utils.gettext("%(subTask)s: %(percentage)s%"),{subTask:subtask.title,percentage:Math.round(subtask.progress)},true);var li=document.createElement('li');li.textContent=msg;list.appendChild(li);}});document.getElementById("loading-subtask-title").innerHTML='';document.getElementById("loading-subtask-title").appendChild(list);};var resizeUI=function resizeUI(){this.alternatives.repaint();if(this.currentWindowMenu){this.currentWindowMenu.calculatePosition();}};var notifyPlatformReady=function notifyPlatformReady(){var loadingElement=document.getElementById("loading-window");if(loadingElement.classList.contains("in")){loadingElement.classList.remove("in");}else{loadingElement.classList.remove("fade");}};var on_click=function on_click(event){var loadingElement=document.getElementById("loading-window");if(!(loadingElement.classList.contains("in"))){loadingElement.classList.remove("fade");}};var on_fullscreen_change=function on_fullscreen_change(event){var baseelement=utils.getFullscreenElement()||document.body;baseelement.insertBefore(coverLayerElement,baseelement.firstChild);};Wirecloud.UserInterfaceManager=UserInterfaceManager;})(Wirecloud.Utils);;(function(utils){"use strict";var Task=function Task(title,executor){if(title==null){throw new TypeError("missing title parameter");}
if(typeof executor!=="function"&&!Array.isArray(executor)){throw new TypeError("executor must be a function or a task array");}else if(Array.isArray(executor)&&executor.length===0){throw new TypeError("at least one subtask is required");}
privates.set(this,{parent:null,title:title,progress:0,status:"pending",value:undefined,subtasks:[]});Object.defineProperties(this,{title:{get:on_title_get},progress:{get:on_progress_get},status:{get:on_status_get},value:{get:on_value_get},subtasks:{get:on_subtasks_get}});StyledElements.ObjectWithEvents.call(this,['abort','fail','finish','progress','nexttask']);if(typeof executor==="function"){executor(resolve.bind(this),reject.bind(this),update.bind(this));}else{executor.forEach(addAggregatedTask,this);updateAggregatedTaskProgress.call(this);on_task_finish.call(this);}};utils.inherit(Task,StyledElements.ObjectWithEvents);var update=function update(progress){var priv=privates.get(this);if(priv.status==="aborted"){return;}else if(priv.status!=="pending"){throw new Error("Only pending tasks can be resolved");}
if(progress<0){priv.progress=0;}else if(progress>100){priv.progress=100;}else{priv.progress=progress;}
this.dispatchEvent("progress",priv.progress);};Task.prototype.abort=function abort(reason,retroactive){var priv=privates.get(this);if(priv.status==="pending"){priv.status="aborted";priv.value=reason;priv.subtasks.forEach((subtask)=>{subtask.abort(reason)});this.dispatchEvent('abort',reason);}
if(retroactive===true&&priv.parent!=null&&priv.parent.status==="pending"){priv.parent.abort(reason,true);}
return this;};var reject=function reject(reason){var priv=privates.get(this);if(priv.status==="aborted"){return;}else if(priv.status!=="pending"){throw new Error("Only pending tasks can be resolved");}
priv.status="rejected";priv.value=reason;this.dispatchEvent('fail',reason);};var resolve=function resolve(value){var priv=privates.get(this);if(priv.status==="aborted"){return;}else if(priv.status!=="pending"){throw new Error("Only pending tasks can be resolved");}
update.call(this,100);priv.value=value;priv.status="resolved";this.dispatchEvent("finish");};var resolve_then=function resolve_then(tc,callback,next,resolve,reject){var result;if(tc.status==='aborted'){return;}else if(typeof callback==='function'){try{result=callback(this.value);}catch(e){reject(e);return;}
next=resolve;}else{result=this.value;}
if(result instanceof Wirecloud.Task){privates.get(tc).subtasks.push(result);tc.dispatchEvent("nexttask",result);}
if(result!=null&&typeof result.then==="function"){result.then(resolve,reject);}else{next(result);}};Task.prototype.toString=function toString(){return this.title+': '+this.progress+'%';};Task.prototype.toTask=function toTask(title){title=title!=null?title:this.title;var task=new Task(title,(resolve,reject,update)=>{this.addEventListener("progress",function(task,progress){update(progress);});update(this.progress);this.then(resolve,reject);});privates.get(task).subtasks.push(this);return task;};Task.prototype.catch=function _catch(reject,abort){return this.then(null,reject,abort);};Task.prototype.renameTask=function renameTask(title){privates.get(this).title=title;return this;};Task.prototype.then=function then(onFulfilled,onRejected,onAborted){return new TaskContinuation(this,onFulfilled,onRejected,onAborted);};var privates=new WeakMap();var TaskContinuation=function TaskContinuation(parent,onFulfilled,onRejected,onAborted){privates.set(this,{parent:parent,progress:0,status:"pending",value:undefined,subtasks:[]});Object.defineProperties(this,{progress:{get:on_progress_get},type:{value:"then"},status:{get:on_status_get},value:{get:on_value_get},subtasks:{get:on_subtasks_get}});StyledElements.ObjectWithEvents.call(this,['abort','fail','finish','progress','upgrade','nexttask']);var internal_resolve=resolve.bind(this);var internal_reject=reject.bind(this);var internal_abort=this.abort.bind(this);if(parent.status==='resolved'){resolve_then.call(parent,this,onFulfilled,internal_resolve,internal_resolve,internal_reject);}else if(parent.status==='rejected'){resolve_then.call(parent,this,onRejected,internal_reject,internal_resolve,internal_reject);}else if(parent.status==='aborted'){resolve_then.call(parent,this,onAborted,internal_abort,internal_resolve,internal_reject);}else{parent.addEventListener("finish",resolve_then.bind(parent,this,onFulfilled,internal_resolve,internal_resolve,internal_reject));parent.addEventListener("fail",resolve_then.bind(parent,this,onRejected,internal_reject,internal_resolve,internal_reject));parent.addEventListener("abort",resolve_then.bind(parent,this,onAborted,internal_abort,internal_resolve,internal_reject));}};utils.inherit(TaskContinuation,Task);TaskContinuation.prototype.then=Task.prototype.then;TaskContinuation.prototype.catch=Task.prototype.catch;TaskContinuation.prototype.toTask=function toTask(title){var current_task;if(title==null){current_task=privates.get(this);while(current_task.parent!=null){current_task=privates.get(current_task.parent);}
title=current_task.title;}
var task=new Task(title,function(resolve,reject,update){this.then(resolve,reject);}.bind(this));var priv=privates.get(task);current_task=this;while(current_task!=null){current_task.addEventListener("nexttask",(tc,newtask)=>{var index=priv.subtasks.indexOf(tc);priv.subtasks[index]=newtask;newtask.addEventListener('progress',updateAggregatedTaskProgress.bind(task));updateAggregatedTaskProgress.call(task);});priv.subtasks.push(current_task);current_task=privates.get(current_task).parent;}
priv.subtasks=priv.subtasks.reverse();priv.subtasks[0].addEventListener('progress',updateAggregatedTaskProgress.bind(task));updateAggregatedTaskProgress.call(task);return task;};var on_status_get=function on_status_get(){return privates.get(this).status;};var on_value_get=function on_value_get(){return privates.get(this).value;};var on_progress_get=function on_progress_get(){return privates.get(this).progress;};var on_title_get=function on_title_get(){return privates.get(this).title;};var on_subtasks_get=function on_subtasks_get(){return privates.get(this).subtasks.slice(0);};var on_task_finish=function on_task_finish(){var priv=privates.get(this);var status=null;priv.subtasks.some(function(task){if(task.status==="pending"){status="pending";return true;}else if(task.status==="aborted"){status="aborted";}else if(task.status==="resolved"&&status===null){status="resolved";}else if(task.status==="rejected"&&status!=="aborted"){status="rejected";}});if(status!=="pending"){priv.value=priv.subtasks.map(function(task){return task.value});priv.status=status;switch(status){case"resolved":this.dispatchEvent("finish");break;case"rejected":case"aborted":this.dispatchEvent("fail");break;}}};var addAggregatedTask=function addAggregatedTask(task){var priv=privates.get(this);priv.subtasks.push(task);task.addEventListener('progress',updateAggregatedTaskProgress.bind(this));task.addEventListener('finish',on_task_finish.bind(this));task.addEventListener('fail',on_task_finish.bind(this));task.addEventListener('abort',on_task_finish.bind(this));};var updateAggregatedTaskProgress=function updateAggregatedTaskProgress(){var priv,accumulated_progress=0;priv=privates.get(this);priv.subtasks.forEach((subtask)=>{accumulated_progress+=subtask.progress;});priv.progress=accumulated_progress/priv.subtasks.length;this.dispatchEvent("progress",priv.progress);};Wirecloud.Task=Task;Wirecloud.TaskContinuation=TaskContinuation;})(Wirecloud.Utils);;(function(utils){"use strict";var HANDLER_RE=new RegExp(/^on(?:Complete|Exception|Failure|Success|UploadProgress|\d{3})$/);var setRequestHeaders=function setRequestHeaders(){var headers,name;headers=utils.merge({'X-Requested-With':'XMLHttpRequest','Accept':'text/javascript, text/html, application/xml, text/xml, */*'},this.options.requestHeaders);if(!('Content-Type'in headers)&&this.options.contentType!=null){headers['Content-Type']=this.options.contentType;if(this.options.encoding!=null){headers['Content-Type']+='; charset='+this.options.encoding;}}
for(name in headers){if(headers[name]!=null){this.transport.setRequestHeader(name,headers[name]);}}};var onAbort=function onAbort(event){event.stopPropagation();event.preventDefault();var response=new Response(this);Wirecloud.Task.prototype.abort.call(this,response);utils.callCallback(this.options.onAbort);if(this.options.onComplete){try{this.options.onComplete(response);}catch(e){utils.callCallback(this.options.onException,response,e);}}};var onReadyStateChange=function onReadyStateChange(handler,error){var response=new Response(this);if(error){handler(new io.ConnectionError(this));}else{handler(response);}
try{if(('on'+response.status)in this.options){this.options['on'+response.status](response);}else if(this.options.onSuccess&&(response.status>=200&&response.status<300)){this.options.onSuccess(response);}else if(this.options.onFailure&&(response.status<200||response.status>=300)){this.options.onFailure(response);}}catch(e){utils.callCallback(this.options.onException,response,e);}
if(this.options.onComplete){try{this.options.onComplete(response);}catch(e){utils.callCallback(this.options.onException,response,e);}}
return response;};var Response=function Response(request){Object.defineProperties(this,{'request':{value:request},'transport':{value:request.transport},'status':{value:request.transport.status},'statusText':{value:request.transport.statusText},'response':{value:request.transport.response}});if(request.options.responseType==null||request.options.responseType===''){Object.defineProperties(this,{'responseText':{value:request.transport.responseText},'responseXML':{value:request.transport.responseXML}});}};Response.prototype.getHeader=function getHeader(name){try{return this.transport.getResponseHeader(name);}catch(e){return null;}};Response.prototype.getAllResponseHeaders=function getAllResponseHeaders(){return this.transport.getAllResponseHeaders();};var toQueryString=function toQueryString(parameters){var key,query=[];if(parameters==null){return null;}else if(typeof parameters==='string'){parameters=parameters.trim();if(parameters!==''){return parameters;}else{return null;}}else{for(key in parameters){if(typeof parameters[key]==='undefined'){continue;}else if(parameters[key]===null){query.push(encodeURIComponent(key)+'=');}else{query.push(encodeURIComponent(key)+'='+encodeURIComponent(parameters[key]));}}}
if(query.length>0){return query.join('&');}else{return null;}};var Request=function Request(url,options){var key;this.options=utils.merge({method:'POST',asynchronous:true,responseType:null,contentType:null,encoding:null,postBody:null},options);for(key in this.options){if(HANDLER_RE.test(key)&&this.options[key]!=null&&typeof this.options[key]!=='function'){throw new TypeError(utils.interpolate('Invalid %(callback)s callback',{callback:key},true));}}
if(this.options.context!=null){for(key in this.options){if(HANDLER_RE.test(key)&&typeof this.options[key]==='function'){this.options[key]=this.options[key].bind(this.options.context);}}}
Object.defineProperties(this,{method:{value:this.options.method.toUpperCase()}});if(['PUT','POST'].indexOf(this.method)!==-1&&this.options.postBody==null){var parameters=toQueryString(this.options.parameters);if(parameters!=null){this.options.postBody=parameters;if(this.options.contentType==null){this.options.contentType='application/x-www-form-urlencoded';}
if(this.options.encoding==null){this.options.encoding='UTF-8';}}}
Object.defineProperties(this,{url:{value:url},abort:{value:function(){this.transport.aborted=true;this.transport.abort();return this;}}});this.transport=new XMLHttpRequest();if(this.options.withCredentials===true&&this.options.supportsAccessControl){this.transport.withCredentials=true;}
if(this.options.responseType){this.transport.responseType=this.options.responseType;}
this.transport.addEventListener('abort',onAbort.bind(this),true);if(typeof this.options.onUploadProgress==='function'){this.transport.upload.addEventListener('progress',options.onUploadProgress,false);}
Wirecloud.Task.call(this,"making request",function(resolve,reject,update){this.transport.upload.addEventListener('progress',function(event){var progress=Math.round(event.loaded*100/event.total);update(progress/2);});this.transport.addEventListener("progress",function(event){if(event.lengthComputable){var progress=Math.round(event.loaded*100/event.total);update(50+(progress/2));}}.bind(this));this.transport.addEventListener("load",function(){onReadyStateChange.call(this,resolve);}.bind(this));this.transport.addEventListener("error",function(){onReadyStateChange.call(this,reject,true);}.bind(this));}.bind(this));this.transport.open(this.method,this.url,this.options.asynchronous);setRequestHeaders.call(this);this.transport.send(this.options.postBody);};utils.inherit(Request,Wirecloud.Task);var io={};io.ConnectionError=function ConnectionError(){this.name='ConnectionError';this.message='Connection Error';};io.ConnectionError.prototype=new Error();io.ConnectionError.prototype.constructor=io.ConnectionError;io.ConnectionError.prototype.toString=function toString(){return this.message;};io.buildProxyURL=function buildProxyURL(url,options){var forceProxy,hash;options=utils.merge({method:'POST',asynchronous:true,responseType:null,contentType:null,encoding:null,postBody:null},options);if(!(url instanceof URL)){url=new URL(url,Wirecloud.location.base);}
forceProxy=!!options.forceProxy;if(["blob:","data:"].indexOf(url.protocol)!==-1){return url.toString();}
hash=url.hash;url.hash='';if(forceProxy||(options.supportsAccessControl!==true&&url.origin!==Wirecloud.location.domain)){url=new URL(Wirecloud.URLs.PROXY.evaluate({protocol:url.protocol.slice(0,-1),domain:url.host,path:url.pathname})+url.search,Wirecloud.location.base).toString();}else{url=url.toString();}
if(['PUT','POST'].indexOf(options.method)===-1||options.postBody!=null){var parameters=toQueryString(options.parameters);if(parameters!=null){if(url.indexOf('?')!==-1){url+='&'+parameters;}else{url+='?'+parameters;}}}
return url+hash;};io.makeRequest=function makeRequest(url,options){return new Request(Wirecloud.io.buildProxyURL(url,options),options);};Wirecloud.io=io;})(Wirecloud.Utils);;(function(utils){"use strict";var ContextManager=function ContextManager(contextInstance,context_description){if(context_description==null||typeof context_description!=='object'){throw new TypeError('invalid context_description parameter');}
context_description=utils.clone(context_description,true);Object.defineProperty(this,'instance',{value:contextInstance});var context={};var handlers=[];for(var key in context_description){if(context_description==null||typeof context_description[key]!=='object'){delete context_description[key];}
context_description[key].name=key;if('value'in context_description[key]){context[key]=context_description[key].value;delete context_description[key].value;}else{context[key]=null;}
Object.freeze(context_description[key]);}
Object.freeze(context_description);Object.defineProperty(this,'getAvailableContext',{value:function getAvailableContext(){return context_description;}});Object.defineProperty(this,'addCallback',{value:function addCallback(handler){if(typeof handler!=='function'){throw new TypeError();}
handlers.push(handler);}});Object.defineProperty(this,'removeCallback',{value:function removeCallback(handler){var index;if(typeof handler!=='function'){throw new TypeError();}
index=handlers.indexOf(handler);if(index!==-1){handlers.splice(index,1);}}});Object.defineProperty(this,'get',{value:function get(key){return context[key];}});Object.defineProperty(this,'modify',{value:function get(values){var key,i,updated_values={};if(typeof values!=='object'){throw new TypeError();}
for(key in values){if(!context.hasOwnProperty(key)){throw new TypeError(key);}}
for(key in values){if(context[key]!==values[key]){context[key]=values[key];updated_values[key]=values[key];}}
if(!utils.isEmpty(updated_values)){for(i=0;i<handlers.length;i+=1){try{handlers[i](updated_values);}catch(e){}}}}});};Wirecloud.ContextManager=ContextManager;})(Wirecloud.Utils);;(function(){"use strict";var PreferenceDoesNotExistError=function PreferenceDoesNotExistError(message){this.name="PreferenceDoesNotExistError";this.message=message||"";};PreferenceDoesNotExistError.prototype=new Error();PreferenceDoesNotExistError.prototype.constructor=PreferenceDoesNotExistError;Object.freeze(PreferenceDoesNotExistError.prototype);Object.freeze(PreferenceDoesNotExistError);Wirecloud.PreferenceDoesNotExistError=PreferenceDoesNotExistError;})();;(function(){"use strict";var UserPrefDef=function UserPrefDef(options){if(options==null||typeof options!=="object"){throw new TypeError('Invalid options parameter');}
if(options.default!=null&&typeof options.default!=="string"){throw new TypeError('Invalid default option');}
if(options.type==='list'){options.type='select';}
Object.defineProperties(this,{name:{value:options.name},type:{value:options.type},label:{value:options.label},description:{value:options.description},required:{value:options.required},options:{value:options.options}});var default_value='';if(options.type==='boolean'){default_value=options.default.trim().toLowerCase()==='true';}else if(options.type==='number'&&options.default!=null){default_value=Number(options.default);}else if(options.default!=null){default_value=options.default;}
Object.defineProperty(this,'default',{value:default_value});};Wirecloud.UserPrefDef=UserPrefDef;})();;(function(){"use strict";var UserPref=function UserPref(meta,readonly,hidden,currentValue){if(meta==null||!(meta instanceof Wirecloud.UserPrefDef)){throw new TypeError("invalid meta parameter");}
Object.defineProperties(this,{meta:{value:meta},readonly:{value:!!readonly},hidden:{value:!!hidden}});if(meta.type==='boolean'&&typeof currentValue==='string'){this.value=currentValue.trim().toLowerCase()==='true';}else if(meta.type==='number'&&typeof currentValue==='string'){this.value=Number(currentValue);}else{this.value=currentValue;}};UserPref.prototype.getInterfaceDescription=function getInterfaceDescription(){var type=this.meta.type;var desc={type:type,label:this.meta.label,description:this.meta.description,defaultValue:this.meta.default,initiallyDisabled:this.readonly,initialValue:this.value,required:this.meta.required};if(type==='select'){desc.initialEntries=this.meta.options;desc.required=true;}
return desc;};Wirecloud.UserPref=UserPref;})();;(function(){"use strict";var PersistentVariable=function PersistentVariable(meta,commiter,readonly,value){if(meta==null||!(meta instanceof Wirecloud.PersistentVariableDef)){throw new TypeError("invalid meta parameter");}
Object.defineProperties(this,{meta:{value:meta},readonly:{value:readonly},commiter:{value:commiter},value:{get:property_value_get}});privates.set(this,value);};PersistentVariable.prototype.get=function get(){return this.value;};PersistentVariable.prototype.set=function set(new_value){if(this.readonly){throw new Error('Read only properties cannot be modified');}
privates.set(this,new_value);this.commiter.add(this.meta.name,new_value);};Wirecloud.PersistentVariable=PersistentVariable;var privates=new WeakMap();var property_value_get=function property_value_get(){return privates.get(this);};})();;(function(){"use strict";var PersistentVariableDef=function PersistentVariableDef(options){if(options==null||typeof options!=="object"){throw new TypeError('Invalid options parameter');}
if(options.default!=null&&typeof options.default!=="string"){throw new TypeError('Invalid default option');}
Object.defineProperties(this,{name:{value:options.name},type:{value:options.type},label:{value:options.label},description:{value:options.description},multiuser:{value:options.multiuser},secure:{value:options.secure},options:{value:options},default:{value:options.default}});};Wirecloud.PersistentVariableDef=PersistentVariableDef;})();;(function(){"use strict";var PolicyManager={},policy={};Object.defineProperty(PolicyManager,'evaluate',{value:function evaluate(context,action){if(context in policy){context=policy[context];}else{return true;}
if(action in context){return context[action];}else{return true;}}});Object.preventExtensions(PolicyManager);Object.defineProperty(Wirecloud,'PolicyManager',{value:PolicyManager});})();;(function(utils){"use strict";var currentState={};var onpopstate=function onpopstate(event){if(event.state===null){return;}
currentState=event.state;document.title=currentState.title;Wirecloud.UserInterfaceManager.onHistoryChange(event.state);};var prepareData=function prepareData(data){var header,key;data=utils.merge({view:"workspace"},data);header=Wirecloud.UserInterfaceManager.header;if(header!=null&&header.currentView!=null){data.title=header.currentView.getTitle();}else{data.title=document.title;}
for(key in data){data[key]=""+data[key];}
return data;};var buildURL=function buildURL(data){var url,key,hash='';if(data.workspace_owner!=="wirecloud"||data.workspace_name!=="landing"){url=new URL("/"+encodeURIComponent(data.workspace_owner)+'/'+encodeURIComponent(data.workspace_name),Wirecloud.location.base);}else{url=new URL("/",Wirecloud.location.base);}
url.search=window.location.search;for(key in data){if(['workspace_name','workspace_owner','workspace_title','tab_id','title'].indexOf(key)!==-1){continue;}
hash+='&'+encodeURIComponent(key)+'='+encodeURIComponent(data[key]);}
url.hash='#'+hash.substr(1);return url;};var HistoryManager={};HistoryManager.init=function init(){var initialState=this._parseStateFromHash(window.location.hash);this._parseWorkspaceFromPathName(window.location.pathname,initialState);window.addEventListener("popstate",onpopstate.bind(this),true);initialState=prepareData(initialState);var url=buildURL(initialState);history.replaceState(initialState,document.title,url);currentState=initialState;};HistoryManager._parseStateFromHash=function _parseStateFromHash(hash){var definitions,i,pair,key,value,data={};if(hash.charAt(0)==='#'){hash=hash.substr(1);}
if(hash.length===0){return data;}
definitions=hash.split('&');for(i=0;i<definitions.length;i+=1){pair=definitions[i].split('=');key=decodeURIComponent(pair[0]);value=decodeURIComponent(pair[1]);data[key]=value;}
return data;};HistoryManager._parseWorkspaceFromPathName=function _parseWorkspaceFromPathName(pathname,status){var index=pathname.lastIndexOf('/');var index2=pathname.lastIndexOf('/',index-1);if(index!==index2){status.workspace_owner=decodeURIComponent(pathname.substring(index2+1,index));status.workspace_name=decodeURIComponent(pathname.substring(index+1));}else{status.workspace_owner="wirecloud";status.workspace_name="landing";}};HistoryManager.pushState=function pushState(data){var url,key,equal;data=prepareData(data);equal=true;for(key in data){if(data[key]!==currentState[key]){equal=false;break;}}
if(equal){return;}
url=buildURL(data);history.pushState(data,null,url);document.title=data.title;currentState=data;};HistoryManager.replaceState=function replaceState(data){var url,key,equal;data=prepareData(data);equal=true;for(key in data){if(data[key]!==currentState[key]){equal=false;break;}}
if(equal){return;}
url=buildURL(data);history.replaceState(data,null,url);document.title=data.title;currentState=data;};HistoryManager.getCurrentState=function getCurrentState(){return utils.clone(currentState);};Wirecloud.HistoryManager=HistoryManager;})(Wirecloud.Utils);;(function(utils){"use strict";var VERSION_RE=/^((?:[1-9]\d*\.|0\.)*(?:[1-9]\d*|0))((?:a|b|rc)[1-9]\d*)?(-dev(.+)?)?$/;var Version=function Version(version){var groups,msg;if(typeof version==='string'){groups=version.match(VERSION_RE);if(groups==null){msg="%(version)s is not a valid version";throw new TypeError(utils.interpolate(msg,{version:version}));}
this.array=groups[1].split('.').map(function(x){return parseInt(x,10);});this.pre_version=groups[2]!=null?groups[2]:null;this.dev=groups[3]!=null;this.devtext=groups[4];this.text=version;}else{throw new TypeError("missing or invalid version parameter");}
Object.freeze(this);};Version.prototype.compareTo=function compareTo(version){var len,value1,value2,pre_version1,pre_version2,i;if(!(version instanceof Version)){try{version=new Version(version);}catch(e){throw new TypeError("invalid version parameter");}}
len=Math.max(this.array.length,version.array.length);for(i=0;i<len;i+=1){value1=this.array[i]!=null?this.array[i]:0;value2=version.array[i]!=null?version.array[i]:0;if(value1!==value2){return value1-value2;}}
pre_version1=this.pre_version;if(pre_version1==null){pre_version1="z";}
pre_version2=version.pre_version;if(pre_version2==null){pre_version2="z";}
if(pre_version1<pre_version2){return-1;}else if(pre_version1>pre_version2){return 1;}else{if(this.dev===version.dev){return this.devtext===version.devtext?0:1;}else{return this.dev?-1:1;}}};Version.prototype.toString=function toString(){return this.text.replace(/-dev.*$/,'-dev');};Wirecloud.Version=Version;})(Wirecloud.Utils);;(function(ns,utils){"use strict";ns.MashableApplicationComponent=function MashableApplicationComponent(desc){var vendor,name,version,i,inputs,outputs,preference;if(!('vendor'in desc)||desc.vendor.trim()===''){throw new TypeError(utils.gettext('missing vendor'));}
vendor=desc.vendor.trim();if(!('name'in desc)||desc.name.trim()===''){throw new TypeError(utils.gettext('missing name'));}
name=desc.name.trim();if(!('version'in desc)||desc.version.trim()===''){throw new TypeError(utils.gettext('missing version'));}
version=new Wirecloud.Version(desc.version.trim());if(typeof desc.type!=='string'){throw new TypeError(utils.gettext('missing type'));}
Object.defineProperties(this,{missing:{value:!!desc.missing},vendor:{value:vendor},name:{value:name},version:{value:version},uri:{value:vendor+'/'+name+'/'+version.text},group_id:{value:vendor+'/'+name},type:{value:desc.type},image:{value:desc.image},description:{value:desc.description!=null?desc.description.trim():''},doc:{value:desc.doc!=null?desc.doc.trim():''},changelog:{value:desc.changelog!=null?desc.changelog.trim():''},title:{value:desc.title==null||desc.title.trim()===''?name:desc.title},base_url:{value:location.origin+Wirecloud.URLs.MAC_BASE_URL.evaluate({vendor:vendor,name:name,version:version.text,file_path:''})}});this.preferences={};this.preferenceList=[];for(i=0;i<desc.preferences.length;i++){preference=new Wirecloud.UserPrefDef(desc.preferences[i]);this.preferences[preference.name]=preference;this.preferenceList.push(preference);}
Object.freeze(this.preferences);Object.freeze(this.preferenceList);this.requirements=desc.requirements;Object.freeze(this.requirements);if(desc.wiring.inputs==null){desc.wiring.inputs=[];}
Object.defineProperty(this,'inputList',{value:desc.wiring.inputs});inputs={};for(i=0;i<this.inputList.length;i++){inputs[this.inputList[i].name]=this.inputList[i];}
Object.defineProperty(this,'inputs',{value:inputs});if(desc.wiring.outputs==null){desc.wiring.outputs=[];}
Object.defineProperty(this,'outputList',{value:desc.wiring.outputs});outputs={};for(i=0;i<this.outputList.length;i++){outputs[this.outputList[i].name]=this.outputList[i];}
Object.defineProperty(this,'outputs',{value:outputs});};ns.MashableApplicationComponent.prototype={hasEndpoints:function hasEndpoints(){return(this.inputList.length+this.outputList.length)>0;},hasPreferences:function hasPreferences(){return this.preferenceList.length>0;},is:function is(other){return other!=null&&this.type==other.type&&this.uri==other.uri;}};})(Wirecloud,Wirecloud.Utils);;(function(ns,utils){"use strict";ns.WidgetMeta=function WidgetMeta(data){var i,property;if(data.type==null){data.type='widget';}else if(data.type!=='widget'){throw new TypeError(utils.interpolate('Invalid component type for a widget: %(type)s.',{type:data.type}));}
Wirecloud.MashableApplicationComponent.call(this,data);if(this.missing){this.codeurl=(new URL(Wirecloud.URLs.MISSING_WIDGET_CODE_ENTRY,Wirecloud.location.base)).href;this.codecontenttype="application/xhtml+xml";}else{this.codeurl=data.contents.src;this.codecontenttype=data.contents.contenttype;}
this.codeurl+="?entrypoint=true&v="+Wirecloud.contextManager.get('version_hash')+"&theme="+Wirecloud.contextManager.get('theme');this.properties={};this.propertyList=[];for(i=0;i<data.properties.length;i++){property=new Wirecloud.PersistentVariableDef(data.properties[i]);this.properties[property.name]=property;this.propertyList.push(property);}
Object.freeze(this.properties);Object.freeze(this.propertyList);Object.defineProperties(this,{"default_width":{value:data.widget_width},"default_height":{value:data.widget_height},});this.getIcon=function getIcon(){return data.smartphoneimage!==''?data.smartphoneimage:data.image;};this.getIPhoneImageURI=this.getIcon;Object.freeze(this);};utils.inherit(ns.WidgetMeta,Wirecloud.MashableApplicationComponent,{getInfoString:function getInfoString(){var transObj={vendor:this.vendor,name:this.name,version:this.version};var msg=utils.gettext("[Widget; Vendor: %(vendor)s, Name: %(name)s, Version: %(version)s]");return utils.interpolate(msg,transObj,true);}});})(Wirecloud,Wirecloud.Utils);;(function(){"use strict";var PreferenceDef=function PreferenceDef(name,inheritable,inheritByDefault,hidden,options){Object.defineProperties(this,{name:{value:name},label:{value:options.label},description:{value:options.description},inheritable:{value:!!inheritable},inheritByDefault:{value:!!(inheritable&&inheritByDefault)},default:{value:options.defaultValue},hidden:{value:!!hidden},options:{value:options}});Object.freeze(this);};Wirecloud.PreferenceDef=PreferenceDef;})();;(function(){"use strict";var PlatformPref=function PlatformPref(manager,preferenceDef,inherit,value){Object.defineProperty(this,'meta',{value:preferenceDef});Object.defineProperty(this,'manager',{value:manager});this.inherit=inherit;if(value!=null){this.value=Wirecloud.ui.InputInterfaceFactory.parse(preferenceDef.options.type,value);}else{this.value=preferenceDef.default;}
this.handlers=[];};PlatformPref.prototype.getEffectiveValue=function getEffectiveValue(){if(this.inherit){return this.manager.getParentValue(this.meta.name);}
return this.value;};PlatformPref.prototype.addHandler=function addHandler(handler){this.handlers.push(handler);};PlatformPref.prototype._propagate=function _propagate(){for(var i=0;i<this.handlers.length;i++){try{this.handlers[i](this.scope,this.name,this.value);}catch(e){}}};PlatformPref.prototype.setDefaultValue=function setDefaultValue(){this.setValue(this.definition.inputInterface.getDefaultValue());};Wirecloud.PlatformPref=PlatformPref;})();;(function(){"use strict";var PreferencesDef=function PreferencesDef(definitions){if(arguments.length===0){return;}
Object.defineProperty(this,'preferences',{value:definitions});};Wirecloud.PreferencesDef=PreferencesDef;})();;(function(){"use strict";var PlatformPreferencesDef=function PlatformPreferencesDef(definitions){Wirecloud.PreferencesDef.call(this,definitions);};PlatformPreferencesDef.prototype=new Wirecloud.PreferencesDef();PlatformPreferencesDef.prototype.buildPreferences=function buildPreferences(values){return new Wirecloud.PlatformPreferences(this,values);};Wirecloud.PlatformPreferencesDef=PlatformPreferencesDef;})();;(function(){"use strict";var WorkspacePreferencesDef=function WorkspacePreferencesDef(definitions,args){var empty_params,i,param,extra_prefs=args[2];extra_prefs=Wirecloud.PreferenceManager.processDefinitions(extra_prefs);if(Array.isArray(args[3])&&args[3].length>0){empty_params=args[3];definitions={};for(i=0;i<empty_params.length;i+=1){param=empty_params[i];definitions[param]=extra_prefs[param];}}else{definitions=Wirecloud.Utils.merge(definitions,extra_prefs);}
Wirecloud.PreferencesDef.call(this,definitions);};WorkspacePreferencesDef.prototype=new Wirecloud.PreferencesDef();WorkspacePreferencesDef.prototype.buildPreferences=function buildPreferences(values,workspace){return new Wirecloud.WorkspacePreferences(this,workspace,values);};Wirecloud.WorkspacePreferencesDef=WorkspacePreferencesDef;})();;(function(){"use strict";var TabPreferencesDef=function TabPreferencesDef(definitions){Wirecloud.PreferencesDef.call(this,definitions);};TabPreferencesDef.prototype=new Wirecloud.PreferencesDef();TabPreferencesDef.prototype.buildPreferences=function buildPreferences(values,tab){return new Wirecloud.TabPreferences(this,tab,values);};Wirecloud.TabPreferencesDef=TabPreferencesDef;})();;(function(se,utils){"use strict";se.StyledElement=function StyledElement(events){this.wrapperElement=null;this.parentElement=null;Object.defineProperties(this,{enabled:{get:function get(){return!this.hasClassName('disabled');},set:function set(value){value=!!value;if(this.enabled!==value){this.toggleClassName('disabled',!value)._onenabled(value);}}},hidden:{get:function get(){return this.hasClassName('hidden');},set:function set(value){this.toggleClassName('hidden',value)._onhidden(value);}}});events=Array.isArray(events)?events:[];se.ObjectWithEvents.call(this,['hide','show'].concat(events));};utils.inherit(se.StyledElement,se.ObjectWithEvents,{_onenabled:function _onenabled(enabled){},_onhidden:function _onhidden(hidden){},addClassName:function addClassName(classList){if(!Array.isArray(classList)){classList=classList==null?"":classList.toString().trim();if(classList===""){return this;}
classList=classList.split(/\s+/);}
classList.forEach(add_individual_class,this);return this;},appendTo:function appendTo(parentElement,refElement){if(parentElement instanceof se.StyledElement&&typeof parentElement.appendChild==='function'){parentElement.appendChild(this,refElement);}else{utils.appendChild(parentElement,this,refElement);}
return this;},destroy:function destroy(){this.remove();se.ObjectWithEvents.prototype.destroy.call(this);},disable:function disable(){this.enabled=false;return this;},enable:function enable(){this.enabled=true;return this;},get:function get(){return this.wrapperElement;},hide:function hide(){if(!this.hidden){this.hidden=true;this.dispatchEvent('hide');}
return this;},parent:function parent(){if(this.parentElement!=null){return this.parentElement.get();}
return this.get().parentElement;},prependTo:function prependTo(parentElement,refElement){if(parentElement instanceof se.StyledElement&&typeof parentElement.prependChild==='function'){parentElement.prependChild(this,refElement);}else{utils.prependChild(parentElement,this,refElement);}
return this;},remove:function remove(){if(this.parentElement instanceof se.StyledElement&&typeof this.parentElement.removeChild==='function'){this.parentElement.removeChild(this);}else{this.get().remove();}
return this;},replaceClassName:function replaceClassName(removeList,addList){this.removeClassName(removeList);this.addClassName(addList);return this;},show:function show(){if(this.hidden){this.hidden=false;this.dispatchEvent('show');}
return this;},style:function style(properties,value){if(arguments.length===1){if(typeof properties==='string'){return this.get().style[properties];}
for(var name in properties){this.get().style[name]=properties[name];}}else{this.get().style[properties]=value!=null?value:"";}
return this;},toggleClassName:function toggleClassName(classList,state){var method;if(!Array.isArray(classList)){classList=classList==null?[]:classList.toString().trim();classList=classList!==""?classList.split(/\s+/):[];}
if(classList.length){if(typeof state!=='boolean'){classList.forEach(toggle_individual_class,this);}else{method=state?add_individual_class:remove_individual_class;classList.forEach(method,this);}}
return this;},_getUsableHeight:function _getUsableHeight(){var parentElement=this.wrapperElement.parentElement;if(parentElement==null){return null;}
var parentStyle=document.defaultView.getComputedStyle(parentElement,null);if(parentStyle.getPropertyCSSValue('display')==null){return null;}
var containerStyle=document.defaultView.getComputedStyle(this.wrapperElement,null);var height=parentElement.offsetHeight-
parentStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
parentStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);return height;},_getUsableWidth:function _getUsableWidth(){var parentElement=this.wrapperElement.parentElement;if(parentElement==null){return null;}
var parentStyle=document.defaultView.getComputedStyle(parentElement,null);var containerStyle=document.defaultView.getComputedStyle(this.wrapperElement,null);var width=parentElement.offsetWidth-
parentStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX)-
parentStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);return width;},getBoundingClientRect:function getBoundingClientRect(){return this.wrapperElement.getBoundingClientRect();},hasClassName:function hasClassName(className){className=className==null?"":className.toString().trim();return this.get().classList.contains(className);},insertInto:function insertInto(parentElement,refElement){return refElement!=null?this.prependTo(parentElement,refElement):this.appendTo(parentElement);},removeClassName:function removeClassName(classList){if(!Array.isArray(classList)){classList=classList==null?"":classList.toString().trim();if(classList===""){this.get().className="";return this;}
classList=classList.split(/\s+/);}
classList.forEach(remove_individual_class,this);return this;},repaint:function repaint(temporal){return this;},setDisabled:function setDisabled(disable){if(disable){return this.disable();}else{return this.enable();}}});var add_individual_class=function add_individual_class(className){this.get().classList.add(className);};var remove_individual_class=function remove_individual_class(className){this.get().classList.remove(className);};var toggle_individual_class=function toggle_individual_class(className){if(this.get().classList.contains(className)){this.get().classList.remove(className);}else{this.get().classList.add(className);}};})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var InputElement=function InputElement(defaultValue,events){this.inputElement=null;this.defaultValue=defaultValue;StyledElements.StyledElement.call(this,events);};utils.inherit(InputElement,StyledElements.StyledElement);Object.defineProperty(InputElement.prototype,'value',{get:function(){return this.getValue();},set:function(value){return this.setValue(value);}});InputElement.prototype.getValue=function getValue(){return this.inputElement.value;};InputElement.prototype.setValue=function setValue(newValue){var oldValue=this.inputElement.value;this.inputElement.value=newValue;if('change'in this.events&&newValue!==oldValue){this.dispatchEvent('change');}
return this;};InputElement.prototype.reset=function reset(){return this.setValue(this.defaultValue);};InputElement.prototype.enable=function enable(){StyledElements.StyledElement.prototype.enable.call(this);this.inputElement.disabled=false;return this;};InputElement.prototype.disable=function disable(){StyledElements.StyledElement.prototype.disable.call(this);this.inputElement.disabled=true;return this;};InputElement.prototype.blur=function blur(){this.inputElement.blur();return this;};InputElement.prototype.focus=function focus(){this.inputElement.focus();return this;};StyledElements.InputElement=InputElement;})(StyledElements.Utils);;(function(utils){"use strict";var privates=new WeakMap();var CommandQueue=function CommandQueue(context,callback){if(typeof callback!=="function"){throw new TypeError("callback parameter must be a function");}
privates.set(this,{callback:callback,context:context,elements:[],running:false});Object.defineProperties(this,{callback:{value:callback},context:{value:context},running:{get:running_getter}});};CommandQueue.prototype.addCommand=function addCommand(command){if(command===undefined){return Promise.resolve();}
var priv=privates.get(this);var p=new Promise(function(resolve,reject){priv.elements.push({command:command,resolve:resolve,reject:reject});});if(!priv.running){priv.running=true;doInit.call(priv);}
return p;};var doInit=function doInit(){var element,action;element=this.elements.shift();if(element===undefined){this.running=false;return;}
try{action=this.callback(this.context,element.command);}catch(error){element.reject(error);doInit.call(this);}
if(action!=null&&typeof action.then==="function"){action.then((value)=>{element.resolve(value);doInit.call(this);},(error)=>{element.reject(error);doInit.call(this);});}else{element.resolve(action);doInit.call(this);}};var running_getter=function running_getter(){return privates.get(this).running;};StyledElements.CommandQueue=CommandQueue;})(StyledElements.Utils);;(function(se,utils){"use strict";se.Container=function Container(options,events){options=utils.merge(utils.clone(defaults),options);se.StyledElement.call(this,events);this.wrapperElement=document.createElement(options.tagname);this.wrapperElement.className='se-container';if(options.id){this.wrapperElement.setAttribute('id',options.id);}
this.addClassName(options.class);var priv={children:[]};privates.set(this,priv);Object.defineProperties(this,{'children':{get:function(){return priv.children.slice(0);}}});};utils.inherit(se.Container,se.StyledElement,{has:function has(childElement){var priv=privates.get(this);if(childElement instanceof se.StyledElement&&priv.children.indexOf(childElement)!==-1){return true;}
return childElement.parentElement===this.get();},appendChild:function appendChild(newElement,refElement){utils.appendChild(this,newElement,refElement).forEach(addChild,this);orderbyIndex.call(this);return this;},prependChild:function prependChild(newElement,refElement){utils.prependChild(this,newElement,refElement).forEach(addChild,this);orderbyIndex.call(this);return this;},removeChild:function removeChild(childElement){utils.removeChild(this,childElement);if(childElement instanceof se.StyledElement){var priv=privates.get(this);priv.children.splice(priv.children.indexOf(childElement),1);}
return this;},repaint:function repaint(temporal){temporal=temporal!==undefined?temporal:false;var priv=privates.get(this);for(var i=0;i<priv.children.length;i++){priv.children[i].repaint(temporal);}},clear:function clear(){var priv=privates.get(this);priv.children=[];this.wrapperElement.innerHTML="";this.wrapperElement.scrollTop=0;this.wrapperElement.scrollLeft=0;if(priv.disabledLayer!=null){this.wrapperElement.appendChild(priv.disabledLayer);}
return this;},text:function text(text){if(text==null){return this.get().textContent;}else{return this.clear().appendChild(""+text);}},isDisabled:function isDisabled(){return!this.enabled;},_onenabled:function _onenabled(enabled){var icon,priv;priv=privates.get(this);if(enabled){if(priv.disabledLayer!=null){priv.disabledLayer.remove();}
priv.disabledLayer=null;}else{priv.disabledLayer=document.createElement('div');priv.disabledLayer.className='se-container-disable-layer';icon=document.createElement('i');icon.className='disable-icon fa fa-spin fa-spinner';priv.disabledLayer.appendChild(icon);this.wrapperElement.appendChild(priv.disabledLayer);}}});var privates=new WeakMap();var defaults={class:"",id:"",tagname:'div',useFullHeight:false};var addChild=function addChild(newElement){var priv=privates.get(this);if(newElement instanceof se.StyledElement){var index=priv.children.indexOf(newElement);if(index===-1){priv.children.push(newElement);}}};var orderbyIndex=function orderbyIndex(){var children=[],priv;priv=privates.get(this);Array.prototype.forEach.call(this.get().childNodes,function(childNode){var i,elementFound=false;for(i=0;i<priv.children.length&&!elementFound;i++){if(priv.children[i].get()===childNode){children.push(priv.children.splice(i,1)[0]);elementFound=true;}}});priv.children=children;};})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var Accordion=function Accordion(options){var defaultOptions={'class':'','exclusive':true,'full':true};options=StyledElements.Utils.merge(defaultOptions,options);this.exclusive=options.exclusive;this.full=options.full;this.children=[];this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord(options.class,"styled_accordion");};utils.inherit(Accordion,StyledElements.StyledElement);Accordion.prototype.createContainer=function createContainer(options){var expander;options=utils.merge({'listenOnTitle':true},options);expander=new StyledElements.Expander(options);expander.insertInto(this.wrapperElement);if(this.exclusive){expander.addEventListener('expandChange',function(expander,expanded){var old_expander;if(expanded){old_expander=this.currentContainer;this.currentContainer=expander;if(old_expander){old_expander.setExpanded(false);old_expander.wrapperElement.style.height='';}}else if(this.currentContainer===expander){expander.wrapperElement.style.height='';this.currentContainer=null;}
this.repaint();}.bind(this));}else if(this.full){expander.addEventListener('expandChange',function(expanded){this.repaint();}.bind(this));}
this.children.push(expander);if(this.currentContainer==null){expander.setExpanded(true);}
return expander;};Accordion.prototype.repaint=function repaint(temporal){var height,computedStyle,i;height=this._getUsableHeight();if(height==null||this.currentContainer==null){return;}
for(i=0;i<this.children.length;i+=1){if(this.children[i]===this.currentContainer){continue;}
computedStyle=document.defaultView.getComputedStyle(this.currentContainer.wrapperElement,null);height-=this.children[i].wrapperElement.offsetHeight;height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);}
computedStyle=document.defaultView.getComputedStyle(this.currentContainer.wrapperElement,null);height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX);this.currentContainer.wrapperElement.style.height=height+'px';this.currentContainer.repaint(temporal);};Accordion.prototype.destroy=function destroy(){var i;for(i=0;i<this.children.length;i+=1){this.children[i].destroy();}
this.children=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Accordion=Accordion;})(StyledElements.Utils);;(function(utils){"use strict";var Expander=function Expander(options){var defaultOptions={'buttonFloat':'left','class':'','expandButton':true,'listenOnTitle':false,'state':'default','title':null};options=utils.merge(defaultOptions,options);if(!options.expandButton&&!options.listenOnTitle){throw new TypeError();}
StyledElements.StyledElement.call(this,['expandChange']);this.wrapperElement=document.createElement('div');this.wrapperElement.className=utils.appendWord("panel se-expander",options.class);if(options.state!=null&&options.state.trim()!==""){this.addClassName('panel-'+options.state);}
var header=document.createElement('div');header.className='panel-heading';this.wrapperElement.appendChild(header);this.toggleButton=null;if(options.expandButton){this.toggleButton=new StyledElements.ToggleButton({class:'icon-expand',plain:true});this.toggleButton.insertInto(header);}
this.titleContainer=new StyledElements.Container({'class':'title'});this.titleContainer.insertInto(header);if(options.title){this.titleContainer.appendChild(document.createTextNode(options.title));}
this.contentContainer=new StyledElements.Container({'class':'panel-body'});this.contentContainer.insertInto(this.wrapperElement);var callback=function(){this.setExpanded(!this.isExpanded());}.bind(this);if(this.toggleButton){this.toggleButton.addEventListener('click',callback);}
if(options.listenOnTitle){this.titleContainer.wrapperElement.style.cursor="pointer";this.titleContainer.wrapperElement.addEventListener('click',callback,false);}};utils.inherit(Expander,StyledElements.StyledElement);Expander.prototype.repaint=function repaint(temporal){var height,computedStyle;if(this.isExpanded()){height=this.wrapperElement.clientHeight;if(height==null){return;}
computedStyle=document.defaultView.getComputedStyle(this.titleContainer.wrapperElement,null);height-=this.titleContainer.wrapperElement.offsetHeight;height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);computedStyle=document.defaultView.getComputedStyle(this.contentContainer.wrapperElement,null);height-=computedStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);if(height<0){height=0;}
this.contentContainer.wrapperElement.style.height=height+'px';this.contentContainer.repaint(temporal);}};Expander.prototype.isExpanded=function isExpanded(){return this.hasClassName('expanded');};Expander.prototype.setExpanded=function setExpanded(expanded){expanded=!!expanded;if(this.isExpanded()===expanded){return;}
if(expanded){this.addClassName('expanded');}else{this.removeClassName('expanded');this.contentContainer.wrapperElement.style.height='';}
if(this.toggleButton){this.toggleButton.active=expanded;}
this.dispatchEvent('expandChange',expanded);};Expander.prototype.getTitleContainer=function getTitleContainer(){return this.titleContainer;};Expander.prototype.appendChild=function appendChild(element){this.contentContainer.appendChild(element);};Expander.prototype.removeChild=function removeChild(element){this.contentContainer.removeChild(element);};Expander.prototype.clear=function clear(){this.contentContainer.clear();};StyledElements.Expander=Expander;})(StyledElements.Utils);;(function(se,utils){"use strict";se.Fragment=function Fragment(newElement){se.StyledElement.call(this);this.children=[];if(Array.isArray(newElement)){newElement.forEach(function(childElement){this.appendChild(childElement);}.bind(this));}else{this.appendChild(newElement);}
Object.defineProperties(this,{elements:{get:function get(){return this.children;}}});};utils.inherit(se.Fragment,se.StyledElement,{appendChild:function appendChild(newElement){if(newElement==null){return this;}
if(typeof newElement==='string'){this.children=this.children.concat(getChildrenFromText(newElement));}else if(newElement instanceof se.Fragment){this.children=this.children.concat(newElement.children);}else{this.children.push(newElement);}
return this;},appendTo:function appendTo(parentElement,refElement){this.children.forEach(function(childElement){utils.appendChild(parentElement,childElement,refElement);});return this;},repaint:function repaint(){this.children.forEach(function(childElement){if(typeof childElement.repaint==='function'){childElement.repaint();}});return this;}});var getChildrenFromText=function getChildrenFromText(text){var targetElement,children=[];if(text.length){targetElement=document.createElement('div');targetElement.innerHTML=text;children=Array.prototype.slice.call(targetElement.childNodes);}
return children;};})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var PaginatedSource,onSuccessCallback,onErrorCallback;onSuccessCallback=function onSuccessCallback(elements,options){var priv=privates.get(this);if(typeof priv.options.processFunc==='function'){priv.options.processFunc(elements,options);}
priv.currentPage=parseInt(options.current_page,10);priv.currentElements=elements;if(priv.totalCount!==options.total_count){priv.totalCount=options.total_count;calculatePages.call(this);this.dispatchEvent('paginationChanged');}
this.dispatchEvent('requestEnd');};onErrorCallback=function onErrorCallback(error){var priv=privates.get(this);priv.currentElements=[];if(error==null){error={'message':'unknown cause'};}
this.dispatchEvent('requestEnd',error);};PaginatedSource=function PaginatedSource(options){var defaultOptions={'pageSize':25,'requestFunc':null,'processFunc':null};StyledElements.ObjectWithEvents.call(this,['optionsChanged','paginationChanged','requestStart','requestEnd']);var priv={};privates.set(this,priv);Object.defineProperties(this,{currentPage:{get:function(){return priv.currentPage;}},options:{get:function(){return priv.options;}},totalCount:{get:function(){return priv.totalCount;}},totalPages:{get:function(){return priv.totalPages;}},currentElements:{get:function(){return priv.currentElements;}}});priv.options=utils.merge(defaultOptions,options);priv.currentPage=1;priv.currentElements=[];priv.totalPages=1;};utils.inherit(PaginatedSource,StyledElements.ObjectWithEvents);PaginatedSource.prototype.getCurrentPage=function getCurrentPage(){return this.currentElements;};PaginatedSource.prototype.changeOptions=function changeOptions(options){var new_page_size,old_offset,key,changed=false;var priv=privates.get(this);if(typeof options!=='object'){return;}
for(key in options){if(key==='pageSize'){new_page_size=parseInt(options.pageSize,10);if(!isNaN(new_page_size)&&new_page_size!==priv.options.pageSize){changed=true;old_offset=(priv.currentPage-1)*priv.options.pageSize;priv.currentPage=Math.floor(old_offset/new_page_size)+1;priv.options.pageSize=new_page_size;calculatePages.call(this);}}else{changed=true;priv.options[key]=options[key];priv.currentPage=1;}}
if(changed){this.dispatchEvent('optionsChanged',priv.options);this.refresh();}
return this;};PaginatedSource.prototype.goToFirst=function goToFirst(){return this.changePage(0);};PaginatedSource.prototype.goToPrevious=function goToPrevious(){var priv=privates.get(this);return this.changePage(priv.currentPage-1);};PaginatedSource.prototype.goToNext=function goToNext(){var priv=privates.get(this);return this.changePage(priv.currentPage+1);};PaginatedSource.prototype.goToLast=function goToLast(){var priv=privates.get(this);this.changePage(priv.totalPages);};var calculatePages=function calculatePages(){var priv=privates.get(this);if(priv.options.pageSize===0){priv.totalPages=1;}else{priv.totalPages=Math.ceil(priv.totalCount/priv.options.pageSize);if(priv.totalPages<=0){priv.totalPages=1;}}};PaginatedSource.prototype.refresh=function refresh(){var priv=privates.get(this);this.dispatchEvent('requestStart');priv.options.requestFunc(priv.currentPage,priv.options,onSuccessCallback.bind(this),onErrorCallback.bind(this));};PaginatedSource.prototype.changePage=function changePage(idx){var priv=privates.get(this);if(idx<1){idx=1;}else if(idx>priv.totalPages){idx=priv.totalPages;}
this.dispatchEvent('requestStart');priv.options.requestFunc(idx,priv.options,onSuccessCallback.bind(this),onErrorCallback.bind(this));};var privates=new WeakMap();StyledElements.PaginatedSource=PaginatedSource;})(StyledElements.Utils);;(function(utils){"use strict";var GUIBuilder,processTComponent,processTree,processRoot,extractOptions,extractOptionsFromAttributes,populateContainer,NAMESPACE,TEMPLATE_NAMESPACE;NAMESPACE='http://wirecloud.conwet.fi.upm.es/StyledElements';TEMPLATE_NAMESPACE='http://wirecloud.conwet.fi.upm.es/Template';processTComponent=function processTComponent(element,tcomponents,context){var options,tcomponent,new_component;tcomponent=tcomponents[element.localName];if(typeof tcomponent==='function'){options=element.textContent.trim();if(options!==''){try{options=JSON.parse(options);}catch(e){options={};}}else{options={};}
utils.merge(options,extractOptionsFromAttributes(element));new_component=tcomponent(options,tcomponents,context);}else{new_component=tcomponent;}
if((new_component instanceof StyledElements.StyledElement)||utils.isElement(new_component)){new_component=new_component;}else if(new_component!=null){new_component=element.ownerDocument.createTextNode(new_component);}else{new_component=element.ownerDocument.createTextNode('');}
return new_component;};processTree=function processTree(builder,element,tcomponents,context){var i,child,component,new_component;for(i=0;i<element.childNodes.length;i+=1){child=element.childNodes[i];if(child.nodeType!==Node.ELEMENT_NODE){continue;}
if(child.namespaceURI===NAMESPACE){component=builder.build(child,tcomponents,context);component.insertInto(element,child);element.removeChild(child);}else if(child.namespaceURI===TEMPLATE_NAMESPACE){new_component=processTComponent(child,tcomponents,context);if(new_component instanceof StyledElements.StyledElement){new_component.insertInto(element,child);}else{element.insertBefore(new_component,child);}
element.removeChild(child);}else{processTree(builder,child,tcomponents,context);}}};processRoot=function processRoot(builder,element,tcomponents,context){var i,children,child,component;children=Array.prototype.slice.call(element.childNodes,0);for(i=0;i<children.length;i+=1){child=children[i];if(!(child instanceof Element)){continue;}
if(child.namespaceURI===NAMESPACE){component=builder.build(child,tcomponents,context);children[i]=component;}else if(child.namespaceURI===TEMPLATE_NAMESPACE){children[i]=processTComponent(child,tcomponents,context);}else{processTree(builder,child,tcomponents,context);}}
return new StyledElements.Fragment(children);};extractOptionsFromAttributes=function extractOptionsFromAttributes(element){var i,options={};for(i=0;i<element.attributes.length;i++){options[element.attributes[i].localName]=element.attributes[i].nodeValue;}
return options;};extractOptions=function extractOptions(element){var options,options_element;options={};options_element=element.ownerDocument.evaluate('s:options',element,function(){return NAMESPACE;},XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(options_element!=null){options_element.parentNode.removeChild(options_element);try{options=JSON.parse(options_element.textContent);}catch(e){}}
return options;};populateContainer=function populateContainer(builder,element,tag_name,container,tcomponents,context){var container_element,fragment,options;container_element=element.getElementsByTagNameNS(NAMESPACE,tag_name)[0];if(container_element!=null){options=utils.merge(extractOptions(container_element),extractOptionsFromAttributes(container_element));if(options!=null&&'class'in options){container.addClassName(options.class);}
fragment=processRoot(builder,container_element,tcomponents,context);container.appendChild(fragment);}};GUIBuilder=function GUIBuilder(){var mapping={'borderlayout':function(builder,element,options,tcomponents,context){var layout=new StyledElements.BorderLayout(options);populateContainer(builder,element,'northcontainer',layout.north,tcomponents,context);populateContainer(builder,element,'westcontainer',layout.west,tcomponents,context);populateContainer(builder,element,'centercontainer',layout.center,tcomponents,context);populateContainer(builder,element,'eastcontainer',layout.east,tcomponents,context);populateContainer(builder,element,'southcontainer',layout.south,tcomponents,context);return layout;},'button':function(builder,element,options){options=utils.merge({},options);options.text=element.textContent;return new StyledElements.Button(options);},'horizontallayout':function(builder,element,options,tcomponents,context){var layout=new StyledElements.HorizontalLayout(options);populateContainer(builder,element,'westcontainer',layout.west,tcomponents,context);populateContainer(builder,element,'centercontainer',layout.center,tcomponents,context);populateContainer(builder,element,'eastcontainer',layout.east,tcomponents,context);return layout;},'select':function(builder,element,options){return new StyledElements.Select(options);},'verticallayout':function(builder,element,options,tcomponents,context){var layout=new StyledElements.VerticalLayout(options);populateContainer(builder,element,'northcontainer',layout.north,tcomponents,context);populateContainer(builder,element,'centercontainer',layout.center,tcomponents,context);populateContainer(builder,element,'southcontainer',layout.south,tcomponents,context);return layout;}};this.build=function build(element,tcomponents,context){var builder,options;builder=mapping[element.localName];options=utils.merge(extractOptions(element),extractOptionsFromAttributes(element));return builder(this,element,options,tcomponents,context);};};GUIBuilder.prototype.DEFAULT_OPENING='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml">';GUIBuilder.prototype.DEFAULT_CLOSING='</s:styledgui>';GUIBuilder.prototype.parse=function parse(document,tcomponents,context){var parser;if(typeof document==='string'){parser=new DOMParser();document=parser.parseFromString(document,'application/xml');}
if(!(document instanceof Document)){throw new TypeError('document is not a Document or cannot be parsed into a Document');}
return processRoot(this,document.documentElement,tcomponents,context);};StyledElements.GUIBuilder=GUIBuilder;})(StyledElements.Utils);;(function(utils){"use strict";var builder=new StyledElements.GUIBuilder();var template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="tooltip fade" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"><t:content/></div></div></s:styledgui>';var setPosition=function setPosition(refPosition,position){this.element.classList.remove('top','right','bottom','left');switch(position){case'top':this.element.classList.add('top');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=(refPosition.top-this.element.offsetHeight)+"px";break;case'right':this.element.classList.add('right');this.element.style.left=refPosition.right+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;case'bottom':this.element.classList.add('bottom');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=refPosition.bottom+"px";break;case'left':this.element.classList.add('left');this.element.style.left=(refPosition.left-this.element.offsetWidth)+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;}};var standsOut=function standsOut(){var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setPosition.call(this,refPosition,position);var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.element.style.top="";this.element.style.bottom="10px";element_box=this.element.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.element.style.top="10px";}};var searchBestPosition=function searchBestPosition(refPosition,positions){var i=0,weights=[];do{setPosition.call(this,refPosition,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,positions);}};var _show=function _show(refPosition){if('Wirecloud'in window){Wirecloud.UserInterfaceManager._registerTooltip(this);}
if(this.visible){this.element.classList.add('in');this.repaint();return;}
if('getBoundingClientRect'in refPosition){refPosition=refPosition.getBoundingClientRect();}
this.element=builder.parse(template,{content:this.options.content}).elements[0];this.element.addEventListener('transitionend',_hide.bind(this));var baseelement=utils.getFullscreenElement()||document.body;baseelement.appendChild(this.element);searchBestPosition.call(this,refPosition,this.options.placement);this.element.classList.add('in');return this;};var Tooltip=function Tooltip(options){var defaultOptions={'content':'','class':'','placement':['right','bottom','left','top']};Object.defineProperty(this,'options',{value:utils.merge(defaultOptions,options)});StyledElements.StyledElement.call(this,[]);Object.defineProperties(this,{element:{value:null,writable:true},visible:{get:function(){return this.element!=null;}}});};utils.inherit(Tooltip,StyledElements.StyledElement);Tooltip.prototype.destroy=function destroy(){this.hide();};Tooltip.prototype.bind=function bind(element){element.addEventListener('focus',this.show.bind(this,element),false);element.addEventListener('blur',this.hide.bind(this),false);element.addEventListener('mouseenter',this.show.bind(this,element),false);element.addEventListener('mouseleave',this.hide.bind(this),false);element.addEventListener('click',this.hide.bind(this),false);};Tooltip.prototype.toggle=function toggle(refElement){if(this.visible){return this.hide();}else{return _show.call(this,refElement);}};Tooltip.prototype.show=function show(refElement){return _show.call(this,refElement);};var _hide=function _hide(){if(this.element!=null&&!this.element.classList.contains('in')){this.element.remove();this.element=null;if('Wirecloud'in window){Wirecloud.UserInterfaceManager._unregisterTooltip(this);}}};Tooltip.prototype.hide=function hide(){var force;if(!this.visible){return this;}
force=!this.element.classList.contains('in')|| getComputedStyle(this.element).getPropertyValue('opacity')==="0";this.element.classList.remove('in');if(force){_hide.call(this);}
return this;};StyledElements.Tooltip=Tooltip;})(StyledElements.Utils);;(function(se,utils){"use strict";var privates=new WeakMap();var clickCallback=function clickCallback(e){e.preventDefault();e.stopPropagation();var priv=privates.get(this);if(this.enabled&&priv.related_input){priv.related_input.focus();}};var Addon=function Addon(options){var defaultOptions={'text':null,'title':'','class':''};options=utils.merge(defaultOptions,options);se.Container.call(this,[]);this.wrapperElement=document.createElement("span");this.wrapperElement.className="se-add-on";this.addClassName(options.class);privates.set(this,{related_input:null});this.setTitle(options.title);this.setLabel(options.text);this._clickCallback=clickCallback.bind(this);this.wrapperElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._clickCallback,true);};utils.inherit(Addon,se.Container);Addon.prototype.Tooltip=se.Tooltip;Addon.prototype.setLabel=function setLabel(label){this.wrapperElement.textContent=label;return this;};Addon.prototype.setTitle=function setTitle(title){var priv=privates.get(this);if(title==null||title===""){if(priv.tooltip!=null){priv.tooltip.destroy();priv.tooltip=null;}}else{if(priv.tooltip==null){priv.tooltip=new this.Tooltip({content:title,placement:['bottom','top','right','left']});priv.tooltip.bind(this.wrapperElement);}
priv.tooltip.options.content=title;}
return this;};Addon.prototype.assignInput=function assignInput(input){privates.get(this).related_input=input;return this;};Addon.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('mousedown',utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._clickCallback,true);delete this._clickCallback;se.StyledElement.prototype.destroy.call(this);};se.Addon=Addon;})(StyledElements,StyledElements.Utils);;(function(se,utils){"use strict";var clickCallback=function clickCallback(e){if(this.inputElement!=null&&e.target===this.inputElement){return;}
e.preventDefault();e.stopPropagation();if(this.enabled){if(this.inputElement!=null){this.inputElement.click();}
this.dispatchEvent('click');}};var dblclickCallback=function dblclickCallback(e){e.preventDefault();e.stopPropagation();if(this.enabled){this.dispatchEvent('dblclick');}};var element_onkeydown=function element_onkeydown(event){var modifiers;if(this.enabled){modifiers=utils.extractModifiers(event);modifiers.preventDefault=event.preventDefault.bind(event);modifiers.stopPropagation=event.stopPropagation.bind(event);this._onkeydown(modifiers,utils.normalizeKey(event));}};var onmouseenter=function onmouseenter(){this.dispatchEvent('mouseenter');};var onmouseleave=function onmouseleave(){this.dispatchEvent('mouseleave');};var onfocus=function onfocus(){this.dispatchEvent('focus');};var onblur=function onblur(){this.dispatchEvent('blur');};var update_tabindex=function update_tabindex(){if(this.enabled){this.wrapperElement.setAttribute('tabindex',this.tabindex);}else{this.wrapperElement.setAttribute('tabindex',-1);}};var Button=function Button(options){options=utils.merge(utils.clone(defaults),options);se.StyledElement.call(this,events);if(options.usedInForm){this.wrapperElement=document.createElement("button");this.wrapperElement.setAttribute('type','button');}else{this.wrapperElement=document.createElement("div");}
this.wrapperElement.className="se-btn";this.label=null;this.icon=null;this.badgeElement=null;this.tooltip=null;this.addClassName(options.class);if(options.id.trim()!==""){this.wrapperElement.setAttribute('id',options.id);}
if(options.plain){this.addClassName("plain");}
this.addIconClassName(options.iconClass);this.setLabel(options.text);this.setTitle(options.title);if(options.iconClass&&options.stackedIconClass){this.stackedIcon=document.createElement('span');this.stackedIcon.className=[options.stackedIconClass,'se-stacked-icon',options.stackedIconPlacement].join(' ');this.icon.appendChild(this.stackedIcon);}
var tabindex,state,depth;Object.defineProperties(this,{depth:{get:function get(){return depth;},set:function set(newDepth){depth=prop_depth_set.call(this,depth,newDepth);}},state:{get:function get(){return prop_state_get.call(this,state);},set:function set(newState){state=prop_state_set.call(this,state,newState);}},tabindex:{get:function get(){return tabindex;},set:function set(new_tabindex){tabindex=new_tabindex;update_tabindex.call(this);}}});this.state=options.state;this.depth=options.depth;this.tabindex=options.tabindex;var prototype=Object.getPrototypeOf(this);if(typeof prototype._clickCallback==='function'){this._clickCallback=prototype._clickCallback.bind(this);}else{this._clickCallback=clickCallback.bind(this);}
this._onkeydown_bound=element_onkeydown.bind(this);this.wrapperElement.addEventListener('touchstart',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._clickCallback,false);this.wrapperElement.addEventListener('dblclick',dblclickCallback.bind(this),true);this.wrapperElement.addEventListener('keydown',this._onkeydown_bound,false);this.wrapperElement.addEventListener('focus',onfocus.bind(this),true);this.wrapperElement.addEventListener('blur',onblur.bind(this),true);this.wrapperElement.addEventListener('mouseenter',onmouseenter.bind(this),false);this.wrapperElement.addEventListener('mouseleave',onmouseleave.bind(this),false);};StyledElements.Utils.inherit(Button,StyledElements.StyledElement);Button.prototype.Tooltip=StyledElements.Tooltip;Button.prototype._onenabled=function _onenabled(enabled){update_tabindex.call(this);if(!enabled){this.blur();}
return this;};Button.prototype._onkeydown=function _onkeydown(event,key){switch(key){case' ':case'Enter':this._clickCallback(event);break;default:break;}};Button.prototype.focus=function focus(){this.wrapperElement.focus();return this;};Button.prototype.blur=function blur(){this.wrapperElement.blur();return this;};Button.prototype.setLabel=function setLabel(text){return text?addLabel.call(this,text):removeLabel.call(this);};Button.prototype.clearClassName=function clearClassName(){this.wrapperElement.className='se-btn';return this;};Button.prototype.addIconClassName=function addIconClassName(classList){if(!Array.isArray(classList)){classList=classList==null?"":classList.toString().trim();if(classList===""){return this;}
classList=classList.split(/\s+/);}
if(classList.length===0){return this;}else if(this.icon==null){this.icon=document.createElement('i');this.icon.classList.add('se-icon');this.wrapperElement.appendChild(this.icon);}
classList.forEach(function(classname){this.icon.classList.add(classname);},this);return this;};Button.prototype.removeIconClassName=function removeIconClassName(classList){if(this.icon==null){return this;}
if(!Array.isArray(classList)){classList=classList==null?"":classList.toString().trim();if(classList===""){this.icon.remove();this.icon=null;return this;}
classList=classList.split(/\s+/);}
classList.forEach(function(classname){this.icon.classList.remove(classname);},this);if(this.icon.className.trim()==='se-icon'){this.icon.remove();this.icon=null;}
return this;};Button.prototype.replaceIconClassName=function replaceIconClassName(className,newClassName){this.removeIconClassName(className);return this.addIconClassName(newClassName);};Button.prototype.setTitle=function setTitle(title){if(title==null||title===''){if(this.tooltip!=null){this.tooltip.destroy();this.tooltip=null;}}else{if(this.tooltip==null){this.tooltip=new this.Tooltip({content:title,placement:['bottom','top','right','left']});this.tooltip.bind(this);}
this.tooltip.options.content=title;}
return this;};Button.prototype.click=function click(){if(this.enabled){this.dispatchEvent('click');}
return this;};Button.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('touchstart',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._clickCallback,true);this.wrapperElement.removeEventListener('keydown',this._onkeydown_bound,false);delete this._clickCallback;delete this._onkeydown_bound;StyledElements.StyledElement.prototype.destroy.call(this);};Button.prototype.setBadge=function setBadge(content,state,isAlert){return content?insertBadge.call(this,content,state,!!isAlert):removeBadge.call(this);};StyledElements.Button=Button;var defaults={id:"",class:"",iconClass:"",stackedIconClass:"",state:'',plain:false,usedInForm:false,text:"",depth:null,title:'',stackedIconPlacement:'bottom-right',tabindex:0};var events=['blur','click','dblclick','focus','mouseenter','mouseleave'];var prop_state_get=function prop_state_get(state){return state;};var prop_state_set=function prop_state_set(state,newState){var states=['default','primary','success','info','warning','danger'];if(states.indexOf(newState)!==-1){if(newState!==state){if(state){this.removeClassName('btn-'+state);}
state=newState;this.addClassName('btn-'+state);}}else{if(state){this.removeClassName('btn-'+state);}
state="";}
return state;};var prop_depth_set=function prop_depth_set(depth,newDepth){if(typeof newDepth==='number'&&newDepth>=0&&newDepth<=5){if(newDepth!==depth){if(depth>=0){this.removeClassName('z-depth-'+depth);}
depth=newDepth;this.addClassName('z-depth-'+depth);}}else{if(depth!=null){this.removeClassName('z-depth-'+depth);}
depth=null;}
return depth;};var removeLabel=function removeLabel(){if(this.label!=null){this.label.remove();this.label=null;}
return this;};var addLabel=function addLabel(textContent){if(this.label==null){this.label=document.createElement('span');this.wrapperElement.appendChild(this.label);}
this.label.textContent=textContent;return this;};var insertBadge=function insertBadge(content,state,isAlert){var states=['inverse','primary','success','info','warning','danger'];if(this.badgeElement==null){this.badgeElement=document.createElement('span');this.wrapperElement.insertBefore(this.badgeElement,this.wrapperElement.firstChild);}
this.badgeElement.className="badge";if(states.indexOf(state)!==-1){this.badgeElement.classList.add("badge-"+state);}
this.badgeElement.classList.add("z-depth-"+(this.depth+1));this.toggleClassName('has-alert',isAlert);this.badgeElement.textContent=content;return this;};var removeBadge=function removeBadge(){if(this.badgeElement!=null){this.badgeElement.remove();this.badgeElement=null;}
this.removeClassName('has-alert');return this;};})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var FileButton,onchange;onchange=function onchange(){if(this.inputElement.files){this.dispatchEvent('fileselect',this.inputElement.files);this.inputElement.value='';}};FileButton=function FileButton(options){var defaultOptions={'multiple':true};options=utils.merge(defaultOptions,options);StyledElements.Button.call(this,options);Object.defineProperty(this,'inputElement',{value:document.createElement("input")});this.inputElement.setAttribute("type","file");this.inputElement.setAttribute("tabindex","-1");this.inputElement.multiple=options.multiple;this.wrapperElement.appendChild(this.inputElement);this.events.fileselect=new StyledElements.Event();this._onchange=onchange.bind(this);this.inputElement.addEventListener('change',this._onchange,true);};utils.inherit(FileButton,StyledElements.Button);FileButton.prototype.destroy=function destroy(){this.inputElement.removeEventListener('change',this._onchange,true);delete this._onchange;StyledElements.Button.prototype.destroy.call(this);};StyledElements.FileButton=FileButton;})(StyledElements.Utils);;(function(se,utils){"use strict";var POPUP_POSITIONS=['left-bottom','right-bottom','top-left','top-right','bottom-right','bottom-left'];Object.freeze(POPUP_POSITIONS);var DEFAULT_PLACEMENT=['bottom-left','bottom-right','top-left','top-right'];Object.freeze(DEFAULT_PLACEMENT);var setPosition=function setPosition(refPosition,placement){var i=0;for(i=0;i<POPUP_POSITIONS.length;i++){this.wrapperElement.classList.remove('se-popup-menu-'+POPUP_POSITIONS[i]);}
this.wrapperElement.classList.add('se-popup-menu-'+placement);switch(placement){case'left-bottom':this.wrapperElement.style.left=(refPosition.left-this.wrapperElement.offsetWidth+1)+"px";this.wrapperElement.style.top=(refPosition.top-1)+"px";break;case'right-bottom':this.wrapperElement.style.left=(refPosition.right-1)+"px";this.wrapperElement.style.top=(refPosition.top-1)+"px";break;case'top-left':this.wrapperElement.style.top=(refPosition.top-this.wrapperElement.offsetHeight+1)+"px";this.wrapperElement.style.left=refPosition.left+"px";break;case'top-right':this.wrapperElement.style.top=(refPosition.top-this.wrapperElement.offsetHeight+1)+"px";this.wrapperElement.style.left=(refPosition.right-this.wrapperElement.offsetWidth)+"px";break;case'bottom-right':this.wrapperElement.style.top=(refPosition.bottom-1)+"px";this.wrapperElement.style.left=(refPosition.right-this.wrapperElement.offsetWidth)+"px";break;default:case'bottom-left':this.wrapperElement.style.top=(refPosition.bottom-1)+"px";this.wrapperElement.style.left=refPosition.left+"px";break;}};var standsOut=function standsOut(){var parent_box=this.wrapperElement.parentElement.getBoundingClientRect();var element_box=this.wrapperElement.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,placements){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var placement=placements[index];setPosition.call(this,refPosition,placement);var parent_box=this.wrapperElement.parentElement.getBoundingClientRect();var element_box=this.wrapperElement.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.wrapperElement.style.top="";this.wrapperElement.style.bottom="10px";element_box=this.wrapperElement.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.wrapperElement.style.top="10px";}};var PopupMenuBase=function PopupMenuBase(options){var defaultOptions={oneActiveAtLeast:false,placement:null,useRefElementWidth:false};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.ObjectWithEvents.call(this,['itemOver','visibilityChange','click']);this.wrapperElement=document.createElement('div');this.wrapperElement.className='se-popup-menu hidden';this._context=null;if('position'in options){if(Array.isArray(options.position)){this._placement=options.position;}else if(typeof options.position==='string'){this._placement=[options.placement];}else{this._placement=DEFAULT_PLACEMENT;}}else{if(Array.isArray(options.placement)){this._placement=options.placement;}else if(typeof options.placement==='string'){this._placement=[options.placement];}else{this._placement=DEFAULT_PLACEMENT;}}
Object.defineProperties(this,{activeItem:{get:property_activeItem_get},firstEnabledItem:{get:property_firstEnabledItem_get},hidden:{get:property_hidden_get},lastEnabledItem:{get:property_lastEnabledItem_get},oneActiveAtLeast:{value:options.oneActiveAtLeast},useRefElementWidth:{value:options.useRefElementWidth}});this._items=[];this._dynamicItems=[];this._submenus=[];this._menuItemCallback=this._menuItemCallback.bind(this);this._menuItem_onactivate_bound=menuItem_onactivate.bind(this);this._menuItem_ondeactivate_bound=menuItem_ondeactivate.bind(this);this._menuItem_onfocus_bound=menuItem_onfocus.bind(this);this._menuItem_onblur_bound=menuItem_onblur.bind(this);};utils.inherit(PopupMenuBase,StyledElements.ObjectWithEvents);var _append=function _append(child,where){if(child instanceof StyledElements.MenuItem){child.addEventListener('click',this._menuItemCallback);child.addEventListener('mouseenter',this._menuItem_onactivate_bound);child.addEventListener('mouseleave',this._menuItem_ondeactivate_bound);child.addEventListener('focus',this._menuItem_onfocus_bound);child.addEventListener('blur',this._menuItem_onblur_bound);}else if(child instanceof StyledElements.SubMenuItem){child.addEventListener('click',this._menuItemCallback);child.menuItem.addEventListener('mouseenter',this._menuItem_onactivate_bound);child.menuItem.addEventListener('mouseleave',this._menuItem_ondeactivate_bound);child.menuItem.addEventListener('focus',this._menuItem_onfocus_bound);child.menuItem.addEventListener('blur',this._menuItem_onblur_bound);child._setParentPopupMenu(this);}else if(child instanceof StyledElements.DynamicMenuItems||child instanceof StyledElements.Separator){}else if(child!=null){throw new TypeError('Invalid chlid element');}else{throw new TypeError('The new child element is null');}
where.push(child);};PopupMenuBase.prototype.append=function append(child){_append.call(this,child,this._items);if(this.isVisible()){display.call(this,child);if((this._enabledItems.length>0)&&this.oneActiveAtLeast){activateMenuItem.call(this,this._enabledItems[0]);}}};PopupMenuBase.prototype.appendSeparator=function appendSeparator(){this.append(new StyledElements.Separator());};PopupMenuBase.prototype.clear=function clear(){var i;if(!this.hidden){hideContent.call(this);}
for(i=0;i<this._items.length;i++){this._items[i].removeEventListener('click',this._menuItemCallback);}
this._items=[];return this;};PopupMenuBase.prototype.setContext=function setContext(context){this._context=context;};PopupMenuBase.prototype._menuItemCallback=function _menuItemCallback(menuItem){this.dispatchEvent('click',menuItem);if(!menuItem.hasClassName('submenu')){this.hide();}
if(typeof menuItem.run==='function'){menuItem.run(this._context,menuItem.context);}};PopupMenuBase.prototype.isVisible=function isVisible(){return!this.hidden;};var display=function display(item){var i,generatedItems,generatedItem;if(item instanceof StyledElements.DynamicMenuItems){generatedItems=item.build(this._context);for(i=0;i<generatedItems.length;i+=1){generatedItem=generatedItems[i];_append.call(this,generatedItem,this._dynamicItems);if(generatedItem instanceof StyledElements.MenuItem||generatedItem instanceof StyledElements.Separator){generatedItem.insertInto(this.wrapperElement);generatedItem.parentElement=this;if(generatedItem instanceof StyledElements.MenuItem&&generatedItem.enabled){this._enabledItems.push(generatedItem);}}else if(generatedItem instanceof StyledElements.SubMenuItem){generatedItem._getMenuItem().insertInto(this.wrapperElement);generatedItem.parentElement=this;this._enabledItems.push(generatedItem.menuItem);}}}else if(item instanceof StyledElements.MenuItem||item instanceof StyledElements.Separator){item.insertInto(this.wrapperElement);item.parentElement=this;if(item instanceof StyledElements.MenuItem&&item.enabled){this._enabledItems.push(item);}}else if(item instanceof StyledElements.SubMenuItem){item._getMenuItem().insertInto(this.wrapperElement);item._getMenuItem().parentElement=this;this._submenus.push(item);this._enabledItems.push(item.menuItem);}else{this.wrapperElement.appendChild(item);}};PopupMenuBase.prototype.show=function show(refPosition){var i;if(this.isVisible()){return;}
this._enabledItems=[];this._activeMenuItem=null;this._focusedMenuItem=null;for(i=0;i<this._items.length;i+=1){display.call(this,this._items[i]);}
if((this._enabledItems.length>0)&&this.oneActiveAtLeast){activateMenuItem.call(this,this._enabledItems[0]);}
this.wrapperElement.classList.remove('hidden');var baseelement=utils.getFullscreenElement()||document.body;baseelement.appendChild(this.wrapperElement);Wirecloud.UserInterfaceManager._registerPopup(this);this.dispatchEvent("visibilityChange");if(!('left'in refPosition)&&'x'in refPosition&&'y'in refPosition){this.wrapperElement.style.top=refPosition.y+"px";this.wrapperElement.style.left=refPosition.x+"px";}else{i=0;var weights=[];do{setPosition.call(this,refPosition,this._placement[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<this._placement.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,this._placement);}}
if(this.useRefElementWidth){this.wrapperElement.style.width=refPosition.width+"px";}};PopupMenuBase.prototype.moveCursorDown=function moveCursorDown(){var index;if(!this.hasEnabledItem()){return this;}
if(this._activeMenuItem!=null){this._activeMenuItem.deactivate();index=this._enabledItems.indexOf(this._activeMenuItem);if(index!==(this._enabledItems.length-1)){this._activeMenuItem=this._enabledItems[index+1];}else{this._activeMenuItem=this.firstEnabledItem;}}else{this._activeMenuItem=this.firstEnabledItem;}
this._activeMenuItem.activate();this.dispatchEvent('itemOver',this._activeMenuItem);return this;};PopupMenuBase.prototype.moveCursorUp=function moveCursorUp(){var index;if(!this.hasEnabledItem()){return this;}
if(this._activeMenuItem!=null){this._activeMenuItem.deactivate();index=this._enabledItems.indexOf(this._activeMenuItem);if(index!==0){this._activeMenuItem=this._enabledItems[index-1];}else{this._activeMenuItem=this.lastEnabledItem;}}else{this._activeMenuItem=this.lastEnabledItem;}
this._activeMenuItem.activate();this.dispatchEvent('itemOver',this._activeMenuItem);return this;};PopupMenuBase.prototype.moveFocusDown=function moveFocusDown(){var index;if(!this.hasEnabledItem()){return this;}
if(this._focusedMenuItem!=null){index=this._enabledItems.indexOf(this._focusedMenuItem);if(index!==(this._enabledItems.length-1)){this._enabledItems[index+1].focus();}else{this.firstEnabledItem.focus();}}else{this.firstEnabledItem.focus();}
return this;};PopupMenuBase.prototype.moveFocusUp=function moveFocusUp(){var index;if(!this.hasEnabledItem()){return this;}
if(this._focusedMenuItem!=null){index=this._enabledItems.indexOf(this._focusedMenuItem);if(index!==0){this._enabledItems[index-1].focus();}else{this.lastEnabledItem.focus();}}else{this.lastEnabledItem.focus();}
return this;};PopupMenuBase.prototype.hide=function hide(){if(this.hidden){return this;}
this.wrapperElement.classList.add("hidden");this.wrapperElement.style.bottom="";hideContent.call(this);this.wrapperElement.remove();Wirecloud.UserInterfaceManager._unregisterPopup(this);return this.dispatchEvent('visibilityChange');};PopupMenuBase.prototype.destroy=function destroy(){var i,item;this.hide();for(i=0;i<this._items.length;i+=1){item=this._items[i];if(item instanceof StyledElements.MenuItem){item.destroy();}}
this._items=null;this._menuItemCallback=null;this._context=null;StyledElements.ObjectWithEvents.prototype.destroy.call(this);};PopupMenuBase.prototype.hasEnabledItem=function hasEnabledItem(){return!this.hidden&&(this._enabledItems.length>0);};var property_activeItem_get=function property_activeItem_get(){return!this.hidden?this._activeMenuItem:null;};var property_firstEnabledItem_get=function property_firstEnabledItem_get(){return this.hasEnabledItem()?this._enabledItems[0]:null;};var property_lastEnabledItem_get=function property_lastEnabledItem_get(){return this.hasEnabledItem()?this._enabledItems[this._enabledItems.length-1]:null;};var property_hidden_get=function property_hidden_get(){return this.wrapperElement.parentElement==null;};var activateMenuItem=function activateMenuItem(menuItem){this._activeMenuItem=menuItem.activate();this.dispatchEvent('itemOver',menuItem);};var hideContent=function hideContent(){var i,item;for(i=this._submenus.length-1;i>=0;i--){this._submenus[i].hide();this._submenus.splice(i,1);}
for(i=this._dynamicItems.length-1;i>=0;i--){item=this._dynamicItems[i];if(item instanceof se.SubMenuItem){item.hide();}
item.destroy();this._dynamicItems.splice(i,1);}
this._enabledItems=[];this._activeMenuItem=null;this.wrapperElement.innerHTML="";};var menuItem_onactivate=function menuItem_onactivate(menuItem){var i;for(i=0;i<this._enabledItems.length;i++){this._enabledItems[i].deactivate();}
activateMenuItem.call(this,menuItem);};var menuItem_ondeactivate=function menuItem_ondeactivate(menuItem){if(this.oneActiveAtLeast){if(this._activeMenuItem!==menuItem){menuItem.deactivate();}}else{if(this._activeMenuItem===menuItem){this._activeMenuItem=null;}
menuItem.deactivate();}};var menuItem_onfocus=function menuItem_onfocus(menuItem){this._focusedMenuItem=menuItem;};var menuItem_onblur=function menuItem_onblur(menuItem){if(this._focusedMenuItem===menuItem){this._focusedMenuItem=null;}};StyledElements.PopupMenuBase=PopupMenuBase;})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var disableCallback=function disableCallback(e){if(e.button!==0){return;}
var boundingBox=this.wrapperElement.getBoundingClientRect();if(e.clientX<boundingBox.left||e.clientX>boundingBox.right||e.clientY<boundingBox.top||e.clientY>boundingBox.bottom){setTimeout(this.hide.bind(this),0);}};var PopupMenu=function PopupMenu(options){StyledElements.PopupMenuBase.call(this,options);this._disableCallback=disableCallback.bind(this);};utils.inherit(PopupMenu,StyledElements.PopupMenuBase);PopupMenu.prototype.show=function show(refPosition){document.addEventListener("click",this._disableCallback,true);StyledElements.PopupMenuBase.prototype.show.call(this,refPosition);return this;};PopupMenu.prototype.hide=function hide(){StyledElements.PopupMenuBase.prototype.hide.call(this);document.removeEventListener("click",this._disableCallback,true);document.removeEventListener("contextmenu",this._disableCallback,true);return this;};PopupMenu.prototype.destroy=function destroy(){this._disableCallback=null;StyledElements.PopupMenuBase.prototype.destroy.call(this);};StyledElements.PopupMenu=PopupMenu;})(StyledElements.Utils);;(function(){"use strict";StyledElements.DynamicMenuItems=function DynamicMenuItems(){};StyledElements.DynamicMenuItems.prototype.build=function build(){return[];};})();;(function(se,utils){"use strict";se.MenuItem=function MenuItem(title,handler,context){se.StyledElement.call(this,events);this.wrapperElement=document.createElement('div');this.wrapperElement.className="se-popup-menu-item";this.thumbnailElement=document.createElement('div');this.thumbnailElement.className="se-popup-menu-item-thumbnail";this.bodyElement=document.createElement('div');this.bodyElement.className="se-popup-menu-item-body";this.wrapperElement.appendChild(this.bodyElement);this.titleElement=document.createElement('div');this.titleElement.className="se-popup-menu-item-title";this.bodyElement.appendChild(this.titleElement);Object.defineProperties(this,{active:{get:property_active_get,set:property_active_set},description:{get:property_description_get},title:{get:property_title_get}});this.setTitle(title);this.run=handler;this.context=context;this._onclick_bound=element_onclick.bind(this);this._onmouseenter_bound=element_onmouseenter.bind(this);this._onmouseleave_bound=element_onmouseleave.bind(this);this.wrapperElement.addEventListener('click',this._onclick_bound,true);this.wrapperElement.addEventListener('mouseenter',this._onmouseenter_bound);this.wrapperElement.addEventListener('mouseleave',this._onmouseleave_bound);this._onblur_bound=element_onblur.bind(this);this._onfocus_bound=element_onfocus.bind(this);this.wrapperElement.addEventListener('blur',this._onblur_bound);this.wrapperElement.addEventListener('focus',this._onfocus_bound);this._onenabled(true);this._onkeydown_bound=element_onkeydown.bind(this);this.wrapperElement.addEventListener('keydown',this._onkeydown_bound);};utils.inherit(se.MenuItem,se.StyledElement,{_onenabled:function _onenabled(enabled){if(enabled){this.wrapperElement.setAttribute('tabindex',-1);}else{this.wrapperElement.removeAttribute('tabindex');}},activate:function activate(){this.active=true;return this;},addIconClass:function addIconClass(iconClass){if(this.iconElement==null){this.iconElement=document.createElement('span');this.thumbnailElement.appendChild(this.iconElement);}
if(this.thumbnailElement.parentElement==null){this.wrapperElement.insertBefore(this.thumbnailElement,this.wrapperElement.firstChild);}
this.iconElement.className="se-icon "+iconClass;return this;},deactivate:function deactivate(){this.active=false;return this;},destroy:function destroy(){if(this.wrapperElement.parentElement!=null){this.wrapperElement.parentElement.removeChild(this.wrapperElement);}
this.wrapperElement.removeEventListener('click',this._onclick_bound,true);this.wrapperElement.removeEventListener('mouseenter',this._onmouseenter_bound);this.wrapperElement.removeEventListener('mouseleave',this._onmouseleave_bound);this.wrapperElement.removeEventListener('keydown',this._onkeydown_bound);this.wrapperElement.removeEventListener('blur',this._onblur_bound);this.wrapperElement.removeEventListener('focus',this._onfocus_bound);this._onclick_bound=null;this._onmouseenter_bound=null;this._onmouseleave_bound=null;this._onkeydown_bound=null;this._onblur_bound=null;this._onfocus_bound=null;se.StyledElement.prototype.destroy.call(this);},focus:function focus(){if(this.enabled&&!this.hasFocus()){this.wrapperElement.focus();this.dispatchEvent('focus');}
return this;},hasFocus:function hasFocus(){return utils.hasFocus(this.wrapperElement);},click:function click(){if(this.enabled){this.dispatchEvent('click');}
return this;},setDescription:function setDescription(description){if(this.descriptionElement==null){this.descriptionElement=document.createElement('div');this.descriptionElement.className="se-popup-menu-item-description";this.bodyElement.appendChild(this.descriptionElement);}
if(description instanceof se.StyledElement){this.descriptionElement.innerHTML="";description.appendTo(this.descriptionElement);}else{this.descriptionElement.textContent=description;}
return this;},setTitle:function setTitle(title){if(title instanceof se.StyledElement){this.titleElement.innerHTML="";title.appendTo(this.titleElement);}else{this.titleElement.textContent=title;}
return this;}});var events=['blur','click','focus','mouseenter','mouseleave'];var property_active_get=function property_active_get(){return this.hasClassName("active");};var property_active_set=function property_active_set(active){if(this.enabled&&this.active!==active){this.toggleClassName("active",active);}};var property_description_get=function property_description_get(){return this.descriptionElement!=null?this.descriptionElement.textContent:"";};var property_title_get=function property_title_get(){return this.titleElement.textContent;};var element_onclick=function element_onclick(event){event.stopPropagation();this.click();};var element_onmouseenter=function element_onmouseenter(event){if(this.enabled){this.dispatchEvent('mouseenter');}};var element_onmouseleave=function element_onmouseleave(event){if(this.enabled){this.dispatchEvent('mouseleave');}};var element_onblur=function element_onblur(event){if(this.enabled){this.dispatchEvent('blur');}};var element_onfocus=function element_onfocus(event){if(this.enabled){this.dispatchEvent('focus');}};var element_onkeydown=function element_onkeydown(event){var item,key;key=utils.normalizeKey(event);switch(key){case' ':case'Enter':event.preventDefault();this.click();break;case'Escape':case'ArrowLeft':event.stopPropagation();event.preventDefault();this.parentElement.hide();if(this.parentElement instanceof StyledElements.SubMenuItem){this.parentElement.menuItem.focus();}
break;case'ArrowUp':event.preventDefault();this.parentElement.moveFocusUp();break;case'Tab':event.preventDefault();if('submenu'in this&&this.submenu.isVisible()){item=this.submenu;}else{item=this.parentElement;}
if(event.shiftKey){item.moveFocusUp();}else{item.moveFocusDown();}
break;case'ArrowDown':event.preventDefault();this.parentElement.moveFocusDown();break;case'ArrowRight':event.preventDefault();if('submenu'in this){this.submenu.show(this.getBoundingClientRect());if(this.submenu.hasEnabledItem()){this.submenu.moveFocusDown();}}
break;}};})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var Separator=function Separator(){StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement("hr");};utils.inherit(Separator,StyledElements.StyledElement);StyledElements.Separator=Separator;})(StyledElements.Utils);;(function(utils){"use strict";var SubMenuItem=function SubMenuItem(text,options){if(arguments.length===0){return true;}
options=utils.merge({'position':['right-bottom','left-bottom']},options);StyledElements.PopupMenuBase.call(this,options);this.wrapperElement.classList.add('se-popup-submenu');this.menuItem=new StyledElements.MenuItem(text,function(){this.submenu.show(this.getBoundingClientRect());});this.menuItem.addClassName('submenu');this.menuItem.submenu=this;};utils.inherit(SubMenuItem,StyledElements.PopupMenuBase);SubMenuItem.prototype._getContext=function _getContext(){if(this.parentMenu instanceof SubMenuItem){return this.parentMenu._getContext();}else{return this.parentMenu._context;}};SubMenuItem.prototype._menuItemCallback=function _menuItemCallback(menuItem){var currentMenu=this;while(currentMenu.parentMenu){currentMenu=currentMenu.parentMenu;}
currentMenu.hide();menuItem.run(currentMenu._context);};SubMenuItem.prototype._setParentPopupMenu=function _setParentPopupMenu(popupMenu){this.parentMenu=popupMenu;this.parentMenu.addEventListener('itemOver',function(popupMenu,item){if(item===this.menuItem){this.show(this.menuItem.getBoundingClientRect());}else{this.hide();}}.bind(this));};SubMenuItem.prototype._getMenuItem=function _getMenuItem(){return this.menuItem;};SubMenuItem.prototype.addEventListener=function addEventListener(eventId,handler){switch(eventId){case'mouseenter':case'mouseleave':case'click':case'blur':case'focus':return this.menuItem.addEventListener(eventId,handler);default:return StyledElements.PopupMenuBase.prototype.addEventListener.call(this,eventId,handler);}};SubMenuItem.prototype.enable=function enable(){this.menuItem.enable();};SubMenuItem.prototype.disable=function disable(){this.menuItem.disable();};SubMenuItem.prototype.setDisabled=function setDisabled(disabled){this.menuItem.setDisabled(disabled);};SubMenuItem.prototype.destroy=function destroy(){if(this.menuItem){this.menuItem.destroy();}
this.menuItem=null;StyledElements.PopupMenuBase.prototype.destroy.call(this);};StyledElements.SubMenuItem=SubMenuItem;})(StyledElements.Utils);;(function(utils){"use strict";var visibilityChangeListener=function visibilityChangeListener(){if(this.popup_menu.isVisible()){this.wrapperElement.classList.add('open');}else{this.wrapperElement.classList.remove('open');}};var PopupButton=function PopupButton(options){var defaultOptions={'menuOptions':null,'menu':null};options=utils.merge(defaultOptions,options);StyledElements.Button.call(this,options);if(options.menu!=null){this.popup_menu=options.menu;this._owned_popup_menu=false;}else{this.popup_menu=new this.PopupMenu(options.menuOptions);this._owned_popup_menu=true;}
this.addEventListener('click',function(){if(this.popup_menu.isVisible()){this.popup_menu.hide();}else{this.popup_menu.show(this.getBoundingClientRect());}}.bind(this));this._visibilityChangeListener=visibilityChangeListener.bind(this);this.popup_menu.addEventListener('visibilityChange',this._visibilityChangeListener);};utils.inherit(PopupButton,StyledElements.Button);PopupButton.prototype.PopupMenu=StyledElements.PopupMenu;PopupButton.prototype._onkeydown=function _onkeydown(event,key){switch(key){case'ArrowDown':event.preventDefault();this.popup_menu.show(this.getBoundingClientRect()).moveFocusDown();break;case'ArrowUp':event.preventDefault();this.popup_menu.show(this.getBoundingClientRect()).moveFocusUp();break;case' ':case'Enter':this._clickCallback(event);break;case'Tab':if(this.popup_menu.hasEnabledItem()){event.preventDefault();this.popup_menu.moveFocusDown();}
break;default:break;}};PopupButton.prototype.getPopupMenu=function getPopupMenu(){return this.popup_menu;};PopupButton.prototype.replacePopupMenu=function replacePopupMenu(new_popup_menu){if(this._owned_popup_menu){this.popup_menu.destroy();this._owned_popup_menu=false;}
this.popup_menu=new_popup_menu;};PopupButton.prototype.destroy=function destroy(){StyledElements.Button.prototype.destroy.call(this);if(this._owned_popup_menu){this.popup_menu.destroy();}else{this.popup_menu.removeEventListener('visibilityChange',this._visibilityChangeListener);}
this.popup_menu=null;};StyledElements.PopupButton=PopupButton;})(StyledElements.Utils);;(function(utils){"use strict";var getFieldValue=function getFieldValue(item,field){var fieldPath,currentNode,currentField;if(typeof field==="string"){fieldPath=[field];}else{fieldPath=field.slice(0);}
currentNode=item;while(currentNode!=null&&fieldPath.length>0){currentField=fieldPath.splice(0,1)[0];currentNode=currentNode[currentField];}
if(fieldPath.length>0){return undefined;}
return currentNode;};var elementPassFilter=function elementPassFilter(element,pattern){return Object.getOwnPropertyNames(element).some(function(key,index,array){var value=getFieldValue(element,key);switch(typeof value){case"number":return pattern.test(""+value);case"string":return pattern.test(value);default:return false;}});};var createFilterPattern=function createFilterPattern(keywords){return new RegExp(utils.escapeRegExp(keywords),'i');};var filterElements=function filterElements(keywords){var filteredElements,i,element;var priv=privates.get(this);if(!keywords){priv.filteredElements=priv.elements.slice(0);return;}
var pattern=createFilterPattern(keywords);filteredElements=[];for(i=0;i<priv.elements.length;i+=1){element=priv.elements[i];if(elementPassFilter.call(this,element,pattern)){filteredElements.push(element);}}
priv.filteredElements=filteredElements;};var sortElements=function sortElements(order){var sort_id,inverse,column,sortFunc,parseDate;var priv=privates.get(this);if(order==null){priv.sortedElements=priv.filteredElements;return;}
sort_id=order[0];inverse=false;if(sort_id[0]==='-'){inverse=true;sort_id=sort_id.substr(1);}
column=priv.sort_info[sort_id]|| {};if(!('field'in column)){column.field=sort_id;}
sortFunc=column.sortFunc;if(sortFunc==null){switch(column.type){case"date":if(typeof column.dateparser==='function'){parseDate=column.dateparser;}else{parseDate=function(string){return new Date(string);};}
sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);try{value1=parseDate(value1);if(isNaN(value1.getTime())){throw new Error();}}catch(e){value1=new Date(0);}
value2=getFieldValue(value2,this.field);try{value2=parseDate(value2);if(isNaN(value2.getTime())){throw new Error();}}catch(e2){value2=new Date(0);}
return value1-value2;}.bind({field:column.field});break;case"number":sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);value1=value1!==null?Number(value1):0;value2=getFieldValue(value2,this.field);value2=value2!==null?Number(value2):0;return value1-value2;}.bind({field:column.field});break;default:case"text":sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);value1=value1!=null?value1.toString():'';value2=getFieldValue(value2,this.field);value2=value2!=null?value2.toString():'';return value1.localeCompare(value2);}.bind({field:column.field});}}
if(inverse){sortFunc=function(value1,value2){return-this(value1,value2);}.bind(sortFunc);}
priv.sortedElements=priv.filteredElements.slice(0).sort(sortFunc);};var requestFunc=function requestFunc(index,options,onSuccess,onError){var elements,page=index;var priv=privates.get(this);if(index>priv.totalPages){index=priv.totalPages;}
index-=1;filterElements.call(this,this.options.keywords);sortElements.call(this,this.options.order);if(options.pageSize>0){var start=index*options.pageSize;var end=start+options.pageSize;elements=priv.sortedElements.slice(start,end);}else{elements=priv.sortedElements;}
onSuccess(elements,{current_page:page,total_count:priv.sortedElements.length});};var onLengthGet=function onLengthGet(){return privates.get(this).elements.length;};var StaticPaginatedSource=function StaticPaginatedSource(options){if(typeof options!=='object'){options={};}
options.requestFunc=requestFunc.bind(this);StyledElements.PaginatedSource.call(this,options);var priv={};privates.set(this,priv);priv.sort_info=options.sort_info;if(typeof priv.sort_info!=='object'){priv.sort_info={};}
Object.defineProperties(this,{length:{get:onLengthGet}});this.changeElements(options.initialElements);};utils.inherit(StaticPaginatedSource,StyledElements.PaginatedSource);StaticPaginatedSource.prototype.changeOptions=function changeOptions(newOptions){var force_sort=false;if('keywords'in newOptions){filterElements.call(this,newOptions.keywords);force_sort=true;}
if('order'in newOptions){sortElements.call(this,newOptions.order);}else if(force_sort){sortElements.call(this,this.options.order);}
return StyledElements.PaginatedSource.prototype.changeOptions.call(this,newOptions);};StaticPaginatedSource.prototype.getElements=function getElements(){return privates.get(this).elements.slice(0);};var searchElement=function searchElement(list,el,idAttr){if(!idAttr){return-2;}
var pos=-1;list.every(function(elem,i){if(getFieldValue(elem,idAttr)===getFieldValue(el,idAttr)){pos=i;return false;}else{return true;}});return pos;};StaticPaginatedSource.prototype.changeElements=function changeElements(newElements){var priv=privates.get(this);if(Array.isArray(newElements)){if(this.options.idAttr){var bol=newElements.every(function(elem,i){if(getFieldValue(elem,this.options.idAttr)==null){throw new Error("All elements must have a valid ID");}
return searchElement(newElements.slice(0,i),elem,this.options.idAttr)<=-1;}.bind(this));if(!bol){throw new Error("All elements must have an unique ID");}}
priv.elements=newElements;}else{priv.elements=[];}
filterElements.call(this,this.options.keywords);sortElements.call(this,this.options.order);this.refresh();return this;};StaticPaginatedSource.prototype.addElement=function addElement(newElement){var priv=privates.get(this);if(this.options.idAttr&&getFieldValue(newElement,this.options.idAttr)==null){throw new Error("The element must have a valid ID");}
var pos=searchElement(priv.elements,newElement,this.options.idAttr);if(pos>=0){priv.elements.splice(pos,1);}
priv.elements.push(newElement);pos=searchElement(priv.filteredElements,newElement,this.options.idAttr);if(pos>=0){priv.filteredElements.splice(pos,1);}
if(this.options.keywords){var pattern=createFilterPattern(this.options.keywords);if(elementPassFilter.call(this,newElement,pattern)){priv.filteredElements.push(newElement);}}else{priv.filteredElements.push(newElement);}
sortElements.call(this,this.options.order);this.refresh();return this;};StaticPaginatedSource.prototype.removeElement=function removeElement(element){var priv=privates.get(this);if(!this.options.idAttr){throw new Error("options.idAttr is not set");}else{if(getFieldValue(element,this.options.idAttr)==null){throw new Error("The element must have a valid ID");}}
var pos=searchElement(priv.elements,element,this.options.idAttr);if(pos>=0){priv.elements.splice(pos,1);filterElements.call(this,this.options.keywords);sortElements.call(this,this.options.order);return this;}else{throw new Error("Element does not exist");}};var privates=new WeakMap();StyledElements.StaticPaginatedSource=StaticPaginatedSource;})(StyledElements.Utils);;(function(utils){"use strict";var FileField,onchange,onclick,onfocus,onblur;onclick=function onclick(e){if(e.target===this.inputElement){return;}
this.inputElement.click();e.stopPropagation();e.preventDefault();return false;};onchange=function onchange(){var file,filename;file=this.getValue();if(file!=null){filename=file.name;}else{filename='';}
this.name_preview.textContent=filename;this.name_preview.setAttribute('title',filename);this.dispatchEvent('change');};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.dispatchEvent('focus');};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.dispatchEvent('blur');};FileField=function FileField(options){var defaultOptions={'class':''};options=utils.merge(defaultOptions,options);StyledElements.InputElement.call(this,options.initialValue,['change','focus','blur']);this.layout=new StyledElements.HorizontalLayout({'class':'se-file-field input input-append'});this.wrapperElement=this.layout.wrapperElement;if(options.class!==""){this.wrapperElement.className+=" "+options.class;}
var wrapper=document.createElement('div');wrapper.className='input_wrapper';this.wrapperElement.appendChild(wrapper);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","file");this.inputElement.setAttribute('tabindex',0);wrapper.appendChild(this.inputElement);if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.name_preview=document.createElement('div');this.name_preview.className='filename';this.layout.getCenterContainer().appendChild(this.name_preview);var button=document.createElement('div');button.className='se-btn';var button_span=document.createElement('span');button_span.textContent=utils.gettext('Select');button.appendChild(button_span);this.layout.getEastContainer().appendChild(button);this._onchange=onchange.bind(this);this._onclick=onclick.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._onclick,true);this.inputElement.addEventListener('change',this._onchange,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);};utils.inherit(FileField,StyledElements.InputElement);FileField.prototype.repaint=function repaint(){this.layout.repaint();};FileField.prototype.insertInto=function insertInto(element,refElement){StyledElements.InputElement.prototype.insertInto.call(this,element,refElement);this.repaint();};FileField.prototype.getValue=function getValue(){return this.inputElement.files[0];};FileField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._onclick,true);this.inputElement.removeEventListener('change',this._onchange,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._onchange;delete this._onfocus;delete this._onblur;StyledElements.InputElement.prototype.destroy.call(this);};StyledElements.FileField=FileField;})(StyledElements.Utils);;(function(utils){"use strict";var update=function update(inc){var value=Number(this.inputElement.value);if(!isNaN(value)){value=Math.round((value+inc)*100)/100;if(value>this.options.max){value=this.options.max;}else if(value<this.options.min){value=this.options.min;}}else if(inc>0&&this.options.min!==Number.NEGATIVE_INFINITY){value=this.options.min;}else if(inc<0&&this.options.max!==Number.POSITIVE_INFINITY){value=this.options.max;}else{value=0;}
this.inputElement.value=value;};var onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.dispatchEvent('focus');};var onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.dispatchEvent('blur');};var NumericField=function NumericField(options){var defaultOptions={'initialValue':0,'class':'','min':Number.NEGATIVE_INFINITY,'max':Number.POSITIVE_INFINITY,'inc':1};this.options=options=utils.merge(defaultOptions,options);options.min=Number(options.min);options.max=Number(options.max);options.inc=Number(options.inc);options.initialValue=Number(options.initialValue);StyledElements.InputElement.call(this,options.initialValue,['change','focus','blur']);this.wrapperElement=document.createElement("div");this.wrapperElement.className="se-numeric-field";this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","text");if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);var topButton=new StyledElements.Button({'class':'se-numeric-field-top-button',iconClass:'fa fa-caret-up'});var bottomButton=new StyledElements.Button({'class':'se-numeric-field-bottom-button',iconClass:'fa fa-caret-down'});topButton.addEventListener("click",update.bind(this,options.inc));bottomButton.addEventListener("click",update.bind(this,-options.inc));this.inputElement.addEventListener("focus",onfocus.bind(this),true);this.inputElement.addEventListener("blur",onblur.bind(this),true);this.inputElement.addEventListener("keydown",utils.stopInputKeydownPropagationListener,false);this.wrapperElement.appendChild(this.inputElement);topButton.insertInto(this.wrapperElement);bottomButton.insertInto(this.wrapperElement);};utils.inherit(NumericField,StyledElements.InputElement);NumericField.prototype.getValue=function getValue(){return Number(this.inputElement.value);};StyledElements.NumericField=NumericField;})(StyledElements.Utils);;(function(se,utils){"use strict";var TextField,oninput,onfocus,onblur,onkeypress;oninput=function oninput(){this.dispatchEvent('change');};onfocus=function onfocus(){this.dispatchEvent('focus');};onblur=function onblur(){this.dispatchEvent('blur');};onkeypress=function onkeypress(event){if(utils.normalizeKey(event)==="Enter"){this.dispatchEvent('submit');}};TextField=function TextField(options){var defaultOptions={'initialValue':'','class':'','placeholder':null};options=utils.merge(defaultOptions,options);StyledElements.InputElement.call(this,options.initialValue,['change','focus','blur','submit','keydown']);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","text");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-text-field";if(options.class!==""){this.wrapperElement.className+=" "+options.class;}
if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.placeholder!=null){this.setPlaceholder(options.placeholder);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this._onkeypress=onkeypress.bind(this);this.inputElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.addEventListener('click',utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);this.inputElement.addEventListener('keypress',this._onkeypress,true);this._onkeydown_bound=element_onkeydown.bind(this);this.inputElement.addEventListener('keydown',this._onkeydown_bound,false);};utils.inherit(TextField,StyledElements.InputElement);TextField.prototype.setPlaceholder=function setPlaceholder(placeholder){this.inputElement.setAttribute('placeholder',placeholder);};TextField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);this.inputElement.removeEventListener('keypress',this._onkeypress,true);this.inputElement.removeEventListener('keydown',this._onkeydown_bound,false);delete this._oninput;delete this._onfocus;delete this._onblur;delete this._onkeypress;delete this._onkeydown_bound;StyledElements.InputElement.prototype.destroy.call(this);};StyledElements.TextField=TextField;var propagate_keys=['Escape','Enter'];var element_onkeydown=function element_onkeydown(event){var modifiers,key;modifiers=utils.extractModifiers(event);key=utils.normalizeKey(event);if((!modifiers.altKey&&!modifiers.metaKey&&!modifiers.ctrlKey&&propagate_keys.indexOf(key)===-1)||key==='Backspace'){event.stopPropagation();}
if(this.enabled){modifiers.preventDefault=event.preventDefault.bind(event);modifiers.stopPropagation=event.stopPropagation.bind(event);modifiers.key=key;this.dispatchEvent('keydown',modifiers,key);}};})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var TextArea,oninput,onfocus,onblur;oninput=function oninput(){this.dispatchEvent('change');};onfocus=function onfocus(){this.dispatchEvent('focus');};onblur=function onblur(){this.dispatchEvent('blur');};TextArea=function TextArea(options){var defaultOptions={'initialValue':'','class':''};options=utils.merge(defaultOptions,options);StyledElements.InputElement.call(this,options.initialValue,['blur','change','focus']);this.inputElement=document.createElement("textarea");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-text-area";if(options.class!==""){this.wrapperElement.className+=" "+options.class;}
if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.setValue(options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.addEventListener('click',utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);this.inputElement.addEventListener('keydown',utils.stopInputKeydownPropagationListener,false);};utils.inherit(TextArea,StyledElements.InputElement);TextArea.prototype.select=function select(){this.inputElement.select();};TextArea.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);this.inputElement.removeEventListener('keydown',utils.stopInputKeydownPropagationListener,false);delete this._oninput;delete this._onfocus;delete this._onblur;StyledElements.InputElement.prototype.destroy.call(this);};StyledElements.TextArea=TextArea;})(StyledElements.Utils);;(function(utils){"use strict";var itemListener=function itemListener(){if(this.listComponent.enabled){this.listComponent.toggleElementSelection(this.value);}};var _cleanSelection=function _cleanSelection(){for(var i=0;i<this.currentSelection.length;i++){var value=this.currentSelection[i];this.entriesByValue[value].element.classList.remove("selected");}
this.currentSelection=[];};var List=function List(options){options=utils.merge({class:'',id:null,multivalued:false,initialEntries:[],initialSelection:[]},options);StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=utils.prependWord(options.class,"styled_list");if(options.id!=null){this.wrapperElement.id=options.id;}
this.content=document.createElement("div");this.wrapperElement.appendChild(this.content);this.entries=[];this.entriesByValue={};this.currentSelection=[];this.addEntries(options.initialEntries);this.select(options.initialSelection);if(options.full){this.wrapperElement.classList.add("full");}
this.multivalued=options.multivalued;if(options.allowEmpty===undefined){this.allowEmpty=this.multivalued;}else{this.allowEmpty=options.allowEmpty;}};utils.inherit(List,StyledElements.StyledElement);List.prototype.addEntries=function addEntries(entries){var entryValue,entryText;if(entries==null||entries.length===0){return;}
if(!Array.isArray(entries)){throw new TypeError();}
for(var i=0;i<entries.length;i++){var entry=entries[i];if(Array.isArray(entry)){entryValue=entry[0];entryText=entry[1];}else{entryValue=entries[i].value;entryText=entries[i].label;}
entryText=entryText?entryText:entryValue;var row=document.createElement("div");row.className="row";var context={listComponent:this,value:entryValue};row.addEventListener("click",itemListener.bind(context),true);entry.element=row;row.appendChild(document.createTextNode(entryText));this.content.appendChild(row);this.entriesByValue[entryValue]=entry;}
this.entries=this.entries.concat(entries);};List.prototype.removeEntryByValue=function removeEntryByValue(value){var entry,index;entry=this.entriesByValue[value];delete this.entriesByValue[value];this.entries.slice(this.entries.indexOf(entry),1);entry.element.remove();if(index!==-1){this.currentSelection.splice(index,1);this.dispatchEvent('change',this.currentSelection,[],[value]);}};List.prototype.clear=function clear(){this.cleanSelection();this.content.innerHTML='';this.entries=[];this.entriesByValue={};};List.prototype.getSelection=function getSelection(){return utils.clone(this.currentSelection);};List.prototype.cleanSelection=function cleanSelection(){if(this.currentSelection.length===0){return;}
var oldSelection=this.currentSelection;_cleanSelection.call(this);this.dispatchEvent('change',[],[],oldSelection);};List.prototype.select=function select(selection){_cleanSelection.call(this);this.addSelection(selection);};List.prototype.addSelection=function addSelection(selection){var i,entry,addedValues=[],removedValues=[];if(selection.length===0){return;}
if(!this.multivalued){if(selection[0]===this.currentSelection[0]){return;}
removedValues=this.currentSelection;_cleanSelection.call(this);if(selection.length>1){selection=selection.splice(0,1);}}
for(i=0;i<selection.length;i++){entry=selection[i];if(this.currentSelection.indexOf(entry)===-1){this.entriesByValue[entry].element.classList.add("selected");this.currentSelection.push(entry);addedValues.push(entry);}}
this.dispatchEvent('change',this.currentSelection,addedValues,removedValues);};List.prototype.removeSelection=function removeSelection(selection){var i,entry,index,removedValues=[];if(selection.length===0){return;}
for(i=0;i<selection.length;i++){entry=selection[i];this.entriesByValue[entry].element.classList.remove("selected");index=this.currentSelection.indexOf(entry);if(index!==-1){this.currentSelection.splice(index,1);this.entriesByValue[entry].element.classList.remove("selected");removedValues.push(entry);}}
if(removedValues.length>0){this.dispatchEvent('change',this.currentSelection,[],removedValues);}};List.prototype.toggleElementSelection=function toggleElementSelection(element){if(!this.entriesByValue[element].element.classList.contains("selected")){this.addSelection([element]);}else if(this.allowEmpty){this.removeSelection([element]);}};StyledElements.List=List;})(StyledElements.Utils);;(function(utils){"use strict";var PasswordField,oninput,onfocus,onblur;oninput=function oninput(){this.dispatchEvent('change');};onfocus=function onfocus(){this.dispatchEvent('focus');};onblur=function onblur(){this.dispatchEvent('blur');};PasswordField=function PasswordField(options){var defaultOptions={'initialValue':'','class':''};options=utils.merge(defaultOptions,options);StyledElements.InputElement.call(this,options.initialValue,['change','focus','blur']);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","password");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-password-field";if(options.class!==""){this.wrapperElement.className+=" "+options.class;}
if('name'in options){this.inputElement.setAttribute("name",options.name);}
if('id'in options){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.addEventListener('click',utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);this.inputElement.addEventListener('keydown',utils.stopInputKeydownPropagationListener,false);};utils.inherit(PasswordField,StyledElements.InputElement);PasswordField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);this.inputElement.removeEventListener('keydown',utils.stopInputKeydownPropagationListener,false);StyledElements.InputElement.prototype.destroy.call(this);};StyledElements.PasswordField=PasswordField;})(StyledElements.Utils);;(function(utils){"use strict";var Select,onchange,onfocus,onblur;onchange=function onchange(event){if(this.enabled){var optionList=event.target;this.textDiv.textContent=optionList[optionList.selectedIndex].text;this.dispatchEvent('change');}};onfocus=function onfocus(){this.addClassName('focus').dispatchEvent('focus');};onblur=function onblur(){this.removeClassName('focus').dispatchEvent('blur');};Select=function Select(options){options=utils.merge({'class':'','initialEntries':[],'initialValue':null,'idFunc':function(value){return value==null?'':value.toString();}},options);StyledElements.InputElement.call(this,options.initialValue,['change','focus','blur']);this.wrapperElement=document.createElement("div");this.wrapperElement.className="se-select";this.addClassName(options.class);var div=document.createElement("div");div.className="se-select-arrow";this.inputElement=document.createElement("select");if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id){this.wrapperElement.setAttribute("id",options.id);}
this.textDiv=document.createElement("div");this.textDiv.className="se-select-text";this.wrapperElement.appendChild(this.textDiv);this.wrapperElement.appendChild(div);this.wrapperElement.appendChild(this.inputElement);this.optionsByValue={};this.optionValues={};this.idFunc=options.idFunc;this.addEntries(options.initialEntries);this._onchange=onchange.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.addEventListener('click',utils.stopPropagationListener,true);this.inputElement.addEventListener('change',this._onchange,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);var selectedIndex=this.inputElement.options.selectedIndex;if(selectedIndex!==-1){this.textDiv.textContent=this.inputElement.options[selectedIndex].text;}};utils.inherit(Select,StyledElements.InputElement);Select.prototype.getLabel=function getLabel(){return this.textDiv.textContent;};Select.prototype.getValue=function getValue(){return this.optionValues[this.inputElement.value];};Select.prototype.setValue=function setValue(newValue){if(typeof newValue!=='string'){try{newValue=this.idFunc(newValue);}catch(e){newValue=null;}}
if(newValue===null||!(newValue in this.optionValues)){if(this.defaultValue!=null){newValue=this.defaultValue;}else if(this.inputElement.options.length>0){newValue=this.inputElement.options[0].value;}else{StyledElements.InputElement.prototype.setValue.call(this,'');this.textDiv.textContent='';return;}}
StyledElements.InputElement.prototype.setValue.call(this,newValue);this.textDiv.textContent=this.optionsByValue[newValue];};Select.prototype.addEntries=function addEntries(newEntries){var oldSelectedIndex,optionValue,optionLabel,newEntry,defaultValue;oldSelectedIndex=this.inputElement.options.selectedIndex;defaultValue=this.defaultValue!==undefined?this.idFunc(this.defaultValue):null;if(newEntries==null||newEntries.length===0){return;}
for(var i=0;i<newEntries.length;i++){newEntry=newEntries[i];var option=document.createElement("option");if(Array.isArray(newEntry)){optionValue=newEntry[0];optionLabel=newEntry[1];}else if(newEntry.value!=null){optionValue=newEntry.value;optionLabel=newEntry.label;}else{optionValue=newEntry;optionLabel=newEntry;}
optionLabel=optionLabel?optionLabel:optionValue;var realValue=optionValue;if(typeof optionValue!=='string'){optionValue=this.idFunc(optionValue);}
option.setAttribute("value",optionValue);option.appendChild(document.createTextNode(optionLabel));if(defaultValue===optionValue){option.setAttribute("selected","selected");}
this.inputElement.appendChild(option);this.optionValues[optionValue]=realValue;this.optionsByValue[optionValue]=optionLabel;}
var selectedIndex=this.inputElement.options.selectedIndex;if(oldSelectedIndex!==selectedIndex){this.textDiv.textContent=this.inputElement.options[selectedIndex].text;}};Select.prototype.clear=function clear(){this.textDiv.textContent="";this.inputElement.textContent="";this.optionsByValue={};this.optionValues={};};Select.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',utils.stopPropagationListener,true);this.inputElement.removeEventListener('change',this._onchange,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._onchange;delete this._onfocus;delete this._onblur;StyledElements.InputElement.prototype.destroy.call(this);};StyledElements.Select=Select;})(StyledElements.Utils);;(function(utils){"use strict";StyledElements.ToggleButton=function ToggleButton(options){var defaultOptions={'initiallyChecked':false};options=utils.merge(defaultOptions,options);StyledElements.Button.call(this,options);Object.defineProperty(this,'active',{get:function get(){return this.hasClassName('active');},set:function set(value){this.toggleClassName('active',value);}});this.active=options.initiallyChecked;};utils.inherit(StyledElements.ToggleButton,StyledElements.Button);StyledElements.ToggleButton.prototype._clickCallback=function _clickCallback(event){event.stopPropagation();this.click();};StyledElements.ToggleButton.prototype.click=function click(){if(this.enabled){this.active=!this.active;this.dispatchEvent('click');}
return this;};})(StyledElements.Utils);;(function(utils){"use strict";var clickCallback=function clickCallback(id,e){e.preventDefault();e.stopPropagation();this.switchPill(id);};var Pills=function Pills(options){var defaultOptions={'class':''};options=utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement("ul");this.wrapperElement.className=utils.appendWord(options.class,"se-pills");this.activePill=null;this.pills={};};utils.inherit(Pills,StyledElements.Container);Pills.prototype.add=function add(id,label){var pill=document.createElement('li');pill.className='se-pill';pill.textContent=label;pill.addEventListener('click',clickCallback.bind(this,id),true);this.wrapperElement.appendChild(pill);this.pills[id]=pill;};Pills.prototype.switchPill=function switchPill(id){if(!(id in this.pills)){throw new TypeError('Invalid pill id');}
if(id===this.activePill){return;}
if(this.activePill!=null){this.pills[this.activePill].classList.remove('active');}
this.activePill=id;this.pills[this.activePill].classList.add('active');this.dispatchEvent('change',id);};StyledElements.Pills=Pills;})(StyledElements.Utils);;(function(se,utils){"use strict";var Tab=function Tab(id,notebook,options){if(!(notebook instanceof se.Notebook)){throw new TypeError("Invalid notebook argument");}
var defaultOptions={'closable':true,'containerOptions':{},'label':''};options=utils.merge(defaultOptions,options);options.useFullHeight=true;Object.defineProperties(this,{label:{get:on_label_get},notebook:{value:notebook},tabElement:{get:on_tabelement_get},tabId:{value:id}});var priv={labelElement:document.createElement('span'),tabElement:document.createElement("li")};privates.set(this,priv);priv.tabElement.className="se-notebook-tab";priv.tabElement.appendChild(priv.labelElement);se.Container.call(this,options.containerOptions,['show','hide','close']);this.wrapperElement.classList.add("se-notebook-tab-content");this.wrapperElement.classList.add("hidden");priv.tabElement.addEventListener("click",function(){this.notebook.goToTab(this.tabId);}.bind(this),false);if(options.closable){var closeButton=new this.Button({iconClass:"fa fa-remove",plain:true,class:"close_button"});closeButton.insertInto(priv.tabElement);closeButton.addEventListener("click",this.close.bind(this),false);}
if(options.name!=null){options.label=options.name;}
Tab.prototype.setLabel.call(this,options.label);this.setTitle(options.title);};utils.inherit(Tab,se.Container);Tab.prototype.Tooltip=se.Tooltip;Tab.prototype.Button=se.Button;Tab.prototype.close=function close(){this.notebook.removeTab(this.tabId);return this.dispatchEvent("close");};Tab.prototype.setLabel=function setLabel(newLabel){privates.get(this).labelElement.textContent=newLabel;return this;};Tab.prototype.setTitle=function setTitle(title){if(title==null||title===''){if(this.tooltip!=null){this.tooltip.destroy();this.tooltip=null;}}else{if(this.tooltip==null){this.tooltip=new this.Tooltip({content:title,placement:['bottom','top','right','left']});this.tooltip.bind(privates.get(this).tabElement);}
this.tooltip.options.content=title;}
return this;};Tab.prototype.setVisible=function setVisible(newStatus){return newStatus?this.show():this.hide();};Tab.prototype.hide=function hide(){se.Container.prototype.hide.call(this);privates.get(this).tabElement.classList.remove("selected");return this;};Tab.prototype.show=function show(){se.Container.prototype.show.call(this);privates.get(this).tabElement.classList.add("selected");this.repaint(false);return this;};Tab.prototype.getId=function getId(){return this.tabId;};Tab.prototype.getTabElement=function getTabElement(){return privates.get(this).tabElement;};Tab.prototype.rename=Tab.prototype.setLabel;var privates=new WeakMap();var on_label_get=function on_label_get(){return privates.get(this).tabElement.textContent;};var on_tabelement_get=function on_tabelement_get(){return privates.get(this).tabElement;};se.Tab=Tab;})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var onNewTab=function onNewTab(){this.dispatchEvent('newTab');};var Notebook=function Notebook(options){var tabWrapper;StyledElements.StyledElement.call(this,['change','changed','tabDeletion','tabInsertion','newTab']);var defaultOptions={'class':'','focusOnSetVisible':true,'full':true};options=utils.merge(defaultOptions,options);this.wrapperElement=document.createElement("div");this.wrapperElement.className=utils.prependWord(options.class,"se-notebook");tabWrapper=new StyledElements.HorizontalLayout({'class':'se-notebook-tabs-wrapper','autoHeight':false});this.tabWrapper=tabWrapper;tabWrapper.insertInto(this.wrapperElement);this.tabArea=new StyledElements.Container();tabWrapper.center.appendChild(this.tabArea.addClassName('se-notebook-tab-area'));this.moveLeftButton=new this.Button({class:'move_left',iconClass:'fa fa-caret-left'});tabWrapper.west.appendChild(this.moveLeftButton);this.moveRightButton=new this.Button({class:'move_right',iconClass:'fa fa-caret-right'});tabWrapper.east.appendChild(this.moveRightButton);this.contentArea=document.createElement("div");this.contentArea.className="se-notebook-content-wrapper";this.wrapperElement.appendChild(this.contentArea);this.tabs=[];this.tabsById=[];this.visibleTab=null;if(options.id!=null){this.wrapperElement.setAttribute('id',options.id);}
if(options.full){this.wrapperElement.classList.add('full');}
this.focusOnSetVisible=options.focusOnSetVisible;this.events.newTab.addEventListener=function addEventListener(listener){var new_tab_main_listener;if(this.new_tab_button_tabs==null){new_tab_main_listener=onNewTab.bind(this);this.new_tab_button_tabs=new this.Button({iconClass:'fa fa-plus','class':'se-notebook-new-tab',title:utils.gettext('Add Tab')});this.new_tab_button_tabs.addEventListener('click',new_tab_main_listener);this.tabArea.appendChild(this.new_tab_button_tabs);this.new_tab_button_left=new this.Button({iconClass:'fa fa-plus','class':'se-notebook-new-tab',title:utils.gettext('Add Tab')});this.new_tab_button_left.addEventListener('click',new_tab_main_listener);this.addButton(this.new_tab_button_left);}
StyledElements.Event.prototype.addEventListener.call(this.events.newTab,listener);}.bind(this);var context={control:this,initialScrollLeft:null,finalScrollLeft:null,steps:null,step:null,inc:null};var stepFunc=function stepFunc(step,context){var scrollLeft=context.initialScrollLeft+Math.floor((step+1)*context.inc);if((context.inc<0)&&(scrollLeft>context.finalScrollLeft)||(context.inc>0)&&(scrollLeft<context.finalScrollLeft)){context.control.tabArea.wrapperElement.scrollLeft=Math.round(scrollLeft);return true;}else{context.control.tabArea.wrapperElement.scrollLeft=context.finalScrollLeft;enableDisableButtons.call(context.control);return false;}};var initFunc=function initFunc(context,command){var firstVisibleTab,currentTab,maxScrollLeft,baseTime,stepTimes,computedStyle,padding;context.initialScrollLeft=context.control.tabArea.wrapperElement.scrollLeft;computedStyle=document.defaultView.getComputedStyle(context.control.tabArea.wrapperElement,null);padding=computedStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);switch(command.type){case'shiftLeft':if(context.control.tabs.length===0||isTabVisible.call(context.control,0)){return false;}
firstVisibleTab=getFirstVisibleTab.call(context.control);currentTab=context.control.tabs[firstVisibleTab-1].getTabElement();context.finalScrollLeft=currentTab.offsetLeft-padding;break;case'shiftRight':if(isLastTabVisible.call(context.control)){return false;}
firstVisibleTab=getFirstVisibleTab.call(context.control);currentTab=context.control.tabs[firstVisibleTab+1].getTabElement();context.finalScrollLeft=currentTab.offsetLeft-padding;break;case'focus':if(context.control.tabsById[command.tabId]==null){return false;}
currentTab=context.control.tabsById[command.tabId].getTabElement();if(isTabVisible.call(context.control,context.control.getTabIndex(command.tabId),true)){return false;}
context.finalScrollLeft=currentTab.offsetLeft-padding;break;}
maxScrollLeft=context.control.tabArea.wrapperElement.scrollWidth-context.control.tabArea.wrapperElement.clientWidth;if(context.finalScrollLeft>maxScrollLeft){context.finalScrollLeft=maxScrollLeft;}
baseTime=(new Date()).getTime()+100;stepTimes=[];context.steps=6;for(var i=0;i<=context.steps;i++){stepTimes[i]=baseTime+(i*100);}
context.step=0;context.inc=Math.floor((context.finalScrollLeft-context.initialScrollLeft)/context.steps);return new Promise((resolve,reject)=>{var doStep=function doStep(){var cont=stepFunc(context.step,context);if(cont){var timeDiff=stepTimes[context.step]-(new Date()).getTime();if(timeDiff<0){timeDiff=0;}
context.step++;setTimeout(doStep,timeDiff);}else{resolve();}};doStep();});};this.transitionsQueue=new StyledElements.CommandQueue(context,initFunc);this.moveLeftButton.addEventListener("click",this.shiftLeftTabs.bind(this));this.moveRightButton.addEventListener("click",this.shiftRightTabs.bind(this));Object.defineProperty(this,'fullscreen',{get:function(){return utils.getFullscreenElement()===this.wrapperElement;}});};utils.inherit(Notebook,StyledElements.StyledElement);Notebook.prototype.Button=StyledElements.Button;Notebook.prototype.Tab=StyledElements.Tab;var isTabVisible=function isTabVisible(tabIndex,full){var tabElement,tabAreaStart,tabAreaEnd,tabOffsetRight;tabElement=this.tabs[tabIndex].getTabElement();tabAreaStart=this.tabArea.wrapperElement.scrollLeft;tabAreaEnd=tabAreaStart+this.tabArea.wrapperElement.clientWidth;if(full){tabOffsetRight=tabElement.offsetLeft+tabElement.offsetWidth;return tabElement.offsetLeft>=tabAreaStart&&tabOffsetRight<=tabAreaEnd;}else{return tabElement.offsetLeft>=tabAreaStart&&tabElement.offsetLeft<=tabAreaEnd;}};var isLastTabVisible=function isLastTabVisible(){var lastTab=this.tabs.length-1;if(this.tabs.length===0||isTabVisible.call(this,lastTab,true)){return true;}
if(!isTabVisible.call(this,lastTab)){return false;}
return this.tabs.length<2||!isTabVisible.call(this,lastTab-1);};var enableDisableButtons=function enableDisableButtons(){if(this.tabs.length===0){this.moveLeftButton.disable();this.moveRightButton.disable();if(this.new_tab_button_tabs!=null){this.new_tab_button_tabs.enable();this.new_tab_button_left.disable();}
return;}
var first_tab_visible=isTabVisible.call(this,0);var last_tab_visible=isLastTabVisible.call(this);this.moveLeftButton.setDisabled(first_tab_visible);this.moveRightButton.setDisabled(last_tab_visible);if(this.new_tab_button_tabs!=null){if(first_tab_visible&&last_tab_visible){this.new_tab_button_tabs.enable();this.new_tab_button_left.disable();}else{this.new_tab_button_tabs.disable();this.new_tab_button_left.enable();}
this.tabWrapper.repaint();}};var getFirstVisibleTab=function getFirstVisibleTab(){var i;for(i=0;i<this.tabs.length;i+=1){if(isTabVisible.call(this,i)){return i;}}
return null;};Notebook.prototype.shiftLeftTabs=function shiftLeftTabs(){return this.transitionsQueue.addCommand({type:'shiftLeft'});};Notebook.prototype.shiftRightTabs=function shiftRightTabs(){return this.transitionsQueue.addCommand({type:'shiftRight'});};Notebook.prototype.createTab=function createTab(options){var defaultOptions={initiallyVisible:false,tab_constructor:this.Tab};options=utils.merge(defaultOptions,options);var tabId=this.tabsById.push(null);if((options.tab_constructor!==this.Tab)&&!(options.tab_constructor.prototype instanceof StyledElements.Tab)){throw new TypeError();}
var tab=new options.tab_constructor(tabId,this,options);this.tabs[this.tabs.length]=tab;this.tabsById[tabId]=tab;var tabElement=tab.getTabElement();if(this.new_tab_button_tabs!=null){this.tabArea.prependChild(tabElement,this.new_tab_button_tabs);}else{this.tabArea.appendChild(tabElement);}
tab.insertInto(this.contentArea);if(!this.visibleTab){this.visibleTab=tab;tab.setVisible(true);}
enableDisableButtons.call(this);if(options.initiallyVisible){this.goToTab(tabId);}
this.dispatchEvent('tabInsertion',tab);return tab;};Notebook.prototype.getTab=function getTab(id){return this.tabsById[id];};Notebook.prototype.getTabByLabel=function getTabByLabel(label){for(var i=0;i<this.tabs.length;i++){if(this.tabs[i].label===label){return this.tabs[i];}}
return null;};Notebook.prototype.getVisibleTab=function getVisibleTab(){return this.visibleTab;};Notebook.prototype.getTabByIndex=function getTabByIndex(index){return this.tabs[index];};Notebook.prototype.getTabIndex=function getTabIndex(id){for(var i=0;i<this.tabs.length;i++){if(this.tabs[i].tabId===id){return i;}}
return null;};Notebook.prototype.removeTab=function removeTab(tab){var index,tabToExtract,nextTab;if(tab instanceof StyledElements.Tab){if(this.tabsById[tab.tabId]!==tab){throw new TypeError('tab is not owned by this notebook');}
tab=tab.getId();}
if(!this.tabsById[tab]){return this;}
delete this.tabsById[tab];index=this.getTabIndex(tab);tabToExtract=this.tabs.splice(index,1)[0];this.tabArea.removeChild(tabToExtract.getTabElement());this.contentArea.removeChild(tabToExtract.wrapperElement);enableDisableButtons.call(this);if((this.visibleTab===tabToExtract)&&(this.tabs.length>0)){nextTab=this.tabs[index];if(!nextTab){nextTab=this.tabs[index-1];}
this.goToTab(nextTab.tabId);}else if(this.visibleTab===tabToExtract){this.visibleTab=null;}
tabToExtract.dispatchEvent('close',this);this.dispatchEvent('tabDeletion',tabToExtract);return this;};Notebook.prototype.goToTab=function goToTab(tab,options){var newTab,oldTab;if(tab instanceof StyledElements.Tab){if(this.tabsById[tab.tabId]!==tab){throw new TypeError('tab is not owned by this notebook');}
newTab=tab;}else{newTab=this.tabsById[tab];if(newTab==null){throw new TypeError('Invalid tab id');}}
oldTab=this.visibleTab;if(options==null){options={};}
if(this.visibleTab&&newTab===this.visibleTab){if(this.focusOnSetVisible){this.focus(newTab.tabId);}
return;}
this.dispatchEvent('change',oldTab,newTab,options.context);if(this.visibleTab){this.visibleTab.setVisible(false);}
this.visibleTab=newTab;this.visibleTab.setVisible(true);if(this.focusOnSetVisible){this.focus(newTab.tabId);}
this.dispatchEvent('changed',oldTab,newTab,options.context);};Notebook.prototype.getNumberOfTabs=function getNumberOfTabs(){return this.tabs.length;};Notebook.prototype.focus=function focus(tab){if(tab instanceof StyledElements.Tab){if(this.tabsById[tab.tabId]!==tab){throw new TypeError('tab is not owned by this notebook');}}else{tab=this.tabsById[tab];if(tab==null){throw new TypeError('Invalid tab id');}}
return this.transitionsQueue.addCommand({type:'focus',tabId:tab.tabId});};Notebook.prototype.repaint=function repaint(temporal){var i;temporal=temporal!=null?temporal:false;this.tabWrapper.repaint();enableDisableButtons.call(this);if(temporal){if(this.visibleTab){this.visibleTab.repaint(true);}}else{for(i=0;i<this.tabs.length;i++){this.tabs[i].repaint(false);}}
return this;};Notebook.prototype._onenabled=function _onenabled(enabled){if(!enabled){this.disabledLayer=document.createElement('div');this.disabledLayer.classList.add('se-container-disable-layer');this.wrapperElement.appendChild(this.disabledLayer);}else{this.disabledLayer.remove();this.disabledLayer=null;}};Notebook.prototype.clear=function clear(){this.tabs=[];this.tabsById=[];this.visibleTab=null;this.tabArea.clear();this.contentArea.innerHTML='';enableDisableButtons.call(this);return this;};Notebook.prototype.addButton=function addButton(button,position){if(!(button instanceof StyledElements.Button)&&!(button instanceof StyledElements.Select)){throw new TypeError();}
position=position||'right';switch(position){case'left':this.tabWrapper.west.prependChild(button,this.moveLeftButton);break;case'right':this.tabWrapper.east.appendChild(button);break;}
enableDisableButtons.call(this);return this;};Notebook.prototype.requestFullscreen=function requestFullscreen(){if('requestFullscreen'in this.wrapperElement){this.wrapperElement.requestFullscreen();}else if('msRequestFullscreen'in this.wrapperElement){this.wrapperElement.msRequestFullscreen();}else if('mozRequestFullScreen'in this.wrapperElement){this.wrapperElement.mozRequestFullScreen();}else if('webkitRequestFullscreen'in this.wrapperElement){this.wrapperElement.webkitRequestFullscreen();}
return this;};Notebook.prototype.exitFullscreen=function exitFullscreen(){if(this.fullscreen!==true){return this;}
if('exitFullscreen'in document){document.exitFullscreen();}else if('msExitFullscreen'in document){document.msExitFullscreen();}else if('mozCancelFullScreen'in document){document.mozCancelFullScreen();}else if('webkitExitFullscreen'in document){document.webkitExitFullscreen();}
return this;};Notebook.prototype.destroy=function destroy(){this.remove();this.tabs=null;this.tabsById=null;this.visibleTab=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Notebook=Notebook;})(StyledElements.Utils);;(function(se,utils){"use strict";var Alternative=function Alternative(id,options){se.Container.call(this,options,['hide','show']);this.addClassName('hidden');Object.defineProperties(this,{altId:{value:id}});};utils.inherit(Alternative,se.Container);Alternative.prototype._onhidden=function _onhidden(hidden){if(!hidden){this.repaint(false);}
return se.Container.prototype._onhidden.call(this,hidden);};Alternative.prototype.setVisible=function setVisible(visible){return visible?this.show():this.hide();};Alternative.prototype.isVisible=function isVisible(){return!this.hidden;};Alternative.prototype.getId=function getId(){return this.altId;};se.Alternative=Alternative;})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var Alternatives=function Alternatives(options){var defaultOptions={'class':'','full':true,'defaultEffect':StyledElements.Alternatives.NONE};options=utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['preTransition','postTransition']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=utils.prependWord(options.class,"se-alternatives");if(options.id){this.wrapperElement.setAttribute("id",options.id);}
if(options.full){this.wrapperElement.classList.add("full");}
Object.defineProperties(this,{alternatives:{get:on_alternatives_get},alternativeList:{get:on_alternative_list_get},defaultEffect:{value:options.defaultEffect,writable:true}});var initFunc=function initFunc(context,command){var inAlternative,outAlternative,p,priv=privates.get(context);p=Promise.resolve();switch(command.type){case"transit":inAlternative=command.inAlternative;outAlternative=context.visibleAlt;if(inAlternative===outAlternative){utils.callCallback(command.onComplete,context,outAlternative,inAlternative);return false;}
p=build_transit_promise(command.effect,outAlternative,inAlternative,context);break;case"remove":outAlternative=command.outAlternative;if(priv.visibleAlt===outAlternative){if(priv.alternativeList.length>0){inAlternative=priv.alternativeList[command.index];if(!inAlternative){inAlternative=priv.alternativeList[command.index-1];}
p=build_transit_promise(command.effect,outAlternative,inAlternative,context);}else{priv.visibleAlt=null;}}
p=p.then(function(){context.wrapperElement.removeChild(outAlternative.wrapperElement);}.bind(this));}
return p.then(function(){utils.callCallback(command.onComplete,context,outAlternative,inAlternative);});};privates.set(this,{nextAltId:0,transitionsQueue:new StyledElements.CommandQueue(this,initFunc),visibleAlt:null,alternatives:{},alternativeList:[]});};utils.inherit(Alternatives,StyledElements.StyledElement);Alternatives.HORIZONTAL_FLIP="horizontalflip";Alternatives.HORIZONTAL_SLIDE="horizontalslide";Alternatives.CROSS_DISSOLVE="dissolve";Alternatives.NONE="none";Alternatives.prototype.repaint=function repaint(temporal){var priv=privates.get(this);if(priv.visibleAlt!=null){priv.visibleAlt.repaint(!!temporal);}
return this;};Alternatives.prototype.createAlternative=function createAlternative(options){var priv=privates.get(this);var defaultOptions={alternative_constructor:StyledElements.Alternative,containerOptions:{},initiallyVisible:false};options=utils.update(defaultOptions,options);options.containerOptions.parentElement=this;var altId=privates.get(this).nextAltId++;if((options.alternative_constructor!==StyledElements.Alternative)&&!(options.alternative_constructor.prototype instanceof StyledElements.Alternative)){throw new TypeError();}
var alt=new options.alternative_constructor(altId,options.containerOptions);alt.parentElement=this;alt.insertInto(this.wrapperElement);priv.alternatives[altId]=alt;priv.alternativeList.push(alt);if(!priv.visibleAlt){priv.visibleAlt=alt;alt.setVisible(true);}else if(options.initiallyVisible){this.showAlternative(alt);}
return alt;};Alternatives.prototype.removeAlternative=function removeAlternative(alternative,options){var index,id,priv;priv=privates.get(this);options=utils.update({effect:this.defaultEffect,onComplete:null},options);if(alternative instanceof StyledElements.Alternative){id=alternative.altId;if(priv.alternatives[id]!==alternative){throw new TypeError('alternative is not owner by this alternatives element');}}else{id=alternative;alternative=priv.alternatives[alternative];if(!alternative){utils.callCallback(options.onComplete);return Promise.resolve();}}
delete priv.alternatives[id];index=priv.alternativeList.indexOf(alternative);priv.alternativeList.splice(index,1);return priv.transitionsQueue.addCommand({effect:options.effect,index:index,type:"remove",onComplete:options.onComplete,outAlternative:alternative});};Alternatives.prototype.clear=function clear(){var priv=privates.get(this);priv.alternatives={};priv.alternativeList=[];priv.nextAltId=0;priv.visibleAlt=null;this.wrapperElement.innerHTML='';return this;};Alternatives.prototype.getCurrentAlternative=function getCurrentAlternative(){return privates.get(this).visibleAlt;};Object.defineProperties(Alternatives.prototype,{visibleAlt:{get:Alternatives.prototype.getCurrentAlternative}});Alternatives.prototype.showAlternative=function showAlternative(alternative,options){var priv,command={};options=utils.update({effect:this.defaultEffect,onComplete:null},options);priv=privates.get(this);if(alternative instanceof StyledElements.Alternative){if(priv.alternatives[alternative.altId]!==alternative){throw new TypeError('Invalid alternative');}
command.inAlternative=alternative;}else{if(priv.alternatives[alternative]==null){throw new TypeError('Invalid alternative');}
command.inAlternative=priv.alternatives[alternative];}
command.type="transit";command.onComplete=options.onComplete;command.effect=options.effect;return priv.transitionsQueue.addCommand(command);};var privates=new WeakMap();var on_alternatives_get=function on_alternatives_get(){return utils.clone(privates.get(this).alternatives);};var on_alternative_list_get=function on_alternative_list_get(){return privates.get(this).alternativeList.slice(0);};var build_transit_promise=function build_transit_promise(effect,outAlternative,inAlternative,context){var p=new Promise(function(fulfill){context.dispatchEvent('preTransition',outAlternative,inAlternative);context.wrapperElement.classList.add('se-on-transition');fulfill();});switch(effect){case StyledElements.Alternatives.HORIZONTAL_SLIDE:outAlternative.addClassName('slide');inAlternative.addClassName(['slide',inAlternative.altId<outAlternative.altId?'left':'right']).show();p=p.then(function(){return Promise.all([utils.waitTransition(inAlternative.get()),utils.waitTransition(outAlternative.get())]);}).then(function(){inAlternative.removeClassName('slide');outAlternative.removeClassName('slide left right').hide();});setTimeout(function(){outAlternative.addClassName(inAlternative.altId<outAlternative.altId?'right':'left');inAlternative.removeClassName('left right');},10);break;case StyledElements.Alternatives.CROSS_DISSOLVE:inAlternative.addClassName('fade').show();outAlternative.addClassName('fade in');p=p.then(function(){return Promise.all([utils.waitTransition(inAlternative.get()),utils.waitTransition(outAlternative.get())]);}).then(function(){inAlternative.removeClassName('fade in');outAlternative.removeClassName('fade').hide();});setTimeout(function(){inAlternative.addClassName('in');outAlternative.removeClassName('in');},10);break;default:case StyledElements.Alternatives.NONE:p=p.then(function(){inAlternative.show();outAlternative.hide();});}
return p.then(function(){privates.get(context).visibleAlt=inAlternative;context.wrapperElement.classList.remove('se-on-transition');context.dispatchEvent('postTransition',outAlternative,inAlternative);});};StyledElements.Alternatives=Alternatives;})(StyledElements.Utils);;(function(utils){"use strict";var HorizontalLayout=function HorizontalLayout(options){StyledElements.StyledElement.call(this,[]);this.options=utils.merge({'class':''},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className=utils.appendWord(this.options.class,"se-horizontal-layout");this.west=new StyledElements.Container({'class':'se-hl-west-container'});this.center=new StyledElements.Container({'class':'se-hl-center-container'});this.east=new StyledElements.Container({'class':'se-hl-east-container'});this.west.insertInto(this.wrapperElement);this.center.insertInto(this.wrapperElement);this.east.insertInto(this.wrapperElement);};utils.inherit(HorizontalLayout,StyledElements.StyledElement);HorizontalLayout.prototype.repaint=function repaint(temporal){this.west.repaint(temporal);this.center.repaint(temporal);this.east.repaint(temporal);};HorizontalLayout.prototype.getWestContainer=function getWestContainer(){return this.west;};HorizontalLayout.prototype.getCenterContainer=function getCenterContainer(){return this.center;};HorizontalLayout.prototype.getEastContainer=function getEastContainer(){return this.east;};StyledElements.HorizontalLayout=HorizontalLayout;})(StyledElements.Utils);;(function(utils){"use strict";var VerticalLayout=function VerticalLayout(options){StyledElements.StyledElement.call(this,[]);this.options=utils.merge({'class':''},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className=utils.appendWord(this.options.class,"se-vertical-layout");this.north=new StyledElements.Container({'class':'se-vl-north-container'});this.center=new StyledElements.Container({'class':'se-vl-center-container'});this.south=new StyledElements.Container({'class':'se-vl-south-container'});this.north.insertInto(this.wrapperElement);this.center.insertInto(this.wrapperElement);this.south.insertInto(this.wrapperElement);};utils.inherit(VerticalLayout,StyledElements.StyledElement);VerticalLayout.prototype.repaint=function repaint(temporal){this.north.repaint(temporal);this.center.repaint(temporal);this.south.repaint(temporal);};StyledElements.VerticalLayout=VerticalLayout;})(StyledElements.Utils);;(function(utils){"use strict";var BorderLayout=function BorderLayout(options){StyledElements.StyledElement.call(this,[]);options=utils.merge({'class':''},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className=utils.appendWord(options.class,"se-border-layout");Object.defineProperties(this,{north:{value:new StyledElements.Container({'class':'se-bl-north-container'})},west:{value:new StyledElements.Container({'class':'se-bl-west-container'})},center:{value:new StyledElements.Container({'class':'se-bl-center-container'})},east:{value:new StyledElements.Container({'class':'se-bl-east-container'})},south:{value:new StyledElements.Container({'class':'se-bl-south-container'})}});this.north.insertInto(this.wrapperElement);this.west.insertInto(this.wrapperElement);this.center.insertInto(this.wrapperElement);this.east.insertInto(this.wrapperElement);this.south.insertInto(this.wrapperElement);};utils.inherit(BorderLayout,StyledElements.StyledElement);BorderLayout.prototype.repaint=function repaint(temporal){var usableArea={'width':this.wrapperElement.offsetWidth,'height':this.wrapperElement.offsetHeight};var h1=this.north.wrapperElement.offsetHeight;var h2=usableArea.height-this.south.wrapperElement.offsetHeight;var centerHeight=h2-h1;if(centerHeight<0){centerHeight=0;}
var v1=this.west.wrapperElement.offsetWidth;var v2=usableArea.width-this.east.wrapperElement.offsetWidth;var centerWidth=v2-v1;if(centerWidth<0){centerWidth=0;}
this.west.wrapperElement.style.top=h1+'px';this.west.wrapperElement.style.height=centerHeight+'px';this.center.wrapperElement.style.top=h1+'px';this.center.wrapperElement.style.height=centerHeight+'px';this.center.wrapperElement.style.width=centerWidth+'px';this.center.wrapperElement.style.left=v1+'px';this.east.wrapperElement.style.top=h1+'px';this.east.wrapperElement.style.height=centerHeight+'px';this.east.wrapperElement.style.left=v2+'px';this.south.wrapperElement.style.top=h2+'px';this.north.repaint(temporal);this.west.repaint(temporal);this.center.repaint(temporal);this.east.repaint(temporal);this.south.repaint(temporal);};BorderLayout.prototype.getNorthContainer=function getNorthContainer(){return this.north;};BorderLayout.prototype.getWestContainer=function getWestContainer(){return this.west;};BorderLayout.prototype.getCenterContainer=function getCenterContainer(){return this.center;};BorderLayout.prototype.getEastContainer=function getEastContainer(){return this.east;};BorderLayout.prototype.getSouthContainer=function getSouthContainer(){return this.south;};StyledElements.BorderLayout=BorderLayout;})(StyledElements.Utils);;(function(utils){"use strict";var buildHeader=function buildHeader(){var i,column,cell,label,tooltip;var priv=privates.get(this);priv.headerCells=[];for(i=0;i<this.columns.length;i+=1){column=this.columns[i];label=column.label!=null?column.label:column.field;cell=document.createElement('div');cell.className='se-model-table-cell';if(typeof column.class==='string'){cell.classList.add(column.class);}
if(column.width!=null&&column.width!=="css"){cell.style.width=column.width;cell.style.flexGrow=0;}else if(column.width==="css"){cell.style.flexGrow=0;}
cell.textContent=label;if(column.sortable!==false){cell.classList.add('sortable');tooltip=new this.Tooltip({content:utils.interpolate(utils.gettext('Sort by %(column_name)s'),{column_name:label}),placement:['bottom','top','right','left']});tooltip.bind(cell);cell.callback=sortByColumnCallback.bind({widget:this,column:i});cell.addEventListener('click',cell.callback,true);}
priv.header.appendChild(cell);priv.headerCells.push(cell);}};var highlight_selection=function highlight_selection(){var priv=privates.get(this);this.selection.forEach(function(id){if(id in priv.current_elements){priv.current_elements[id].row.classList.add('highlight');}},this);};var paintTable=function paintTable(items){var i,j,item,row,cell,callback,today,cellContent,column,state;var priv=privates.get(this);clearTable.call(this);for(i=0;i<items.length;i+=1){item=items[i];callback=rowCallback.bind({table:this,item:item,index:i});row=document.createElement('div');row.className='se-model-table-row';if((i%2)===1){row.classList.add('odd');}
state=priv.stateFunc(item);if(state!=null){row.classList.add('se-model-table-row-'+state);}
for(j=0;j<this.columns.length;j+=1){column=this.columns[j];cell=document.createElement('div');cell.className='se-model-table-cell';priv.columnsCells[j].push(cell);if(typeof column.width==='string'&&column.width!=="css"){cell.style.width=column.width;cell.style.flexGrow=0;}else if(column.width==="css"){cell.style.flexGrow=0;}
if(typeof column.class==='string'){cell.classList.add(column.class);}
if(column.contentBuilder){cellContent=column.contentBuilder(item);}else if(column.type==='date'){if(getFieldValue(item,column.field)===''){cellContent='';}else{if(!today){today=new Date();}
cellContent=formatDate.call(this,item,column.field,today,column.dateparser);}}else if(column.type==='number'){cellContent=getFieldValue(item,column.field);if(cellContent!==''&&column.unit){cellContent=cellContent+" "+column.unit;}}else{cellContent=getFieldValue(item,column.field);}
if(cellContent==null){cellContent='';}
if(typeof cellContent==='string'){cell.textContent=cellContent;}else if(typeof cellContent==='number'||typeof cellContent==='boolean'){cell.textContent=""+cellContent;}else if(cellContent instanceof StyledElements.StyledElement){cellContent.insertInto(cell);priv.components.push(cellContent);}else{cell.appendChild(cellContent);}
cell.addEventListener('click',callback,false);priv.listeners.push({element:cell,callback:callback});row.appendChild(cell);if(typeof priv.extractIdFunc==='function'){priv.current_elements[priv.extractIdFunc(item)]={row:row,data:item};}}
priv.tableBody.appendChild(row);}
if(items.length===0&&this.source.currentPage){row=document.createElement('div');row.className='alert alert-info se-model-table-msg';row.textContent=this.emptyMessage;priv.tableBody.appendChild(row);}
highlight_selection.call(this);};var onRequestEnd=function onRequestEnd(source,error){if(error==null){this.reload();}else{var priv=privates.get(this);clearTable.call(this);var message=document.createElement('div');message.className="alert alert-danger";message.textContent=error;priv.tableBody.appendChild(message);}};var ModelTable=function ModelTable(columns,options){var className,i,column,sort_info,sort_id,defaultOptions;defaultOptions={'initialSortColumn':-1,'pageSize':5,'emptyMessage':utils.gettext('No data available'),'selectionType':"none"};options=utils.merge(defaultOptions,options);if(options.class!=null){className=utils.appendWord('se-model-table full',options.class);}else{className='se-model-table full';}
var priv={};privates.set(this,priv);StyledElements.StyledElement.call(this,['click','select']);var priv={};privates.set(this,priv);priv.selection=[];priv.selectionType=options.selectionType;var source;if(options.source!=null){source=options.source;}else if(options.pagination!=null){source=options.pagination;}else{sort_info={};for(i=0;i<columns.length;i+=1){column=columns[i];if(sort_id in column){sort_id=column.sort_id;}else{sort_id=column.field;}
sort_info[sort_id]=column;}
source=new StyledElements.StaticPaginatedSource({pageSize:options.pageSize,sort_info:sort_info,idAttr:options.id});}
priv.layout=new StyledElements.VerticalLayout({'class':className});Object.defineProperties(this,{columns:{writable:true,value:columns},emptyMessage:{writable:true,value:options.emptyMessage},selection:{get:function(){return priv.selection;},set:function(value){if(!isSelectionEnabled(priv.selectionType)){throw new Error("Selection is disabled");}
if(!Array.isArray(value)){throw new TypeError();}
if(priv.selectionType==="single"&&value.length>1){throw new Error("Selection is set to \"single\" but tried to select more than one rows.");}
priv.selection.forEach(function(id){if(id in priv.current_elements){priv.current_elements[id].row.classList.remove('highlight');}},this);priv.selection=value;highlight_selection.call(this);}},source:{writable:false,value:source},statusBar:{get:function(){return priv.statusBar;}}});this.wrapperElement=priv.layout.wrapperElement;this.wrapperElement.addEventListener("click",function(evt){var priv=privates.get(this);if(!isSelectionEnabled(priv.selectionType)){return;}
if(!evt.shiftKey&&!evt.ctrlKey){this.select([]);this.events.select.dispatch([]);}}.bind(this));priv.header=priv.layout.north;priv.header.addClassName('se-model-table-headrow');buildHeader.call(this);priv.components=[];priv.listeners=[];priv.tableBody=priv.layout.center;priv.tableBody.addClassName('se-model-table-body');priv.statusBar=priv.layout.south;priv.statusBar.addClassName('se-model-table-statusrow');priv.sortColumn=null;Object.defineProperty(this,'pagination',{get:function(){return this.source;}});this.source.addEventListener('requestEnd',onRequestEnd.bind(this));if(this.source.options.pageSize!==0){priv.paginationInterface=new StyledElements.PaginationInterface(this.source);priv.statusBar.appendChild(priv.paginationInterface);}
if(options.initialSortColumn===-1){for(i=0;i<this.columns.length;i+=1){if(this.columns[i].sortable!==false){options.initialSortColumn=i;break;}}
if(options.initialSortColumn===-1){options.initialSortColumn=null;}}else if(typeof options.initialSortColumn==='string'){for(i=0;i<this.columns.length;i+=1){if(this.columns[i].field===options.initialSortColumn){options.initialSortColumn=i;break;}}
if(typeof options.initialSortColumn==='string'){options.initialSortColumn=null;}}
sortByColumn.call(this,options.initialSortColumn,options.initialDescendingOrder);priv.current_elements={};if(typeof options.id==='string'){priv.extractIdFunc=function(data){return data[options.id];};}else if(typeof options.id==='function'){priv.extractIdFunc=options.id;}
if(typeof options.stateFunc==='function'){priv.stateFunc=options.stateFunc;}else{priv.stateFunc=function(){};}};utils.inherit(ModelTable,StyledElements.StyledElement);ModelTable.prototype.Tooltip=StyledElements.Tooltip;ModelTable.prototype.select=function select(selection){if(selection!=null){this.selection=Array.isArray(selection)?selection:[selection];}else{this.selection=[];}
return this;};var sortByColumn=function sortByColumn(column,descending){var sort_id,order,oldSortHeaderCell,sortHeaderCell;var priv=privates.get(this);if(priv.sortColumn!=null){oldSortHeaderCell=priv.headerCells[priv.sortColumn];oldSortHeaderCell.classList.remove('ascending');oldSortHeaderCell.classList.remove('descending');}
priv.sortInverseOrder=descending;priv.sortColumn=column;if(priv.sortColumn!=null){sortHeaderCell=priv.headerCells[priv.sortColumn];if(priv.sortInverseOrder){sortHeaderCell.classList.remove('ascending');sortHeaderCell.classList.add('descending');}else{sortHeaderCell.classList.remove('descending');sortHeaderCell.classList.add('ascending');}
column=this.columns[priv.sortColumn];if(column.sort_id!=null){sort_id=column.sort_id;}else{sort_id=column.field;}
if(priv.sortInverseOrder){sort_id='-'+sort_id;}
order=[sort_id];}else{order=null;}
this.source.changeOptions({order:order});};var sortByColumnCallback=function sortByColumnCallback(){var priv=privates.get(this.widget);var descending=priv.sortColumn===this.column?!priv.sortInverseOrder:false;sortByColumn.call(this.widget,this.column,descending);};var getFieldValue=function getFieldValue(item,field){var fieldPath,currentNode,currentField;if(typeof field==="string"){fieldPath=[field];}else{fieldPath=field.slice();}
currentNode=item;while(currentNode!=null&&fieldPath.length>0){currentField=fieldPath.splice(0,1)[0];currentNode=currentNode[currentField];}
if(currentNode==null||fieldPath.length>0){return"";}
return currentNode;};var formatDate=function formatDate(item,field,today,dateparser){var date,m,shortVersion,fullVersion,element,tooltip;date=getFieldValue(item,field);if(typeof dateparser==='function'){date=dateparser(date);}else if(!(date instanceof Date)){date=new Date(date);}
m=moment(date);shortVersion=m.fromNow();fullVersion=m.format('LLLL');element=document.createElement('span');element.textContent=shortVersion;tooltip=new this.Tooltip({content:fullVersion,placement:['bottom','top','right','left']});tooltip.bind(element);var timer=setInterval(function(){if(!element.ownerDocument.body.contains(element)){clearInterval(timer);}
var newTime=m.fromNow();if(element.textContent!==newTime){element.textContent=newTime;}},1000);return element;};var rowCallback=function rowCallback(evt){evt.stopPropagation();changeSelection.call(this.table,this.item,evt,this.index);this.table.events.click.dispatch(this.item,evt);};var isSelectionEnabled=function isSelectionEnabled(selectionSettings){return selectionSettings==="single"||selectionSettings==="multiple";};var changeSelection=function changeSelection(row,event,index){var priv=privates.get(this);if(!isSelectionEnabled(priv.selectionType)){return;}
var selected,data,lastSelectedIndex,lower,upper,j;var id=priv.extractIdFunc(row);if(priv.selectionType==="multiple"&&event.ctrlKey&&event.shiftKey){data=this.source.getCurrentPage();lastSelectedIndex=data.indexOf(priv.lastSelected);if(lastSelectedIndex===-1){priv.lastSelected=row;selected=[id];}else{selected=priv.savedSelection.slice();selected.splice(selected.indexOf(priv.extractIdFunc(priv.lastSelected)),1);var aux=[];lower=Math.min(index,lastSelectedIndex);upper=Math.max(index,lastSelectedIndex);for(j=lower;j<=upper;j++){aux.push(priv.extractIdFunc(data[j]));}
selected=selected.concat(aux);event.target.ownerDocument.defaultView.getSelection().removeAllRanges();}}else if(priv.selectionType==="multiple"&&event.shiftKey){data=this.source.getCurrentPage();lastSelectedIndex=data.indexOf(priv.lastSelected);if(lastSelectedIndex===-1){priv.lastSelected=row;selected=[id];}else{selected=[];lower=Math.min(index,lastSelectedIndex);upper=Math.max(index,lastSelectedIndex);for(j=lower;j<=upper;j++){selected.push(priv.extractIdFunc(data[j]));}
event.target.ownerDocument.defaultView.getSelection().removeAllRanges();}}else if(priv.selectionType==="multiple"&&event.ctrlKey){priv.lastSelected=row;selected=this.selection.slice();var i=selected.indexOf(id);if(i!==-1){priv.lastSelected=null;selected.splice(i,1);}else{selected.push(id);}
priv.savedSelection=selected;}else{selected=[id];priv.lastSelected=row;priv.savedSelection=selected;}
this.select(selected);this.events.select.dispatch(selected);};var clearTable=function clearTable(){var i,entry;var priv=privates.get(this);for(i=0;i<priv.listeners.length;i+=1){entry=priv.listeners[i];entry.element.removeEventListener('click',entry.callback,false);}
priv.components=[];priv.listeners=[];priv.columnsCells=[];for(i=0;i<this.columns.length;i+=1){priv.columnsCells[i]=[];}
priv.tableBody.clear();priv.current_elements={};};ModelTable.prototype.reload=function reload(){paintTable.call(this,this.source.getCurrentPage());};ModelTable.prototype.destroy=function destroy(){var i,cell;var priv=privates.get(this);for(i=0;i<priv.headerCells.length;i+=1){cell=priv.headerCells[i];if(cell.callback){cell.removeEventListener('click',cell.callback,true);cell.callback=null;}}
clearTable.call(this);priv.layout.destroy();priv.layout=null;if(priv.paginationInterface){priv.paginationInterface.destroy();priv.paginationInterface=null;}
this.source.destroy();return this;};var privates=new WeakMap();StyledElements.ModelTable=ModelTable;})(StyledElements.Utils);;(function(utils){"use strict";var onFocus=function onFocus(e){var range=document.createRange();range.selectNodeContents(this.wrapperElement);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);document.addEventListener('mousedown',this._onBlur,false);};var onKeydown=function onKeydown(e){if(e.keyCode===13){this._onBlur();}else if(e.keyCode===27){this.wrapperElement.textContent=this._prev_content;this._onBlur();}};var onBlur=function onBlur(e){if(!this.wrapperElement.hasAttribute('contenteditable')){return;}
document.removeEventListener('mousedown',this._onBlur,false);var new_content=this.wrapperElement.textContent;this.wrapperElement.textContent=new_content;if(this._prev_content!==new_content){this.dispatchEvent('change',new_content);}
this.disableEdition();};var EditableElement=function EditableElement(options){StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement('span');this.setTextContent(options.initialContent);this._onFocus=onFocus.bind(this);this._onKeydown=onKeydown.bind(this);this._onBlur=onBlur.bind(this);this.wrapperElement.addEventListener('focus',this._onFocus,true);this.wrapperElement.addEventListener('keydown',this._onKeydown,true);this.wrapperElement.addEventListener('blur',this._onBlur,true);};utils.inherit(EditableElement,StyledElements.StyledElement);EditableElement.prototype.disableEdition=function disableEdition(){if(this.wrapperElement.hasAttribute('contenteditable')){this.wrapperElement.removeEventListener('mousedown',utils.stopPropagationListener,true);this.wrapperElement.removeAttribute('contenteditable');this.wrapperElement.blur();this.wrapperElement.scrollLeft=0;this.wrapperElement.scrollTop=0;}};EditableElement.prototype.enableEdition=function enableEdition(){if(!this.wrapperElement.hasAttribute('contenteditable')){this.wrapperElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.wrapperElement.setAttribute('contenteditable','true');this._prev_content=this.wrapperElement.textContent;}
this.wrapperElement.focus();};EditableElement.prototype.setTextContent=function setTextContent(textContent){this.wrapperElement.textContent=textContent;return this;};EditableElement.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('focus',this._onFocus,true);this.wrapperElement.removeEventListener('keydown',this._onKeydown,true);this.wrapperElement.removeEventListener('blur',this._onBlur,true);this._onFocus=null;this._onKeydown=null;this._onBlur=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.EditableElement=EditableElement;})(StyledElements.Utils);;(function(utils){"use strict";var HiddenField=function HiddenField(options){var defaultOptions={'initialValue':'','class':''};options=utils.merge(defaultOptions,options);StyledElements.InputElement.call(this,options.initialValue,[]);this.wrapperElement=document.createElement("div");this.wrapperElement.className=utils.prependWord(options.class,'styled_hidden_field');this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","hidden");if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this.wrapperElement.appendChild(this.inputElement);};utils.inherit(HiddenField,StyledElements.InputElement);StyledElements.HiddenField=HiddenField;})(StyledElements.Utils);;(function(utils){"use strict";var ButtonsGroup=function ButtonsGroup(name){StyledElements.InputElement.call(this,"",['change']);Object.defineProperty(this,'name',{value:name});this.buttons=[];};utils.inherit(ButtonsGroup,StyledElements.InputElement);ButtonsGroup.prototype.insertButton=function insertButton(button){this.buttons[this.buttons.length]=button;button.addEventListener('change',function(){this.dispatchEvent('change');}.bind(this));return this;};ButtonsGroup.prototype.getValue=function getValue(){var i,result=[];if(this.buttons[0]instanceof StyledElements.CheckBox){for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){result.push(this.buttons[i].getValue());}}}else{for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){return this.buttons[i].getValue();}}}
return result;};ButtonsGroup.prototype.setValue=function setValue(newValue){if(newValue==null){newValue=[];}else if(typeof newValue==='string'){newValue=[newValue];}
for(var i=0;i<this.buttons.length;i++){if(newValue.indexOf(this.buttons[i].inputElement.value)!==-1){this.buttons[i].setValue(true);}else{this.buttons[i].setValue(false);}}
return this;};ButtonsGroup.prototype.reset=function reset(){for(var i=0;i<this.buttons.length;i++){this.buttons[i].reset();}
return this;};ButtonsGroup.prototype.getSelectedButtons=function getSelectedButtons(){var i;if(this.buttons.length===0){return[];}
if(this.buttons[0]instanceof StyledElements.CheckBox){var result=[];for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){result[result.length]=this.buttons[i];}}
return result;}else{for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){return[this.buttons[i]];}}
return[];}};StyledElements.ButtonsGroup=ButtonsGroup;})(StyledElements.Utils);;(function(utils){"use strict";var CheckBox=function CheckBox(options){var defaultOptions={'initialValue':false,'class':'','group':null,'secondInput':null,'value':true};options=utils.merge(defaultOptions,options);if('initiallyChecked'in options){options.initialValue=options.initiallyChecked;}
StyledElements.InputElement.call(this,options.initialValue,['change']);this.wrapperElement=document.createElement("input");this.wrapperElement.className='checkbox';this.wrapperElement.setAttribute("type","checkbox");this.inputElement=this.wrapperElement;if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.checkedValue=options.value;this.inputElement.setAttribute("value",options.value);this.secondInput=options.secondInput;this.setValue(options.initialValue);if(options.group instanceof StyledElements.ButtonsGroup){this.wrapperElement.setAttribute("name",options.group.name);options.group.insertButton(this);}else if(typeof options.group==='string'){this.wrapperElement.setAttribute("name",options.group);}
this.inputElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.addEventListener('click',utils.stopPropagationListener,true);this.inputElement.addEventListener('change',function(){if(this.enabled){if(this.secondInput!=null){this.secondInput.setDisabled(!this.inputElement.checked);}
this.dispatchEvent('change');}}.bind(this),true);};utils.inherit(CheckBox,StyledElements.InputElement);CheckBox.prototype.reset=function reset(){this.setValue(this.defaultValue);};CheckBox.prototype.getValue=function getValue(){if(this.checkedValue===true&&this.secondInput==null){return this.inputElement.checked;}else if(this.secondInput==null){return this.inputElement.checked?this.checkedValue:null;}else{return this.secondInput.getValue();}};CheckBox.prototype.setValue=function setValue(newValue){this.inputElement.checked=newValue!=null&&newValue!==false;if(this.secondInput!=null){this.secondInput.setDisabled(!this.inputElement.checked);if(this.inputElement.checked){this.secondInput.setValue(newValue);}}};StyledElements.CheckBox=CheckBox;})(StyledElements.Utils);;(function(utils){"use strict";var RadioButton=function RadioButton(options){var defaultOptions={'initiallyChecked':false,'class':'','group':null,'value':null};options=utils.merge(defaultOptions,options);StyledElements.InputElement.call(this,options.initiallyChecked,['change']);this.wrapperElement=document.createElement("input");this.wrapperElement.setAttribute("type","radio");if(options.value!=null){this.wrapperElement.setAttribute("value",options.value);}
this.inputElement=this.wrapperElement;if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
if(options.initiallyChecked===true){this.inputElement.setAttribute("checked",true);}
if(options.group instanceof StyledElements.ButtonsGroup){this.wrapperElement.setAttribute("name",options.group.name);options.group.insertButton(this);}else if(typeof options.group==='string'){this.wrapperElement.setAttribute("name",options.group);}
this.inputElement.addEventListener('mousedown',utils.stopPropagationListener,true);this.inputElement.addEventListener('click',utils.stopPropagationListener,true);this.inputElement.addEventListener('change',function(){if(this.enabled){this.dispatchEvent('change');}}.bind(this),true);};utils.inherit(RadioButton,StyledElements.InputElement);RadioButton.prototype.insertInto=function insertInto(element,refElement){var checked=this.inputElement.checked;StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.inputElement.checked=checked;};RadioButton.prototype.reset=function reset(){this.inputElement.checked=this.defaultValue;return this;};RadioButton.prototype.setValue=function setValue(newValue){this.inputElement.checked=newValue;return this;};StyledElements.RadioButton=RadioButton;})(StyledElements.Utils);;(function(utils){"use strict";var InputInterface=function InputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.StyledElement.call(this,[]);options.name=fieldId;this._fieldId=fieldId;this._initialValue=options.initialValue;this._defaultValue=options.defaultValue;this._label=options.label;Object.defineProperty(this,'required',{value:'required'in options?!!options.required:false});this._readOnly=!!options.readOnly;this._hidden=!!options.hidden;if(options.description){this._description=options.description;}else{this._description=options.label;}};utils.inherit(InputInterface,StyledElements.StyledElement);InputInterface.prototype.repaint=function repaint(){this.inputElement.repaint();};InputInterface.prototype.getValue=function getValue(){return this.inputElement.getValue();};InputInterface.prototype.setValue=function setValue(newValue){if(this.isValidValue(newValue)){this._setValue(newValue);}};InputInterface.prototype.getLabel=function getLabel(){return this._label;};InputInterface.prototype.getDescription=function getDescription(){return this._description;};InputInterface.prototype.getDefaultValue=function getDefaultValue(){return this._defaultValue;};InputInterface.prototype.isEmpty=function isEmpty(){return this._isEmptyValue(this.getValue());};InputInterface.prototype._isEmptyValue=function _isEmptyValue(value){return value===""||value==null;};InputInterface.prototype._normalize=function _normalize(value){if(value==null){return"";}else{return(""+value).trim();}};InputInterface.prototype._checkValue=function _checkValue(newValue){return StyledElements.InputValidationError.NO_ERROR;};InputInterface.prototype.checkValue=function checkValue(newValue){if(newValue===undefined){newValue=this.getValue();}else{newValue=this._normalize(newValue);}
if(!(this instanceof StyledElements.SelectInputInterface)){if(this.required&&this._isEmptyValue(newValue)){return StyledElements.InputValidationError.REQUIRED_ERROR;}
if(!this.required&&this._isEmptyValue(newValue)){return StyledElements.InputValidationError.NO_ERROR;}}
return this._checkValue(newValue);};InputInterface.prototype.validate=function validate(){if(this.timeout!=null){clearTimeout(this.timeout);}
var errorCode=this.checkValue();this._setError(errorCode!==StyledElements.InputValidationError.NO_ERROR);};InputInterface.prototype.isValidValue=function isValidValue(newValue){return this.checkValue(newValue)===StyledElements.InputValidationError.NO_ERROR;};InputInterface.prototype._setValue=function _setValue(newValue){newValue=this._normalize(newValue);this.inputElement.setValue(newValue);};InputInterface.prototype._setError=function _setError(error){if(error){this.inputElement.wrapperElement.classList.add('error');}else{this.inputElement.wrapperElement.classList.remove('error');}};InputInterface.prototype.resetToDefault=function resetToDefault(){this._setError(false);this._setValue(this._defaultValue);};InputInterface.prototype.reset=function reset(){this._setError(false);this._setValue(this._initialValue);};InputInterface.prototype.focus=function focus(){this.inputElement.focus();};InputInterface.prototype.setDisabled=function setDisabled(disable){this.inputElement.setDisabled(this._readOnly||disable);};InputInterface.prototype.enable=function enable(){this.setDisabled(false);};InputInterface.prototype.disable=function disable(){this.setDisabled(true);};InputInterface.prototype.insertInto=function insertInto(element){this.inputElement.insertInto(element);};InputInterface.prototype.assignDefaultButton=function assignDefaultButton(button){};StyledElements.InputInterface=InputInterface;})(StyledElements.Utils);;(function(utils){"use strict";var TextInputInterface=function TextInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.TextField(options);this.inputElement.addEventListener('change',function(){if(this.timeout!=null){clearTimeout(this.timeout);}
this.timeout=setTimeout(this.validate.bind(this),700);}.bind(this));this.inputElement.addEventListener('blur',this.validate.bind(this));};utils.inherit(TextInputInterface,StyledElements.InputInterface);TextInputInterface.parse=function parse(value){return value;};TextInputInterface.stringify=function stringify(value){return value;};TextInputInterface.prototype.assignDefaultButton=function assignDefaultButton(button){this.inputElement.addEventListener('submit',function(){button.click();});};StyledElements.TextInputInterface=TextInputInterface;})(StyledElements.Utils);;(function(){"use strict";var ValidationErrorManager,InputValidationError={};InputValidationError.NO_ERROR=0;InputValidationError.REQUIRED_ERROR=1;InputValidationError.URL_ERROR=2;InputValidationError.EMAIL_ERROR=3;InputValidationError.ID_ERROR=4;InputValidationError.COLOR_ERROR=5;InputValidationError.BOOLEAN_ERROR=6;InputValidationError.VERSION_ERROR=7;InputValidationError.OUT_OF_RANGE_ERROR=8;StyledElements.InputValidationError=InputValidationError;ValidationErrorManager=function ValidationErrorManager(){this.fieldsWithErrorById={};};ValidationErrorManager.prototype._addValidationError=function _addValidationError(errorCode,fieldName){if(this.fieldsWithErrorById[errorCode]===undefined){this.fieldsWithErrorById[errorCode]=[];}
this.fieldsWithErrorById[errorCode].push(fieldName);};ValidationErrorManager.prototype.validate=function validate(field){var errorCode=field.checkValue();if(errorCode!==StyledElements.InputValidationError.NO_ERROR){field._setError(true);this._addValidationError(errorCode,field.getLabel());}else{field._setError(false);}};ValidationErrorManager.prototype._buildErrorMsg=function _buildErrorMsg(errorCode){var msg,fields,i;errorCode=parseInt(errorCode,10);switch(errorCode){case StyledElements.InputValidationError.REQUIRED_ERROR:msg=StyledElements.Utils.gettext("The following required fields are empty: %(fields)s.");break;case StyledElements.InputValidationError.URL_ERROR:msg=StyledElements.Utils.gettext("The following fields do not contain a valid URL: %(fields)s.");break;case StyledElements.InputValidationError.EMAIL_ERROR:msg=StyledElements.Utils.gettext("The following fields do not contain a valid E-Mail address: %(fields)s.");break;case StyledElements.InputValidationError.VERSION_ERROR:msg=StyledElements.Utils.gettext("The following field do not contain a valid version number: %(fields)s.");break;case StyledElements.InputValidationError.ID_ERROR:msg=StyledElements.Utils.gettext("The following fields contain invalid characters: %(fields)s.");break;case StyledElements.InputValidationError.COLOR_ERROR:msg=StyledElements.Utils.gettext("The following fields do not contain a valid color value: %(fields)s.");break;case StyledElements.InputValidationError.OUT_OF_RANGE_ERROR:msg=StyledElements.Utils.gettext("The following fields does contain an out of range value: %(fields)s.");break;}
fields="";for(i=0;i<this.fieldsWithErrorById[errorCode].length;i+=1){fields+=", "+this.fieldsWithErrorById[errorCode][i];}
fields=fields.substring(2);return StyledElements.Utils.interpolate(msg,{'fields':fields});};ValidationErrorManager.prototype.toHTML=function toHTML(){var errorCode,errorMsgs=[];for(errorCode in this.fieldsWithErrorById){if(this.fieldsWithErrorById.hasOwnProperty(errorCode)){errorMsgs.push(this._buildErrorMsg(errorCode));}}
return errorMsgs;};StyledElements.ValidationErrorManager=ValidationErrorManager;var PasswordInputInterface=function PasswordInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.PasswordField(options);};PasswordInputInterface.prototype=new StyledElements.InputInterface();PasswordInputInterface.parse=StyledElements.TextInputInterface.parse;PasswordInputInterface.stringify=StyledElements.TextInputInterface.stringify;StyledElements.PasswordInputInterface=PasswordInputInterface;var ListInputInterface=function ListInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.List(options);};ListInputInterface.prototype=new StyledElements.InputInterface();ListInputInterface.prototype.parse=function parse(value){return JSON.parse(value);};ListInputInterface.prototype.stringify=function stringify(value){return JSON.stringify(value);};ListInputInterface.prototype._normalize=function _normalize(value){if(!Array.isArray(value)){value=[];}};ListInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.cleanSelection();this.inputElement.addSelection(newValue);};ListInputInterface.prototype.getValue=function getValue(){return this.inputElement.getSelection();};ListInputInterface.prototype.isEmpty=function isEmpty(){return this.getValue().length===0;};StyledElements.ListInputInterface=ListInputInterface;var NumberInputInterface=function NumberInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.NumericField(options);};NumberInputInterface.prototype=new StyledElements.InputInterface();NumberInputInterface.parse=function parse(value){return Number(value);};NumberInputInterface.prototype._normalize=function _normalize(value){if(value==null){return 0;}else{return Number(value);}};NumberInputInterface.prototype._checkValue=function _checkValue(newValue){if(!Number.isFinite(newValue)||newValue<this.inputElement.options.min||newValue>this.inputElement.options.max){return StyledElements.InputValidationError.OUT_OF_RANGE_ERROR;}
return StyledElements.InputValidationError.NO_ERROR;};StyledElements.NumberInputInterface=NumberInputInterface;var LongTextInputInterface=function LongTextInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.TextArea(options);this.events.blur=this.inputElement.events.blur;};LongTextInputInterface.prototype=new StyledElements.InputInterface();LongTextInputInterface.parse=StyledElements.TextInputInterface.parse;LongTextInputInterface.stringify=StyledElements.TextInputInterface.stringify;StyledElements.LongTextInputInterface=LongTextInputInterface;var URLInputInterface=function URLInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.TextInputInterface.call(this,fieldId,options);};URLInputInterface.prototype=new StyledElements.TextInputInterface();URLInputInterface.parse=StyledElements.TextInputInterface.parse;URLInputInterface.stringify=StyledElements.TextInputInterface.stringify;URLInputInterface.prototype._URLChecker=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;URLInputInterface.prototype._checkValue=function _checkValue(newValue){return this._URLChecker.test(newValue)?StyledElements.InputValidationError.NO_ERROR:StyledElements.InputValidationError.URL_ERROR;};StyledElements.URLInputInterface=URLInputInterface;var EMailInputInterface=function EMailInputInterface(fieldId,options){StyledElements.TextInputInterface.call(this,fieldId,options);};EMailInputInterface.prototype=new StyledElements.TextInputInterface();EMailInputInterface.prototype._EMailChecker=/^[\w\d._%+-]+@[\w\d.\-]+\.[\w]{2,4}$/;EMailInputInterface.prototype._checkValue=function _checkValue(newValue){return this._EMailChecker.test(newValue)?StyledElements.InputValidationError.NO_ERROR:StyledElements.InputValidationError.EMAIL_ERROR;};StyledElements.EMailInputInterface=EMailInputInterface;var BooleanInputInterface=function BooleanInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);if(typeof options.initialValue==='string'){options.initiallyChecked=options.initialValue.toLowerCase()==='true';}else if(typeof options.initialValue==='boolean'){options.initiallyChecked=options.initialValue;}
this.inputElement=new StyledElements.CheckBox(options);};BooleanInputInterface.prototype=new StyledElements.InputInterface();BooleanInputInterface.parse=function parse(value){return(""+value).trim().toLowerCase()==='true';};BooleanInputInterface.stringify=function stringify(value){return""+value;};BooleanInputInterface.prototype.isEmpty=function isEmpty(){return false;};BooleanInputInterface.prototype._normalize=function _normalize(value){return!!value;};BooleanInputInterface.prototype._checkValue=function _checkValue(newValue){return(typeof newValue==='boolean')?StyledElements.InputValidationError.NO_ERROR:StyledElements.InputValidationError.BOOLEAN_ERROR;};StyledElements.BooleanInputInterface=BooleanInputInterface;var SelectInputInterface=function SelectInputInterface(fieldId,desc){if(!('required'in desc)){desc.required=true;}
StyledElements.InputInterface.call(this,fieldId,desc);if(typeof desc.entries==='function'){this._update=desc.entries;}else if(desc.initialEntries&&!this.required){var i,found=false;for(i=0;i<desc.initialEntries.length;i+=1){if(this._isEmptyValue(desc.initialEntries[i].value)){found=true;break;}}
if(!found){desc.initialEntries=[{label:'---------',value:null}].concat(desc.initialEntries);}}
this.inputElement=new StyledElements.Select(desc);};SelectInputInterface.prototype=new StyledElements.InputInterface();SelectInputInterface.parse=function parse(value){return value;};SelectInputInterface.stringify=function stringify(value){return""+value;};SelectInputInterface.prototype._setValue=function _setValue(newValue){var entries;if(this._update){this.inputElement.clear();entries=this._update();if(!this.required){entries=[{label:'---------',value:null}].concat(entries);}
this.inputElement.addEntries(entries);}
this.inputElement.setValue(newValue);};SelectInputInterface.prototype._checkValue=function _checkValue(newValue){var newValueId;if(typeof newValue!=='string'){try{newValueId=this.inputElement.idFunc(newValue);}catch(e){}}else{newValueId=newValue;}
if(typeof newValueId!=='string'||!(newValueId in this.inputElement.optionValues)){return StyledElements.InputValidationError.OUT_OF_RANGE_ERROR;}else{return StyledElements.InputValidationError.NO_ERROR;}};StyledElements.SelectInputInterface=SelectInputInterface;var HiddenInputInterface=function HiddenInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledHiddenField(options);};HiddenInputInterface.prototype=new StyledElements.InputInterface();StyledElements.HiddenInputInterface=HiddenInputInterface;var ButtonGroupInputInterface=function ButtonGroupInputInterface(fieldId,fieldDesc){var ButtonClass,buttonDesc,i,button,label;if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,fieldDesc);this.inputElement=new StyledElements.ButtonsGroup(fieldId);this.wrapperElement=document.createElement('div');this.wrapperElement.className='button_group';switch(fieldDesc.kind){case'radio':ButtonClass=StyledElements.RadioButton;break;case'checkbox':ButtonClass=StyledElements.CheckBox;break;default:throw new Error();}
for(i=0;i<fieldDesc.buttons.length;i+=1){buttonDesc=fieldDesc.buttons[i];label=document.createElement('label');label.className=fieldDesc.kind;button=new ButtonClass({group:this.inputElement,value:buttonDesc.value,secondInput:buttonDesc.secondInput});button.insertInto(label);label.appendChild(document.createTextNode(buttonDesc.label));if(buttonDesc.secondInput){buttonDesc.secondInput.insertInto(label);}
this.wrapperElement.appendChild(label);}
if('initialValue'in fieldDesc){this.inputElement.setValue(fieldDesc.initialValue);}};ButtonGroupInputInterface.prototype=new StyledElements.InputInterface();ButtonGroupInputInterface.prototype.insertInto=function insertInto(element){element.appendChild(this.wrapperElement);};ButtonGroupInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.setValue(newValue);};ButtonGroupInputInterface.prototype._setError=function _setError(error){};StyledElements.ButtonGroupInputInterface=ButtonGroupInputInterface;var FileInputInterface=function FileInputInterface(fieldId,fieldDesc){StyledElements.InputInterface.call(this,fieldId,fieldDesc);this.inputElement=new StyledElements.FileField(fieldDesc);};FileInputInterface.prototype=new StyledElements.InputInterface();FileInputInterface.prototype.getValue=function getValue(){return this.inputElement.getValue();};FileInputInterface.prototype._setValue=function _setValue(newValue){};FileInputInterface.prototype._setError=function _setError(error){};FileInputInterface.prototype.setDisabled=function setDisabled(disable){this.inputElement.disabled=!!disable;};StyledElements.FileInputInterface=FileInputInterface;var MultivaluedInputInterface=function MultivaluedInputInterface(fieldId,fieldDesc){this.entries=[];this.fields=fieldDesc.fields;this.wrapperElement=new StyledElements.Container();this._addEntry();};MultivaluedInputInterface.prototype=new StyledElements.InputInterface();MultivaluedInputInterface.prototype._addEntry=function _addEntry(){var entry,fields;entry={};entry.wrapper=document.createElement('div');fields={'':{type:'lineLayout',fields:this.fields}};entry.form=new StyledElements.Form(fields,{useHtmlForm:false,acceptButton:false,cancelButton:false,legend:false});entry.form.wrapperElement.style.display="inline-block";entry.form.wrapperElement.style.verticalAlign="middle";entry.form.insertInto(entry.wrapper);entry.addRowButton=new StyledElements.Button({text:'+'});entry.addRowButton.addEventListener('click',function(){this._addEntry();}.bind(this));entry.addRowButton.insertInto(entry.wrapper);entry.removeRowButton=new StyledElements.Button({text:'-'});entry.removeRowButton.addEventListener('click',function(){this.control._removeEntry(entry);}.bind({control:this,entry:entry}));entry.removeRowButton.insertInto(entry.wrapper);this.entries.push(entry);this.wrapperElement.appendChild(entry.wrapper);return entry;};MultivaluedInputInterface.prototype._removeEntry=function _removeEntry(entry){var index;this.wrapperElement.removeChild(entry.wrapper);index=this.entries.indexOf(entry);this.entries.splice(index,1);entry.form.destroy();if(this.entries.length===0){this._addEntry();}};MultivaluedInputInterface.prototype._removeAllEntries=function _removeAllEntries(){var i,entry;for(i=0;i<this.entries.length;i+=1){entry=this.entries[i];this.wrapperElement.removeChild(entry.wrapper);entry.form.destroy();}
this.entries=[];};MultivaluedInputInterface.prototype.getValue=function getValue(){var i,data=[];for(i=0;i<this.entries.length;i+=1){data.push(this.entries[i].form.getData());}
return data;};MultivaluedInputInterface.prototype._setValue=function _setValue(newValue){var i,entry;this._removeAllEntries();if(!(newValue instanceof Array)){newValue=[];}
for(i=0;i<newValue.length;i+=1){entry=this._addEntry();entry.form.setData(newValue[i]);}
if(this.entries.length===0){this._addEntry();}};MultivaluedInputInterface.prototype._setError=function _setError(error){};StyledElements.MultivaluedInputInterface=MultivaluedInputInterface;var FieldSetInterface=function FieldSetInterface(fieldId,fieldDesc,factory){this.form=new StyledElements.Form(fieldDesc.fields,{factory:factory,useHtmlForm:false,acceptButton:false,cancelButton:false,legend:false});};FieldSetInterface.prototype=new StyledElements.InputInterface();FieldSetInterface.prototype.repaint=function repaint(){return this.form.repaint();};FieldSetInterface.prototype.insertInto=function insertInto(element){this.form.insertInto(element);};FieldSetInterface.prototype.getValue=function getValue(){return this.form.getData();};FieldSetInterface.prototype._setValue=function _setValue(newValue){return this.form.setData(newValue);};FieldSetInterface.prototype._setError=function _setError(error){};StyledElements.FieldSetInterface=FieldSetInterface;})();;(function(utils){"use strict";var VALID_SOURCE_VALUES=['current','default','custom'];var VALID_STATUS_VALUES=['normal','hidden','readonly'];var updateInputElement=function updateInputElement(){switch(this.source){case'default':this.inputElement.setValue('');break;case'current':this.inputElement.setValue(Wirecloud.ui.ParametrizedTextInputInterface.prototype.escapeValue(this.variable.value));break;case'custom':this.inputElement.setValue(this.value);}};var updateButton=function updateButton(){if(this.source==='default'){this.buttonElement.setLabel(utils.gettext('Parametrize'));}else{this.buttonElement.setLabel(utils.gettext('Modify'));}
if(this.status!=='normal'){this.readOnlyIcon.classList.add('readOnly');this.readOnlyIcon.title=utils.gettext("This value won't be editable by the user");}else{this.readOnlyIcon.classList.remove('readOnly');this.readOnlyIcon.title=utils.gettext("This value will be editable by the user");}
if(this.status!=='hidden'){this.visibilityIcon.classList.add('visible');this.visibilityIcon.title=utils.gettext("This value will be visible to the user");}else{this.visibilityIcon.classList.remove('visible');this.visibilityIcon.title=utils.gettext("This value won't be visible to the user");}};var ParametrizableValueInputInterface=function ParametrizableValueInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.parentWindow=options.parentWindow;this.variable=options.variable;this.canBeHidden=options.canBeHidden;this.wrapperElement=document.createElement('div');this.wrapperElement.className="parametrizable_input";this.readOnlyIcon=document.createElement('div');this.readOnlyIcon.className='readOnlyIcon';this.wrapperElement.appendChild(this.readOnlyIcon);this.visibilityIcon=document.createElement('div');this.visibilityIcon.className='visibilityIcon';this.wrapperElement.appendChild(this.visibilityIcon);if(!this.canBeHidden){this.visibilityIcon.style.visibility='hidden';}
this.inputElement=new StyledElements.TextField();this.inputElement.disable();this.inputElement.insertInto(this.wrapperElement);this.buttonElement=new StyledElements.Button({text:''});this.buttonElement.addEventListener('click',function(){var dialog=new Wirecloud.ui.ParametrizeWindowMenu(this);dialog.show(this.parentWindow);dialog.setValue(this.getValue());}.bind(this));this.buttonElement.insertInto(this.wrapperElement);};ParametrizableValueInputInterface.prototype=new StyledElements.InputInterface();ParametrizableValueInputInterface.prototype._checkValue=function _checkValue(newValue){return StyledElements.InputValidationError.NO_ERROR;};ParametrizableValueInputInterface.prototype.getValue=function getValue(){var value={'source':this.source,'status':this.status};if(this.source!=='default'){value.value=this.inputElement.getValue();}
return value;};ParametrizableValueInputInterface.prototype._setValue=function _setValue(newValue){if(newValue==null||VALID_SOURCE_VALUES.indexOf(newValue.source)===-1){this.source='current';}else{this.source=newValue.source;}
if(newValue==null||typeof newValue.value!=='string'){this.value='';}else{this.value=newValue.value;}
if(newValue==null||VALID_STATUS_VALUES.indexOf(newValue.status)===-1){this.status='normal';}else if(!this.canBeHidden&&newValue.status==='hidden'){this.status='readonly';}else{this.status=newValue.status;}
updateInputElement.call(this);updateButton.call(this);};ParametrizableValueInputInterface.prototype.insertInto=function insertInto(element){element.appendChild(this.wrapperElement);};Wirecloud.ui.ParametrizableValueInputInterface=ParametrizableValueInputInterface;})(Wirecloud.Utils);;(function(utils){"use strict";var ParametrizedTextInputInterface=function ParametrizedTextInputInterface(fieldId,options){var i,param,option;StyledElements.InputInterface.call(this,fieldId,options);this.variable=options.variable;this.parameters=this.getAvailableParameters();this.wrapperElement=new StyledElements.Container({'class':'parametrized_text_input'});this.resetButton=new StyledElements.Button({'text':StyledElements.Utils.gettext('Use current value')});this.resetButton.addEventListener('click',function(){this.inputElement.setValue(this.escapeValue(this.variable.value));}.bind(this));this.wrapperElement.appendChild(this.resetButton);this.selectorWrapperElement=new StyledElements.Container({'class':'context_selector'});this.wrapperElement.appendChild(this.selectorWrapperElement);this.mainSelect=document.createElement('select');for(i=0;i<this.parameters.length;i+=1){param=this.parameters[i];option=new Option(param.label,param.value);try{this.mainSelect.add(option,null);}catch(e){this.mainSelect.add(option);}}
this.mainSelect.addEventListener('change',this._updateSecondSelect.bind(this),true);this.selectorWrapperElement.appendChild(this.mainSelect);this.secondSelect=document.createElement('select');this.selectorWrapperElement.appendChild(this.secondSelect);this.secondSelect.addEventListener('change',this._updateDescription.bind(this),true);this.addButton=new StyledElements.Button({'text':StyledElements.Utils.gettext('Add')});this.addButton.addEventListener('click',function(){var prefix,suffix,parameter,start,input;input=this.inputElement.inputElement;start=input.selectionStart;prefix=input.value.substr(0,start);suffix=input.value.substr(input.selectionEnd);parameter=this.mainSelect.value+'.'+this.secondSelect.value;this.inputElement.setValue(prefix+'%('+parameter+')'+suffix);input.selectionStart=start;input.selectionEnd=start+parameter.length+3;}.bind(this));this.selectorWrapperElement.appendChild(this.addButton);this.descriptionDiv=document.createElement('div');this.descriptionDiv.className='description';this.wrapperElement.appendChild(this.descriptionDiv);this.inputElement=new StyledElements.TextArea();this.wrapperElement.appendChild(this.inputElement);this._updateSecondSelect();};ParametrizedTextInputInterface.prototype=new StyledElements.InputInterface();ParametrizedTextInputInterface.prototype._ESCAPE_RE=new RegExp("(%+)(\\([a-zA-Z]\\w*(?:\\.[a-zA-Z]\\w*)*\\))");ParametrizedTextInputInterface.prototype._ESCAPE_FUNC=function(){var str,i;i=arguments[1].length*2;str='';while((i-=1)>=0){str+='%';}
return str+arguments[2];};ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS=null;ParametrizedTextInputInterface.prototype.getAvailableParameters=function getAvailableParameters(){var concepts,contextFields,conceptName,dashIndex,provider,concept,parameters,label;if(ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS===null){concepts=Wirecloud.activeWorkspace.contextManager._concepts;contextFields={'':[]};for(conceptName in concepts){concept=concepts[conceptName];dashIndex=conceptName.indexOf('-');provider=conceptName.substring(0,dashIndex);if(!(provider in contextFields)){contextFields[provider]=[];}
label=utils.interpolate('%(label)s (%(concept)s)',{label:concept._label,concept:conceptName});contextFields[provider].push({label:label,description:concept._description,value:conceptName});}
parameters=[{label:StyledElements.Utils.gettext('User'),value:'user',fields:[{label:StyledElements.Utils.gettext('User Name'),description:'',value:'username'},{label:StyledElements.Utils.gettext('First Name'),description:'',value:'first_name'},{label:StyledElements.Utils.gettext('Last Name'),description:'',value:'last_name'}]},{label:StyledElements.Utils.gettext('Context'),value:'context',fields:contextFields['']}];delete contextFields[''];for(conceptName in contextFields){parameters.push({label:conceptName,value:'context',fields:contextFields[conceptName]});}
ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS=parameters;}
return ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS;};ParametrizedTextInputInterface.prototype.escapeValue=function escapeValue(value){switch(typeof value){case"number":case"boolean":value=value.toString();break;default:if(value==null){value="";}}
return value.replace(ParametrizedTextInputInterface.prototype._ESCAPE_RE,ParametrizedTextInputInterface.prototype._ESCAPE_FUNC);};ParametrizedTextInputInterface.prototype._updateSecondSelect=function _updateSecondSelect(){var fields,field,i;this.secondSelect.innerHTML='';fields=this.parameters[this.mainSelect.selectedIndex].fields;for(i=0;i<fields.length;i+=1){field=fields[i];try{this.secondSelect.add(new Option(field.label,field.value),null);}catch(e){this.secondSelect.add(new Option(field.label,field.value));}}
this._updateDescription();};ParametrizedTextInputInterface.prototype._updateDescription=function _updateDescription(){var fields,field;fields=this.parameters[this.mainSelect.selectedIndex].fields;field=fields[this.secondSelect.selectedIndex];this.descriptionDiv.textContent=field.description;};ParametrizedTextInputInterface.prototype._setError=function _setError(){};ParametrizedTextInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.value=newValue;if(this.update){this.update();}};ParametrizedTextInputInterface.prototype.setDisabled=function setDisabled(disabled){this.mainSelect.disabled=!!disabled;this.secondSelect.disabled=!!disabled;this.addButton.setDisabled(disabled);this.resetButton.setDisabled(disabled);this.inputElement.setDisabled(disabled);};ParametrizedTextInputInterface.prototype.insertInto=function insertInto(element){this.wrapperElement.insertInto(element);};Wirecloud.ui.ParametrizedTextInputInterface=ParametrizedTextInputInterface;})(Wirecloud.Utils);;(function(utils){"use strict";var LAYOUT_FIELDS_MAPPING={'columnlayout':[{"name":"smart","defaultValue":true,"label":utils.gettext("Smart"),"type":"boolean","description":utils.gettext("Widgets will tend to be placed on the topmost position available if this option is enabled. (default: enabled)")},{"name":"columns","min":1,"max":200,"defaultValue":20,"label":utils.gettext("Columns"),"type":"number","description":utils.gettext("Grid columns. (default: 20 columns)")},{"name":"cellheight","min":7,"max":1024,"defaultValue":13,"label":utils.gettext("Row Height (in pixels)"),"type":"number","description":utils.gettext("Row/cell height. Must be specified in pixel units. (default: 13px)")},{"name":"horizontalmargin","min":0,"defaultValue":4,"label":utils.gettext("Horizontal Margin between widgets (in pixels)"),"type":"number","description":utils.gettext("Horizontal Margin between widgets. Must be specified in pixel units. (default: 4px)")},{"name":"verticalmargin","min":0,"defaultValue":3,"label":utils.gettext("Vertical Margin between widgets (in pixels)"),"type":"number","description":utils.gettext("Vertical Margin between widgets. Must be specified in pixel units. (default: 3px)")}],'gridlayout':[{"name":"columns","min":1,"max":200,"defaultValue":20,"label":utils.gettext("Columns"),"type":"number","description":utils.gettext("Grid columns. (default: 20 columns)")},{"name":"rows","min":1,"max":200,"defaultValue":12,"label":utils.gettext("Rows"),"type":"number","description":utils.gettext("Grid rows. (default: 12 rows)")},{"name":"horizontalmargin","min":0,"defaultValue":4,"label":utils.gettext("Horizontal Margin between widgets (in pixels)"),"type":"number","description":utils.gettext("Horizontal Margin between widgets. Must be specified in pixel units. (default: 4px)")},{"name":"verticalmargin","min":0,"defaultValue":3,"label":utils.gettext("Vertical Margin between widgets (in pixels)"),"type":"number","description":utils.gettext("Vertical Margin between widgets. Must be specified in pixel units. (default: 3px)")}]};var updateLayoutSummary=function updateLayoutSummary(){var summary='',context=utils.clone(this.layout);switch(this.layout.type){case'columnlayout':if(context.smart){context.smart=utils.gettext(' smart');}else{context.smart='';}
summary=utils.gettext('%(columns)s%(smart)s columns');break;case'gridlayout':summary=utils.gettext('%(columns)s columns x %(rows)s rows');break;}
summary=utils.interpolate(summary,context);this.summary_addon.setLabel(summary).setTitle(summary);};var LayoutInputInterface=function LayoutInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.wrapperElement=new StyledElements.Container({class:'se-layout-field se-input-group'});this.selectElement=new StyledElements.Select({name:options.name+'-type',initialEntries:[{"value":"columnlayout","label":utils.gettext("Columns")},{"value":"gridlayout","label":utils.gettext("Grid")}]});this.selectElement.addEventListener('change',function(select){this.layout=utils.clone(this.layout);this.layout.type=select.getValue();var fields=LAYOUT_FIELDS_MAPPING[this.layout.type];for(var i=0;i<fields.length;i++){if(!(fields[i].name in this.layout)){this.layout[fields[i].name]=fields[i].defaultValue;}}
updateLayoutSummary.call(this);}.bind(this));this.wrapperElement.appendChild(this.selectElement);this.summary_addon=new StyledElements.Addon();this.wrapperElement.appendChild(this.summary_addon);this.buttonElement=new StyledElements.Button({iconClass:'fa fa-cogs'});this.buttonElement.addEventListener('click',function(){var fields=LAYOUT_FIELDS_MAPPING[this.layout.type];var dialog=new Wirecloud.ui.FormWindowMenu(fields,utils.gettext('Layout configuration'),'wc-layout-settings-modal');dialog.executeOperation=function(data){this.layout=utils.clone(this.layout);utils.merge(this.layout,data);updateLayoutSummary.call(this);}.bind(this);dialog.show(Wirecloud.UserInterfaceManager.currentWindowMenu);dialog.setValue(this.layout);}.bind(this));this.wrapperElement.appendChild(this.buttonElement);};LayoutInputInterface.prototype=new StyledElements.InputInterface();LayoutInputInterface.parse=function parse(value){return JSON.parse(value);};LayoutInputInterface.stringify=function stringify(value){return JSON.stringify(value);};LayoutInputInterface.prototype._checkValue=function _checkValue(newValue){return StyledElements.InputValidationError.NO_ERROR;};LayoutInputInterface.prototype.getValue=function getValue(){return this.layout;};LayoutInputInterface.prototype.setDisabled=function setDisabled(disabled){this.selectElement.setDisabled(disabled);this.summary_addon.setDisabled(disabled);this.buttonElement.setDisabled(disabled);};LayoutInputInterface.prototype.repaint=function epaint(){this.wrapperElement.repaint();};LayoutInputInterface.prototype._setValue=function _setValue(newValue){this.layout=newValue;this.selectElement.setValue(this.layout.type);updateLayoutSummary.call(this);};LayoutInputInterface.prototype._setError=function _setError(error){};LayoutInputInterface.prototype.insertInto=function insertInto(element){this.wrapperElement.insertInto(element);};Wirecloud.ui.LayoutInputInterface=LayoutInputInterface;})(Wirecloud.Utils);;(function(utils){"use strict";var VERSION_RE=/^([1-9]\d*|0)(?:\.([1-9]\d*|0))*$/;var VersionInputInterface=function VersionInputInterface(fieldId,options){if(options==null){options={};}
if(options.placeholder==null){options.placeholder='1.0';}
StyledElements.TextInputInterface.call(this,fieldId,options);};utils.inherit(VersionInputInterface,StyledElements.TextInputInterface);VersionInputInterface.prototype._checkValue=function _checkValue(newValue){if(newValue.match(VERSION_RE)!=null){return StyledElements.InputValidationError.NO_ERROR;}else{return StyledElements.InputValidationError.VERSION_ERROR;}};StyledElements.VersionInputInterface=VersionInputInterface;})(StyledElements.Utils);;(function(){"use strict";var default_mapping={'boolean':StyledElements.BooleanInputInterface,'text':StyledElements.TextInputInterface,'version':StyledElements.VersionInputInterface,'password':StyledElements.PasswordInputInterface,'hidden':StyledElements.HiddenInputInterface,'list':StyledElements.ListInputInterface,'number':StyledElements.NumberInputInterface,'longtext':StyledElements.LongTextInputInterface,'url':StyledElements.URLInputInterface,'email':StyledElements.EMailInputInterface,'select':StyledElements.SelectInputInterface,'buttons':StyledElements.ButtonGroupInputInterface,'file':StyledElements.FileInputInterface,'fieldset':StyledElements.FieldSetInterface,'multivalued':StyledElements.MultivaluedInputInterface};var InputInterfaceFactory=function InputInterfaceFactory(){var mapping=StyledElements.Utils.clone(default_mapping);this.createInterface=function createInterface(fieldId,fieldDesc){var Class_=mapping[fieldDesc.type];if(Class_==null){throw new Error(fieldDesc.type);}
var instance=new Class_(fieldId,fieldDesc,this);if(fieldDesc.initiallyDisabled){instance.disable();}
return instance;};this.addFieldType=function addFieldType(type,class_){if(!(class_.prototype instanceof StyledElements.InputInterface)){throw new TypeError();}
if(mapping[type]!==undefined){throw new Error();}
mapping[type]=class_;};this.parse=function parse(type,value){if(mapping[type]==null){throw new TypeError('Invalid data type');}
return mapping[type].parse(value);};this.stringify=function stringify(type,value){if(mapping[type]==null){throw new TypeError('Invalid data type');}
return mapping[type].stringify(value);};};StyledElements.InputInterfaceFactory=InputInterfaceFactory;})();;(function(){"use strict";StyledElements.DefaultInputInterfaceFactory=new StyledElements.InputInterfaceFactory();})();;(function(se,utils){"use strict";var Form=function Form(fields,options){var div,buttonArea,defaultOptions;defaultOptions={readOnly:false,buttonArea:null,setdefaultsButton:false,resetButton:false,acceptButton:true,cancelButton:true,useHtmlForm:true,factory:StyledElements.DefaultInputInterfaceFactory};if(options&&options.readOnly){defaultOptions.acceptButton=false;defaultOptions.cancelButton=false;}
options=utils.merge(defaultOptions,options);if(fields==null||typeof fields!=="object"){throw new TypeError("invalid fields parameter");}else if(!Array.isArray(fields)){fields=norm_fields(fields);}
this.setdefaultsButton=null;if(options.setdefaultsButton instanceof StyledElements.Button){this.setdefaultsButton=options.setdefaultsButton;}else if(options.setdefaultsButton===true){this.setdefaultsButton=new StyledElements.Button({usedInForm:options.useHtmlForm,text:utils.gettext('Set Defaults')});}
this.resetButton=null;if(options.resetButton instanceof StyledElements.Button){this.resetButton=options.resetButton;}else if(options.resetButton===true){this.resetButton=new StyledElements.Button({usedInForm:options.useHtmlForm,text:utils.gettext('Reset')});}
this.acceptButton=null;if(options.acceptButton instanceof StyledElements.Button){this.acceptButton=options.acceptButton;}else if(options.acceptButton===true){this.acceptButton=new StyledElements.Button({'usedInForm':options.useHtmlForm,'class':'btn-primary','text':utils.gettext('Accept')});}
this.cancelButton=null;if(options.cancelButton instanceof StyledElements.Button){this.cancelButton=options.cancelButton;}else if(options.cancelButton===true){this.cancelButton=new StyledElements.Button({usedInForm:options.useHtmlForm,text:utils.gettext('Cancel')});}
StyledElements.StyledElement.call(this,['submit','cancel']);this.childComponents=[];this.readOnly=options.readOnly;this.fields={};this.fieldList=fields;this.focusField=fields.length>0?fields[0].name:null;this.fieldInterfaces={};this.factory=options.factory;div=document.createElement('div');if(options.useHtmlForm){this.wrapperElement=document.createElement('form');this.wrapperElement.addEventListener('submit',function(e){e.preventDefault();},true);this.wrapperElement.appendChild(div);}else{this.wrapperElement=div;}
div.appendChild(this.pBuildFieldTable(fields));this.wrapperElement.className="styled_form";this.msgElement=document.createElement('div');this.msgElement.className='alert alert-error';div.appendChild(this.msgElement);setMsgs.call(this,[]);if(options.buttonArea!=null){buttonArea=options.buttonArea;}else if(options.acceptButton!==false||options.cancelButton!==false){buttonArea=document.createElement('div');buttonArea.className='buttons';div.appendChild(buttonArea);}
if(this.setdefaultsButton!=null){this.setdefaultsButton.addEventListener("click",this.defaults.bind(this));this.setdefaultsButton.insertInto(buttonArea);}
if(this.resetButton!=null){this.resetButton.addEventListener("click",this.reset.bind(this));this.resetButton.insertInto(buttonArea);}
if(this.acceptButton!=null){this.acceptButton.addEventListener("click",acceptHandler.bind(this));this.acceptButton.insertInto(buttonArea);}
if(this.cancelButton!=null){this.cancelButton.addEventListener("click",cancelHandler.bind(this));this.cancelButton.insertInto(buttonArea);}};utils.inherit(Form,StyledElements.StyledElement);Form.prototype.repaint=function repaint(temporal){var i;for(i=0;i<this.childComponents.length;i+=1){this.childComponents[i].repaint(temporal);}
for(i in this.fieldInterfaces){this.fieldInterfaces[i].repaint();}
return this;};Form.prototype.pBuildFieldGroups=function(fields){var notebook,tab,tmp_field,tmp_input;notebook=new StyledElements.Notebook({full:false});this.childComponents.push(notebook);fields.forEach(function(field){tab=notebook.createTab({label:field.shortTitle,closable:false});tab.addEventListener('show',this.repaint.bind(this));if(field.nested===true){tmp_field={'name':field.name,'type':'fieldset','fields':field.fields};tmp_input=this.factory.createInterface(field.name,tmp_field);tmp_input.assignDefaultButton(this.acceptButton);this.fieldInterfaces[field.name]=tmp_input;this.fields[field.name]=tmp_field;tab.appendChild(tmp_input);}else{tab.appendChild(this.pBuildFieldTable(field.fields));}},this);return notebook.wrapperElement;};Form.prototype.pBuildFieldTable=function(fields){var table,tbody;if(fields[0]&&fields[0].type==='group'){return this.pBuildFieldGroups(fields);}
table=document.createElement('table');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');tbody=document.createElement('tbody');table.appendChild(tbody);fields.forEach(function(field){var row,cell,fieldId=field.name;row=tbody.insertRow(-1);switch(field.type){case'columnLayout':cell=row.insertCell(-1);cell.setAttribute('colspan',2);insertColumnLayout.call(this,field,cell);break;case'lineLayout':cell=row.insertCell(-1);cell.setAttribute('colspan',2);insertLineLayout.call(this,field,cell);break;case'hidden':row.className="hidden";default:insertField.call(this,fieldId,field,row);}},this);return table;};Form.prototype.extraValidation=function(fields){return[];};Form.prototype.getData=function getData(){var data,fieldId,field;data={};for(fieldId in this.fieldInterfaces){field=this.fieldInterfaces[fieldId];data[fieldId]=field.getValue();}
return data;};Form.prototype.setData=function setData(data){var field,fieldId;if(typeof data!=='object'&&typeof data!=='undefined'){throw new TypeError();}
setMsgs.call(this,[]);if(data!=null){for(fieldId in this.fieldInterfaces){field=this.fieldInterfaces[fieldId];field._setValue(data[fieldId]);}}else{for(fieldId in this.fields){field=this.fieldInterfaces[fieldId];field.reset();}}
return this;};Form.prototype.update=function update(data){var field,fieldId;if(data==null||typeof data!=='object'){throw new TypeError("Invalid data value");}
setMsgs.call(this,[]);for(fieldId in this.fieldInterfaces){if(fieldId in data){field=this.fieldInterfaces[fieldId];field._setValue(data[fieldId]);}}
return this;};Form.prototype.is_valid=function(){var fieldId,extraErrorMsgs,errorMsgs,validationManager=new StyledElements.ValidationErrorManager();for(fieldId in this.fieldInterfaces){validationManager.validate(this.fieldInterfaces[fieldId]);}
extraErrorMsgs=this.extraValidation(this.fields);errorMsgs=validationManager.toHTML();if(extraErrorMsgs!==null){errorMsgs=errorMsgs.concat(extraErrorMsgs);}
setMsgs.call(this,errorMsgs);return errorMsgs.length===0;};Form.prototype.reset=function reset(){return this.setData();};Form.prototype.defaults=function defaults(){var field,fieldId;setMsgs.call(this,[]);for(fieldId in this.fields){field=this.fieldInterfaces[fieldId];field._setValue(field._defaultValue);}
return this;};Form.prototype.destroy=function destroy(){var i=0;for(i=0;i<this.childComponents.length;i+=1){this.childComponents[i].destroy();}
this.childComponents=null;if(this.setdefaultsButton){this.setdefaultsButton.destroy();this.setdefaultsButton=null;}
if(this.resetButton){this.resetButton.destroy();this.resetButton=null;}
if(this.acceptButton){this.acceptButton.destroy();this.acceptButton=null;}
if(this.cancelButton){this.cancelButton.destroy();this.cancelButton=null;}};Form.prototype._onenabled=function _onenabled(enabled){var fieldId,inputInterface;for(fieldId in this.fieldInterfaces){inputInterface=this.fieldInterfaces[fieldId];inputInterface.setDisabled(!enabled||this.readOnly||inputInterface._readOnly);}
if(this.resetButton!=null){this.resetButton.enabled=enabled;}
if(this.setdefaultsButton!=null){this.setdefaultsButton.enabled=enabled;}
if(this.acceptButton!=null){this.acceptButton.enabled=enabled;}
if(this.cancelButton!=null){this.cancelButton.enabled=enabled;}};Form.prototype.focus=function focus(){var field=this.fieldInterfaces[this.focusField];if(field){field.focus();}
return this;};Form.prototype.displayMessage=function displayMessage(message){setMsgs.call(this,[message]);};Form.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.repaint();};var norm_fields=function norm_fields(fields){var key,field,list=[];for(key in fields){field=fields[key];if(!('name'in field)){field.name=key;}
list.push(field);}
return list;};var acceptHandler=function acceptHandler(){if(this.is_valid()){var data=this.getData();this.dispatchEvent('submit',data);}};var cancelHandler=function cancelHandler(){this.dispatchEvent('cancel');};var insertColumnLayout=function insertColumnLayout(desc,wrapper){var table,tbody,row,cell,i;table=document.createElement('table');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');tbody=document.createElement('tbody');table.appendChild(tbody);row=tbody.insertRow(-1);for(i=0;i<desc.columns.length;i+=1){cell=row.insertCell(-1);cell.appendChild(this.pBuildFieldTable(desc.columns[i]));}
wrapper.appendChild(table);};var insertLineLayout=function insertLineLayout(desc,wrapper){var fields=norm_fields(desc.fields);fields.forEach(function(field){var fieldId,inputInterface,wrapperElement;fieldId=field.name;inputInterface=this.factory.createInterface(fieldId,field);inputInterface.assignDefaultButton(this.acceptButton);inputInterface.insertInto(wrapper);wrapperElement=null;if(inputInterface.wrapperElement&&inputInterface.wrapperElement.wrapperElement){wrapperElement=inputInterface.wrapperElement.wrapperElement;}else if(inputInterface.inputElement&&inputInterface.inputElement.wrapperElement){wrapperElement=inputInterface.inputElement.wrapperElement;}
if(wrapperElement){wrapperElement.style.display='inline-block';wrapperElement.style.verticalAlign='middle';}
this.fieldInterfaces[fieldId]=inputInterface;this.fields[fieldId]=field;},this);};var insertField=function insertField(fieldId,field,row){var separator,hr,labelRow,labelCell,label,requiredMark,inputCell,inputInterface,tooltip;if(field.type==='separator'){separator=row.insertCell(-1);separator.setAttribute('colspan','2');hr=document.createElement('hr');separator.appendChild(hr);return;}
if(field.type==='label'){labelRow=row.insertCell(-1);labelRow.setAttribute('colspan','2');labelRow.addClassName('label-row');if(field.url){label=document.createElement('a');label.setAttribute("href",field.url);label.setAttribute("target","_blank");}else{label=document.createElement('label');}
label.appendChild(document.createTextNode(field.label));labelRow.appendChild(label);return;}
inputInterface=this.factory.createInterface(fieldId,field);labelCell=row.insertCell(-1);labelCell.classList.add('label-cell');label=document.createElement('label');label.textContent=field.label;labelCell.appendChild(label);if(field.description!=null){tooltip=new StyledElements.Tooltip({content:field.description,placement:['right','bottom','top','left']});tooltip.bind(label);}
if(field.required&&!this.readOnly){requiredMark=document.createElement('span');requiredMark.appendChild(document.createTextNode('*'));requiredMark.className='required_mark';labelCell.appendChild(requiredMark);}
inputCell=document.createElement('td');row.appendChild(inputCell);inputInterface.assignDefaultButton(this.acceptButton);inputInterface.insertInto(inputCell);if(this.readOnly||inputInterface._readOnly){inputInterface.setDisabled(true);}
this.fieldInterfaces[fieldId]=inputInterface;this.fields[fieldId]=field;};var setMsgs=function setMsgs(msgs){var i,wrapper;this.msgElement.innerHTML='';if(msgs.length>0){for(i=0;i<msgs.length;i+=1){wrapper=document.createElement('p');wrapper.textContent=msgs[i];this.msgElement.appendChild(wrapper);}
this.msgElement.style.display='';}else{this.msgElement.style.display='none';}};StyledElements.Form=Form;})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var builder,onPaginationChanged,updateButtons,updateLayout,PaginationInterface;builder=new StyledElements.GUIBuilder();onPaginationChanged=function onPaginationChanged(source){if(this.autoHide&&this.source.totalPages===1){this.wrapperElement.style.display='none';}else{this.wrapperElement.style.display='';}
this.totalPagesLabel.textContent=this.source.totalPages;this.currentPageLabel.textContent=this.source.currentPage;this.totalCountLabel.textContent=this.source.totalCount;updateButtons.call(this);};updateButtons=function updateButton(){if(this.source.currentPage<=1){this.prevBtn.disable();this.firstBtn.disable();}else{this.prevBtn.enable();this.firstBtn.enable();}
if(this.source.currentPage>=this.source.totalPages){this.nextBtn.disable();this.lastBtn.disable();}else{this.nextBtn.enable();this.lastBtn.enable();}};updateLayout=function updateLayout(pattern){var elements={'firstBtn':this.firstBtn,'prevBtn':this.prevBtn,'nextBtn':this.nextBtn,'lastBtn':this.lastBtn,'currentPage':this.currentPageLabel,'totalPages':this.totalPagesLabel,'totalCount':this.totalCountLabel};var contents=builder.parse(pattern,elements);this.wrapperContainer.appendChild(contents);};PaginationInterface=function PaginationInterface(source,options){var defaultOptions={'layout':utils.gettext(builder.DEFAULT_OPENING+'<div class="se-input-group"><t:firstBtn/><t:prevBtn/><div class="se-box">Page: <t:currentPage/>/<t:totalPages/></div><t:nextBtn/><t:lastBtn/></div>'+builder.DEFAULT_CLOSING),'autoHide':false};options=utils.merge(defaultOptions,options);this.autoHide=options.autoHide;StyledElements.StyledElement.call(this,[]);this.source=source;this.wrapperContainer=new StyledElements.Container({class:'pagination'});this.wrapperElement=this.wrapperContainer.wrapperElement;this.firstBtn=new StyledElements.Button({'iconClass':'icon-first-page'});this.firstBtn.addEventListener('click',source.goToFirst.bind(source));this.prevBtn=new StyledElements.Button({'iconClass':'icon-prev-page'});this.prevBtn.addEventListener('click',source.goToPrevious.bind(source));this.nextBtn=new StyledElements.Button({'iconClass':'icon-next-page'});this.nextBtn.addEventListener('click',source.goToNext.bind(source));this.lastBtn=new StyledElements.Button({'iconClass':'icon-last-page'});this.lastBtn.addEventListener('click',source.goToLast.bind(source));this.currentPageLabel=document.createElement('span');this.currentPageLabel.classList.add('current-page');this.totalPagesLabel=document.createElement('span');this.totalPagesLabel.classList.add('total-pages');this.totalCountLabel=document.createElement('span');this.totalCountLabel.classList.add('total-count');updateLayout.call(this,options.layout);this.currentPageLabel.textContent=this.currentPage+1;this.totalPagesLabel.textContent=this.totalPages;updateButtons.call(this);this.source.addEventListener('requestEnd',onPaginationChanged.bind(this));};utils.inherit(PaginationInterface,StyledElements.StyledElement);PaginationInterface.prototype.changeLayout=function changeLayout(newLayout){updateLayout.call(this,newLayout);};StyledElements.PaginationInterface=PaginationInterface;})(StyledElements.Utils);;(function(utils){"use strict";var builder=new StyledElements.GUIBuilder();var template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="popover fade"><div class="arrow"/><h3 class="popover-title"><t:title/></h3><div class="popover-content"><t:content/></div></div></s:styledgui>';var disableCallback=function disableCallback(e){if(e.button!==0){return;}
setTimeout(this.hide.bind(this),0);};var setPosition=function setPosition(refPosition,position){this.element.classList.remove('top','right','bottom','left');switch(position){case'top':this.element.classList.add('top');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=(refPosition.top-this.element.offsetHeight)+"px";break;case'right':this.element.classList.add('right');this.element.style.left=refPosition.right+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;case'bottom':this.element.classList.add('bottom');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=refPosition.bottom+"px";break;case'left':this.element.classList.add('left');this.element.style.left=(refPosition.left-this.element.offsetWidth)+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;}};var standsOut=function standsOut(){var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setPosition.call(this,refPosition,position);var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.element.style.top="";this.element.style.bottom="10px";element_box=this.element.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.element.style.top="10px";}};var searchBestPosition=function searchBestPosition(refPosition,positions){var i=0,weights=[];do{setPosition.call(this,refPosition,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,positions);}};var _show=function _show(refPosition){if('Wirecloud'in window){Wirecloud.UserInterfaceManager._registerPopup(this);}
if(this.visible){this.element.classList.add('in');this.repaint();return;}
if('getBoundingClientRect'in refPosition){refPosition=refPosition.getBoundingClientRect();}
this.element=builder.parse(template,{title:this.options.title,content:this.options.content}).elements[0];this.element.addEventListener('transitionend',_hide.bind(this));var baseelement=utils.getFullscreenElement()||document.body;baseelement.appendChild(this.element);baseelement.addEventListener("click",this._disableCallback,true);searchBestPosition.call(this,refPosition,this.options.placement);this.element.classList.add('in');this.dispatchEvent('show');return this;};var Popover=function Popover(options){var defaultOptions={'content':'','title':'','class':'','html':false,'placement':['right','bottom','left','top']};Object.defineProperty(this,'options',{value:utils.merge(defaultOptions,options)});StyledElements.StyledElement.call(this,[]);Object.defineProperties(this,{element:{value:null,writable:true},visible:{get:function(){return this.element!=null;}},_disableCallback:{value:disableCallback.bind(this),enumerable:false}});};utils.inherit(Popover,StyledElements.StyledElement);Popover.prototype.bind=function bind(element,mode){switch(mode){case"click":element.addEventListener('click',this.toggle.bind(this),true);break;case"hover":element.addEventListener('focus',this.show.bind(this,element),false);element.addEventListener('blur',this.hide.bind(this),false);element.addEventListener('mouseenter',this.show.bind(this,element),true);element.addEventListener('mouseleave',this.hide.bind(this),true);element.addEventListener('click',this.show.bind(this,element),false);break;default:throw new TypeError('Invalid mode: '+mode);}};Popover.prototype.toggle=function toggle(refElement){if(this.visible){return this.hide();}else{return _show.call(this,refElement);}};Popover.prototype.show=function show(refElement){return _show.call(this,refElement);};var _hide=function _hide(){if(this.element!=null&&!this.element.classList.contains('in')){this.element.remove();this.element=null;if('Wirecloud'in window){Wirecloud.UserInterfaceManager._unregisterPopup(this);}
document.removeEventListener('click',this._disableCallback,true);this.dispatchEvent('hide');}};Popover.prototype.hide=function hide(){var force;if(!this.visible){return this;}
force=!this.element.classList.contains('in')|| getComputedStyle(this.element).getPropertyValue('opacity')==="0";this.element.classList.remove('in');if(force){_hide.call(this);}
return this;};StyledElements.Popover=Popover;})(StyledElements.Utils);;(function(se,utils){"use strict";se.Panel=function Panel(options){options=utils.merge(utils.clone(defaults),options);se.StyledElement.call(this,['click'].concat(options.events));this.wrapperElement=document.createElement('div');this.wrapperElement.className='panel';if(options.state){this.addClassName('panel-'+options.state);}
if(options.selectable){this.addClassName('panel-selectable');}
this.addClassName(options.class);this.heading=new se.Container({class:"panel-heading"});this.heading.insertInto(this.wrapperElement);if(options.title){this.setTitle(options.title);}
if(options.buttons.length){this.buttons=new se.Container({class:"panel-options"});options.buttons.forEach(function(button){this.buttons.appendChild(button);},this);this.heading.appendChild(this.buttons);}
if(options.subtitle){this.setSubtitle(options.subtitle);}
if(!options.noBody){this.body=new se.Container({class:"panel-body"});this.body.insertInto(this.wrapperElement);}
Object.defineProperties(this,{active:{get:function get(){return this.hasClassName('active');},set:function set(value){if(this.active!==value){this.toggleClassName('active',value)._onactive(value);}}},title:{get:function get(){return this.heading.title.text();}}});this.wrapperElement.addEventListener('click',this._onclick.bind(this));};utils.inherit(se.Panel,se.StyledElement,{_onactive:function _onactive(active){},_onclick:function _onclick(event){event.stopPropagation();return this.dispatchEvent('click',event);},clear:function clear(){if(this.body!=null){this.body.clear();}
return this;},setTitle:function setTitle(title){if(this.heading.title==null){this.heading.title=new se.Container({class:"panel-title"});this.heading.appendChild(this.heading.title);}
this.heading.title.clear().appendChild(title);return this;},setSubtitle:function setSubtitle(subtitle){if(this.heading.subtitle==null){this.heading.subtitle=new se.Container({class:"panel-subtitle"});this.heading.appendChild(this.heading.subtitle);}
this.heading.subtitle.clear().appendChild(subtitle);return this;}});var defaults={class:"",events:[],title:"",subtitle:"",state:'default',selectable:false,noBody:false,buttons:[]};})(StyledElements,StyledElements.Utils);;(function(se,utils){"use strict";se.OffCanvasLayout=function OffCanvasLayout(options){se.StyledElement.call(this,['slideIn','slideOut']);options=utils.merge({sideway:'left'},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className='se-offcanvas '+options.sideway+'-sideway';Object.defineProperties(this,{slipped:{get:function get(){return this.hasClassName('slipped');}},sidebar:{value:new se.Container({class:'se-offcanvas-sidebar'})},content:{value:new se.Container({class:'se-offcanvas-content'})}});this.index=-1;this.sidebar.appendTo(this.wrapperElement);this.content.appendTo(this.wrapperElement);};utils.inherit(se.OffCanvasLayout,se.StyledElement,{appendChild:function appendChild(element){this.sidebar.appendChild(element);if(this.index<0){this.index=this.sidebar.children.length-1;}
return this;},repaint:function repaint(){if(this.slipped){this.sidebar.repaint();}
this.content.repaint();return this;},slideIn:function slideIn(index){var element;if(this.sidebar.children.length){this.sidebar.children.forEach(function(element){element.hide();});if(typeof index==='number'){this.index=index;}
element=this.sidebar.children[this.index].show();}
this.toggleClassName('slipped',true);return this.dispatchEvent('slideIn',element);},slideOut:function slideOut(index){if(typeof index==='number'){this.index=index;}
this.toggleClassName('slipped',false);return this.dispatchEvent('slideOut');}});})(StyledElements,StyledElements.Utils);;(function(se,utils){"use strict";se.Alert=function Alert(options){options=utils.merge(utils.clone(defaults),options);se.StyledElement.call(this);this.wrapperElement=document.createElement('div');this.wrapperElement.className='alert';if(options.state!=null&&options.state.trim()!==""){this.addClassName('alert-'+options.state);}
if(options.alignment){this.addClassName('se-alert-'+options.alignment);}
this.addClassName(options.class);this.heading=new se.Container({class:"se-alert-heading"});this.heading.appendChild(options.title).insertInto(this.wrapperElement);this.body=new se.Container({class:"se-alert-body"});this.body.appendChild(options.message).insertInto(this.wrapperElement);};utils.inherit(se.Alert,se.StyledElement,{addNote:function addNote(textContent){var blockquote=document.createElement('blockquote');if(textContent instanceof StyledElements.StyledElement){textContent.appendTo(blockquote);}else{blockquote.innerHTML=textContent;}
this.body.appendChild(blockquote);return blockquote;}});var defaults={state:'warning',alignment:"",class:"",title:"",message:""};})(StyledElements,StyledElements.Utils);;(function(se,utils){"use strict";se.Typeahead=function Typeahead(options){options=utils.merge(utils.clone(defaults),options);se.ObjectWithEvents.call(this,events);this.lookup=options.lookup;this.compare=options.compare;this.build=options.build;this.notFoundMessage=options.notFoundMessage;this.timeout=null;this.currentRequest=null;Object.defineProperties(this,{autocomplete:{value:options.autocomplete},cleanedQuery:{get:property_cleanedQuery_get},dataFiltered:{value:options.dataFiltered},minLength:{value:options.minLength}});this.popupMenu=new se.PopupMenu({oneActiveAtLeast:true,useRefElementWidth:true});this.popupMenu.addEventListener('click',popupMenu_onselect.bind(this));};utils.inherit(se.Typeahead,se.ObjectWithEvents,{bind:function bind(textField){if(!(textField instanceof se.TextField)){throw new TypeError();}
this.textField=textField;this.textField.inputElement.setAttribute('autocomplete','off');this.textField.inputElement.setAttribute('autocorrect','off');this.textField.inputElement.setAttribute('spellcheck','false');this.textField.addEventListener('change',textField_onchange.bind(this));this.textField.addEventListener('keydown',textField_onkeydown.bind(this));this.textField.addEventListener('submit',textField_onsubmit.bind(this));this.textField.addEventListener('focus',textField_onchange.bind(this));this.textField.addEventListener('blur',textField_onblur.bind(this));return this;}});var builder=new se.GUIBuilder();var events=['select','show'];var defaults={autocomplete:true,dataFiltered:false,minLength:1};var property_cleanedQuery_get=function property_cleanedQuery_get(){return this.textField!=null?this.textField.value.trim().split(/\s+/).join(" "):"";};var textField_onchange=function textField_onchange(){if(this.timeout!=null){clearTimeout(this.timeout);}
this.timeout=setTimeout(search.bind(this),150);};var search=function search(){this.timeout=null;this.userQuery=this.cleanedQuery;if(this.userQuery.length>=this.minLength){if(this.currentRequest!=null&&'abort'in this.currentRequest){this.currentRequest.abort();}
this.currentRequest=this.lookup(this.userQuery,sortResult.bind(this));}else{this.popupMenu.hide();}};var filterData=function filterData(data){var i,result=[];for(i=0;i<data.length;i++){switch(this.compare(this.userQuery,data[i])){case 0:result.push(data[i]);break;default:break;}}
return result;};var sortResult=function sortResult(data){var i,msg,item;this.currentRequest=null;this.popupMenu.clear();if(data.length>0){if(!this.dataFiltered){data=filterData.call(this,data);}
for(i=0;i<data.length;i++){this.popupMenu.append(createMenuItem.call(this,this.build(this,data[i])));}}else{msg=this.notFoundMessage!=null?this.notFoundMessage:utils.gettext("No results found for <em><t:query/></em>");msg=builder.DEFAULT_OPENING+msg+builder.DEFAULT_CLOSING;msg=builder.parse(msg,{query:this.cleanedQuery});item=new StyledElements.MenuItem(msg);item.disable();this.popupMenu.append(item);}
this.popupMenu.show(this.textField.getBoundingClientRect());return this.dispatchEvent('show',data);};var popupMenu_onselect=function popupMenu_onselect(popupMenu,menuItem){this.textField.inputElement.value=this.autocomplete?menuItem.context.value:"";this.textField.focus();menuItem.context=menuItem.context.context;this.dispatchEvent('select',menuItem);};var createMenuItem=function createMenuItem(data){var menuItem=new se.MenuItem(new se.Fragment(utils.highlight(data.title,this.userQuery)),null,data);if(data.iconClass){menuItem.addIconClass(data.iconClass);}
if(data.description){menuItem.setDescription(new se.Fragment(utils.highlight(data.description,this.userQuery)));}
return menuItem;};var textField_onkeydown=function textField_onkeydown(textField,event,key){if(this.popupMenu.hasEnabledItem()){switch(key){case'Tab':case'Enter':event.preventDefault();this.popupMenu.activeItem.click();break;case'ArrowDown':event.preventDefault();this.popupMenu.moveCursorDown();break;case'ArrowUp':event.preventDefault();this.popupMenu.moveCursorUp();break;default:}}};var textField_onsubmit=function textField_onsubmit(textField){if(this.popupMenu.hasEnabledItem()){this.popupMenu.activeItem.click();}};var textField_onblur=function textField_onblur(textField){if(this.timeout!=null){clearTimeout(this.timeout);}
if(this.currentRequest!=null&&'abort'in this.currentRequest){this.currentRequest.abort();}
this.timeout=null;this.currentRequest=null;setTimeout(this.popupMenu.hide.bind(this.popupMenu),100);};})(StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.WorkspaceTab=function WorkspaceTab(workspace,data){if(!(workspace instanceof Wirecloud.Workspace)){throw new TypeError("invalid workspace parameter");}
se.ObjectWithEvents.call(this,events);data=clean_data.call(this,data);privates.set(this,{initial:data.initial,name:data.name,title:data.title!=null&&data.title.trim()!=""?data.title:data.name,widgets:[],on_changetab:on_changetab.bind(this),on_removewidget:on_removewidget.bind(this)});Object.defineProperties(this,{id:{value:data.id},initial:{get:function(){return privates.get(this).initial;}},name:{get:function(){return privates.get(this).name;}},title:{get:function(){return privates.get(this).title;}},widgets:{get:function(){return privates.get(this).widgets.slice(0);}},widgetsById:{get:function(){return get_widgets_by_id.call(this);}},workspace:{value:workspace}});Object.defineProperties(this,{preferences:{value:create_preferences.call(this,data.preferences)}});this.workspace.addEventListener('changetab',privates.get(this).on_changetab);};utils.inherit(ns.WorkspaceTab,se.ObjectWithEvents,{createWidget:function createWidget(resource,options){options=utils.merge({commit:true,title:resource.title},options);if(!options.commit){return create_widget.call(this,resource,options);}
return new Promise(function(resolve,reject){var url=Wirecloud.URLs.IWIDGET_COLLECTION.evaluate({workspace_id:this.workspace.id,tab_id:this.id});if(this.workspace.restricted){reject(utils.interpolate(utils.gettext("The destination tab (%(title)s) is readonly"),{title:this.title}));}
var content=utils.merge(options,{widget:resource.uri});Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(content),onComplete:function(response){if(response.status===201){resolve(create_widget.call(this,resource,JSON.parse(response.responseText)));}else{reject();}}.bind(this)});}.bind(this));},findWidget:function findWidget(id){return get_widgets_by_id.call(this)[id];},isAllowed:function isAllowed(permission){switch(permission){case'remove':return!this.workspace.restricted&&Object.keys(this.workspace.tabs).length>1&&!privates.get(this).widgets.some(function(widget){return!widget.volatile&&!widget.isAllowed('close');});default:throw new TypeError("invalid permission parameter");}},remove:function remove(){var url=Wirecloud.URLs.TAB_ENTRY.evaluate({workspace_id:this.workspace.id,tab_id:this.id});return Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'}}).then((response)=>{if([204,401,403,404,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,404,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
remove_tab.call(this);return Promise.resolve(this);});},rename:function rename(title,name){if(typeof title!=='string'||!title.trim().length){throw new TypeError("invalid title parameter");}
if(name==null){name=URLify(title);}
var url=Wirecloud.URLs.TAB_ENTRY.evaluate({workspace_id:this.workspace.id,tab_id:this.id});var content={title:title,name:name};return Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(content),}).then((response)=>{if([204,401,403,409,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,409,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
change_name.call(this,title,name);return Promise.resolve(this);});},setInitial:function setInitial(){return new Promise(function(resolve,reject){var url=Wirecloud.URLs.TAB_ENTRY.evaluate({workspace_id:this.workspace.id,tab_id:this.id});var content={visible:true};Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(content),onComplete:function(response){if(response.status===204){change_initial.call(this,true);resolve(this);}else{reject();}}.bind(this)});}.bind(this));}});var privates=new WeakMap();var events=['change','createwidget','preremove','remove','removewidget'];var change_initial=function change_initial(initial){privates.get(this).initial=initial;this.dispatchEvent('change',['initial']);};var change_name=function change_name(title,name){var priv=privates.get(this);var old_title=priv.title;var old_name=priv.name;priv.title=title;priv.name=name;this.dispatchEvent('change',['name','title'],{name:old_name,title:old_title});};var clean_data=function clean_data(data){data=utils.merge({preferences:{}},data);data.initial=!!data.visible;data.name=data.name;return data;};var create_preferences=function create_preferences(preferences){return Wirecloud.PreferenceManager.buildPreferences('tab',preferences,this);};var create_widget=function create_widget(resource,data){var widget=new Wirecloud.Widget(this,resource,data);widget.addEventListener('remove',privates.get(this).on_removewidget);privates.get(this).widgets.push(widget);this.dispatchEvent('createwidget',widget);return widget;};var get_widgets_by_id=function get_widgets_by_id(){var widgets={};privates.get(this).widgets.forEach(function(widget){widgets[widget.id]=widget;});return widgets;};var remove_tab=function remove_tab(){this.dispatchEvent('preremove');this.workspace.removeEventListener('changetab',privates.get(this).on_changetab);this.dispatchEvent('remove');};var on_changetab=function on_changetab(workspace,tab,changes){if(tab!==this&&changes.initial&&tab.initial&&this.initial){change_initial.call(this,false);}};var on_removewidget=function on_removewidget(widget){widget.removeEventListener('remove',privates.get(this).on_removewidget);privates.get(this).widgets.splice(privates.get(this).widgets.indexOf(widget),1);this.dispatchEvent('removewidget',widget);};})(Wirecloud,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.Workspace=function Workspace(data,resources){var priv;se.ObjectWithEvents.call(this,['createoperator','createtab','createwidget','change','changetab','remove','removeoperator','removetab','removewidget','unload']);priv={tabs:[],on_livemessage:on_livemessage.bind(this),on_changetab:on_changetab.bind(this),on_createoperator:on_createoperator.bind(this),on_createwidget:on_createwidget.bind(this),on_removetab:on_removetab.bind(this),on_removeoperator:on_removeoperator.bind(this),on_removewidget:on_removewidget.bind(this)};privates.set(this,priv);Object.defineProperties(this,{contextManager:{value:new Wirecloud.ContextManager(this,Wirecloud.constants.WORKSPACE_CONTEXT)},description:{get:function(){return this.contextManager.get('description');}},emptyparams:{value:data.empty_params},extraprefs:{value:data.extra_prefs},id:{value:data.id},initialtab:{get:on_initial_tab_get},longdescription:{get:function(){return this.contextManager.get('longdescription');}},name:{get:function(){return this.contextManager.get('name');}},title:{get:function(){return this.contextManager.get('title');}},owner:{get:function(){return this.contextManager.get('owner');}},resources:{value:resources},shared:{value:!!data.shared},tabs:{get:on_tabs_get},tabsById:{get:on_tabs_by_id_get},updateDate:{value:new Date(data.lastmodified)},users:{value:data.users},url:{get:on_url_get},widgets:{get:on_widgets_get},widgetsById:{get:on_widgets_by_id_get}});this.contextManager.modify({title:data.title!=null&&data.title.trim()!=""?data.title:data.name,name:data.name,owner:data.owner,description:data.description,longdescription:data.longdescription});this.restricted=data.owner!==Wirecloud.contextManager.get('username')||Wirecloud.contextManager.get('mode')==='embedded';this.removable=!this.restricted&&data.removable;Object.defineProperties(this,{preferences:{value:Wirecloud.PreferenceManager.buildPreferences('workspace',data.preferences,this,data.extra_prefs)}});if(Array.isArray(data.tabs)){data.tabs.forEach(_create_tab,this);}
Object.defineProperties(this,{operators:{get:on_operators_get},operatorsById:{get:on_operators_by_id_get},wiring:{value:new Wirecloud.Wiring(this,data.wiring)}});this.wiring.addEventListener('createoperator',priv.on_createoperator);this.wiring.addEventListener('removeoperator',priv.on_removeoperator);if(Wirecloud.live){Wirecloud.live.addEventListener('workspace',priv.on_livemessage);}};utils.inherit(ns.Workspace,se.ObjectWithEvents,{createTab:function createTab(options){if(options==null){options={};}
var url=Wirecloud.URLs.TAB_COLLECTION.evaluate({workspace_id:this.id});if(options.title==null){options.title=create_tabtitle.call(this);}
if(options.name==null){options.name=URLify(options.title);}
var content={name:options.name,title:options.title};return Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(content)}).then((response)=>{if([201,401,403,409,422,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if(response.status!==201){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
var tab=_create_tab.call(this,JSON.parse(response.responseText));return Promise.resolve(tab);});},findOperator:function findOperator(id){return this.wiring.findOperator(id);},findTab:function findTab(id){if(id==null){throw new TypeError("Missing id parameter");}
id=String(id);return this.tabsById[id]||null;},findWidget:function findWidget(id){if(id==null){throw new TypeError("Missing id parameter");}
id=String(id);for(var i=0;i<this.widgets.length;i++){if(this.widgets[i].id===id){return this.widgets[i];}}
return null;},isAllowed:function isAllowed(permission){if(this.restricted){return false;}
switch(permission){case"remove":return this.removable;case"merge_workspaces":return is_allowed('add_remove_iwidgets')||is_allowed('merge_workspaces');case"update_preferences":return this.removable&&is_allowed('change_workspace_preferences');case"rename":return this.removable&&is_allowed('rename_workspaces');case"edit":return this.removable;default:return is_allowed(permission);}},merge:function merge(options){return Wirecloud.mergeWorkspace(this,options);},publish:function publish(options){if(options==null){throw new TypeError("missing options parameter");}
var url=Wirecloud.URLs.WORKSPACE_PUBLISH.evaluate({workspace_id:this.id});var content=new FormData();if(options.image){content.append('image',options.image);delete options.image;}
content.append('json',JSON.stringify(options));return Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},postBody:content}).then((response)=>{if([201,401,403,409,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,409,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
Wirecloud.LocalCatalogue._includeResource(JSON.parse(response.responseText));return Promise.resolve();});},remove:function remove(){return Wirecloud.removeWorkspace(this).then(function(){this.dispatchEvent('remove');}.bind(this));},rename:function rename(title,name){if(typeof title!=='string'||!title.trim().length){throw new TypeError("invalid title parameter");}
if(name==null){name=URLify(title);}
var url=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({workspace_id:this.id});var content={title:title,name:name};return Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(content)}).then((response)=>{if([204,401,403,409,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,409,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
var old_name=this.contextManager.get('name');var old_title=this.contextManager.get('title');this.contextManager.modify({name:name,title:title});this.dispatchEvent('change',['name','title'],{name:old_name,title:old_title});return Promise.resolve(this);});},unload:function unload(){var priv=privates.get(this);if(Wirecloud.live){Wirecloud.live.removeEventListener('workspace',priv.on_livemessage);}
this.wiring.removeEventListener('removeoperator',priv.on_removeoperator);this.wiring.removeEventListener('createoperator',priv.on_createoperator);this.dispatchEvent('unload');return this;}});var privates=new WeakMap();var on_tabs_get=function on_tabs_get(){return privates.get(this).tabs.slice(0);};var on_tabs_by_id_get=function on_tabs_by_id_get(){var tabs={};privates.get(this).tabs.forEach(function(tab){tabs[tab.id]=tab;});return tabs;};var _create_tab=function _create_tab(data){var tab=new Wirecloud.WorkspaceTab(this,data);var priv=privates.get(this);tab.addEventListener('change',priv.on_changetab);tab.addEventListener('createwidget',priv.on_createwidget);tab.addEventListener('remove',priv.on_removetab);tab.addEventListener('removewidget',priv.on_removewidget);priv.tabs.push(tab);this.dispatchEvent('createtab',tab);data.iwidgets.forEach(function(data){var resource=this.resources.findResource('widget',data.widget,true);tab.createWidget(resource,utils.merge(data,{commit:false}));},this);return tab;};var create_tabtitle=function create_tabtitle(){var copy,base,title,titles,priv;priv=privates.get(this);titles=priv.tabs.map(function(tab){return tab.title;});copy=1;base=title=utils.interpolate(utils.gettext("Tab %(index)s"),{index:priv.tabs.length+1});while(titles.indexOf(title)!==-1){copy+=1;title=utils.interpolate(utils.gettext("%(base) (%(copy)s)"),{base:base,copy:copy});}
return title;};var on_initial_tab_get=function on_initial_tab_get(){var i,priv;priv=privates.get(this);for(i=0;i<priv.tabs.length;i++){if(priv.tabs[i].initial){return priv.tabs[i];}}
return null;};var on_operators_get=function on_operators_get(){return this.wiring.operators;};var on_operators_by_id_get=function on_operators_by_id_get(){return this.wiring.operatorsById;};var on_url_get=function on_url_get(){return new URL(Wirecloud.URLs.WORKSPACE_VIEW.evaluate({name:encodeURIComponent(this.name),owner:encodeURIComponent(this.owner)}),Wirecloud.location.base);};var on_widgets_get=function on_widgets_get(){return Array.prototype.concat.apply([],privates.get(this).tabs.map(function(tab){return tab.widgets;}));};var on_widgets_by_id_get=function on_widgets_by_id_get(){var args=privates.get(this).tabs.map(function(tab){return tab.widgetsById;})
args.unshift({});return utils.merge.apply(utils,args);};var is_allowed=function is_allowed(permission){return Wirecloud.PolicyManager.evaluate('workspace',permission);};var on_changetab=function on_changetab(tab,changes){this.dispatchEvent('changetab',tab,changes);};var on_createoperator=function on_createoperator(wiring,operator){this.resources.addComponent(operator.meta);this.dispatchEvent('createoperator',operator);};var on_createwidget=function on_createwidget(tab,widget){this.resources.addComponent(widget.meta);this.dispatchEvent('createwidget',widget);};var on_livemessage=function on_livemessage(live,data){if(data.workspace===this.id){if('name'in data){var old_name=this.contextManager.get('name');this.contextManager.modify({name:data.name});this.dispatchEvent('change',['name'],{name:old_name});}}};var on_removetab=function on_removetab(tab){var priv=privates.get(this);priv.tabs.splice(priv.tabs.indexOf(tab),1);tab.removeEventListener('change',priv.on_changetab);tab.removeEventListener('createwidget',priv.on_createwidget);tab.removeEventListener('remove',priv.on_removetab);tab.removeEventListener('removewidget',priv.on_removewidget);this.dispatchEvent('removetab',tab);};var on_removeoperator=function on_removeoperator(wiring,operator){this.dispatchEvent('removeoperator',operator);};var on_removewidget=function on_removewidget(tab,widget){this.dispatchEvent('removewidget',widget);};})(Wirecloud,StyledElements,StyledElements.Utils);;(function(utils){"use strict";var onSuccessSavePreferences=function onSuccessSavePreferences(options){utils.callCallback(options.onSuccess,this.preferences);this.preferences.dispatchEvent('post-commit',this.modifiedValues);};var onErrorSavePreferences=function onErrorSavePreferences(options){utils.callCallback(options.onFailure,this.preferences);};var persist=function persist(modifiedValues,options){var context={preferences:this,modifiedValues:modifiedValues};Wirecloud.io.makeRequest(this._build_save_url(),{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(modifiedValues),onSuccess:onSuccessSavePreferences.bind(context,options),onFailure:onErrorSavePreferences.bind(context,options)});};var Preferences=function Preferences(preferencesDef,values){if(arguments.length===0){return;}
Object.defineProperty(this,'meta',{value:preferencesDef});Object.defineProperty(this,'preferences',{value:{}});var inherit,value,definition;for(var key in preferencesDef.preferences){definition=preferencesDef.preferences[key];if(key in values){inherit=values[definition.name].inherit;value=values[key].value;}else{value=null;inherit=definition.inheritByDefault;}
this.preferences[definition.name]=new Wirecloud.PlatformPref(this,definition,inherit,value);}
this._handleParentChanges=this._handleParentChanges.bind(this);StyledElements.ObjectWithEvents.call(this,['pre-commit','post-commit']);};Preferences.prototype=new StyledElements.ObjectWithEvents();Preferences.prototype.get=function get(name){return this.preferences[name].getEffectiveValue();};Preferences.prototype.set=function set(newValues,options){var newEffectiveValues={};var modifiedValues={};if(options==null){options={};}
for(var name in newValues){var preference=this.preferences[name];var changes=newValues[name];if('inherit'in changes){preference.inherit=changes.inherit;}
if('value'in changes){preference.value=changes.value;changes.value=Wirecloud.ui.InputInterfaceFactory.stringify(preference.meta.options.type,preference.value);}
modifiedValues[name]=changes;newEffectiveValues[name]=preference.getEffectiveValue();}
this.dispatchEvent('pre-commit',newEffectiveValues);persist.call(this,modifiedValues,options);};Preferences.prototype._handleParentChanges=function _handleParentChanges(parentPreferences,modifiedValues){var valuesToPropagate={};var propagate=false;for(var preferenceName in modifiedValues){if(preferenceName in this.preferences&&this.preferences[preferenceName].inherit){propagate=true;valuesToPropagate[preferenceName]=modifiedValues[preferenceName];}}
if(propagate){this.dispatchEvent('pre-commit',valuesToPropagate);}};Preferences.prototype.destroy=function destroy(){};Wirecloud.Preferences=Preferences;})(Wirecloud.Utils);;(function(utils){"use strict";var PlatformPreferences=function PlatformPreferences(definitions,values){Wirecloud.Preferences.call(this,definitions,values);};PlatformPreferences.prototype=new Wirecloud.Preferences();PlatformPreferences.prototype.buildTitle=function buildTitle(){return utils.gettext("Platform Preferences");};PlatformPreferences.prototype._build_save_url=function _build_save_url(){return Wirecloud.URLs.PLATFORM_PREFERENCES;};Wirecloud.PlatformPreferences=PlatformPreferences;})(Wirecloud.Utils);;(function(utils){"use strict";var PreferenceManager=function PreferenceManager(){this.preferencesDef={};var definitions,i;var platformPreferences=[{"name":"language","label":utils.gettext('Language'),"type":"select","initialEntries":[{value:'default',label:utils.gettext('Default setting')},{value:'browser',label:utils.gettext('Detect browser language')}]}];for(i=0;i<Wirecloud.constants.AVAILABLE_LANGUAGES.length;i+=1){platformPreferences[0].initialEntries.push(Wirecloud.constants.AVAILABLE_LANGUAGES[i]);}
definitions=this.processDefinitions(platformPreferences);this.preferencesDef.platform=[Wirecloud.PlatformPreferencesDef,definitions];definitions=this.processDefinitions(Wirecloud.constants.WORKSPACE_PREFERENCES);this.preferencesDef.workspace=[Wirecloud.WorkspacePreferencesDef,definitions];definitions=this.processDefinitions(Wirecloud.constants.TAB_PREFERENCES);this.preferencesDef.tab=[Wirecloud.TabPreferencesDef,definitions];};PreferenceManager.prototype.processDefinitions=function processDefinitions(preferences){var i,preference_data,preferenceDef,definitions={};for(i=0;i<preferences.length;i++){preference_data=preferences[i];preferenceDef=new Wirecloud.PreferenceDef(preference_data.name,preference_data.inheritable,preference_data.inheritByDefault,preference_data.hidden,preference_data);definitions[preference_data.name]=preferenceDef;}
return definitions;};PreferenceManager.prototype.buildPreferences=function buildPreferences(scope,values){var args=Array.prototype.slice.call(arguments,1);if(!(scope in this.preferencesDef)){throw new TypeError();}
var manager=new(this.preferencesDef[scope][0])(this.preferencesDef[scope][1],args);return manager.buildPreferences.apply(manager,args);};Wirecloud.PreferenceManager=new PreferenceManager();})(Wirecloud.Utils);;(function(utils){"use strict";var WorkspacePreferences=function WorkspacePreferences(definitions,workspace,values){Wirecloud.Preferences.call(this,definitions,values);this._workspace=workspace;Wirecloud.preferences.addEventListener('pre-commit',this._handleParentChanges);};WorkspacePreferences.prototype=new Wirecloud.Preferences();WorkspacePreferences.prototype.buildTitle=function buildTitle(){return utils.gettext("Settings");};WorkspacePreferences.prototype.getParentValue=function getParentValue(name){return Wirecloud.preferences.get(name);};WorkspacePreferences.prototype._build_save_url=function _build_save_url(){return Wirecloud.URLs.WORKSPACE_PREFERENCES.evaluate({workspace_id:this._workspace.id});};WorkspacePreferences.prototype.destroy=function destroy(){Wirecloud.preferences.removeEventListener('pre-commit',this._handleParentChanges);Wirecloud.Preferences.prototype.destroy.call(this);this._workspace=null;};Wirecloud.WorkspacePreferences=WorkspacePreferences;})(Wirecloud.Utils);;(function(ns,utils){"use strict";var TabPreferences=function TabPreferences(definitions,tab,values){Wirecloud.Preferences.call(this,definitions,values);Object.defineProperties(this,{tab:{value:tab}});this.tab.workspace.preferences.addEventListener('pre-commit',this._handleParentChanges);};TabPreferences.prototype=new Wirecloud.Preferences();TabPreferences.prototype.buildTitle=function buildTitle(){return utils.gettext("Settings");};TabPreferences.prototype.getParentValue=function getParentValue(name){return this.tab.workspace.preferences.get(name);};TabPreferences.prototype._build_save_url=function _build_save_url(modifiedValues){return Wirecloud.URLs.TAB_PREFERENCES.evaluate({workspace_id:this.tab.workspace.id,tab_id:this.tab.id});};TabPreferences.prototype.destroy=function destroy(){this.tab.workspace.preferences.removeEventListener('pre-commit',this._handleParentChanges);Wirecloud.Preferences.prototype.destroy.call(this);};Wirecloud.TabPreferences=TabPreferences;})(Wirecloud,Wirecloud.Utils);;(function(){"use strict";var PropertyCommiter=function PropertyCommiter(component){Object.defineProperty(this,'component',{value:component});this.values={};this.pending_values=null;this.timeout=null;};PropertyCommiter.prototype.add=function add(name,value){if(this.pending_values==null){this.values[name]=value;if(this.timeout!=null){clearTimeout(this.timeout);}
this.timeout=setTimeout(this.commit.bind(this),1000);}else{this.pending_values[name]=value;}};PropertyCommiter.prototype.commit=function commit(){if(this.timeout!=null){clearTimeout(this.timeout);}
if(Object.keys(this.values).length===0){return;}
this.timeout=null;this.pending_values={};if(this.component.meta.type==="widget"){commitWidgetProperties.call(this);}else{commitOperatorProperties.call(this);}};var commitWidgetProperties=function commitWidgetProperties(){var url=Wirecloud.URLs.IWIDGET_PROPERTIES.evaluate({workspace_id:this.component.tab.workspace.id,tab_id:this.component.tab.id,iwidget_id:this.component.id});Wirecloud.io.makeRequest(url,{contentType:'application/json',postBody:JSON.stringify(this.values),onSuccess:function(){this.values=this.pending_values;if(Object.keys(this.values).length>0){this.timeout=setTimeout(this.commit.bind(this),1000);}
this.pending_values=null;}.bind(this),onFailure:function(){this.values=Wirecloud.Utils.merge(this.values,this.pending_values);this.timeout=setTimeout(this.commit.bind(this),30000);}.bind(this)});}
var commitOperatorProperties=function commitOperatorProperties(){var url=(Wirecloud.URLs.WIRING_ENTRY.evaluate({workspace_id:this.component.wiring.workspace.id,}));var requestBody=[];for(var key in this.values){var property=this.values[key];requestBody.push({op:"replace",path:"/operators/"+this.component.id+"/properties/"+key+"/value",value:property});}
Wirecloud.io.makeRequest(url,{method:'PATCH',contentType:'application/json-patch+json',postBody:JSON.stringify(requestBody),onSuccess:function(){this.values=this.pending_values;if(Object.keys(this.values).length>0){this.timeout=setTimeout(this.commit.bind(this),1000);}
this.pending_values=null;}.bind(this),onFailure:function(){this.values=Wirecloud.Utils.merge(this.values,this.pending_values);this.timeout=setTimeout(this.commit.bind(this),30000);}.bind(this)});}
Wirecloud.PropertyCommiter=PropertyCommiter;})();;(function(se,utils){"use strict";var LogManager=function LogManager(parent){var entries=[];var priv={closed:false,entries:entries,errorcount:0,previouscycles:[],parent:null};se.ObjectWithEvents.call(this,["newentry"]);privates.set(this,priv);Object.defineProperties(this,{closed:{get:function(){return priv.closed;}},entries:{get:function(){return priv.entries.slice(0);}},errorCount:{get:function(){return priv.errorcount;}},previouscycles:{get:function(){return priv.previouscycles;}},parent:{get:function(){return priv.parent;}},totalCount:{get:function(){return priv.entries.length;}}});setParent.call(this,parent);};utils.inherit(LogManager,se.ObjectWithEvents,{close:function close(){privates.get(this).closed=true;return this;},formatException:function formatException(exception){var builder=new StyledElements.GUIBuilder();return builder.parse(Wirecloud.currentTheme.templates['wirecloud/logs/details'],{message:exception.toString(),stacktrace:exception.stack});},log:function log(message,options){var entry;if(this.closed){throw new Error("Trying to log a message in a closed LogManager");}
if(typeof options==="number"){options={level:options};}
options=utils.merge({console:true,level:Wirecloud.constants.LOGGING.ERROR_MSG},options);if(typeof options.level!=="number"||options.level<0||options.level>4){throw new TypeError("Invalid level value");}
entry=Object.freeze({date:new Date(),details:options.details,level:options.level,logManager:this,msg:message});appendEntry.call(this,entry);if(window.console&&options.console){printEntry.call(this,entry);}
return this;},newCycle:function newCycle(){var priv=privates.get(this);if(priv.closed){throw new Error("Trying to create a new cycle in a closed LogManager");}
Object.freeze(priv.entries);priv.previouscycles.unshift(priv.entries);priv.entries=[];priv.errorcount=0;return this;},parseErrorResponse:function parseErrorResponse(response){var errorDesc,msg;try{var errorInfo=JSON.parse(response.responseText);if(!("description"in errorInfo)){throw new Error();}
msg=errorInfo.description;}catch(error){msg=utils.gettext("HTTP Error %(errorCode)s - %(errorDesc)s");if(response.status!==0&&response.statusText!==''){errorDesc=response.statusText;}else{errorDesc=Wirecloud.constants.HTTP_STATUS_DESCRIPTIONS[response.status];if(errorDesc==null){errorDesc=Wirecloud.constants.UNKNOWN_STATUS_CODE_DESCRIPTION;}}
msg=utils.interpolate(msg,{errorCode:response.status,errorDesc:errorDesc},true);}
return msg;},reset:function reset(){var priv=privates.get(this);if(priv.closed){throw new Error("Closed LogManagers cannot be reset");}
priv.entries.length=0;priv.errorcount=0;priv.previouscycles=[];return this;}});var privates=new WeakMap();var appendEntry=function appendEntry(entry){var priv=privates.get(this);if(entry.level===Wirecloud.constants.LOGGING.ERROR_MSG){priv.errorcount+=1;}
priv.entries.unshift(entry);this.dispatchEvent('newentry',entry);if(priv.parent){appendEntry.call(priv.parent,entry);}};var printEntry=function printEntry(entry){switch(entry.level){case Wirecloud.constants.LOGGING.ERROR_MSG:console.error(entry.msg);break;case Wirecloud.constants.LOGGING.WARN_MSG:console.warn(entry.msg);break;case Wirecloud.constants.LOGGING.DEBUG_MSG:case Wirecloud.constants.LOGGING.INFO_MSG:console.info(entry.msg);break;}};var setParent=function setParent(parent){var priv=privates.get(this);if(parent instanceof LogManager){if(parent.closed){throw new Error();}
priv.parent=parent;}};Wirecloud.LogManager=LogManager;Wirecloud.GlobalLogManager=new LogManager();})(StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.Widget=function Widget(tab,meta,data){se.ObjectWithEvents.call(this,['change','load','remove','unload']);if(data==null){throw new TypeError("invalid data parameter");}
data=utils.merge({title:meta.title,preferences:{},properties:{}},data);this.pending_events=[];this.prefCallback=null;this.permissions=Wirecloud.Utils.merge({close:true,configure:true,move:true,rename:true,resize:true,minimize:true,upgrade:true},data.permissions);if(data.readonly){this.permissions.close=false;this.permissions.upgrade=false;}
privates.set(this,{position:{x:data.left,y:data.top,z:data.zIndex},meta:meta,shape:{width:data.width,height:data.height},status:STATUS.CREATED,tab:tab,on_preremovetab:on_preremovetab.bind(this)});Object.defineProperties(this,{codeurl:{get:function(){var url=this.meta.codeurl+"#id="+encodeURIComponent(this.id);if('workspaceview'in this.tab.workspace.view){url+="&workspaceview="+encodeURIComponent(this.tab.workspace.view.workspaceview);}
return url;}},id:{value:data.id},loaded:{get:function(){return privates.get(this).status===STATUS.RUNNING;}},logManager:{value:new Wirecloud.LogManager(Wirecloud.GlobalLogManager)},meta:{get:function(){return privates.get(this).meta;}},missing:{get:function(){return this.meta.missing;}},tab:{get:function(){return privates.get(this).tab;}},title:{get:function(){return this.contextManager.get('title');}},volatile:{value:!!data.volatile}});this.wrapperElement=document.createElement('iframe');this.wrapperElement.className="wc-widget-content";this.wrapperElement.setAttribute('frameBorder',"0");this.wrapperElement.addEventListener('load',on_load.bind(this),true);this.meta.requirements.some(function(requirement){if(requirement.type==='feature'&&requirement.name==='FullscreenWidget'){this.wrapperElement.setAttribute('allowfullscreen','true');return true;}},this);build_endpoints.call(this);build_prefs.call(this,data.preferences);build_props.call(this,data.properties);Object.defineProperties(this,{layout:{writable:true,value:data.layout},minimized:{writable:true,value:data.minimized},position:{get:function(){return utils.clone(privates.get(this).position);}},shape:{get:function(){return utils.clone(privates.get(this).shape);}}});this.callbacks={'iwidget':[],'mashup':[],'platform':[]};this.contextManager=new Wirecloud.ContextManager(this,{'title':{label:utils.gettext("Title"),description:utils.gettext("Widget's title"),value:data.title},'xPosition':{label:utils.gettext("X-Position"),description:utils.gettext("Specifies the x-coordinate at which the widget is placed"),value:data.left},'yPosition':{label:utils.gettext("Y-Position"),description:utils.gettext("Specifies the y-coordinate at which the widget is placed"),value:data.top},'zPosition':{label:utils.gettext("Z-Position"),description:utils.gettext("Specifies the z-coordinate at which the widget is placed"),value:data.zIndex},'height':{label:utils.gettext("Height"),description:utils.gettext("Widget's height in layout cells"),value:data.height},'width':{label:utils.gettext("Width"),description:utils.gettext("Widget's width in layout cells"),value:data.width},'heightInPixels':{label:utils.gettext("Height in pixels (deprecated)"),description:utils.gettext("Widget's height in pixels"),value:0},'widthInPixels':{label:utils.gettext("Width in pixels"),description:utils.gettext("Widget's width in pixels"),value:0}});this.tab.addEventListener('preremove',privates.get(this).on_preremovetab);this.logManager.log(utils.gettext("Widget created successfully."),Wirecloud.constants.LOGGING.DEBUG_MSG);};utils.inherit(ns.Widget,se.ObjectWithEvents,{changeTab:function changeTab(tab){var priv=privates.get(this);if(priv.tab===tab){return Promise.resolve(this);}else{var url=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.tab.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});var content={tab:tab.id};return Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(content)}).then((response)=>{if(response.status===204){priv.tab=tab;this.dispatchEvent('change',['tab']);return Promise.resolve(this);}else{return Promise.reject(new Error("Unexpected response from server"));}});}},fullDisconnect:function fullDisconnect(){var name;for(name in this.inputs){this.inputs[name].fullDisconnect();}
for(name in this.outputs){this.outputs[name].fullDisconnect();}
return this;},hasEndpoints:function hasEndpoints(){return this.meta.hasEndpoints();},hasPreferences:function hasPreferences(){return this.meta.hasPreferences();},is:function is(component){return this.meta.type===component.meta.type&&this.id===component.id;},isAllowed:function isAllowed(name){if(!(name in this.permissions)){throw new TypeError("invalid name parameter");}
if(!this.volatile){switch(name){case"close":return this.permissions.close&&this.tab.workspace.isAllowed('add_remove_iwidgets');case"move":case"resize":case"minimize":return this.permissions[name]&&this.tab.workspace.isAllowed('edit_layout');default:return!this.tab.workspace.restricted&&this.permissions[name];}}else{return this.permissions[name];}},load:function load(){if(privates.get(this).status!==STATUS.CREATED){return this;}
privates.get(this).status=STATUS.LOADING;this.wrapperElement.contentWindow.location.replace(this.codeurl);this.wrapperElement.setAttribute('type',this.meta.codecontenttype);return this;},reload:function reload(){this.wrapperElement.setAttribute('type',this.meta.codecontenttype);this.wrapperElement.contentWindow.location.reload();return this;},registerContextAPICallback:function registerContextAPICallback(scope,callback){switch(scope){case'iwidget':this.contextManager.addCallback(callback);break;case'mashup':this.tab.workspace.contextManager.addCallback(callback);break;case'platform':Wirecloud.contextManager.addCallback(callback);break;default:throw new TypeError('invalid scope parameter');}
this.callbacks[scope].push(callback);},registerPrefCallback:function registerPrefCallback(callback){this.prefCallback=callback;return this;},remove:function remove(){if(this.volatile){_remove.call(this);return Promise.resolve(this);}else{var url=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.tab.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});return Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'}}).then((response)=>{if(response.status===204){_remove.call(this);return Promise.resolve(this);}else{return Promise.reject(new Error("Unexpected response from server"));}});}},rename:function rename(title){title=clean_title.call(this,title);if(this.volatile){_rename.call(this,title);return Promise.resolve(this);}else{var url=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.tab.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});var payload={title:title};return Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(payload)}).then((response)=>{if(response.status===204){_rename.call(this,title);return Promise.resolve(this);}else{return Promise.reject(new Error("Unexpected response from server"));}});}},setPosition:function setPosition(position){utils.update(privates.get(this).position,position);return this;},setShape:function setShape(shape){utils.update(privates.get(this).shape,shape);return this;},showLogs:function showLogs(){var dialog=new Wirecloud.ui.LogWindowMenu(this.logManager);dialog.htmlElement.classList.add("wc-component-logs-modal");dialog.show();return this;},showSettings:function showSettings(){var dialog=new Wirecloud.Widget.PreferencesWindowMenu();dialog.show(this);return this;},upgrade:function upgrade(meta){if(!is_valid_meta.call(this,meta)){throw new TypeError("invalid meta parameter");}
if(this.meta.uri===meta.uri){return change_meta.call(this,meta);}else{var url=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.tab.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});var payload={widget:meta.uri};return Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(payload)}).then((response)=>{var message;if(response.status===204){var cmp=meta.version.compareTo(privates.get(this).meta.version);if(cmp>0){message=utils.gettext("The %(type)s was upgraded to v%(version)s successfully.");}else if(cmp<0){message=utils.gettext("The %(type)s was downgraded to v%(version)s successfully.");}else{message=utils.gettext("The %(type)s was replaced using v%(version)s successfully.");}
message=utils.interpolate(message,{type:this.meta.type,version:meta.version.text});return change_meta.call(this,meta).then(()=>{this.logManager.log(message,Wirecloud.constants.LOGGING.INFO_MSG);});}else{return Promise.reject(new Error("Unexpected response from server"));}});}}});var privates=new WeakMap();var STATUS={CREATED:0,LOADING:1,RUNNING:2};var build_endpoints=function build_endpoints(){this.inputs={};this.meta.inputList.forEach(function(endpoint){this.inputs[endpoint.name]=new Wirecloud.wiring.WidgetTargetEndpoint(this,endpoint);},this);this.outputs={};this.meta.outputList.forEach(function(endpoint){this.outputs[endpoint.name]=new Wirecloud.wiring.WidgetSourceEndpoint(this,endpoint);},this);};var build_prefs=function build_prefs(initial_values){this.preferenceList=[];this.preferences={};this.meta.preferenceList.forEach((preference)=>{if(preference.name in initial_values){var pref_data=initial_values[preference.name];this.preferences[preference.name]=new Wirecloud.UserPref(preference,pref_data.readonly,pref_data.hidden,pref_data.value);}else{this.preferences[preference.name]=new Wirecloud.UserPref(preference,false,false,preference.default);}
this.preferenceList.push(this.preferences[preference.name]);});};var build_props=function build_props(initial_values){this.propertyList=[];this.properties={};this.propertyCommiter=new Wirecloud.PropertyCommiter(this);this.meta.propertyList.forEach((property)=>{if(property.name in initial_values){var prop_data=initial_values[property.name];this.properties[property.name]=new Wirecloud.PersistentVariable(property,this.propertyCommiter,prop_data.readonly,prop_data.value);}else{this.properties[property.name]=new Wirecloud.PersistentVariable(property,this.propertyCommiter,false,property.default);}
this.propertyList.push(this.properties[property.name]);});}
var _remove=function _remove(){this.fullDisconnect();if(this.loaded){on_unload.call(this);}
this.dispatchEvent('remove');};var change_meta=function change_meta(meta){var sync_values;var old_value=privates.get(this).meta;privates.get(this).meta=meta;if(!meta.missing){var process_response=(response)=>{if(response.status!==200){return Promise.reject(new Error("Unexpected response from server"));}
try{return JSON.parse(response.responseText);}catch(e){return Promise.reject("Unexpected response from server");}};sync_values=Promise.all([Wirecloud.io.makeRequest(Wirecloud.URLs.IWIDGET_PREFERENCES.evaluate({workspace_id:this.tab.workspace.id,tab_id:this.tab.id,iwidget_id:this.id}),{method:'GET',requestHeaders:{'Accept':'application/json'},}).then(process_response),Wirecloud.io.makeRequest(Wirecloud.URLs.IWIDGET_PROPERTIES.evaluate({workspace_id:this.tab.workspace.id,tab_id:this.tab.id,iwidget_id:this.id}),{method:'GET',requestHeaders:{'Accept':'application/json'},}).then(process_response)]);}else{sync_values=Promise.resolve([{},{}]);}
return sync_values.then((values)=>{build_endpoints.call(this);build_prefs.call(this,values[0]);build_props.call(this,values[1]);if(this.loaded){on_unload.call(this);this.load();}
this.dispatchEvent('change',['meta'],{meta:old_value});;});};var _rename=function _rename(title){this.contextManager.modify({title:title});this.dispatchEvent('change',['title']);};var clean_title=function clean_title(title){if(typeof title!=='string'||!title.trim().length){throw new TypeError("invalid title parameter");}
return title.trim();};var is_valid_meta=function is_valid_meta(meta){return meta instanceof Wirecloud.WidgetMeta&&meta.group_id===this.meta.group_id;};var remove_context_callbacks=function remove_context_callbacks(){var i;for(i=0;i<this.callbacks.iwidget.length;i+=1){this.contextManager.removeCallback(this.callbacks.iwidget[i]);}
for(i=0;i<this.callbacks.mashup.length;i+=1){this.tab.workspace.contextManager.removeCallback(this.callbacks.mashup[i]);}
for(i=0;i<this.callbacks.platform.length;i+=1){Wirecloud.contextManager.removeCallback(this.callbacks.platform[i]);}
this.callbacks={'iwidget':[],'mashup':[],'platform':[]};};var send_pending_event=function send_pending_event(pendingEvent){this.inputs[pendingEvent.endpoint].propagate(pendingEvent.value);};var on_preremovetab=function on_preremovetab(tab){_remove.call(this);tab.removeEventListener('preremove',privates.get(this).on_preremovetab);};var on_load=function on_load(){if(this.wrapperElement.contentWindow.location.href!==this.codeurl) {return;}
privates.get(this).status=STATUS.RUNNING;this.wrapperElement.contentDocument.defaultView.addEventListener('unload',on_unload.bind(this),true);if(this.missing){this.logManager.log(utils.gettext("Failed to load widget."),{level:Wirecloud.constants.LOGGING.ERROR_MSG,details:new se.Fragment(utils.gettext("<p>This widget is currently not available. You or an administrator probably uninstalled it.</p><h5>Suggestions:</h5><ul><li>Remove this widget from the dashboard</li><li>Reinstall the appropiated version of the widget</li><li>Or install another version of the widget and then use the <em>Upgrade/Downgrade</em> option</li></ul>"))});}else{this.logManager.log(utils.gettext("Widget loaded successfully."),{level:Wirecloud.constants.LOGGING.INFO_MSG});}
this.dispatchEvent('load');this.pending_events.forEach(send_pending_event,this);this.pending_events=[];};var on_unload=function on_unload(){if(!this.loaded){return;}
privates.get(this).status=STATUS.CREATED;this.prefCallback=null;remove_context_callbacks.call(this);this.propertyCommiter.commit();for(var name in this.inputs){this.inputs[name].callback=null;}
this.logManager.log(utils.gettext("Widget unloaded successfully."),{level:Wirecloud.constants.LOGGING.INFO_MSG});this.logManager.newCycle();this.dispatchEvent('unload');};})(Wirecloud,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.wiring={};ns.Wiring=function Wiring(workspace,data){se.ObjectWithEvents.call(this,['createoperator','load','removeoperator']);privates.set(this,{fixederrors:0,freezedOperatorsById:null,operatorId:1,operators:[],operatorsById:{},connections:[],on_changecomponent:on_changecomponent.bind(this),on_createwidget:on_createwidget.bind(this),on_removeconnection:on_removeconnection.bind(this),on_removeoperator:on_removeoperator.bind(this),on_removewidget:on_removewidget.bind(this)});Object.defineProperties(this,{connections:{get:on_connections_get},errorCount:{get:on_error_count_get},logManager:{value:new Wirecloud.LogManager(Wirecloud.GlobalLogManager)},operators:{get:on_operators_get},operatorsById:{get:on_operators_by_id_get},status:{get:on_status_get},visualdescription:{get:on_visualdescription_get},workspace:{value:workspace}});this.workspace.widgets.forEach(function(widget){on_createwidget.call(this,this.workspace,widget);},this);this.workspace.addEventListener('createwidget',privates.get(this).on_createwidget);this.load(unmarshall.call(this,utils.clone(data)));};ns.Wiring.normalize=function normalize(status){var new_status=utils.update({version:'2.0',connections:[],operators:{},visualdescription:{behaviours:[],components:{operator:{},widget:{}},connections:[]}},status);normalize_object(new_status.visualdescription.components.operator,normalize_visual_component);normalize_object(new_status.visualdescription.components.widget,normalize_visual_component);return new_status;};utils.inherit(ns.Wiring,se.ObjectWithEvents,{_notifyOperatorInstall:function _notifyOperatorInstall(resource){privates.get(this).operators.forEach(function(operator){if(operator.missing&&operator.meta.uri===resource.uri){operator.upgrade(resource);}});},createConnection:function createConnection(source,target,options){options=utils.merge({commit:false},options);var connection=new Wirecloud.wiring.Connection(this,source,target,options);if(options.commit){connection.addEventListener('remove',privates.get(this).on_removeconnection);connection.establish();privates.get(this).connections.push(connection);}
return connection;},createOperator:function createOperator(meta,data){var priv=privates.get(this);data=utils.merge({id:(priv.operatorId).toString(),volatile:false},data);var operator=create_operator.call(this,meta,data);if(data.volatile){return append_operator.call(this,operator);}
var requestContent=[{op:"add",path:"/operators/"+operator.id,value:operator}];return Wirecloud.io.makeRequest(Wirecloud.URLs.WIRING_ENTRY.evaluate({workspace_id:this.workspace.id,}),{method:'PATCH',contentType:'application/json-patch+json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(requestContent)}).then((response)=>{if([204,401,403,404,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,404,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
append_operator.call(this,operator);return Promise.resolve(operator);});},findOperator:function findOperator(id){if(id==null){throw new TypeError("Missing id parameter");}
id=String(id);return this.operatorsById[id]||null;},load:function load(status){var connection,i,id,operator,priv;status=ns.Wiring.normalize(status);priv=privates.get(this);priv.connections.forEach(function(connection){if(!connection.volatile){connection.detach();}});for(i=priv.operators.length-1;i>=0;i--){operator=priv.operators[i];if(!operator.volatile&&!(operator.id in status.operators)){operator.remove();on_removeoperator.call(this,operator);}}
for(i=priv.connections.length-1;i>=0;i--){connection=priv.connections[i];if(!connection.volatile){connection.removeEventListener('remove',priv.on_removeconnection);priv.connections.splice(i,1);}}
this.logManager.newCycle();priv.fixederrors=0;for(id in status.operators){operator=status.operators[id];if(priv.operatorsById[id]==null){append_operator.call(this,operator);}else if(operator.missing){this.logManager.log(utils.gettext("Failed to load operator."));}}
this.workspace.widgets.forEach(function(widget){if(widget.loaded&&widget.missing){this.logManager.log(utils.gettext("Failed to load widget."));}},this);priv.operatorId=1;priv.operators.forEach(function(operator){if(Number(operator.id)>=priv.operatorId){priv.operatorId=Number(operator.id)+1;}},this);status.connections.forEach(function(connection){connection.addEventListener('remove',priv.on_removeconnection);priv.connections.push(connection);},this);priv.connections.forEach(function(connection){connection.establish();});priv.visualdescription=status.visualdescription;return this.dispatchEvent('load');},save:function save(){var url=Wirecloud.URLs.WIRING_ENTRY.evaluate({workspace_id:this.workspace.id});return Wirecloud.io.makeRequest(url,{method:'PUT',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(this)}).then(function(response){if(response.status===204){return Promise.resolve();}else{return Promise.reject(new Error("Unexpected error response"));}});},toJSON:function toJSON(){var operators={},id,priv;priv=privates.get(this);for(id in priv.operatorsById){if(!priv.operatorsById[id].volatile){operators[id]=priv.operatorsById[id];}}
return{version:'2.0',connections:priv.connections.filter(function(connection){return!connection.volatile;}),operators:operators,visualdescription:priv.visualdescription};}});var privates=new WeakMap();var on_status_get=function on_status_get(){var priv=privates.get(this);return{version:'2.0',connections:priv.connections.slice(0),operators:this.operatorsById,visualdescription:this.visualdescription};};var on_visualdescription_get=function on_visualdescription_get(){return utils.clone(privates.get(this).visualdescription,true);};var unmarshall=function unmarshall(status){var connection_info,i,id,operator_info,meta,source,target;status=ns.Wiring.normalize(status);for(id in status.operators){operator_info=status.operators[id];meta=this.workspace.resources.getOrCreateMissing(operator_info.name,'operator');operator_info.id=id;status.operators[id]=new Wirecloud.wiring.Operator(this,meta,operator_info);}
for(i=status.connections.length-1;i>=0;i--){connection_info=utils.merge({},Wirecloud.wiring.Connection.JSON_TEMPLATE,status.connections[i]);source=getEndpoint.call(this,'outputs',connection_info.source,status);target=getEndpoint.call(this,'inputs',connection_info.target,status);if(source!=null&&target!=null){status.connections[i]=new Wirecloud.wiring.Connection(this,source,target,{readonly:connection_info.readonly});status.connections[i]=status.connections[i];}else{status.connections.splice(i,1);}}
return status;};var normalize_visual_component=function normalize_visual_component(component){return utils.updateObject({name:"",position:{x:0,y:0},collapsed:false,endpoints:{source:[],target:[]}},component);};var normalize_object=function normalize_object(object,normalizer){for(var key in object){object[key]=normalizer(object[key]);}};var addMissingEndpoint=function addMissingEndpoint(component,endpointGroup,name){var endpoint;switch(endpointGroup){case'inputs':endpoint=new ns.wiring.GhostTargetEndpoint(component,name);component.inputs[name]=endpoint;break;case'outputs':endpoint=new ns.wiring.GhostSourceEndpoint(component,name);component.outputs[name]=endpoint;break;}
return endpoint;};var getEndpointOrCreateMissing=function getEndpointOrCreateMissing(component,type,name){if(name in component[type]){return component[type][name];}else{return addMissingEndpoint(component,type,name);}};var getEndpoint=function getEndpoint(endpointGroup,endpointInfo,status){var component;switch(endpointInfo.type){case'widget':component=this.workspace.findWidget(endpointInfo.id);break;case'operator':component=status.operators[endpointInfo.id];break;}
if(component==null){return null;}
return getEndpointOrCreateMissing(component,endpointGroup,endpointInfo.endpoint);};var getEndpointInfo=function getEndpointInfo(endpointName){var splitText=endpointName.split("/");return{type:splitText[0],id:splitText[1],endpoint:splitText[2]};};var connection_hasComponent=function connection_hasComponent(connectionInfo,component){var source=getEndpointInfo(connectionInfo.sourcename),target=getEndpointInfo(connectionInfo.targetname);if(source.type===component.meta.type&&source.id===component.id){return true;}
if(target.type===component.meta.type&&target.id===component.id){return true;}
return false;};var on_connections_get=function on_connections_get(){return privates.get(this).connections.slice(0);};var on_error_count_get=function on_error_count_get(){var priv=privates.get(this);return this.logManager.errorCount-priv.fixederrors;};var on_operators_get=function on_operators_get(){return privates.get(this).operators.slice(0);};var on_operators_by_id_get=function on_operators_by_id_get(){var priv=privates.get(this);if(priv.freezedOperatorsById==null){priv.freezedOperatorsById=Object.freeze(utils.clone(priv.operatorsById));}
return priv.freezedOperatorsById;};var removeComponent=function removeComponent(component){var connection,i,priv;priv=privates.get(this);for(i=priv.connections.length-1;i>=0;i--){connection=priv.connections[i];if(connection.source.component===component||connection.target.component===component){connection.detach();priv.connections.splice(i,1);}}
removeComponentInfo(component,priv.visualdescription);for(i=priv.visualdescription.behaviours.length-1;i>=0;i--){removeComponentInfo(component,priv.visualdescription.behaviours[i]);}
return this;};var removeComponentInfo=function removeComponentInfo(component,status){var i;for(i=status.connections.length-1;i>=0;i--){if(connection_hasComponent(status.connections[i],component)){status.connections.splice(i,1);}}
delete status.components[component.meta.type][component.id];};var append_operator=function append_operator(operator){var priv=privates.get(this);priv.operatorsById[operator.id]=operator;priv.operators.push(operator);priv.freezedOperatorsById=null;operator.addEventListener('change',priv.on_changecomponent);operator.addEventListener('remove',priv.on_removeoperator);this.dispatchEvent('createoperator',operator.load());return operator;};var create_operator=function create_operator(meta,data){var operator,priv;priv=privates.get(this);operator=new Wirecloud.wiring.Operator(this,meta,data);if(Number(operator.id)>=priv.operatorId){priv.operatorId=Number(operator.id)+1;}
return operator;};var on_changecomponent=function on_changecomponent(component,changes,old_values){if(changes.indexOf('meta')!==-1){component.fullDisconnect();var priv=privates.get(this);priv.connections.forEach((connection)=>{if(connection.source.component.is(component)){connection.updateEndpoint(getEndpointOrCreateMissing(component,'outputs',connection.source.name));if(old_values.meta.missing&&!connection.missing){priv.fixederrors+=1;}}else if(connection.target.component.is(component)){connection.updateEndpoint(getEndpointOrCreateMissing(component,'inputs',connection.target.name));if(old_values.meta.missing&&!connection.missing){priv.fixederrors+=1;}}});if(old_values.meta.missing){priv.fixederrors+=1;}}};var on_createwidget=function on_createwidget(workspace,widget){var priv=privates.get(this);widget.addEventListener('change',priv.on_changecomponent);widget.addEventListener('remove',priv.on_removewidget);};var on_removeconnection=function on_removeconnection(connection){var priv=privates.get(this);connection.removeEventListener('remove',priv.on_removeconnection);priv.connections.splice(priv.connections.indexOf(connection),1);};var on_removeoperator=function on_removeoperator(operator){var priv=privates.get(this);if(!(operator.id in priv.operatorsById)){return;}
priv.operators.splice(priv.operators.indexOf(operator),1);delete priv.operatorsById[operator.id];priv.freezedOperatorsById=null;removeComponent.call(this,operator);operator.removeEventListener('change',priv.on_changecomponent);operator.removeEventListener('remove',priv.on_removeoperator);this.dispatchEvent('removeoperator',operator);};var on_removewidget=function on_removewidget(widget){var priv=privates.get(this);removeComponent.call(this,widget);widget.removeEventListener('change',priv.on_changecomponent);widget.removeEventListener('remove',priv.on_removewidget);if(widget.missing){priv.fixederrors+=1;}};})(Wirecloud,StyledElements,StyledElements.Utils);;(function(utils){"use strict";var MACField,onclick,onfocus,onblur;onclick=function onclick(e){if('target'in e&&e.target===this.wrapperElement){e.stopPropagation();e.preventDefault();}
var dialog=new Wirecloud.ui.MACSelectionWindowMenu(this.dialog_title,{scope:this.scope,});dialog.show(this.parent_dialog);dialog.addEventListener('select',function(menu,selected_mashup){this.setValue(selected_mashup);}.bind(this));};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.dispatchEvent('focus');};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.dispatchEvent('blur');};MACField=function MACField(options){var defaultOptions={'class':'','scope':'','dialog':null};options=Wirecloud.Utils.merge(defaultOptions,options);StyledElements.InputElement.call(this,options.initialValue,['change','focus','blur']);this.wrapperElement=document.createElement('div');this.wrapperElement.className='se-mac-field se-input-group';if(options.class!==""){this.wrapperElement.className+=" "+options.class;}
this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","hidden");if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
var close_button=new StyledElements.Button({iconClass:'fa fa-remove',title:utils.gettext('Clear current selection')});close_button.appendTo(this.wrapperElement);close_button.disable().addEventListener('click',function(){this.setValue('');}.bind(this));this.name_preview=document.createElement('div');this.name_preview.className='se-add-on';this.wrapperElement.appendChild(this.name_preview);this.wrapperElement.appendChild(this.inputElement);var button=new StyledElements.Button({iconClass:'fa fa-search',title:utils.gettext('Search')});button.appendTo(this.wrapperElement);Object.defineProperties(this,{'close_button':{value:close_button},'scope':{value:options.scope},'parent_dialog':{value:options.parent_dialog},'dialog_title':{value:options.dialog_title}});this.wrapperElement.addEventListener('click',onclick.bind(this),false);button.addEventListener('click',onclick.bind(this),true);close_button.addEventListener('focus',onfocus.bind(this));close_button.addEventListener('blur',onblur.bind(this));button.addEventListener('focus',onfocus.bind(this));button.addEventListener('blur',onblur.bind(this));};MACField.prototype=new StyledElements.InputElement();MACField.prototype.insertInto=function insertInto(element,refElement){StyledElements.InputElement.prototype.insertInto.call(this,element,refElement);this.repaint();};MACField.prototype.setValue=function setValue(new_value){var mac_id,mac_title;if(typeof new_value!=='string'){mac_id=new_value.uri;mac_title=new_value.title;}else{mac_id=new_value;mac_title=new_value;}
this.inputElement.value=mac_id;this.name_preview.textContent=mac_title;this.close_button.setDisabled(new_value==='');this.dispatchEvent('change');};MACField.prototype.getValue=function getValue(){return this.inputElement.value;};Wirecloud.ui.MACField=MACField;var MACInputInterface=function MACInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new Wirecloud.ui.MACField(options);};MACInputInterface.prototype=new StyledElements.InputInterface();Wirecloud.ui.MACInputInterface=MACInputInterface;})(Wirecloud.Utils);;(function(){"use strict";var InputInterfaceFactory=new StyledElements.InputInterfaceFactory();InputInterfaceFactory.addFieldType('layout',Wirecloud.ui.LayoutInputInterface);InputInterfaceFactory.addFieldType('parametrizableValue',Wirecloud.ui.ParametrizableValueInputInterface);InputInterfaceFactory.addFieldType('parametrizedText',Wirecloud.ui.ParametrizedTextInputInterface);InputInterfaceFactory.addFieldType('mac',Wirecloud.ui.MACInputInterface);Wirecloud.ui.InputInterfaceFactory=InputInterfaceFactory;})();;(function(){"use strict";var returnTrue=function returnTrue(){return true;};var ResizeHandle=function ResizeHandle(resizableElement,handleElement,data,onStart,onResize,onFinish,canBeResized){var xDelta=0,yDelta=0;var xStart=0,yStart=0;var scrollDelta,scrollStart=0;var dragboardCover;var x,y;var endresize,resize,startresize,scroll;canBeResized=canBeResized?canBeResized:returnTrue;endresize=function endresize(e){if(e.type==='mouseup'&&e.button!==0){return;}else if(e.type==='touchend'&&e.touches.length>0){return;}
document.removeEventListener("mouseup",endresize,false);document.removeEventListener("touchend",endresize,false);document.removeEventListener("mousemove",resize,false);document.removeEventListener("touchmove",resize,false);dragboardCover.parentNode.removeEventListener("scroll",scroll,true);dragboardCover.parentNode.removeChild(dragboardCover);dragboardCover=null;handleElement.removeEventListener("mouseup",endresize,false);handleElement.removeEventListener("touchend",endresize,false);handleElement.removeEventListener("mousemove",resize,false);handleElement.removeEventListener("touchmove",resize,false);onFinish(resizableElement,handleElement,data);handleElement.addEventListener("mousedown",startresize,false);handleElement.addEventListener("touchstart",startresize,false);document.removeEventListener('mousedown',Wirecloud.Utils.preventDefaultListener,false);document.removeEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener,false);};resize=function resize(e){var clientX,clientY;if('touches'in e){clientX=e.touches[0].clientX;clientY=e.touches[0].clientY;e.preventDefault();}else{clientX=e.clientX;clientY=e.clientY;}
xDelta=clientX-xStart;yDelta=clientY-yStart;onResize(resizableElement,handleElement,data,x+xDelta,y+yDelta-scrollDelta);};scroll=function scroll(){var dragboard=dragboardCover.parentNode;dragboardCover.style.height=dragboard.scrollHeight+"px";var scrollTop=parseInt(dragboard.scrollTop,10);scrollDelta=scrollStart-scrollTop;onResize(resizableElement,handleElement,data,x+xDelta,y+yDelta-scrollDelta);};startresize=function startresize(e){if(e.type==='mousedown'&&e.button!==0){return;}
if(!canBeResized(resizableElement,data)){return false;}
document.addEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener,false);document.addEventListener('mousedown',Wirecloud.Utils.preventDefaultListener,false);handleElement.removeEventListener("mousedown",startresize,false);handleElement.removeEventListener("touchstart",startresize,false);if('touches'in e){xStart=e.touches[0].clientX;yStart=e.touches[0].clientY;}else{xStart=e.clientX;yStart=e.clientY;}
x=resizableElement.offsetLeft+handleElement.offsetLeft+(handleElement.offsetWidth/2);y=resizableElement.offsetTop+handleElement.offsetTop+(handleElement.offsetHeight/2);document.addEventListener("mouseup",endresize,false);document.addEventListener("touchend",endresize,false);document.addEventListener("mousemove",resize,false);document.addEventListener("touchmove",resize,false);var dragboard=document.body;dragboardCover=document.createElement("div");dragboardCover.className="cover";dragboardCover.addEventListener("mouseup",endresize,true);dragboardCover.addEventListener("mousemove",resize,true);dragboardCover.style.zIndex="1000000";dragboardCover.style.position="absolute";dragboardCover.style.top="0";dragboardCover.style.left="0";dragboardCover.style.width="100%";dragboardCover.style.height=dragboard.scrollHeight+"px";scrollStart=dragboard.scrollTop;scrollDelta=0;dragboard.addEventListener("scroll",scroll,true);dragboard.insertBefore(dragboardCover,dragboard.firstChild);handleElement.addEventListener("mouseup",endresize,false);handleElement.addEventListener("touchend",endresize,false);handleElement.addEventListener("mousemove",resize,false);handleElement.addEventListener("touchmove",resize,false);onStart(resizableElement,handleElement,data);return false;};handleElement.addEventListener("mousedown",startresize,false);handleElement.addEventListener("touchstart",startresize,false);this.setResizableElement=function(element){resizableElement=element;};this.destroy=function(){handleElement.removeEventListener("mousedown",startresize,true);startresize=null;resize=null;scroll=null;endresize=null;data=null;handleElement=null;};};Wirecloud.ui.ResizeHandle=ResizeHandle;})();;(function(ns,se,utils){"use strict";ns.WidgetView=function WidgetView(tab,model,options){se.StyledElement.call(this,['highlight','remove','unhighlight']);options=utils.merge({template:Wirecloud.currentTheme.templates['wirecloud/workspace/widget']},options);privates.set(this,{layout:null,minimized:false,minimized_shape:null,position:model.position,shape:model.shape,tab:tab});Object.defineProperties(this,{id:{value:model.id},layout:{get:function(){return privates.get(this).layout;},set:function(new_layout){privates.get(this).layout=new_layout;update_className.call(this);}},minimized:{get:function(){return privates.get(this).minimized;}},model:{value:model},position:{get:function(){return utils.clone(privates.get(this).position);}},shape:{get:function(){return utils.clone(privates.get(this)[this.minimized?'minimized_shape':'shape']);}},tab:{get:function(){return privates.get(this).tab;}},title:{get:function(){return this.model.title;}}});this.wrapperElement=(new se.GUIBuilder()).parse(options.template,{'closebutton':function(options,tcomponents,view){var button=new se.Button({plain:true,class:'wc-remove fa fa-remove',title:utils.gettext("Remove")});button.setDisabled(!view.model.isAllowed('close'));button.addEventListener('click',function(){view.remove();});return button;},'errorbutton':function(options,tcomponents,view){var button=new StyledElements.Button({plain:true,class:'errorbutton fa fa-warning'});button.addEventListener('click',function(button){var dialog=new Wirecloud.ui.LogWindowMenu(view.model.logManager);dialog.show();});button.disable();view.errorbutton=button;return button;},'menubutton':function(options,tcomponents,view){var button=new StyledElements.PopupButton({class:'wc-menu-button fa fa-cogs',plain:true,title:utils.gettext("Menu")});button.popup_menu.append(new ns.WidgetViewMenuItems(view));return button;},'minimizebutton':function(options,tcomponents,view){var button=new StyledElements.Button({class:'fa fa-minus',plain:true,title:utils.gettext("Minimize")});button.setDisabled(!view.model.isAllowed('minimize'));button.addEventListener('click',function(button){view.toggleMinimizeStatus(true);});view.minimizebutton=button;return button;},'title':function(options,tcomponents,view){var element=new StyledElements.EditableElement({initialContent:view.model.title});element.addEventListener('change',function(element,new_title){view.rename(new_title);});view.titleelement=element;return element;},'bottomresizehandle':function(options,tcomponents,view){var handle=new Wirecloud.ui.WidgetViewResizeHandle(view,{resizeLeftSide:true,fixWidth:true});handle.addClassName("wc-bottom-resize-handle");handle.setDisabled(!view.model.isAllowed('resize'));view.bottomresizehandle=handle;return handle;},'leftresizehandle':function(options,tcomponents,view){var handle=new Wirecloud.ui.WidgetViewResizeHandle(view,{resizeLeftSide:true});handle.addClassName("wc-bottom-left-resize-handle");handle.setDisabled(!view.model.isAllowed('resize'));view.leftresizehandle=handle;return handle;},'rightresizehandle':function(options,tcomponents,view){var handle=new Wirecloud.ui.WidgetViewResizeHandle(view,{resizeLeftSide:false});handle.addClassName("wc-bottom-right-resize-handle");handle.setDisabled(!view.model.isAllowed('resize'));view.rightresizehandle=handle;return handle;},'iframe':function(options,tcomponents,view){return view.model.wrapperElement;}},this).children[1];if('bottomresizehandle'in this){this.bottomresizehandle.setResizableElement(this.wrapperElement);}
if('leftresizehandle'in this){this.leftresizehandle.setResizableElement(this.wrapperElement);}
if('rightresizehandle'in this){this.rightresizehandle.setResizableElement(this.wrapperElement);}
this.wrapperElement.classList.add("wc-widget");this.wrapperElement.setAttribute('data-id',model.id);model.addEventListener('change',function(widget,changes){if(changes.indexOf('title')!==-1){this.titleelement.setTextContent(widget.title);}
if(changes.indexOf('meta')!==-1){update_className.call(this);}}.bind(this));model.addEventListener('unload',function(widget){this.unhighlight();}.bind(this));this.heading=this.wrapperElement.getElementsByClassName('wc-widget-heading')[0];var layout=model.layout===0?tab.dragboard.baseLayout:tab.dragboard.freeLayout;layout.addWidget(this,true);this.setMinimizeStatus(model.minimized,false,true);this.draggable=new Wirecloud.ui.WidgetViewDraggable(this);update_className.call(this);this.model.logManager.addEventListener('newentry',on_add_log.bind(this));this.wrapperElement.addEventListener('transitionend',function(e){if(this.layout.iwidgetToMove==null&&['width','height','top','left'].indexOf(e.propertyName)!==-1){this.repaint();notify_shape.call(this);}}.bind(this),true);model.addEventListener('load',function(model){this.wrapperElement.classList.add('in');model.wrapperElement.contentDocument.defaultView.addEventListener('keydown',function(event){if(event.keyCode===27){Wirecloud.UserInterfaceManager.handleEscapeEvent();}},true);model.wrapperElement.contentDocument.defaultView.addEventListener('click',function(){Wirecloud.UserInterfaceManager.handleEscapeEvent();this.unhighlight();}.bind(this),true);this.repaint();}.bind(this));model.addEventListener('remove',on_remove.bind(this));};utils.inherit(ns.WidgetView,se.StyledElement,{setMinimizeStatus:function setMinimizeStatus(newStatus,persistence,reserveSpace){var oldHeight=this.shape.height;if(newStatus===this.minimized){return this;}
privates.get(this).minimized=newStatus;if(this.minimized){this.minimizebutton.setTitle(utils.gettext("Maximize"));this.minimizebutton.replaceClassName("fa-minus","fa-plus");this.wrapperElement.classList.add('wc-minimized-widget');this.wrapperElement.style.height="";privates.get(this).minimized_shape={height:this.layout.adaptHeight(this.wrapperElement.offsetHeight+'px').inLU,width:privates.get(this).shape.width};}else{this.minimizebutton.setTitle(utils.gettext("Minimize"));this.minimizebutton.replaceClassName("fa-plus","fa-minus");this.wrapperElement.classList.remove('wc-minimized-widget');this.wrapperElement.style.height=this.layout.getHeightInPixels(privates.get(this).shape.height)+'px';privates.get(this).minimized_shape=null;}
this.model.contextManager.modify({'height':this.shape.height,'heightInPixels':this.model.wrapperElement.offsetHeight});reserveSpace=reserveSpace!=null?reserveSpace:true;if(reserveSpace){var persist=persistence!=null?persistence:true;this.layout._notifyResizeEvent(this,this.shape.width,oldHeight,this.shape.width,this.shape.height,false,persist,reserveSpace);}
return this;},setPosition:function setPosition(position){utils.update(privates.get(this).position,position);if(this.layout!=null){update_position.call(this);notify_position.call(this);}},setShape:function setShape(shape,resizeLeftSide,persist){var oldWidth=this.shape.width;var oldHeight=this.shape.height;utils.update(privates.get(this).shape,shape);if(this.layout==null){return;}
update_shape.call(this);notify_shape.call(this);this.layout._notifyResizeEvent(this,oldWidth,oldHeight,this.shape.width,this.shape.height,resizeLeftSide,persist);},load:function load(){if(!this.model.loaded){this.wrapperElement.classList.add('in');this.model.load();}
return this.repaint();},repaint:function repaint(){update_position.call(this);update_shape.call(this);notify_position.call(this);notify_shape.call(this);return this;},reload:function reload(){this.model.reload();return this;},showLogs:function showLogs(){this.model.showLogs();return this;},showSettings:function showSettings(){this.model.showSettings();return this;},highlight:function highlight(){this.wrapperElement.classList.add('panel-success');this.wrapperElement.classList.remove('panel-default');if(!this.wrapperElement.classList.contains('wc-widget-highlight')){this.wrapperElement.classList.add('wc-widget-highlight');this.dispatchEvent('highlight');}else{this.wrapperElement.classList.remove('wc-widget-highlight');setTimeout(function(){this.wrapperElement.classList.add('wc-widget-highlight');}.bind(this));}},unhighlight:function unhighlight(){this.wrapperElement.classList.remove('panel-success');this.wrapperElement.classList.add('panel-default');if(this.wrapperElement.classList.contains('wc-widget-highlight')){this.wrapperElement.classList.remove('wc-widget-highlight');this.dispatchEvent('unhighlight');}},moveToLayout:function moveToLayout(newLayout){var affectedWidgetsRemoving,affectedWidgetsAdding,minimizeOnFinish,p,previousWidth,previousHeight,dragboardChange,oldLayout,oldPositionPixels;if(this.layout===newLayout){return;}
minimizeOnFinish=false;if(this.minimized){minimizeOnFinish=true;this.toggleMinimizeStatus();}
previousWidth=this.wrapperElement.offsetWidth;previousHeight=this.wrapperElement.offsetHeight;dragboardChange=this.layout.dragboard!==newLayout.dragboard||privates.get(this).tab!==newLayout.dragboard.tab;oldLayout=this.layout;affectedWidgetsRemoving=oldLayout.removeWidget(this,dragboardChange);if(oldLayout instanceof Wirecloud.ui.FullDragboardLayout){this.setShape(this.previousShape);}else{this.setShape({width:newLayout.adaptWidth(previousWidth+'px').inLU,height:newLayout.adaptHeight(previousHeight+'px').inLU});}
if(dragboardChange&&!(newLayout instanceof Wirecloud.ui.FreeLayout)){this.setPosition(newLayout._searchFreeSpace(this.shape.width,this.shape.height));}else if(oldLayout instanceof Wirecloud.ui.FullDragboardLayout){this.setPosition(this.previousPosition);}else{oldPositionPixels={x:oldLayout.getColumnOffset(this.position.x)-oldLayout.dragboardLeftMargin,y:oldLayout.getRowOffset(this.position.y)-oldLayout.dragboardTopMargin};this.setPosition({x:newLayout.adaptColumnOffset(oldPositionPixels.x+'px').inLU,y:newLayout.adaptRowOffset(oldPositionPixels.y+'px').inLU});}
affectedWidgetsAdding=newLayout.addWidget(this,dragboardChange);privates.get(this).tab=newLayout.dragboard.tab;if(minimizeOnFinish){this.toggleMinimizeStatus();}
p=this.update();if(dragboardChange&&(affectedWidgetsRemoving||affectedWidgetsAdding)){if(affectedWidgetsRemoving){p.then(function(){return oldLayout.dragboard.update();});}
if(affectedWidgetsAdding){p.then(function(){return newLayout.dragboard.update();});}}},toggleMinimizeStatus:function toggleMinimizeStatus(persistence){this.setMinimizeStatus(!this.minimized,persistence);},setFullDragboardMode:function setFullDragboardMode(enable){if((this.layout===this.tab.dragboard.fulldragboardLayout)===enable){return;}
var dragboard=this.layout.dragboard;if(enable){this.previousShape=this.shape;this.previousLayout=this.layout;this.previousPosition=this.position;this.moveToLayout(dragboard.fulldragboardLayout);dragboard.raiseToTop(this);}else{this.moveToLayout(this.previousLayout);}},toggleLayout:function toggleLayout(){if(this.layout===this.tab.dragboard.freeLayout){this.moveToLayout(this.layout.dragboard.baseLayout);}else{this.moveToLayout(this.layout.dragboard.freeLayout);}},update:function update(){return this.model.changeTab(this.tab.model);},toJSON:function toJSON(){var data={id:this.id,tab:this.tab.id,layout:this.layout===this.tab.dragboard.freeLayout?1:0};if(!this.tab.workspace.restricted){data.minimized=this.minimized;}
if(this.layout!==this.tab.dragboard.fulldragboardLayout){data.top=this.position.y;data.left=this.position.x;data.zIndex=this.position.z;data.width=this.shape.width;data.height=privates.get(this).shape.height;data.fulldragboard=false;}else{data.fulldragboard=true;}
return data;},persist:function persist(){if(!this.model.volatile){this.model.setPosition(this.position);this.model.setShape(privates.get(this).shape);}
return this;},remove:function remove(){this.model.remove();return this;},rename:function rename(title){this.model.rename(title);return this;}});var privates=new WeakMap();var update_className=function update_className(){if(this.model.missing){this.wrapperElement.classList.add('wc-missing-widget');}else{this.wrapperElement.classList.remove('wc-missing-widget');}
if(this.layout!=null&&this.layout instanceof Wirecloud.ui.FreeLayout){this.wrapperElement.classList.add('wc-floating-widget');}else{this.wrapperElement.classList.remove('wc-floating-widget');}};var update_position=function update_position(){this.wrapperElement.style.left=this.layout.getColumnOffset(this.position.x)+"px";this.wrapperElement.style.top=this.layout.getRowOffset(this.position.y)+"px";this.wrapperElement.style.zIndex=this.position.z+1;};var update_shape=function update_shape(){this.wrapperElement.style.width=this.layout.getWidthInPixels(this.shape.width)+'px';this.wrapperElement.style.height=this.minimized?"":this.layout.getHeightInPixels(this.shape.height)+'px';};var notify_position=function notify_position(){this.model.contextManager.modify({'xPosition':this.position.x,'yPosition':this.position.y,'zPosition':this.position.z});};var notify_shape=function notify_shape(){this.model.contextManager.modify({'height':this.shape.height,'width':this.shape.width,'heightInPixels':this.model.wrapperElement.offsetHeight,'widthInPixels':this.model.wrapperElement.offsetWidth});};var on_add_log=function on_add_log(){var label,errorCount=this.model.logManager.errorCount;this.errorbutton.setDisabled(errorCount===0);label=utils.ngettext("%(errorCount)s error","%(errorCount)s errors",errorCount);label=utils.interpolate(label,{errorCount:errorCount},true);this.errorbutton.setTitle(label);};var on_remove=function on_remove(){this.dispatchEvent('remove');};})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.WidgetViewMenuItems=function WidgetViewMenuItems(widget){se.DynamicMenuItems.call(this);Object.defineProperties(this,{widget:{value:widget}});};utils.inherit(ns.WidgetViewMenuItems,se.DynamicMenuItems,{build:function build(){var item,items,item_title,item_icon;items=[];item=new se.MenuItem(utils.gettext("Rename"),function(){this.titleelement.enableEdition();}.bind(this.widget));item.addIconClass("fa fa-pencil");item.setDisabled(!this.widget.model.isAllowed('rename'));items.push(item);item=new se.MenuItem(utils.gettext("Reload"),function(){this.reload();}.bind(this.widget));item.addIconClass("fa fa-refresh");item.setDisabled(this.widget.model.missing);items.push(item);item=new se.MenuItem(utils.gettext("Upgrade/Downgrade"),function(){var dialog=new Wirecloud.ui.UpgradeWindowMenu(this.model);dialog.show();}.bind(this.widget));item.addIconClass("fa fa-retweet");item.setDisabled(!this.widget.model.isAllowed('upgrade')||!Wirecloud.LocalCatalogue.hasAlternativeVersion(this.widget.model.meta));items.push(item);item=new se.MenuItem(utils.gettext("Logs"),function(){this.showLogs();}.bind(this.widget));item.addIconClass("fa fa-tags");items.push(item);item=new se.MenuItem(utils.gettext("Settings"),function(){this.showSettings();}.bind(this.widget));item.addIconClass("fa fa-cog");item.setDisabled(!this.widget.model.hasPreferences()||!this.widget.model.isAllowed('configure'));items.push(item);item=new se.MenuItem(utils.gettext("User's Manual"),function(){var myresources_view=Wirecloud.UserInterfaceManager.views.myresources;myresources_view.createUserCommand('showDetails',this.model.meta,{version:this.model.meta.version,tab:utils.gettext('Documentation')})();}.bind(this.widget));item.addIconClass("fa fa-book");item.setDisabled(this.widget.model.meta.doc==='');items.push(item);if(this.widget.layout===this.widget.tab.dragboard.fulldragboardLayout){item_icon="fa fa-compress";item_title=utils.gettext("Exit Full Dragboard");}else{item_icon="fa fa-expand";item_title=utils.gettext("Full Dragboard");}
item=new se.MenuItem(item_title,function(){this.setFullDragboardMode(this.layout!==this.tab.dragboard.fulldragboardLayout);}.bind(this.widget));item.addIconClass(item_icon);item.setDisabled(!this.widget.model.isAllowed('move'));items.push(item);if(this.widget.layout!==this.widget.tab.dragboard.fulldragboardLayout){if(this.widget.layout===this.widget.tab.dragboard.freeLayout){item_icon="fa fa-sign-in";item_title=utils.gettext("Snap to grid");}else{item_icon="fa fa-sign-out";item_title=utils.gettext("Extract from grid");}
item=new se.MenuItem(item_title,function(){this.toggleLayout();}.bind(this.widget));item.addIconClass(item_icon);item.setDisabled(!this.widget.model.isAllowed('move'));items.push(item);}
return items;}});})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(){"use strict";var WidgetViewResizeHandle=function WidgetViewResizeHandle(widget,options){if(options==null){options={};}
options.resizeLeftSide=!!options.resizeLeftSide;options.resizeTopSide=!!options.resizeTopSide;options.fixHeight=!!options.fixHeight;options.fixWidth=!!options.fixWidth;options.widget=widget;if(options.fixWidth&&options.fixHeight){throw new Error('fixWidth and fixHeight cannot be true at the same time');}
StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement('div');Wirecloud.ui.ResizeHandle.call(this,widget.wrapperElement,this.wrapperElement,options,WidgetViewResizeHandle.prototype.ondragstart,WidgetViewResizeHandle.prototype.ondrag,WidgetViewResizeHandle.prototype.ondragend,WidgetViewResizeHandle.prototype.canDrag);};WidgetViewResizeHandle.prototype=new StyledElements.StyledElement();WidgetViewResizeHandle.prototype.canDrag=function canDrag(resizableElement,data){return data.widget.model.isAllowed('resize');};WidgetViewResizeHandle.prototype.ondragstart=function ondragstart(resizableElement,handleElement,data){handleElement.classList.add("inUse");data.widget.wrapperElement.classList.add('dragging');data.minWidth=Math.ceil(data.widget.layout.fromPixelsToHCells(80));data.minHeight=Math.ceil(data.widget.layout.fromPixelsToVCells(50));data.innitialWidth=data.widget.shape.width;data.innitialHeight=data.widget.shape.height;data.oldZIndex=data.widget.position.z;data.widget.setPosition({z:"999999"});data.dragboard=data.widget.layout.dragboard;};WidgetViewResizeHandle.prototype.ondrag=function ondrag(resizableElement,handleElement,data,x,y){var widget=data.widget;if(widget.layout.isInside(x,y)){var position=widget.layout.getCellAt(x,y);var currentPosition=widget.position;var width,height;if(!data.fixWidth){if(data.resizeLeftSide){width=currentPosition.x+widget.shape.width-position.x;}else{width=position.x-currentPosition.x+1;}}else{width=widget.shape.width;}
if(!data.fixHeight){height=position.y-currentPosition.y+1;}else{height=widget.shape.height;}
if(width<data.minWidth){width=data.minWidth;}
if(height<data.minHeight){height=data.minHeight;}
if(width!==widget.shape.width||height!==widget.shape.height){widget.setShape({width:width,height:height},data.resizeLeftSide);}}};WidgetViewResizeHandle.prototype.ondragend=function ondragend(resizableElement,handleElement,data){var widget=data.widget;data.widget.wrapperElement.classList.remove('dragging');data.widget.setPosition({z:data.oldZIndex});if(data.innitialWidth!==data.widget.shape.width||data.innitialHeight!==data.widget.shape.height){widget.setShape({width:widget.shape.width,height:widget.shape.height},data.resizeLeftSide,true);}
handleElement.classList.remove("inUse");data.dragboard._notifyWindowResizeEvent();};Wirecloud.ui.WidgetViewResizeHandle=WidgetViewResizeHandle;})();;(function(){"use strict";var _canBeDragged=function(){return true;};var Draggable=function Draggable(handler,data,onStart,onDrag,onFinish,canBeDragged,onScroll){var lastClientX,lastClientY;var xStart=0,yStart=0,xScrollStart=0,yScrollStart=0;var xScrollDelta,yScrollDelta;var dragboardCover;var draggable=this;var enddrag,drag,startdrag,scroll;canBeDragged=canBeDragged?canBeDragged:_canBeDragged;enddrag=function enddrag(e){if(e.type==='mouseup'&&e.button!==0){return;}else if(e.type==='touchend'&&e.touches.length>0){return;}
document.removeEventListener("mouseup",enddrag,false);document.removeEventListener("touchend",enddrag,false);document.removeEventListener("mousemove",drag,false);document.removeEventListener("touchmove",drag,false);if(dragboardCover!=null){dragboardCover.parentNode.removeEventListener("scroll",scroll,true);dragboardCover.parentNode.removeChild(dragboardCover);dragboardCover=null;}
onFinish(draggable,data,e);handler.addEventListener("mousedown",startdrag,false);handler.addEventListener("touchstart",startdrag,false);document.removeEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener);document.removeEventListener('mousedown',Wirecloud.Utils.preventDefaultListener);};drag=function drag(e){if('touches'in e){lastClientX=e.touches[0].clientX;lastClientY=e.touches[0].clientY;e.preventDefault();}else{lastClientX=e.clientX;lastClientY=e.clientY;}
var xDelta=lastClientX-xStart-xScrollDelta;var yDelta=lastClientY-yStart-yScrollDelta;onDrag(e,draggable,data,xDelta,yDelta);};startdrag=function startdrag(e){if(e.type==='mousedown'&&e.button!==0){return;}
if(!canBeDragged(draggable,data)){return false;}
e.preventDefault();document.addEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener);document.addEventListener('mousedown',Wirecloud.Utils.preventDefaultListener);handler.removeEventListener("mousedown",startdrag,false);handler.removeEventListener("touchstart",startdrag,false);if('touches'in e){xStart=e.touches[0].clientX;yStart=e.touches[0].clientY;}else{xStart=e.clientX;yStart=e.clientY;}
lastClientX=xStart;lastClientY=yStart;document.addEventListener("mouseup",enddrag,false);document.addEventListener("touchend",enddrag,false);document.addEventListener("mousemove",drag,false);document.addEventListener("touchmove",drag,false);yScrollDelta=0;xScrollDelta=0;var options=onStart(draggable,data,e);if(options!=null&&options.dragboard){var dragboard=options.dragboard;dragboardCover=document.createElement("div");dragboardCover.className="cover";dragboardCover.addEventListener("mouseup",enddrag,true);dragboardCover.addEventListener("touchend",enddrag,true);dragboardCover.addEventListener("mousemove",drag,true);dragboardCover.addEventListener("touchmove",drag,true);dragboardCover.style.zIndex="1000000";dragboardCover.style.position="absolute";dragboardCover.style.top="0";dragboardCover.style.left="0";dragboardCover.style.width="100%";dragboardCover.style.height=dragboard.scrollHeight+"px";yScrollStart=parseInt(dragboard.scrollTop,10);xScrollStart=parseInt(dragboard.scrollLeft,10);dragboard.addEventListener("scroll",scroll,true);dragboard.insertBefore(dragboardCover,dragboard.firstChild);}
e.stopPropagation();};scroll=function scroll(e){var dragboard=dragboardCover.parentNode;dragboardCover.style.height=dragboard.scrollHeight+"px";var scrollTop=parseInt(dragboard.scrollTop,10);yScrollDelta=yScrollStart-scrollTop;var scrollLeft=parseInt(dragboard.scrollLeft,10);xScrollDelta=xScrollStart-scrollLeft;var xDelta=lastClientX-xStart-xScrollDelta;var yDelta=lastClientY-yStart-yScrollDelta;onDrag(e,draggable,data,xDelta,yDelta);};handler.addEventListener("mousedown",startdrag,false);handler.addEventListener("touchstart",startdrag,false);this.destroy=function destroy(){handler.removeEventListener("mousedown",startdrag,false);handler.removeEventListener("touchstart",startdrag,false);startdrag=null;enddrag=null;drag=null;scroll=null;draggable=null;data=null;handler=null;};};Wirecloud.ui.Draggable=Draggable;})();;(function(){"use strict";var Theme=function Theme(desc){Object.defineProperties(this,{name:{value:desc.name},label:{value:desc.label},baseurl:{value:desc.baseurl},templates:{value:desc.templates}});Object.freeze();};Theme.prototype.get_static_url=function get_static_url(path){return this.baseurl+path;};Wirecloud.ui.Theme=Theme;})();;(function(utils,se){"use strict";var WirecloudCatalogue=function WirecloudCatalogue(options){se.ObjectWithEvents.call(this,["change","install","uninstall"]);Object.defineProperty(this,'title',{'value':options.title||options.name});Object.defineProperty(this,'name',{'value':options.name});Object.defineProperty(this,'permissions',{'value':options.permissions});if(options.url==null){options.url=Wirecloud.URLs.LOCAL_REPOSITORY;}else if(options.url[options.url.length-1]!=='/'){options.url+='/';}
Object.defineProperties(this,{'RESOURCE_CHANGELOG_ENTRY':{value:new utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s/changelog')},'RESOURCE_USERGUIDE_ENTRY':{value:new utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s/userguide')},'RESOURCE_COLLECTION':{value:options.url+'catalogue/resources'},'RESOURCE_UNVERSIONED_ENTRY':{value:new utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s')},'RESOURCE_ENTRY':{value:new utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s')},});};utils.inherit(WirecloudCatalogue,se.ObjectWithEvents);WirecloudCatalogue.prototype.isAllow=function isAllow(action){if(action in this.permissions){return this.permissions[action];}else{return false;}};WirecloudCatalogue.prototype.search=function search(options){if(options==null){throw new TypeError();}
var params={};if(options.search_criteria!=null&&options.search_criteria!==''){params.q=options.search_criteria;}
if(options.scope!=null&&options.scope!==''&&options.scope!=='all'){if(['widget','operator','mashup'].indexOf(options.scope)===-1){throw new TypeError('invalid scope value');}
params.scope=options.scope;}
if(options.order_by!=null&&options.order_by!==''){params.orderby=options.order_by;}
if(options.maxresults!=null){if(typeof options.maxresults!=='number'||options.maxresults<20){throw new TypeError('invalid maxresults value');}
params.maxresults=options.maxresults;}
if(options.pagenum!=null){if(typeof options.pagenum!=='number'||options.pagenum<0){throw new TypeError('invalid pagenum value');}
params.pagenum=options.pagenum;}
return Wirecloud.io.makeRequest(this.RESOURCE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},parameters:params}).then((response)=>{return new Promise((resolve,reject)=>{if([200,401,403,500].indexOf(response.status)===-1){return reject(utils.gettext("Unexpected response from server"));}else if([401,403,500].indexOf(response.status)!==-1){return reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
var raw_data=JSON.parse(response.responseText);var data={'resources':raw_data.results,'current_page':parseInt(raw_data.pagenum,10),'total_count':parseInt(raw_data.total,10)};if('corrected_q'in raw_data){data.corrected_query=raw_data.corrected_q;}
resolve(data);});}).toTask(utils.gettext("Doing catalogue search"));};WirecloudCatalogue.prototype.getResourceDetails=function getResourceDetails(vendor,name,options){if(options==null){options={};}
var url=this.RESOURCE_UNVERSIONED_ENTRY.evaluate({vendor:vendor,name:name});Wirecloud.io.makeRequest(url,{method:'GET',onSuccess:function(response){var resource_details=new Wirecloud.WirecloudCatalogue.ResourceDetails(JSON.parse(response.responseText),this);try{options.onSuccess(resource_details);}catch(e){}}.bind(this),onFailure:options.onFailure,onComplete:options.onComplete});};WirecloudCatalogue.prototype.is_purchased=function is_purchased(){return true;};WirecloudCatalogue.prototype.addComponent=function addComponent(options){var url,parameters,requestHeaders,contentType,body;if(typeof options==null){throw new TypeError("missing options parameter");}
options=utils.merge({install_embedded_resources:true},options);if(this.name!=='local'&&options.market_endpoint!==null){throw new TypeError(utils.gettext("market_endpoint option can only be used on local catalogues"));}
requestHeaders={'Accept':'application/json'};if(this.name==='local'){url=Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION;}else{url=this.RESOURCE_COLLECTION;if(this.accesstoken!=null){requestHeaders.Authorization='Bearer '+this.accesstoken;}}
if(options.file!=null){var task_title=utils.interpolate(utils.gettext('Uploading packaged component %(filename)s'),{filename:options.file.name});contentType='application/octet-stream';body=options.file;parameters={};if(options.install_embedded_resources===true){parameters.install_embedded_resources="true";}
if(options.force_create===true){parameters.force_create="true";}}else{var task_title=utils.interpolate(utils.gettext('Installing component from %(url)s'),{url:options.url});contentType='application/json';body=JSON.stringify({url:options.url,headers:options.headers,force_create:!!options.forceCreate,install_embedded_resources:!!options.install_embedded_resources,market_endpoint:options.market_endpoint});}
return Wirecloud.io.makeRequest(url,{method:'POST',contentType:contentType,requestHeaders:requestHeaders,postBody:body,parameters:parameters}).then((response)=>{if([201,400,403,409,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if(response.status!==201){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
var response_data=JSON.parse(response.responseText);return Promise.resolve(response_data);}).toTask(task_title);};WirecloudCatalogue.prototype.deleteResource=function deleteResource(resource,options){var url,msg;options=utils.merge({allversions:false},options);if(options.allversions){url=this.RESOURCE_UNVERSIONED_ENTRY.evaluate({vendor:resource.vendor,name:resource.name});msg=utils.interpolate(utils.gettext("Deleting all versions of %(title)s (%(group_id)s)"),resource);}else{url=this.RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name,version:resource.version.text});msg=utils.interpolate(utils.gettext("Deleting %(title)s (%(uri)s)"),resource);}
return Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'}}).then(function(response){return new Promise(function(resolve,reject){var result;if(response.status!==200){reject(new Error("Unexpected response from server"));}
try{result=JSON.parse(response.responseText);if(result.affectedVersions==null){result.affectedVersions=[resource.version.text];}}catch(e){reject(e);return;}
resolve(result);});}).toTask(msg);};Wirecloud.WirecloudCatalogue=WirecloudCatalogue;})(Wirecloud.Utils,StyledElements);;(function(){"use strict";var ResourceDetails=function ResourceDetails(data,catalogue){var currentVersion=null,allVersions=[],data_by_version={};this.getLastVersion=function(){return allVersions[0];};this.getAllVersions=function(){return allVersions;};this.isAllow=function isAllow(action){switch(action){case'uninstall':case'uninstall-all':return currentVersion.permissions.uninstall;case'delete':case'delete-all':return currentVersion.permissions.delete;}};Object.defineProperties(this,{'catalogue':{value:catalogue},'vendor':{value:data.vendor},'name':{value:data.name},'version':{get:function(){return currentVersion.version;}},'authors':{get:function(){return currentVersion.authors;}},'contributors':{get:function(){return currentVersion.contributors;}},'group_id':{value:data.vendor+'/'+data.name},'uri':{get:function(){return[this.vendor,this.name,currentVersion.version.text].join('/');}},'type':{value:data.type},'image':{get:function(){return currentVersion.image;}},'description_url':{get:function(){return currentVersion.uriTemplate;}},'description':{get:function(){return currentVersion.description;}},'longdescription':{get:function(){return currentVersion.longdescription;}},'homepage':{get:function(){return currentVersion.homepage;}},'doc':{get:function(){return currentVersion.doc;}},'changelog':{get:function(){return currentVersion.changelog;}},'size':{get:function(){return currentVersion.size;}},'title':{get:function(){return currentVersion.title;}},'tags':{get:function(){return[];}},'rating':{get:function(){return 0;}},'date':{get:function(){return currentVersion.date;}},'license':{get:function(){return currentVersion.license;}},'licenseurl':{get:function(){return currentVersion.licenseurl;}},'issuetracker':{get:function(){return currentVersion.issuetracker;}},});this.changeVersion=function changeVersion(version){if(version instanceof Wirecloud.Version){version=version.text;}
if(version in data_by_version){currentVersion=data_by_version[version];}else{currentVersion=data_by_version[allVersions[0].text];}
return this;};var i,version_data;for(i=0;i<data.versions.length;i+=1){version_data=data.versions[i];version_data.version=new Wirecloud.Version(version_data.version,'catalogue');version_data.date=new Date(version_data.date);allVersions.push(version_data.version);data_by_version[version_data.version.text]=version_data;}
allVersions=allVersions.sort(function(version1,version2){return-version1.compareTo(version2);});this.changeVersion(allVersions[0]);Object.freeze(this);};Wirecloud.WirecloudCatalogue.ResourceDetails=ResourceDetails;})();;(function(utils){"use strict";var unload_affected_components=function unload_affected_components(component,result){var task_title;switch(component.type){case'widget':task_title=utils.gettext('Unloading affected widgets');break;case'operator':task_title=utils.gettext('Unloading affected operators');break;case'mashup':return Promise.resolve(result);}
return new Wirecloud.Task(task_title,function(resolve,reject,update){for(var workspaceid in Wirecloud.workspaceInstances){var workspace=Wirecloud.workspaceInstances[workspaceid];if(!(workspace instanceof Wirecloud.Workspace)){continue;}
result.affectedVersions.forEach((version)=>{var list;var new_meta=workspace.resources.remove(component.group_id+'/'+version);if(new_meta!=null){if(component.type==="widget"){list=workspace.widgets;}else{list=workspace.wiring.operators;}
list.forEach(function(component){if(component.meta.uri===new_meta.uri){component.upgrade(new_meta);}});}});}
resolve(result);});};var purge_component_info=function purge_component_info(component,result){var task_title=utils.interpolate(utils.gettext("Purging %(componenttype)s info"),{componenttype:component.type});return new Wirecloud.Task(task_title,function(resolve,reject){result.affectedVersions.forEach(function(version){var component_full_id,index;try{component_full_id=component.group_id+'/'+version;component=this.resources[component_full_id];delete this.resources[component_full_id];index=this.resourceVersions[component.group_id].indexOf(component);this.resourceVersions[component.group_id].splice(index,1);if(this.resourceVersions[component.group_id].length===0){delete this.resourceVersions[component.group_id];}
this.dispatchEvent('uninstall',component);this.dispatchEvent('change','uninstall',component);}catch(e){}},this);resolve(result);}.bind(this));};var LocalCatalogue=new Wirecloud.WirecloudCatalogue({name:'local',permissions:{'delete':false}});LocalCatalogue.reload=function reload(){var request;this.resources={};this.resourceVersions={};if(Wirecloud.contextManager.get('isanonymous')===false){request=Wirecloud.io.makeRequest(Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'}});}else{request=new Wirecloud.Task("",(resolve)=>{resolve({responseText:"[]"});});}
return request.then((response)=>{var resources,resource_id,msg;resources=JSON.parse(response.responseText);for(resource_id in resources){try{this._includeResource.call(this,resources[resource_id]);}catch(e){msg=utils.gettext("Error loading %(resource)s metadata");Wirecloud.GlobalLogManager.log(utils.interpolate(msg,{resource:resource_id}),{details:e});}}
return Promise.resolve();});};LocalCatalogue.uninstallResource=function uninstallResource(resource,options){var url,msg;options=utils.merge({allversions:false},options);if(options.allversions){url=Wirecloud.URLs.LOCAL_UNVERSIONED_RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name});msg=utils.interpolate(utils.gettext("Uninstalling all versions of %(title)s (%(group_id)s)"),resource);}else{url=Wirecloud.URLs.LOCAL_RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name,version:resource.version.text});msg=utils.interpolate(utils.gettext("Uninstalling %(title)s (%(uri)s)"),resource);}
return Wirecloud.io.makeRequest(url+'?affected=true',{method:'DELETE',requestHeaders:{'Accept':'application/json'}}).then(function(response){if(response.status!==200){return Promise.reject(new Error("Unexpected response from server"));}
try{var result=JSON.parse(response.responseText);if(result.affectedVersions==null){result.affectedVersions=[resource.version];}}catch(e){return Promise.reject(e);}
return Promise.resolve(result);}).then(unload_affected_components.bind(this,resource)).then(purge_component_info.bind(this,resource)).toTask(msg);};LocalCatalogue.deleteResource=function deleteResource(resource,options){return Wirecloud.WirecloudCatalogue.prototype.deleteResource.call(this,resource,options).then(unload_affected_components.bind(this,resource)).then(purge_component_info.bind(this,resource));};LocalCatalogue.addComponent=function addComponent(options){var task=Wirecloud.WirecloudCatalogue.prototype.addComponent.call(this,options);task.then((response_data)=>{var components;if('resource_details'in response_data){components=[response_data.resource_details].concat(response_data.extra_resources);}else{components=[response_data];}
components.forEach((component)=>{var id=[component.vendor,component.name,component.version].join('/');if(!this.resourceExistsId(id)){component=this._includeResource.call(this,component);this.dispatchEvent('install',component);this.dispatchEvent('change','install',component);}});return Promise.resolve(response_data);});return task;};LocalCatalogue._includeResource=function _includeResource(component_data){var component,component_id,component_full_id;component_id=component_data.vendor+'/'+component_data.name;component_full_id=component_id+'/'+component_data.version;switch(component_data.type){case'widget':component=new Wirecloud.WidgetMeta(component_data);if(Wirecloud.activeWorkspace!=null){Wirecloud.activeWorkspace.widgets.forEach(function(widget){if(widget.missing&&widget.meta.uri===component.uri){widget.upgrade(component);}});}
break;case'operator':component=new Wirecloud.wiring.OperatorMeta(component_data);if(Wirecloud.activeWorkspace!=null){try{Wirecloud.activeWorkspace.wiring.operators.forEach(function(operator){if(operator.missing&&operator.meta.uri===component.uri){operator.upgrade(component);}});}catch(error){}}
break;case'mashup':component=new Wirecloud.MashableApplicationComponent(component_data);break;default:var msg=utils.interpolate(utils.gettext("Invalid component type: %(type)s"),{type:component_data.type});throw new TypeError(msg);}
if(Wirecloud.activeWorkspace!=null){Wirecloud.activeWorkspace.resources.restore(component);}
if(!(component_id in this.resourceVersions)){this.resourceVersions[component_id]=[];}
this.resourceVersions[component_id].push(component);this.resources[component_full_id]=component;return component;};LocalCatalogue.hasAlternativeVersion=function hasAlternativeVersion(component){var versions=this.resourceVersions[component.group_id];return versions!=null&&(versions.length>1||versions.length===1&&!versions[0].is(component));};LocalCatalogue.getResourceId=function getResourceId(id){return this.resources[id];};LocalCatalogue.getResource=function getResource(vendor,name,version){var id=[vendor,name,version].join('/');return this.getResourceId(id);};LocalCatalogue.resourceExistsId=function resourceExistsId(id){return this.getResourceId(id)!=null;};LocalCatalogue.resourceExists=function resourceExists(resource){var id=[resource.vendor,resource.name,resource.version].join('/');return this.resourceExistsId(id);};Wirecloud.LocalCatalogue=LocalCatalogue;})(Wirecloud.Utils);;(function(utils){"use strict";var _addComponent=function _addComponent(meta){if(!(meta.group_id in this.resourceVersions)){this.resourceVersions[meta.group_id]=[];}
this.resourceVersions[meta.group_id].push(meta);this.resources[meta.uri]=meta;delete this.missingComponents[meta.uri];};var loadResource=function loadResource(resource_data){var resource;switch(resource_data.type){case'widget':resource=new Wirecloud.WidgetMeta(resource_data);break;case'operator':resource=new Wirecloud.wiring.OperatorMeta(resource_data);break;case'mashup':resource=resource_data;break;default:return;}
_addComponent.call(this,resource);};var loadSuccessCallback=function loadSuccessCallback(response){var resources,resource_id,msg;if(response.status!=200){throw Error('Unexpected error code');}
resources=JSON.parse(response.responseText);this.resources={};this.resourceVersions={};this.missingComponents={};for(resource_id in resources){try{loadResource.call(this,resources[resource_id]);}catch(e){msg=utils.gettext("Error loading %(resource)s metadata");Wirecloud.GlobalLogManager.log(utils.interpolate(msg,{resource:resource_id}),{details:e});}}};var createMissing=function createMissing(type,vendor,name,version){var Klass=type==='widget'?Wirecloud.WidgetMeta:Wirecloud.wiring.OperatorMeta;return new Klass({vendor:vendor,name:name,version:version,type:type,missing:true,preferences:[],properties:[],requirements:[],wiring:{}});};var WorkspaceCatalogue=function WorkspaceCatalogue(workspace_id){Object.defineProperty(this,'workspace_id',{value:workspace_id});};WorkspaceCatalogue.prototype.reload=function reload(){var url=Wirecloud.URLs.WORKSPACE_RESOURCE_COLLECTION.evaluate({workspace_id:this.workspace_id});return Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'}}).then(loadSuccessCallback.bind(this)).toTask("Requesting workspace components");};WorkspaceCatalogue.prototype.remove=function remove(resource){var index,new_meta;if(typeof resource==="string"){resource=this.getResourceId(resource);}else{resource=this.getResourceId(resource.uri);}
if(resource!=null){delete this.resources[resource.uri];index=this.resourceVersions[resource.group_id].indexOf(resource);this.resourceVersions[resource.group_id].splice(index,1);new_meta=createMissing(resource.type,resource.vendor,resource.name,resource.version.text);this.missingComponents[resource.uri]=new_meta;return new_meta;}};WorkspaceCatalogue.prototype.addComponent=function addComponent(meta){_addComponent.call(this,meta);};WorkspaceCatalogue.prototype.restore=function restore(meta){if(meta.uri in this.missingComponents){_addComponent.call(this,meta);}};WorkspaceCatalogue.prototype.getOrCreateMissing=function getOrCreateMissing(id,type){var component=this.getResourceId(id);if(component==null){if(!(id in this.missingComponents)){var id_parts=id.split('/');this.missingComponents[id]=createMissing(type,id_parts[0],id_parts[1],id_parts[2]);}
component=this.missingComponents[id];}
return component;};WorkspaceCatalogue.prototype.findResource=function findResource(type,id,newMissingResource){var component=this.resources[id];if(component==null&&!!newMissingResource){if(!(id in this.missingComponents)){var id_parts=id.split('/');this.missingComponents[id]=createMissing(type,id_parts[0],id_parts[1],id_parts[2]);}
component=this.missingComponents[id];}
return component;};WorkspaceCatalogue.prototype.getResourceId=function getResourceId(id){return this.resources[id];};WorkspaceCatalogue.prototype.getResource=function getResource(vendor,name,version){var id=[vendor,name,version].join('/');return this.getResourceId(id);};WorkspaceCatalogue.prototype.resourceExistsId=function resourceExistsId(id){return this.getResourceId(id)!=null;};WorkspaceCatalogue.prototype.resourceExists=function resourceExists(resource){var id=[resource.vendor,resource.name,resource.version.text].join('/');return this.resourceExistsId(id);};Wirecloud.WorkspaceCatalogue=WorkspaceCatalogue;})(Wirecloud.Utils);;(function(ns,se,utils){"use strict";ns.Connection=function Connection(wiring,source,target,options){se.ObjectWithEvents.call(this,['detach','establish','remove']);this.established=false;options=utils.merge({readonly:false},options);Object.defineProperties(this,{id:{get:function get(){return this.source.id+"//"+this.target.id;}},logManager:{value:new Wirecloud.LogManager(wiring.logManager)},readonly:{value:options.readonly},source:{value:source,writable:true},target:{value:target,writable:true},volatile:{get:function get(){return source.component.volatile||target.component.volatile;}},wiring:{value:wiring}});};ns.Connection.JSON_TEMPLATE={readonly:false,source:{type:"",id:null,endpoint:""},target:{type:"",id:null,endpoint:""}};utils.inherit(ns.Connection,se.ObjectWithEvents,{_connect:function _connect(){var message=utils.gettext("The connection ('%(source)s'-'%(target)s') was established.");this.established=true;this.logManager.log(utils.interpolate(message,this),Wirecloud.constants.LOGGING.INFO_MSG);return this.dispatchEvent('establish');},_disconnect:function _disconnect(){var message=utils.gettext("The connection ('%(source)s'-'%(target)s') was detached.");this.established=false;this.logManager.log(utils.interpolate(message,this),Wirecloud.constants.LOGGING.INFO_MSG);return this.dispatchEvent('detach');},detach:function detach(){if(!this.established){return this;}
this.source.disconnect(this.target);this.established=false;return this;},equals:function equals(connection){return connection instanceof ns.Connection&&this.id===connection.id;},establish:function establish(){if(this.source.missing||this.target.missing){var message=utils.gettext("The connection ('%(source)s'-'%(target)s') has a missing endpoint.");this.logManager.log(utils.interpolate(message,this),Wirecloud.constants.LOGGING.ERROR_MSG);return this;}
if(this.established){return this;}
this.source.connect(this.target,this);this.established=true;return this;},updateEndpoint:function updateEndpoint(endpoint){if(!(endpoint instanceof Wirecloud.wiring.Endpoint)){throw new TypeError("endpoint must be a Wirecloud.wiring.Endpoint instance");}
this.detach();this.logManager.newCycle();if(endpoint instanceof Wirecloud.wiring.SourceEndpoint){this.source=endpoint;}else{this.target=endpoint;}
return this.establish();},remove:function remove(){this.detach();return this.dispatchEvent('remove');},showLogs:function showLogs(){var modal=new Wirecloud.ui.LogWindowMenu(this.logManager,{title:utils.gettext("Connection's logs")});modal.show();return this;},toJSON:function toJSON(){return JSON.parse(JSON.stringify({readonly:this.readonly,source:this.source,target:this.target}));}});})(Wirecloud.wiring,StyledElements,StyledElements.Utils);;(function(utils){"use strict";var Endpoint=function Endpoint(){if(!('name'in this)){Object.defineProperty(this,'name',{value:null});}
if(!('friendcode'in this)){Object.defineProperty(this,'friendcode',{value:""});}
var friendcodeList=this.friendcode!==''?this.friendcode.split(/\s+/):[];Object.defineProperty(this,'friendcodeList',{value:friendcodeList});if(!('label'in this)){Object.defineProperty(this,'label',{value:""});}
if(!('description'in this)){Object.defineProperty(this,'description',{value:""});}
if(!('id'in this)){Object.defineProperty(this,'id',{value:null});}};Endpoint.prototype.getReachableEndpoints=function getReachableEndpoints(){return[];};Endpoint.prototype.fullDisconnect=function fullDisconnect(){var funcName='fullDisconnect';var msg=utils.gettext("Unimplemented function: %(funcName)s");msg=utils.interpolate(msg,{funcName:funcName},true);Wirecloud.GlobalLogManager.log(msg);return;};Wirecloud.wiring.Endpoint=Endpoint;})(Wirecloud.Utils);;(function(){"use strict";var EndpointDoesNotExistError=function EndpointDoesNotExistError(message){this.name="EndpointDoesNotExistError";this.message=message||"";};EndpointDoesNotExistError.prototype=new Error();EndpointDoesNotExistError.prototype.constructor=EndpointDoesNotExistError;Object.freeze(EndpointDoesNotExistError.prototype);Object.freeze(EndpointDoesNotExistError);Wirecloud.wiring.EndpointDoesNotExistError=EndpointDoesNotExistError;})();;(function(){"use strict";var EndpointTypeError=function EndpointTypeError(message){this.name="EndpointTypeError";this.message=message||"";};EndpointTypeError.prototype=new Error();EndpointTypeError.prototype.constructor=EndpointTypeError;Object.freeze(EndpointTypeError.prototype);Object.freeze(EndpointTypeError);Wirecloud.wiring.EndpointTypeError=EndpointTypeError;})();;(function(){"use strict";var EndpointValueError=function EndpointValueError(message){this.name="EndpointValueError";this.message=message||"";};EndpointValueError.prototype=new Error();EndpointValueError.prototype.constructor=EndpointValueError;Object.freeze(EndpointValueError.prototype);Object.freeze(EndpointValueError);Wirecloud.wiring.EndpointValueError=EndpointValueError;})();;(function(utils){"use strict";var SourceEndpoint=function SourceEndpoint(){Wirecloud.wiring.Endpoint.call(this);this.outputList=[];this.connections=[];};utils.inherit(SourceEndpoint,Wirecloud.wiring.Endpoint);SourceEndpoint.prototype.connect=function connect(out,connection){if(!(out instanceof Wirecloud.wiring.TargetEndpoint)){throw new TypeError('Invalid target endpoint');}
if(this.outputList.indexOf(out)===-1){this.outputList.push(out);this.connections.push(connection);out._addInput(this,connection);connection._connect();}};SourceEndpoint.prototype.disconnect=function disconnect(out){var connection,index;if(!(out instanceof Wirecloud.wiring.TargetEndpoint)){throw new TypeError('Invalid target endpoint');}
index=this.outputList.indexOf(out);if(index!==-1){this.outputList.splice(index,1);connection=this.connections[index];this.connections.splice(index,1);out._removeInput(this,connection);connection._disconnect();}};SourceEndpoint.prototype.fullDisconnect=function fullDisconnect(){var outputs=utils.clone(this.outputList);for(var i=0;i<outputs.length;++i){this.disconnect(outputs[i]);}};SourceEndpoint.prototype.formatException=function formatException(exception){return exception.toString();};SourceEndpoint.prototype.propagate=function propagate(value,options){var i,errorDetails,targetEndpoint,connection;var outputs=utils.clone(this.outputList);for(i=0;i<outputs.length;++i){targetEndpoint=outputs[i];connection=this.connections[i];try{targetEndpoint.propagate(value,options);}catch(error){errorDetails=this.formatException(error);connection.logManager.log(errorDetails);}}};SourceEndpoint.prototype.getReachableEndpoints=function getReachableEndpoints(){var endpoints=[];for(var i=0;i<this.outputList.length;++i){var currentEndpoints=this.outputList[i].getReachableEndpoints();if(currentEndpoints.length>0){endpoints=endpoints.concat(currentEndpoints);}}
return endpoints;};Wirecloud.wiring.SourceEndpoint=SourceEndpoint;})(Wirecloud.Utils);;(function(utils){"use strict";var TargetEndpoint=function TargetEndpoint(){Wirecloud.wiring.Endpoint.call(this);this.inputs=[];this.connections=[];};utils.inherit(TargetEndpoint,Wirecloud.wiring.Endpoint);TargetEndpoint.prototype.connect=function connect(input,connection){if(!(input instanceof Wirecloud.wiring.SourceEndpoint)){throw new TypeError('Invalid source endpoint');}
input.connect(this,connection);};TargetEndpoint.prototype.disconnect=function disconnect(input){if(!(input instanceof Wirecloud.wiring.SourceEndpoint)){throw new TypeError('Invalid source endpoint');}
input.disconnect(this);};TargetEndpoint.prototype.propagate=function propagate(data,options){};TargetEndpoint.prototype._addInput=function _addInput(input,connection){this.inputs.push(input);this.connections.push(connection);};TargetEndpoint.prototype._removeInput=function _removeInput(input,connection){var index=this.inputs.indexOf(input);this.inputs.splice(index,1);this.connections.splice(index,1);};TargetEndpoint.prototype.fullDisconnect=function fullDisconnect(){var inputs=this.inputs.slice(0);for(var i=0;i<inputs.length;++i){inputs[i].disconnect(this);}};Wirecloud.wiring.TargetEndpoint=TargetEndpoint;})(Wirecloud.Utils);;(function(ns,se,utils){"use strict";var GhostSourceEndpoint=function GhostSourceEndpoint(entity,endpoint){Object.defineProperties(this,{id:{value:entity.meta.type+'/'+entity.id+'/'+endpoint},component:{value:entity},name:{value:endpoint},label:{value:endpoint},description:{value:''},friendcode:{value:''},missing:{value:true}});ns.SourceEndpoint.call(this);};utils.inherit(GhostSourceEndpoint,ns.SourceEndpoint,{propagate:function propagate(){},toString:function toString(){return this.id;},toJSON:function toJSON(){return{type:this.component.meta.type,id:this.component.id,endpoint:this.name};}});Wirecloud.wiring.GhostSourceEndpoint=GhostSourceEndpoint;var GhostTargetEndpoint=function GhostTargetEndpoint(entity,endpoint){Object.defineProperties(this,{id:{value:entity.meta.type+'/'+entity.id+'/'+endpoint},component:{value:entity},name:{value:endpoint},label:{value:endpoint},description:{value:''},friendcode:{value:''},missing:{value:true}});ns.TargetEndpoint.call(this);};utils.inherit(GhostTargetEndpoint,Wirecloud.wiring.TargetEndpoint,{propagate:function propagate(){},toString:function toString(){return this.id;},toJSON:function toJSON(){return{type:this.component.meta.type,id:this.component.id,endpoint:this.name};}});Wirecloud.wiring.GhostTargetEndpoint=GhostTargetEndpoint;})(Wirecloud.wiring,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.Operator=function Operator(wiring,meta,data){se.ObjectWithEvents.call(this,['change','load','remove','unload']);if(data==null){throw new TypeError("invalid data parameter");}
data=utils.merge({},ns.Operator.JSON_TEMPLATE,{title:meta.title},data);this.pending_events=[];this.prefCallback=null;this.permissions=utils.merge({close:true,configure:true,rename:true,upgrade:true},data.permissions);privates.set(this,{meta:meta,status:STATUS.CREATED});Object.defineProperties(this,{codeurl:{get:function(){var url=this.meta.codeurl+"#id="+encodeURIComponent(this.id);if('workspaceview'in this.wiring.workspace){url+="&workspaceview="+encodeURIComponent(this.wiring.workspace.workspaceview);}
return url;}},id:{value:data.id},loaded:{get:function(){return privates.get(this).status===STATUS.RUNNING;}},logManager:{value:new Wirecloud.LogManager(wiring.logManager)},meta:{get:function(){return privates.get(this).meta;}},missing:{get:function(){return this.meta.missing;}},title:{get:function(){return this.contextManager.get('title');}},volatile:{value:!!data.volatile},wiring:{value:wiring}});this.contextManager=new Wirecloud.ContextManager(this,{'title':{label:utils.gettext("Title"),description:utils.gettext("Widget's title"),value:data.title}});this.wrapperElement=document.createElement('iframe');this.wrapperElement.className="wc-operator wc-operator-content";this.wrapperElement.setAttribute('type',"application/xhtml+xml");this.wrapperElement.addEventListener('load',on_load.bind(this),true);build_endpoints.call(this);build_prefs.call(this,data.preferences);build_props.call(this,data.properties);this.logManager.log(utils.gettext("Operator created successfully."),Wirecloud.constants.LOGGING.DEBUG_MSG);};ns.Operator.JSON_TEMPLATE={id:"",preferences:{},properties:{},volatile:false};utils.inherit(ns.Operator,se.ObjectWithEvents,{fullDisconnect:function fullDisconnect(){var name;for(name in this.inputs){this.inputs[name].fullDisconnect();}
for(name in this.outputs){this.outputs[name].fullDisconnect();}
return this;},hasEndpoints:function hasEndpoints(){return this.meta.hasEndpoints();},hasPreferences:function hasPreferences(){return this.meta.hasPreferences();},is:function is(component){return this.meta.type===component.meta.type&&this.id===component.id;},isAllowed:function isAllowed(name){if(!(name in this.permissions)){throw new TypeError("invalid name parameter");}
if(!this.volatile){switch(name){case"close":return this.permissions.close&&this.wiring.workspace.isAllowed('edit_wiring');default:return!this.wiring.workspace.restricted&&this.permissions[name];}}else{return this.permissions[name];}},load:function load(){if(privates.get(this).status!==STATUS.CREATED){return this;}
privates.get(this).status=STATUS.LOADING;this.wrapperElement.setAttribute('src',this.codeurl);return this;},registerPrefCallback:function registerPrefCallback(callback){this.prefCallback=callback;return this;},remove:function remove(){this.fullDisconnect();if(this.loaded){on_unload.call(this);}
this.dispatchEvent('remove');return Promise.resolve(this);},showLogs:function showLogs(){var dialog=new Wirecloud.ui.LogWindowMenu(this.logManager,{title:utils.interpolate(utils.gettext("%(operator_title)s's logs"),{operator_title:this.title})});dialog.htmlElement.classList.add("wc-component-logs-modal");dialog.show();return this;},showSettings:function showSettings(){var dialog=new Wirecloud.ui.OperatorPreferencesWindowMenu();dialog.show(this);return this;},toJSON:function toJSON(){var name,preferences={},properties={};for(name in this.preferences){preferences[name]={hidden:this.preferences[name].hidden,readonly:this.preferences[name].readonly,value:this.preferences[name].value};}
for(name in this.properties){properties[name]={hidden:this.properties[name].hidden,readonly:this.properties[name].readonly,value:this.properties[name].value};}
return{id:this.id,name:this.meta.uri,preferences:preferences,properties:properties};},upgrade:function upgrade(meta){var message;if(!is_valid_meta.call(this,meta)){throw new TypeError("invalid meta parameter");}
if(this.meta.uri===meta.uri){return change_meta.call(this,meta);}else{var cmp=meta.version.compareTo(privates.get(this).meta.version);if(cmp>0){message=utils.gettext("The %(type)s was upgraded to v%(version)s successfully.");}else if(cmp<0){message=utils.gettext("The %(type)s was downgraded to v%(version)s successfully.");}else{message=utils.gettext("The %(type)s was replaced using v%(version)s successfully.");}
message=utils.interpolate(message,{type:this.meta.type,version:meta.version.text});return change_meta.call(this,meta).then(()=>{this.logManager.log(message,Wirecloud.constants.LOGGING.INFO_MSG);});}}});var privates=new WeakMap();var STATUS={CREATED:0,LOADING:1,RUNNING:2};var build_endpoints=function build_endpoints(){this.inputs={};this.meta.inputList.forEach(function(endpoint){this.inputs[endpoint.name]=new Wirecloud.wiring.OperatorTargetEndpoint(this,endpoint);},this);this.outputs={};this.meta.outputList.forEach(function(endpoint){this.outputs[endpoint.name]=new Wirecloud.wiring.OperatorSourceEndpoint(this,endpoint);},this);};var build_prefs=function build_prefs(initial_values){this.preferenceList=[];this.preferences={};this.meta.preferenceList.forEach((preference)=>{if(preference.name in initial_values){var pref_data=initial_values[preference.name];this.preferences[preference.name]=new Wirecloud.UserPref(preference,pref_data.readonly,pref_data.hidden,pref_data.value);}else{this.preferences[preference.name]=new Wirecloud.UserPref(preference,false,false,preference.default);}
this.preferenceList.push(this.preferences[preference.name]);});};var build_props=function build_props(initial_values){this.propertyList=[];this.properties={};this.propertyCommiter=new Wirecloud.PropertyCommiter(this);this.meta.propertyList.forEach((property)=>{if(property.name in initial_values){var prop_data=initial_values[property.name];this.properties[property.name]=new Wirecloud.PersistentVariable(property,this.propertyCommiter,prop_data.readonly,prop_data.value);}else{this.properties[property.name]=new Wirecloud.PersistentVariable(property,this.propertyCommiter,false,property.default);}
this.propertyList.push(this.properties[property.name]);});}
var send_pending_event=function send_pending_event(pendingEvent){this.inputs[pendingEvent.endpoint].propagate(pendingEvent.value);};var is_valid_meta=function is_valid_meta(meta){return meta instanceof Wirecloud.wiring.OperatorMeta&&meta.group_id===this.meta.group_id;};var change_meta=function change_meta(meta){var sync_values;var old_value=privates.get(this).meta;privates.get(this).meta=meta;if(!meta.missing){sync_values=Wirecloud.io.makeRequest(Wirecloud.URLs.OPERATOR_VARIABLES_ENTRY.evaluate({workspace_id:this.wiring.workspace.id,operator_id:this.id}),{method:'GET',requestHeaders:{'Accept':'application/json'},}).then((response)=>{if(response.status!==200){return Promise.reject("Unexpected response from server");}
try{return JSON.parse(response.responseText);}catch(e){return Promise.reject("Unexpected response from server");}});}else{sync_values=Promise.resolve({preferences:{},properties:{}});}
return sync_values.then((values)=>{build_endpoints.call(this);build_prefs.call(this,values.preferences);build_props.call(this,values.properties);if(this.loaded){on_unload.call(this);this.load();}
this.dispatchEvent('change',['meta'],{meta:old_value});});};var on_load=function on_load(){if(!this.wrapperElement.hasAttribute('src')){return;}
privates.get(this).status=STATUS.RUNNING;this.wrapperElement.contentDocument.defaultView.addEventListener('unload',on_unload.bind(this),true);if(this.missing){this.logManager.log(utils.gettext("Failed to load operator."),{level:Wirecloud.constants.LOGGING.ERROR_MSG,details:new se.Fragment(utils.gettext("<p>This operator is currently not available. You or an administrator probably uninstalled it.</p><h5>Suggestions:</h5><ul><li>Remove the operator.</li><li>Reinstall the same version of the operator.</li><li>Or install another version of the operator and then use the <em>Upgrade/Downgrade</em> option.</li></ul>"))});}else{this.logManager.log(utils.gettext("Operator loaded successfully."),{level:Wirecloud.constants.LOGGING.INFO_MSG});}
this.dispatchEvent('load');this.pending_events.forEach(send_pending_event,this);this.pending_events=[];};var on_unload=function on_unload(){if(!this.loaded){return;}
privates.get(this).status=STATUS.CREATED;this.prefCallback=null;for(var name in this.inputs){this.inputs[name].callback=null;}
this.logManager.log(utils.gettext("Operator unloaded successfully."),{level:Wirecloud.constants.LOGGING.INFO_MSG});this.logManager.newCycle();this.dispatchEvent('unload');};})(Wirecloud.wiring,StyledElements,StyledElements.Utils);;(function(ns,utils){"use strict";ns.OperatorMeta=function OperatorMeta(description){if(description.type!=='operator'){throw new TypeError('Invalid operator description');}
Wirecloud.MashableApplicationComponent.call(this,description);this.properties={};this.propertyList=[];for(var i=0;i<description.properties.length;i++){var property=new Wirecloud.PersistentVariableDef(description.properties[i]);this.properties[property.name]=property;this.propertyList.push(property);}
Object.freeze(this.properties);Object.freeze(this.propertyList);if(this.missing){this.codeurl=Wirecloud.URLs.MISSING_WIDGET_CODE_ENTRY;}else{this.codeurl=Wirecloud.URLs.OPERATOR_ENTRY.evaluate({vendor:this.vendor,name:this.name,version:this.version.text});}
this.codeurl+="?v="+Wirecloud.contextManager.get('version_hash');Object.freeze(this);};utils.inherit(ns.OperatorMeta,Wirecloud.MashableApplicationComponent);})(Wirecloud.wiring,Wirecloud.Utils);;(function(utils){"use strict";var OperatorSourceEndpoint=function OperatorSourceEndpoint(operator,meta){Object.defineProperties(this,{component:{value:operator},meta:{value:meta},missing:{value:false}});if(meta!=null){Object.defineProperties(this,{name:{value:meta.name},friendcode:{value:meta.friendcode},label:{value:meta.label},description:{value:meta.description?meta.description:""},id:{value:'operator/'+this.component.id+'/'+this.meta.name},});}
Wirecloud.wiring.SourceEndpoint.call(this);};utils.inherit(OperatorSourceEndpoint,Wirecloud.wiring.SourceEndpoint);OperatorSourceEndpoint.prototype.toString=function toString(){return this.id;};OperatorSourceEndpoint.prototype.toJSON=function toJSON(){return{type:this.component.meta.type,id:this.component.id,endpoint:this.name};};Wirecloud.wiring.OperatorSourceEndpoint=OperatorSourceEndpoint;})(Wirecloud.Utils);;(function(utils){"use strict";var OperatorTargetEndpoint=function OperatorTargetEndpoint(operator,meta){Object.defineProperties(this,{component:{value:operator},meta:{value:meta},missing:{value:false}});if(meta!=null){Object.defineProperties(this,{name:{value:meta.name},friendcode:{value:meta.friendcode},label:{value:meta.label},description:{value:meta.description?meta.description:""},id:{value:'operator/'+operator.id+'/'+this.meta.name},});}
this.callback=null;Wirecloud.wiring.TargetEndpoint.call(this);};utils.inherit(OperatorTargetEndpoint,Wirecloud.wiring.TargetEndpoint);OperatorTargetEndpoint.prototype.toString=function toString(){return this.id;};OperatorTargetEndpoint.prototype.toJSON=function toJSON(){return{type:this.component.meta.type,id:this.component.id,endpoint:this.name};};OperatorTargetEndpoint.prototype.getReachableEndpoints=function getReachableEndpoints(){var actionlabel=this.meta.actionlabel,result;if(!actionlabel||actionlabel===''){actionlabel=utils.gettext('Use in %(endpointName)s');actionlabel=utils.interpolate(actionlabel,{endpointName:this.meta.label},true);}
result=this.toJSON();result.actionlabel=actionlabel;return[result];};OperatorTargetEndpoint.prototype.propagate=function propagate(newValue,options){var msg,details;if(!options||is_target_endpoint.call(this,options.targetEndpoints)){if(this.component.loaded){if(this.callback==null){msg=utils.gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=utils.interpolate(msg,{inputendpoint:this.meta.name},true);details=utils.gettext('Operator has not registered a callback for this input endpoint');this.component.logManager.log(msg,{details:details});return;}
try{this.callback.call(this.component,newValue);}catch(error){if(error instanceof Wirecloud.wiring.EndpointTypeError||error instanceof Wirecloud.wiring.EndpointValueError){throw error;}else{msg=utils.gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=utils.interpolate(msg,{inputendpoint:this.meta.name},true);details=this.component.logManager.formatException(error);this.component.logManager.log(msg,{details:details});}}}else{this.component.pending_events.push({'endpoint':this.meta.name,'value':newValue});}}};var is_target_endpoint=function is_target_endpoint(list){var i,target;if(list==null){return true;}
for(i=0;i<list.length;i+=1){target=list[i];if((target.type===this.component.meta.type)&&(target.id===this.component.id)&&(target.endpoint===this.name)){return true;}}
return false;};Wirecloud.wiring.OperatorTargetEndpoint=OperatorTargetEndpoint;})(Wirecloud.Utils);;(function(utils){"use strict";var WidgetSourceEndpoint=function WidgetSourceEndpoint(widget,meta){Object.defineProperties(this,{component:{value:widget},meta:{value:meta},missing:{value:false}});if(meta!=null){Object.defineProperties(this,{name:{value:meta.name},friendcode:{value:meta.friendcode},label:{value:meta.label},description:{value:meta.description?meta.description:""},id:{value:'widget/'+this.component.id+'/'+this.meta.name},});}
Wirecloud.wiring.SourceEndpoint.call(this);};utils.inherit(WidgetSourceEndpoint,Wirecloud.wiring.SourceEndpoint);WidgetSourceEndpoint.prototype.toString=function toString(){return this.id;};WidgetSourceEndpoint.prototype.toJSON=function toJSON(){return{type:this.component.meta.type,id:this.component.id,endpoint:this.name};};Wirecloud.wiring.WidgetSourceEndpoint=WidgetSourceEndpoint;})(Wirecloud.Utils);;(function(utils){"use strict";var WidgetTargetEndpoint=function WidgetTargetEndpoint(widget,meta){Object.defineProperties(this,{component:{value:widget},meta:{value:meta},missing:{value:false}});if(meta!=null){Object.defineProperties(this,{name:{value:meta.name},friendcode:{value:meta.friendcode},label:{value:meta.label},description:{value:meta.description?meta.description:""},id:{value:'widget/'+this.component.id+'/'+this.meta.name},});}
this.callback=null;Wirecloud.wiring.TargetEndpoint.call(this);};utils.inherit(WidgetTargetEndpoint,Wirecloud.wiring.TargetEndpoint);WidgetTargetEndpoint.prototype.toString=function toString(){return this.id;};WidgetTargetEndpoint.prototype.toJSON=function toJSON(){return{type:this.component.meta.type,id:this.component.id,endpoint:this.name};};WidgetTargetEndpoint.prototype.getReachableEndpoints=function getReachableEndpoints(){var result,actionlabel=this.meta.actionlabel;if(!actionlabel||actionlabel===''){actionlabel=utils.gettext('Use in %(endpointName)s');actionlabel=utils.interpolate(actionlabel,{endpointName:this.meta.label},true);}
result=this.toJSON();result.actionlabel=actionlabel;result.iWidgetName=this.component.title;return[result];};WidgetTargetEndpoint.prototype.propagate=function propagate(newValue,options){var msg,details;if(!options||is_target_endpoint.call(this,options.targetEndpoints)){if(this.component.loaded){if(this.callback==null){msg=utils.gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=utils.interpolate(msg,{inputendpoint:this.meta.name},true);details=utils.gettext('Widget has not registered a callback for this input endpoint');this.component.logManager.log(msg,{details:details});return;}
try{this.callback.call(this.component,newValue);}catch(error){if(error instanceof Wirecloud.wiring.EndpointTypeError||error instanceof Wirecloud.wiring.EndpointValueError){throw error;}else{msg=utils.gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=utils.interpolate(msg,{inputendpoint:this.meta.name},true);details=this.component.logManager.formatException(error);this.component.logManager.log(msg,{details:details});}}}else{this.component.pending_events.push({'endpoint':this.meta.name,'value':newValue});this.component.tab.workspace.view.findWidget(this.component.id).load();}}};var is_target_endpoint=function is_target_endpoint(list){var i,target;if(list==null){return true;}
for(i=0;i<list.length;i+=1){target=list[i];if(target.type===this.component.meta.type&&(target.id===this.component.id)&&(target.endpoint===this.name)){return true;}}
return false;};Wirecloud.wiring.WidgetTargetEndpoint=WidgetTargetEndpoint;})(Wirecloud.Utils);;(function(ns){"use strict";ns.KeywordSuggestion=function KeywordSuggestion(){this.endpoints={source:{},target:{}};};ns.KeywordSuggestion.prototype={appendEndpoint:function appendEndpoint(endpoint){if(endpoint.missing){return this;}
endpoint.friendcodeList.forEach(function(friendcode){updateFriendcode.call(this,friendcode,endpoint);},this);return this;},forEachSuggestion:function forEachSuggestion(endpoint,callback){var oppositeType;if(endpoint.missing){return this;}
oppositeType=getOppositeType(endpoint);this._endpointList=[];endpoint.friendcodeList.forEach(function(friendcode){findEndpoint.call(this,endpoint.component,oppositeType,friendcode,callback);},this);delete this._endpointList;return this;},removeEndpoint:function removeEndpoint(endpoint){if(endpoint.missing){return this;}
endpoint.friendcodeList.forEach(function(friendcode){removeFriendcode.call(this,friendcode,endpoint);},this);return this;},empty:function empty(){this.endpoints={source:{},target:{}};return this;}};var findEndpoint=function findEndpoint(component,type,friendcode,callback){if(!(friendcode in this.endpoints[type])){return this;}
this.endpoints[type][friendcode].forEach(function(endpoint){if(!endpoint.component.equals(component)&&(this._endpointList.indexOf(endpoint)<0)){callback(endpoint);this._endpointList.push(endpoint);}},this);return this;};var getOppositeType=function getOppositeType(endpoint){return endpoint.type==='source'?'target':'source';};var removeFriendcode=function removeFriendcode(friendcode,endpoint){var list=this.endpoints[endpoint.type][friendcode];list.splice(list.indexOf(endpoint),1);if(!list.length){delete this.endpoints[endpoint.type][friendcode];}
return this;};var updateFriendcode=function updateFriendcode(friendcode,endpoint){if(!(friendcode in this.endpoints[endpoint.type])){this.endpoints[endpoint.type][friendcode]=[];}
this.endpoints[endpoint.type][friendcode].push(endpoint);return this;};})(Wirecloud.wiring);;(function(utils){"use strict";var WorkspaceListItems=function(handler){StyledElements.DynamicMenuItems.call(this);this.handler=handler;};WorkspaceListItems.prototype=new StyledElements.DynamicMenuItems();WorkspaceListItems.prototype.build=function(){var workspace_name,items,workspace,username,user_workspaces;items=[];username=Wirecloud.contextManager.get('username');user_workspaces=Wirecloud.workspacesByUserAndName[username];if(user_workspaces==null||Object.keys(user_workspaces).length===0){items.push(new StyledElements.MenuItem(utils.gettext('Empty workspace list'),this.handler,null));items[0].disable();return items;}
for(workspace_name in user_workspaces){workspace=user_workspaces[workspace_name];items.push(new StyledElements.MenuItem(workspace.title,this.handler,workspace));}
return items;};Wirecloud.ui.WorkspaceListItems=WorkspaceListItems;})(Wirecloud.Utils);;(function(ns,se,utils){"use strict";ns.WorkspaceViewMenuItems=function WorkspaceViewMenuItems(workspace){se.DynamicMenuItems.call(this);Object.defineProperties(this,{workspace:{value:workspace}});};utils.inherit(ns.WorkspaceViewMenuItems,se.DynamicMenuItems,{build:function build(){var item,items;items=[];item=new se.MenuItem(utils.gettext("New workspace"),function(){(new Wirecloud.ui.NewWorkspaceWindowMenu()).show();}.bind(this.workspace));item.addIconClass("fa fa-plus");items.push(item);item=new se.MenuItem(utils.gettext("Rename"),function(){(new Wirecloud.ui.RenameWindowMenu(this,utils.gettext('Rename Workspace'))).show();}.bind(this.workspace));item.addIconClass("fa fa-pencil");item.setDisabled(!this.workspace.model.isAllowed('rename'));items.push(item);item=new se.MenuItem(utils.gettext("Share"),function(){(new Wirecloud.ui.SharingWindowMenu(this)).show();}.bind(this.workspace));item.addIconClass("fa fa-share");items.push(item);item=new se.MenuItem(utils.gettext("Upload to my resources"),function(){Wirecloud.UserInterfaceManager.views.marketplace.waitMarketListReady({onComplete:function(){var dialog=new Wirecloud.ui.PublishWorkspaceWindowMenu(this);dialog.show();}.bind(this)});}.bind(this.workspace));item.addIconClass("fa fa-archive");items.push(item);item=new se.MenuItem(utils.gettext("Embed"),function(){(new Wirecloud.ui.EmbedCodeWindowMenu(utils.gettext("Embed Code"),this)).show();}.bind(this.workspace));item.addIconClass("fa fa-code");items.push(item);item=new se.MenuItem(utils.gettext("Settings"),function(){this.showSettings();}.bind(this.workspace));item.addIconClass("fa fa-cog");item.setDisabled(!this.workspace.model.isAllowed('update_preferences'));items.push(item);item=new se.MenuItem(utils.gettext("Remove"),function(){this.remove();}.bind(this.workspace));item.addIconClass("fa fa-trash");item.setDisabled(!this.workspace.model.isAllowed('remove'));items.push(item);return items;}});})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(utils){"use strict";var builder=new StyledElements.GUIBuilder();var MACSearch=function MACSearch(options){options=utils.merge({'extra_template_context':null,'scope':'','template':'wirecloud/macsearch/base',resource_painter:null},options);StyledElements.StyledElement.call(this,['search']);this.info_template=builder.DEFAULT_OPENING+'<div class="alert alert-info"><t:message/></div>'+builder.DEFAULT_CLOSING;this.error_template=builder.DEFAULT_OPENING+'<div class="alert alert-error"><t:message/></div>'+builder.DEFAULT_CLOSING;var priv={request:null,list:new StyledElements.Container({class:'wc-macsearch-list wc-resource-results loading'})};privates.set(this,priv);this.resource_painter=options.resource_painter;var input;var template=Wirecloud.currentTheme.templates[options.template];this.wrapperElement=builder.parse(template,utils.merge({searchinput:function(){input=new StyledElements.TextField({class:"se-field-search",'placeholder':utils.gettext('Keywords...')});input.addEventListener('keydown',_onSearchInputKeyPress.bind(this));input.addEventListener('change',_onSearchInput.bind(this));return input;}.bind(this),list:priv.list},options.extra_template_context)).elements[1];if(this.wrapperElement instanceof StyledElements.StyledElement){this.wrapperElement=this.wrapperElement.get();}
Object.defineProperties(this,{'inputField':{value:input},'search_scope':{value:options.scope,writable:true},'resourceButtonIconClass':{value:options.resourceButtonIconClass},'resourceButtonListener':{value:options.resourceButtonListener},'resourceButtonTooltip':{value:options.resourceButtonTooltip}});this.input=input;};utils.inherit(MACSearch,StyledElements.StyledElement);MACSearch.prototype.paintInfo=function paintInfo(message,context){if(context!=null){message=builder.parse(builder.DEFAULT_OPENING+message+builder.DEFAULT_CLOSING,context);}
return builder.parse(this.info_template,{'message':message});};MACSearch.prototype.paintError=function paintError(message){return builder.parse(this.error_template,{'message':message});};MACSearch.prototype.clear=function clear(){privates.get(this).list.clear();};MACSearch.prototype.repaint=function repaint(){privates.get(this).list.repaint();};MACSearch.prototype.refresh=function refresh(){_keywordTimeoutHandler.call(this,this.input);};MACSearch.prototype.focus=function focus(){this.inputField.focus();};var privates=new WeakMap();var _search=function _search(keywords){var priv=privates.get(this);if(priv.request!=null){priv.request.abort("User input",true);}
priv.list.disable();this.dispatchEvent('search');priv.request=Wirecloud.LocalCatalogue.search({scope:this.search_scope,search_criteria:keywords}).then((search_info)=>{on_search_success.call(this,keywords,search_info.resources,search_info);},(error)=>{var msg=utils.gettext("Connection error: No resource retrieved");_load_resource_painter.call(this);priv.list.clear().appendChild(this.paintError(msg));return Promise.resolve();}).then(()=>{priv.request=null;priv.list.enable();});};var _load_resource_painter=function _load_resource_painter(){if(this.resource_painter==null){this.resource_painter=new Wirecloud.ui.ResourcePainter(null,Wirecloud.currentTheme.templates['wirecloud/macsearch/component'],null,{'mainbutton':function(options,context,resource){var tooltip=this.resourceButtonTooltip;if(typeof tooltip==='function'){tooltip=tooltip(resource);}
var button=new StyledElements.Button({'class':'mainbutton btn-primary','iconClass':this.resourceButtonIconClass,'title':tooltip});button.addEventListener('click',this.resourceButtonListener.bind(null,resource));return button;}.bind(this)});}};var _keywordTimeoutHandler=function _keywordTimeoutHandler(input){privates.get(this).search_timeout=null;_search.call(this,input.value);};var _onSearchInput=function _onSearchInput(input){var priv=privates.get(this);if(priv.search_timeout!==null){clearTimeout(priv.search_timeout);}
priv.search_timeout=setTimeout(_keywordTimeoutHandler.bind(this,input),700);};var _onSearchInputKeyPress=function _onSearchInputKeyPress(input,modifiers,key){if(key==="Enter"){var priv=privates.get(this);if(priv.search_timeout!==null){clearTimeout(priv.search_timeout);}
_keywordTimeoutHandler.call(this,input);}};var on_search_success=function on_search_success(keywords,components,search_info){var msg,priv=privates.get(this);_load_resource_painter.call(this);priv.list.clear();if(search_info.total_count!==0){if('corrected_query'in search_info){msg=utils.gettext("<p>Showing results for <b><t:corrected_query/></b></p>");priv.list.appendChild(this.paintInfo(msg,{corrected_query:search_info.corrected_query}));}
components.forEach(function(component){try{component.version=new Wirecloud.Version(component.version);component.others=component.others.map(function(version){return new Wirecloud.Version(version);});priv.list.appendChild(this.resource_painter.paint(component));}catch(e){}},this);}else{if(keywords!==""){msg=utils.gettext("<p>We couldn't find anything for your search - <b>%(keywords)s.</b></p><p>Suggestions:</p><ul><li>Make sure all words are spelled correctly.</li><li>Try different keywords.</li><li>Try more general keywords.</li></ul>");msg=utils.interpolate(msg,{keywords:utils.escapeHTML(keywords.trim())},true);}else if(this.search_scope!==''){msg=utils.gettext("<p>Currently, you do not have access to any %(scope)s component. You can get components using the Marketplace view or by uploading components manually using the Upload button on the My Resources view.</p>");msg=utils.interpolate(msg,{scope:this.search_scope},true);}else{msg=utils.gettext("<p>Currently, you do not have access to any component. You can get components using the Marketplace view or by uploading components manually using the Upload button on the My Resources view.</p>");}
priv.list.appendChild(this.paintError(new StyledElements.Fragment(msg)));}};Wirecloud.ui.MACSearch=MACSearch;})(Wirecloud.Utils);;(function(ns,se,utils){"use strict";ns.ComponentSidebar=function ComponentSidebar(){se.StyledElement.call(this,['add','create']);this.components={mashup:{},widget:{}};this.groups={};this.mashupButton=new se.ToggleButton({class:'btn-list-mashup-group wc-filter-type-mashup',state:'primary',text:utils.gettext('Mashups')});this.mashupButton.addEventListener('click',function(){this.mashupButton.active=true;this.widgetButton.active=false;this.searchComponents.search_scope='mashup';this.searchComponents.refresh();}.bind(this));this.widgetButton=new se.ToggleButton({class:'btn-list-widget-group wc-filter-type-widget',state:'primary',text:utils.gettext('Widgets')});this.widgetButton.addEventListener('click',function(){this.mashupButton.active=false;this.widgetButton.active=true;this.searchComponents.search_scope='widget';this.searchComponents.refresh();}.bind(this));var resource_painter={paint:function paint(group){var id;group=new ns.WiringEditor.ComponentGroup(group,this.searchComponents.search_scope==="widget"?utils.gettext("Add to workspace"):utils.gettext("Merge"));group.addEventListener('btncreate.click',createcomponent_onclick.bind(this));if(this.components.mashup[group.id]!=null){for(id in this.components.mashup[group.id]){group.addComponent(this.components.mashup[group.id][id]);}}
if(this.components.widget[group.id]!=null){for(id in this.components.widget[group.id]){group.addComponent(this.components.widget[group.id][id]);}}
this.groups[group.id]=group;return group;}.bind(this)};this.searchComponents=new Wirecloud.ui.MACSearch({template:'wirecloud/component_sidebar',extra_template_context:{typebuttons:new se.Fragment([this.mashupButton,this.widgetButton])},scope:'widget',resource_painter:resource_painter});this.searchComponents.addEventListener('search',clearAll.bind(this));this.widgetButton.active=true;this.wrapperElement=this.searchComponents.get();this.wrapperElement.classList.add("wc-resource-list");};utils.inherit(ns.ComponentSidebar,se.StyledElement,{addComponent:function addComponent(wiringComponent){var group_id=wiringComponent.meta.group_id,type=wiringComponent.meta.type;if(!(group_id in this.components[type])){this.components[type][group_id]={};}
var component=new ns.WiringEditor.Component(wiringComponent);component.addEventListener('click',function(){this.dispatchEvent('add',component);}.bind(this));this.components[type][group_id][component.id]=component;if(group_id in this.groups){this.groups[group_id].addComponent(component);}
return component;},clear:function clear(){this.searchComponents.clear();this.components={mashup:{},widget:{}};return this;},findComponent:function findComponent(type,id){var group_id;for(group_id in this.components[type]){if(id in this.components[type][group_id]){return this.components[type][group_id][id];}}
return null;},forEachComponent:function forEachComponent(callback){var type,id,group_id;for(type in this.components){for(group_id in this.components[type]){for(id in this.components[type][group_id]){callback(this.components[type][group_id][id]);}}}
return this;},removeComponent:function removeComponent(component){var group_id=component.meta.group_id;this.components[component.meta.type][group_id][component.id].remove();delete this.components[component.meta.type][group_id][component.id];return this;}});var clearAll=function clearAll(){this.groups={};};var createcomponent_onclick=function createcomponent_onclick(group,button){this.dispatchEvent('create',group,button);};})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";var WorkspaceView=function WorkspaceView(id,options){StyledElements.Alternative.call(this,id,options);this.wrapperElement.classList.add("wc-workspace");this.wsMenu=new StyledElements.PopupMenu();this.wsMenu.append(new Wirecloud.ui.WorkspaceListItems(function(context,workspace){Wirecloud.UserInterfaceManager.monitorTask(Wirecloud.changeActiveWorkspace(workspace));}));this.wsMenu.appendSeparator();this.wsMenu.append(new Wirecloud.ui.WorkspaceViewMenuItems(this));this.walletButton=this.buildAddWidgetButton();this.wiringButton=new StyledElements.Button({class:"wc-show-wiring-button",iconClass:'fa fa-puzzle-piece',title:utils.gettext('Wiring')});this.wiringButton.addEventListener('click',function(){Wirecloud.UserInterfaceManager.changeCurrentView('wiring');});this.myresourcesButton=new StyledElements.Button({iconClass:'fa fa-archive',class:"wc-show-myresources-button",title:utils.gettext('My Resources')});this.myresourcesButton.addEventListener('click',function(){Wirecloud.UserInterfaceManager.changeCurrentView('myresources');});this.marketButton=new StyledElements.Button({iconClass:'fa fa-shopping-cart',class:"wc-show-marketplace-button",title:utils.gettext('Get more components')});this.marketButton.addEventListener('click',function(){Wirecloud.UserInterfaceManager.changeCurrentView('marketplace');});this.layout=new StyledElements.OffCanvasLayout();this.appendChild(this.layout);Object.defineProperties(this,{activeTab:{get:function(){return this.notebook.getVisibleTab();}},tabs:{get:function(){return this.notebook.tabs;}},name:{get:function(){return this.model.name;}},title:{get:function(){return this.model.title;}},widgets:{get:function(){return get_widgets.call(this);}}});this.on_workspace_change_bound=on_workspace_change.bind(this);this.on_workspace_remove_bound=on_workspace_remove.bind(this);this.on_workspace_unload_bound=on_workspace_unload.bind(this);Wirecloud.addEventListener('loaded',function(){this.showcase=new Wirecloud.ui.ComponentSidebar();this.layout.appendChild(this.showcase);this.showcase.addEventListener('create',function(showcase,group,button){button.disable();if(group.meta.type==='widget'){this.activeTab.createWidget(group.meta).then(function(){button.enable();});}else{Wirecloud.UserInterfaceManager.monitorTask(Wirecloud.mergeWorkspace(this.model,{mashup:group.meta.uri}).then((workspace)=>{return Wirecloud.changeActiveWorkspace(workspace);},(error)=>{button.enable();var dialog;if(error.details!=null&&'missingDependencies'in error.details){dialog=new Wirecloud.ui.MissingDependenciesWindowMenu(null,error.details);}else{dialog=new Wirecloud.ui.MessageWindowMenu(error,Wirecloud.constants.LOGGING.ERROR_MSG);}
dialog.show();}));}}.bind(this));}.bind(this));};utils.inherit(WorkspaceView,StyledElements.Alternative);WorkspaceView.prototype.view_name='workspace';WorkspaceView.prototype.findTab=function findTab(id){var i;for(i=0;i<this.notebook.tabs.length;i++){if(this.notebook.tabs[i].id===id){return this.notebook.tabs[i];}}
return null;};WorkspaceView.prototype.findWidget=function findWidget(id){var i,widget;for(i=0;i<this.notebook.tabs.length;i++){widget=this.notebook.tabs[i].findWidget(id);if(widget!=null){return widget;}}
return null;};WorkspaceView.prototype.showSettings=function showSettings(){(new Wirecloud.ui.PreferencesWindowMenu('workspace',this.model.preferences)).show();return this;};WorkspaceView.prototype.loadWorkspace=function loadWorkspace(workspace,options){var loadingTab;options=utils.merge({initialtab:null},options);this.walletButton.active=false;this.notebook=new StyledElements.Notebook({'class':'se-notebook-bottom'});this.notebook.appendTo(this.layout.content);loadingTab=this.notebook.createTab();loadingTab.disable();loadingTab.addClassName('loading');this.model=workspace;this.model.view=this;this.model.addEventListener('unload',this.on_workspace_unload_bound);this.model.addEventListener('change',this.on_workspace_change_bound);this.model.addEventListener('remove',this.on_workspace_remove_bound);this.model.operators.forEach(function(operator){this.layout.content.appendChild(operator.wrapperElement);},this);var initialTab=null;var requestedTab=null;this.model.tabs.forEach(function(model){var tab=this.notebook.createTab({tab_constructor:Wirecloud.ui.WorkspaceTabView,model:model,workspace:this});if(options.initialtab===model.name){requestedTab=tab;}
if(model.initial){initialTab=tab;}},this);if(requestedTab!=null){this.notebook.goToTab(requestedTab);}else{this.notebook.goToTab(initialTab);}
this.notebook.removeTab(loadingTab);if(this.model.isAllowed('edit')){var button=new StyledElements.Button({title:utils.gettext("New tab"),iconClass:"fa fa-plus",class:"wc-create-workspace-tab"});this.notebook.addButton(button);button.addEventListener('click',on_click_createtab.bind(this));}
if(Wirecloud.Utils.isFullscreenSupported()){this.fullscreenButton=new StyledElements.Button({iconClass:'fa fa-expand',title:utils.gettext('Full screen')});this.notebook.addButton(this.fullscreenButton);Wirecloud.Utils.onFullscreenChange(this.notebook,function(){this.fullscreenButton.removeIconClassName(['fa-expand','fa-compress']);if(this.notebook.fullscreen){this.fullscreenButton.addIconClassName('fa-compress');this.fullscreenButton.setTitle(utils.gettext('Exit full screen'));this.notebook.addClassName('fullscreen');}else{this.fullscreenButton.addIconClassName('fa-expand');this.fullscreenButton.setTitle(utils.gettext('Full screen'));this.notebook.removeClassName('fullscreen');}}.bind(this));this.fullscreenButton.addEventListener('click',function(){if(this.notebook.fullscreen){this.notebook.exitFullscreen();}else{this.notebook.requestFullscreen();}}.bind(this));}
if(Wirecloud.contextManager.get('mode')==='embedded'){this.seeOnWirecloudButton=new StyledElements.Button({'class':'powered-by-wirecloud'});this.notebook.addButton(this.seeOnWirecloudButton);this.seeOnWirecloudButton.addEventListener('click',function(){var url=Wirecloud.URLs.WORKSPACE_VIEW.evaluate({owner:encodeURIComponent(this.model.owner),name:encodeURIComponent(this.model.name)});window.open(url,'_blank');}.bind(this));}else{this.poweredByWirecloudButton=new StyledElements.Button({'class':'powered-by-wirecloud'});this.notebook.addButton(this.poweredByWirecloudButton);this.poweredByWirecloudButton.addEventListener('click',function(){window.open('http://conwet.fi.upm.es/wirecloud/','_blank');});}
this.model.addEventListener('createoperator',function(workspace_model,operator){this.layout.content.appendChild(operator.wrapperElement);}.bind(this));this.model.addEventListener('removeoperator',function(workspace_model,operator){this.layout.content.removeChild(operator.wrapperElement);}.bind(this));};WorkspaceView.prototype.buildAddWidgetButton=function buildAddWidgetButton(){var button=new se.ToggleButton({title:utils.gettext("Add components"),class:"btn-primary wc-show-component-sidebar-button",iconClass:"fa fa-archive",stackedIconClass:"fa fa-plus-circle"});button.addEventListener('click',function(button){if(button.active){this.showcase.searchComponents.refresh();this.layout.slideIn();}else{this.layout.slideOut();}}.bind(this));return button;};WorkspaceView.prototype.buildStateData=function buildStateData(){var currentState=Wirecloud.HistoryManager.getCurrentState();return{workspace_owner:currentState.workspace_owner,workspace_name:currentState.workspace_name,view:'workspace'};};WorkspaceView.prototype.canGoUp=function canGoUp(){return Wirecloud.activeWorkspace!=null&&(Wirecloud.activeWorkspace.owner!=="wirecloud"||Wirecloud.activeWorkspace.name!=="home");};WorkspaceView.prototype.goUp=function goUp(){Wirecloud.changeActiveWorkspace({owner:'wirecloud',name:'home'});};WorkspaceView.prototype.getBreadcrumb=function getBreadcrumb(){var entries,current_state;current_state=Wirecloud.HistoryManager.getCurrentState();if(Wirecloud.activeWorkspace!=null){entries=[{'label':Wirecloud.activeWorkspace.owner},{'label':Wirecloud.activeWorkspace.title,}];}else if('workspace_owner'in current_state){entries=[{'label':current_state.workspace_owner},{'label':current_state.workspace_title,}];}else{entries=[{'label':utils.gettext('loading...')}];}
return entries;};WorkspaceView.prototype.getTitle=function getTitle(){var current_state=Wirecloud.HistoryManager.getCurrentState();if(Wirecloud.activeWorkspace!=null){return Wirecloud.activeWorkspace.owner+'/'+Wirecloud.activeWorkspace.name;}else if('workspace_owner'in current_state){return current_state.workspace_owner+'/'+current_state.workspace_name;}else{return utils.gettext('loading...');}};WorkspaceView.prototype.getToolbarMenu=function getToolbarMenu(){var context,current_state;current_state=Wirecloud.HistoryManager.getCurrentState();if('workspace_owner'in current_state){context=Wirecloud.contextManager;if(context&&context.get('username')!=='anonymous'){return this.wsMenu;}}
return null;};WorkspaceView.prototype.getToolbarButtons=function getToolbarButtons(){if(Wirecloud.contextManager&&Wirecloud.contextManager.get('username')!=='anonymous'){this.walletButton.setDisabled(Wirecloud.activeWorkspace==null||!Wirecloud.activeWorkspace.isAllowed('edit'));this.wiringButton.setDisabled(Wirecloud.activeWorkspace==null||!Wirecloud.activeWorkspace.isAllowed('edit'));return[this.walletButton,this.wiringButton,this.myresourcesButton,this.marketButton];}else{return[];}};WorkspaceView.prototype.onHistoryChange=function onHistoryChange(newState){var target_tab,nextWorkspace,alert_msg;nextWorkspace=Wirecloud.workspacesByUserAndName[newState.workspace_owner][newState.workspace_name];if(nextWorkspace==null){if(Wirecloud.activeWorkspace!=null){Wirecloud.activeWorkspace.unload();Wirecloud.activeWorkspace=null;}
alert_msg=document.createElement('div');alert_msg.className='alert alert-info';alert_msg.textContent=utils.gettext('The requested workspace is no longer available (it was deleted).');this.clear();this.appendChild(alert_msg);Wirecloud.dispatchEvent('viewcontextchanged');}else if(Wirecloud.activeWorkspace==null||(nextWorkspace.id!==Wirecloud.activeWorkspace.id)){Wirecloud.changeActiveWorkspace(nextWorkspace,{initialtab:newState.tab,history:'ignore'});}else if(newState.tab!=null){target_tab=get_tab_by_id.call(this,newState.tab_id);this.notebook.goToTab(target_tab);document.title=newState.workspace_owner+'/'+newState.workspace_name;}else{document.title=newState.workspace_owner+'/'+newState.workspace_name;}};WorkspaceView.prototype.rename=function rename(name){return this.model.rename(name);};WorkspaceView.prototype.remove=function remove(){return new Promise(function(resolve,reject){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(utils.interpolate(utils.gettext('Do you really want to remove the "%(name)s" workspace?'),{name:this.title}));dialog.setHandler(function(){this.model.remove().then(function(){resolve();},function(reason){reject(reason);});}.bind(this));dialog.show();}.bind(this));};WorkspaceView.prototype.publish=function publish(data){return this.model.publish(data);};WorkspaceView.prototype.drawAttention=function drawAttention(id){var widget=this.findWidget(id);if(widget!==null){this.highlightTab(widget.tab);widget.tab.dragboard.raiseToTop(widget);widget.highlight();}};WorkspaceView.prototype.highlightTab=function highlightTab(tab){if(typeof tab==='string'){tab=this.findTab(tab);}
tab.tabElement.classList.add("highlight");};WorkspaceView.prototype.unhighlightTab=function unhighlightTab(tab){if(typeof tab==='string'){tab=this.findTab(tab);}
tab.tabElement.classList.remove("highlight");};var get_widgets=function get_widgets(){return Array.prototype.concat.apply([],this.notebook.tabs.map(function(tab){return tab.widgets;}));};var on_workspace_change=function on_workspace_change(workspace){var state;state={workspace_owner:this.model.owner,workspace_name:this.model.name,workspace_title:this.model.title,view:"workspace",tab:Wirecloud.HistoryManager.getCurrentState().tab};Wirecloud.HistoryManager.replaceState(state);Wirecloud.UserInterfaceManager.header.refresh();};var on_workspace_remove=function on_workspace_remove(workspace){Wirecloud.changeActiveWorkspace({owner:'wirecloud',name:'home'});};var on_workspace_unload=function on_workspace_unload(workspace){if(this.model===workspace){this.layout.content.clear();}
workspace.removeEventListener('remove',this.on_workspace_remove_bound);workspace.removeEventListener('change',this.on_workspace_change_bound);};var on_click_createtab=function on_click_createtab(button){button.disable();this.model.createTab().then(function(tab){this.notebook.createTab({tab_constructor:Wirecloud.ui.WorkspaceTabView,model:tab,workspace:this});button.enable();}.bind(this),function(){button.enable();});};var get_tab_by_id=function get_tab_by_id(id){for(var i=0;i<this.notebook.tabs.length;i++){if(this.tabs[i].id===id){return this.tabs[i];}}
return null;};Wirecloud.ui.WorkspaceView=WorkspaceView;})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.WorkspaceTabView=function WorkspaceTabView(id,notebook,options){var model=options.model,workspace=options.workspace;se.Tab.call(this,id,notebook,{closable:false,name:model.title});privates.set(this,{widgets:[],on_changetab:on_changetab.bind(this),on_createwidget:on_createwidget.bind(this),on_removetab:on_removetab.bind(this),on_removewidget:on_removewidget.bind(this)});Object.defineProperties(this,{id:{value:model.id},logManager:{value:new Wirecloud.LogManager(Wirecloud.GlobalLogManager)},model:{value:model},name:{get:function(){return this.model.name;}},title:{get:function(){return this.model.title;}},widgets:{get:function(){return privates.get(this).widgets.slice(0);}},widgetsById:{get:function(){return get_widgets_by_id.call(this);}},workspace:{value:workspace}});this.tabElement.classList.add("wc-workspace-tab");this.tabElement.setAttribute('data-id',this.id);this.tabElement.setAttribute('data-name',this.name);this.wrapperElement.classList.add("wc-workspace-tab-content");this.wrapperElement.setAttribute('data-id',this.id);if(!this.workspace.model.restricted){var button=new se.PopupButton({title:utils.gettext("Preferences"),class:'icon-tab-menu',plain:true,menuOptions:{position:['top-left','top-right']}});button.popup_menu.append(new ns.WorkspaceTabViewMenuItems(this));button.insertInto(this.tabElement);}
this.dragboard=new ns.WorkspaceTabViewDragboard(this);this.initialMessage=(new se.GUIBuilder()).parse(Wirecloud.currentTheme.templates['wirecloud/workspace/empty_tab_message'],{button:this.workspace.buildAddWidgetButton.bind(this.workspace),tutorials:Wirecloud.TutorialCatalogue.buildTutorialReferences(['basic-concepts'])}).children[1];this.appendChild(this.initialMessage);this.model.preferences.addEventListener('pre-commit',on_change_preferences.bind(this));this.model.widgets.forEach(_create_widget,this);this.model.addEventListener('change',privates.get(this).on_changetab);this.model.addEventListener('createwidget',privates.get(this).on_createwidget);this.model.addEventListener('remove',privates.get(this).on_removetab);this.model.addEventListener('removewidget',privates.get(this).on_removewidget);};utils.inherit(ns.WorkspaceTabView,se.Tab,{createWidget:function createWidget(resource,options){var layout,position;options=utils.merge({commit:true,height:resource.default_height,layout:this.model.preferences.get('initiallayout')==="Free"?1:0,width:resource.default_width},options);layout=options.layout===1?this.dragboard.freeLayout:this.dragboard.baseLayout;options.left=options.left!=null?layout.adaptColumnOffset(options.left).inLU:undefined;options.top=options.top!=null?layout.adaptRowOffset(options.top).inLU:undefined;options.height=clean_number(layout.adaptHeight(options.height).inLU,0,layout.rows);options.width=clean_number(layout.adaptWidth(options.width).inLU,0,layout.columns);if(options.left==null||options.top==null){if("_searchFreeSpace"in layout){position=layout._searchFreeSpace(options.width,options.height);options.left=position.x;options.top=position.y;}else{options.left="0";options.top="0";}}
if(!options.commit){return this.findWidget(this.model.createWidget(resource,options).id);}
return new Promise(function(resolve,reject){this.model.createWidget(resource,options).then(function(model){resolve(this.findWidget(model.id));}.bind(this),function(reason){reject(reason);});}.bind(this));},findWidget:function findWidget(id){return this.widgetsById[id];},remove:function remove(){if(privates.get(this).widgets.length){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(utils.gettext("The tab's widgets will also be removed. Would you like to continue?"));dialog.setHandler(function(){_remove.call(this);}.bind(this));dialog.show();}else{_remove.call(this);}
return this;},rename:function rename(name){return this.model.rename(name).catch((reason)=>{this.logManager.log(reason);return Promise.reject(reason);});},repaint:function repaint(){this.dragboard.paint();this.dragboard._notifyWindowResizeEvent();return this;},setInitial:function setInitial(){return this.model.setInitial();},show:function show(){se.Tab.prototype.show.call(this);this.widgets.forEach(function(widget){widget.load();});return this.repaint();},showSettings:function showSettings(){(new Wirecloud.ui.PreferencesWindowMenu('tab',this.model.preferences)).show();return this;}});var privates=new WeakMap();var _create_widget=function _create_widget(model){var widget=new Wirecloud.ui.WidgetView(this,model);privates.get(this).widgets.push(widget);this.initialMessage.hidden=this.widgets.length>0;return widget;};var _remove=function _remove(){this.model.remove();};var clean_number=function clean_number(value,min,max){if(typeof value!=='number'||value<min){return min;}
return value>max?max:value;};var get_widgets_by_id=function get_widgets_by_id(){var widgets={};privates.get(this).widgets.forEach(function(widget){widgets[widget.id]=widget;});return widgets;};var on_change_preferences=function on_change_preferences(preferences,modifiedValues){if('baselayout'in modifiedValues){this.dragboard._updateBaseLayout();}};var on_changetab=function on_changetab(tab,changes){if(changes.indexOf('title')!==-1){se.Tab.prototype.rename.call(this,tab.title);}
if(changes.indexOf('name')!==-1&&!this.hidden){this.tabElement.setAttribute('data-name',this.name);var currentState=Wirecloud.HistoryManager.getCurrentState();var newState=utils.merge({},currentState,{tab:tab.name});Wirecloud.HistoryManager.replaceState(newState);}};var on_createwidget=function on_createwidget(tab,model){var widget=_create_widget.call(this,model);if(!this.hidden){widget.load();}};var on_removetab=function on_removetab(model){se.Tab.prototype.close.call(this);};var on_removewidget=function on_removewidget(widget){privates.get(this).widgets.splice(privates.get(this).widgets.indexOf(widget),1);this.initialMessage.hidden=this.widgets.length>0;};})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.WorkspaceTabViewMenuItems=function WorkspaceTabViewMenuItems(tab){se.DynamicMenuItems.call(this);Object.defineProperties(this,{tab:{value:tab}});};utils.inherit(ns.WorkspaceTabViewMenuItems,se.DynamicMenuItems,{build:function build(){var item,items;items=[];item=new se.MenuItem(utils.gettext("Rename"),function(){(new Wirecloud.ui.RenameWindowMenu(this,utils.gettext('Rename Workspace Tab'))).show();}.bind(this.tab));item.addIconClass("fa fa-pencil");items.push(item);item=new se.MenuItem(utils.gettext("Set as initial"),function(){this.setInitial();}.bind(this.tab));item.addIconClass("fa fa-home");item.setDisabled(this.tab.model.initial);items.push(item);item=new se.MenuItem(utils.gettext("Settings"),function(){this.showSettings();}.bind(this.tab));item.addIconClass("fa fa-cog");items.push(item);item=new se.MenuItem(utils.gettext("Remove"),function(){this.remove();}.bind(this.tab));item.addIconClass("fa fa-trash");item.setDisabled(!this.tab.model.isAllowed('remove'));items.push(item);return items;}});})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(ns){"use strict";var WorkspaceTabViewDragboard=function WorkspaceTabViewDragboard(tab){Object.defineProperties(this,{tab:{value:tab},widgets:{value:[]}});this.scrollbarSpace=17;this.dragboardWidth=800;this.dragboardHeight=600;this.widgetToMove=null;this.painted=false;this.baseLayout=this._buildLayoutFromPreferences();this.freeLayout=new Wirecloud.ui.FreeLayout(this);this.fulldragboardLayout=new Wirecloud.ui.FullDragboardLayout(this);if(this.tab.workspace.restricted){this.tab.wrapperElement.classList.add("fixed");}};WorkspaceTabViewDragboard.prototype.getWidth=function getWidth(){return this.dragboardWidth;};WorkspaceTabViewDragboard.prototype.getHeight=function getHeight(){return this.dragboardHeight;};WorkspaceTabViewDragboard.prototype.lowerToBottom=function lowerToBottom(widget){if(widget.position.z===0){return this;}
this.widgets.splice(widget.position.z,1);this.widgets.unshift(widget);this.widgets.forEach(function(value,index){value.setPosition({z:index});});this.update();return this;};WorkspaceTabViewDragboard.prototype.lower=function lower(widget){var z=widget.position.z;if(z===0){return this;}
var _widget=this.widgets[z-1];this.widgets[z-1]=widget;this.widgets[z]=_widget;widget.setPosition({z:z-1});_widget.setPosition({z:z});this.update([widget.id,_widget.id]);return this;};WorkspaceTabViewDragboard.prototype.raiseToTop=function raiseToTop(widget){if(widget.position.z===(this.widgets.length-1)){return this;}
this.widgets.splice(widget.position.z,1);this.widgets.push(widget);this.widgets.forEach(function(value,index){value.setPosition({z:index});});this.update();return this;};WorkspaceTabViewDragboard.prototype.raise=function raise(widget){var z=widget.position.z;if(z===(this.widgets.length-1)){return this;}
var _widget=this.widgets[z+1];this.widgets[z+1]=widget;this.widgets[z]=_widget;widget.setPosition({z:z+1});_widget.setPosition({z:z});this.update([widget.id,_widget.id]);return this;};WorkspaceTabViewDragboard.prototype.paint=function paint(){if(this.painted){return;}
this._recomputeSize();this.baseLayout.initialize();this.freeLayout.initialize();this.fulldragboardLayout.initialize();refresh_zindex.call(this);this.painted=true;};WorkspaceTabViewDragboard.prototype.update=function update(ids){return new Promise(function(resolve,reject){var url=Wirecloud.URLs.IWIDGET_COLLECTION.evaluate({workspace_id:this.tab.workspace.model.id,tab_id:this.tab.model.id});ids=ids||Object.keys(this.tab.widgetsById);var content=this.widgets.filter(function(widget){return!widget.model.volatile&&ids.indexOf(widget.id)!==-1;});if(!content.length){return resolve(this);}
Wirecloud.io.makeRequest(url,{method:'PUT',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(content),onComplete:function(response){if(response.status===204){this.widgets.filter(function(widget){widget.persist();});resolve(this);}else{reject();}}.bind(this)});}.bind(this));};var refresh_zindex=function refresh_zindex(){var i;for(i=this.widgets.length-1;i>=0;i--){if(this.widgets[i]==null){this.widgets.splice(i,1);}}
this.widgets.forEach(function(widget,index){widget.setPosition({z:index});});};WorkspaceTabViewDragboard.prototype._buildLayoutFromPreferences=function _buildLayoutFromPreferences(description){var layoutInfo=this.tab.model.preferences.get('baselayout');switch(layoutInfo.type){case'columnlayout':if(layoutInfo.smart){return new Wirecloud.ui.SmartColumnLayout(this,layoutInfo.columns,layoutInfo.cellheight,layoutInfo.verticalmargin,layoutInfo.horizontalmargin);}else{return new Wirecloud.ui.ColumnLayout(this,layoutInfo.columns,layoutInfo.cellheight,layoutInfo.verticalmargin,layoutInfo.horizontalmargin);}
break;case'gridlayout':return new Wirecloud.ui.GridLayout(this,layoutInfo.columns,layoutInfo.rows,layoutInfo.verticalmargin,layoutInfo.horizontalmargin);}};WorkspaceTabViewDragboard.prototype._updateBaseLayout=function _updateBaseLayout(){var newBaseLayout=this._buildLayoutFromPreferences();newBaseLayout.initialize();this.baseLayout.moveTo(newBaseLayout);this.baseLayout.destroy();this.baseLayout=newBaseLayout;};WorkspaceTabViewDragboard.prototype._addWidget=function _addWidget(widget){var z=widget.position.z;if(z!=null){if(this.widgets[z]!=null){this.widgets.splice(z,1,this.widgets[z],widget);this.widgets.forEach(function(value,index){if(value!=null){value.setPosition({z:index});}});}else{this.widgets[z]=widget;}}else{widget.setPosition({z:this.widgets.push(widget)-1});}
this.tab.appendChild(widget);};WorkspaceTabViewDragboard.prototype._removeWidget=function _removeWidget(widget){var z=widget.position.z;this.widgets.splice(z,1);this.widgets.forEach(function(value,index){if(value!=null){value.setPosition({z:index});}});this.tab.removeChild(widget);};WorkspaceTabViewDragboard.prototype._notifyWindowResizeEvent=function _notifyWindowResizeEvent(){var oldWidth=this.dragboardWidth;var oldHeight=this.dragboardHeight;this._recomputeSize();var newWidth=this.dragboardWidth;var newHeight=this.dragboardHeight;var widthChanged=oldWidth!==newWidth;var heightChanged=oldHeight!==newHeight;if(widthChanged||heightChanged){this._updateIWidgetSizes(widthChanged,heightChanged);}};WorkspaceTabViewDragboard.prototype._recomputeSize=function _recomputeSize(){var cssStyle=document.defaultView.getComputedStyle(this.tab.wrapperElement,null);if(cssStyle.getPropertyValue("display")==="none"){return;}
this.topMargin=cssStyle.getPropertyCSSValue("padding-top").getFloatValue(CSSPrimitiveValue.CSS_PX);this.bottomMargin=cssStyle.getPropertyCSSValue("padding-bottom").getFloatValue(CSSPrimitiveValue.CSS_PX);this.leftMargin=cssStyle.getPropertyCSSValue("padding-left").getFloatValue(CSSPrimitiveValue.CSS_PX);this.rightMargin=cssStyle.getPropertyCSSValue("padding-right").getFloatValue(CSSPrimitiveValue.CSS_PX);this.dragboardWidth=parseInt(this.tab.wrapperElement.offsetWidth,10)-this.leftMargin-this.rightMargin;this.dragboardHeight=parseInt(this.tab.wrapperElement.parentNode.clientHeight,10)-this.topMargin-this.bottomMargin;};WorkspaceTabViewDragboard.prototype._updateIWidgetSizes=function _updateIWidgetSizes(widthChanged,heightChanged){this.baseLayout._notifyWindowResizeEvent(widthChanged,heightChanged);this.freeLayout._notifyWindowResizeEvent(widthChanged,heightChanged);this.fulldragboardLayout._notifyWindowResizeEvent(widthChanged,heightChanged);};ns.WorkspaceTabViewDragboard=WorkspaceTabViewDragboard;})(Wirecloud.ui);;(function(utils){"use strict";var MyResourcesView=function MyResourcesView(id,options){var resource_extra_context;options.class='catalogue myresources';StyledElements.Alternative.call(this,id,options);this.catalogue=Wirecloud.LocalCatalogue;this.alternatives=new StyledElements.Alternatives();this.appendChild(this.alternatives);var search_options={catalogue:this,resource_painter:Wirecloud.ui.ResourcePainter,resource_extra_context:resource_extra_context,emptyTitle:utils.gettext('Empty resource list'),emptyMessage:utils.gettext('Currently, you do not have access to any component. You can get components using the Marketplace view or by uploading components manually using the Upload button.')};this.viewsByName={'search':this.alternatives.createAlternative({alternative_constructor:CatalogueSearchView,containerOptions:search_options}),'details':this.alternatives.createAlternative({alternative_constructor:Wirecloud.ui.WirecloudCatalogue.ResourceDetailsView,containerOptions:{catalogue:this}})};this.viewsByName.search.init();this.uploadButton=new StyledElements.Button({class:"wc-upload-mac-button",iconClass:'fa fa-cloud-upload',title:utils.gettext('Upload')});var upload_dialog=new Wirecloud.ui.WirecloudCatalogue.UploadWindowMenu({catalogue:this.catalogue,mainview:this});this.uploadButton.addEventListener('click',function(){upload_dialog.show();});this.marketButton=new StyledElements.Button({iconClass:'fa fa-shopping-cart',class:"wc-show-marketplace-button",title:utils.gettext('Get more components')});this.marketButton.addEventListener('click',function(){Wirecloud.UserInterfaceManager.changeCurrentView('marketplace');});this.alternatives.addEventListener('preTransition',function(alternatives,old_alternative,new_alternative){Wirecloud.UserInterfaceManager.header._notifyViewChange();});this.alternatives.addEventListener('postTransition',function(alternatives,old_alternative,new_alternative){setTimeout(Wirecloud.dispatchEvent.bind(Wirecloud,'viewcontextchanged'),0);}.bind(this));this.addEventListener('show',function(){Wirecloud.UserInterfaceManager.rootKeydownHandler=keydown_listener.bind(this);this.refresh_if_needed();}.bind(this));};MyResourcesView.prototype=new StyledElements.Alternative();MyResourcesView.prototype.view_name='myresources';MyResourcesView.prototype.buildStateData=function buildStateData(){var currentState,data,subview;currentState=Wirecloud.HistoryManager.getCurrentState();data={workspace_owner:currentState.workspace_owner,workspace_name:currentState.workspace_name,view:'myresources',subview:'search'};subview=this.alternatives.getCurrentAlternative();if(subview.view_name!=null){data.subview=subview.view_name;if('buildStateData'in subview){subview.buildStateData(data);}}
return data;};MyResourcesView.prototype.onHistoryChange=function onHistoryChange(state){var details,parts,currentResource;if(state.subview==='search'){this.changeCurrentView(state.subview,{});}else{parts=state.resource.split('/');details={vendor:parts[0],name:parts[1]};currentResource=this.viewsByName.details.currentEntry;if(currentResource!=null&&currentResource.vendor===details.vendor&&currentResource.name===details.name){details=currentResource;}
this.createUserCommand('showDetails',details,{history:"replace",tab:state.tab,version:parts[2]})();}};MyResourcesView.prototype.goUp=function goUp(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){Wirecloud.UserInterfaceManager.changeCurrentView('workspace');}
this.changeCurrentView('search');};MyResourcesView.prototype.getBreadcrumb=function getBreadcrumb(){var breadcrum=[utils.gettext('My Resources')];if(this.alternatives.getCurrentAlternative()===this.viewsByName.details&&this.viewsByName.details.currentEntry!=null){breadcrum.push(this.viewsByName.details.currentEntry.title);}
return breadcrum;};MyResourcesView.prototype.getTitle=function getTitle(){var currentResource;if(this.alternatives.getCurrentAlternative()===this.viewsByName.details){currentResource=this.viewsByName.details.currentEntry;if(currentResource!=null){return utils.interpolate(utils.gettext('My Resources - %(resource)s'),{resource:currentResource.uri});}}
return utils.gettext('My Resources');};MyResourcesView.prototype.getToolbarButtons=function getToolbarButtons(){return[this.uploadButton,this.marketButton];};MyResourcesView.prototype.search=function search(options){return this.catalogue.search(options);};MyResourcesView.prototype.changeCurrentView=function changeCurrentView(view_name,options){if(!(view_name in this.viewsByName)){throw new TypeError();}
if(options==null){options={onComplete:function(alternatives,out_alternative){this.refresh_if_needed();var new_status=this.buildStateData();Wirecloud.HistoryManager.pushState(new_status);Wirecloud.dispatchEvent('viewcontextchanged');}.bind(this)};}
this.alternatives.showAlternative(this.viewsByName[view_name],options);};MyResourcesView.prototype.home=function home(){this.changeCurrentView('search');};MyResourcesView.prototype.createUserCommand=function createUserCommand(command){return this.ui_commands[command].apply(this,Array.prototype.slice.call(arguments,1));};MyResourcesView.prototype.ui_commands={};MyResourcesView.prototype.ui_commands.install=function install(resource,catalogue_source){return function(){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.addComponent({url:resource.description_url}).then(()=>{this.refresh_search_results();catalogue_source.home();catalogue_source.refresh_search_results();},logerror));}.bind(this);};MyResourcesView.prototype.ui_commands.uninstall=function uninstall(resource,catalogue_source){return function(){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.uninstallResource(resource).then(function(){this.refresh_search_results();if(catalogue_source!=null){catalogue_source.home();catalogue_source.refresh_search_results();}}.bind(this),logerror));}.bind(this);};MyResourcesView.prototype.ui_commands.uninstallall=function uninstallall(resource,catalogue_source){return function(){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.uninstallResource(resource,{allversions:true}).then(function(){this.refresh_search_results();if(catalogue_source!=null){catalogue_source.home();catalogue_source.refresh_search_results();}}.bind(this),logerror));}.bind(this);};MyResourcesView.prototype.ui_commands.publishOtherMarket=function publishOtherMarket(resource){return function(){var marketplaceview=Wirecloud.UserInterfaceManager.views.marketplace;marketplaceview.waitMarketListReady({include_markets:true,onComplete:function(){var dialog,msg,key;var views=Wirecloud.UserInterfaceManager.views.marketplace.viewsByName;for(key in views){if(views[key].getPublishEndpoints()!=null){dialog=new Wirecloud.ui.PublishResourceWindowMenu(resource);break;}}
if(dialog==null){msg=utils.gettext("You have not configured any marketplace to upload this resource. Please, configure one on the Marketplace view.");dialog=new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.WARN_MSG);}
dialog.show();}});}.bind(this);};MyResourcesView.prototype.ui_commands.showDetails=function showDetails(resource,options){options=utils.merge({history:"push"},options);return function(e){var onSuccess=function onSuccess(resource_details){if(options.version!=null){resource_details.changeVersion(options.version);}
this.viewsByName.details.paint(resource_details,{tab:options.tab});};var viewChanged=false,dataLoaded=false;var onComplete=function onComplete(){var new_status=this.buildStateData();if(options.history==="push") {Wirecloud.HistoryManager.pushState(new_status);}else{Wirecloud.HistoryManager.replaceState(new_status);}
utils.callCallback(options.onComplete);};var onCompleteRequest=function onCompleteRequest(){this.viewsByName.details.enable();dataLoaded=true;if(viewChanged&&dataLoaded){onComplete.call(this);}};this.viewsByName.details.disable();this.changeCurrentView('details',{onComplete:function(){Wirecloud.UserInterfaceManager.changeCurrentView('myresources',{onComplete:function(){viewChanged=true;if(viewChanged&&dataLoaded){onComplete.call(this);}}.bind(this)});}.bind(this)});if(resource instanceof Wirecloud.WirecloudCatalogue.ResourceDetails){onSuccess.call(this,resource);onCompleteRequest.call(this);}else{this.catalogue.getResourceDetails(resource.vendor,resource.name,{onSuccess:onSuccess.bind(this),onComplete:onCompleteRequest.bind(this)});}}.bind(this);};MyResourcesView.prototype.ui_commands.delete=function(resource){var doRequest,msg;doRequest=function(){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.deleteResource(resource).then(()=>{this.home();this.refresh_search_results();},logerror));};msg=utils.gettext('Do you really want to remove the "%(name)s" (vendor: "%(vendor)s", version: "%(version)s") resource?');msg=utils.interpolate(msg,resource,true);return function(){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(doRequest.bind(this));dialog.show();}.bind(this);};MyResourcesView.prototype.ui_commands.deleteall=function deleteall(resource){var success_callback,doRequest,msg,context;success_callback=function(response){this.home();this.refresh_search_results();}.bind(this);doRequest=function(){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.deleteResource(resource,{allversions:true}).then(success_callback,logerror));};msg=utils.gettext('Do you really want to remove all versions of the (vendor: "%(vendor)s", name: "%(name)s") resource?');context={vendor:resource.vendor,name:resource.name};msg=utils.interpolate(msg,context,true);return function(){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(doRequest.bind(this));dialog.show();}.bind(this);};MyResourcesView.prototype.refresh_if_needed=function refresh_if_needed(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){this.viewsByName.search.refresh_if_needed();}};MyResourcesView.prototype.refresh_search_results=function(){this.viewsByName.search.source.refresh();};var keydown_listener=function keydown_listener(key,modifiers){var subview=this.alternatives.getCurrentAlternative();if(typeof subview.handleKeydownEvent==="function"){return subview.handleKeydownEvent(key,modifiers);}};var logerror=function logerror(msg){(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(msg);};Wirecloud.ui.MyResourcesView=MyResourcesView;})(Wirecloud.Utils);;(function(utils){"use strict";var MarketplaceView,onGetMarketsSuccess,auto_select_initial_market,notifyError,builder,ERROR_TEMPLATE;ERROR_TEMPLATE='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="alert alert-error"><t:message/></div></s:styledgui>';builder=new StyledElements.GUIBuilder();notifyError=function notifyError(message,context){var error_alert;message=builder.parse(builder.DEFAULT_OPENING+message+builder.DEFAULT_CLOSING,context);error_alert=builder.parse(ERROR_TEMPLATE,{'message':message});this.errorsAlternative.clear();this.errorsAlternative.appendChild(error_alert);this.alternatives.showAlternative(this.errorsAlternative);};auto_select_initial_market=function auto_select_initial_market(){var currentState=Wirecloud.HistoryManager.getCurrentState();if(currentState.market&&currentState.market in this.viewsByName){this.changeCurrentMarket(currentState.market,{history:"ignore"});}else if(this.viewList.length>0){this.changeCurrentMarket(this.viewList[0].market_id,{history:"replace"});}else{var msg=utils.gettext("<p>WireCloud is not connected with any marketplace.</p><p>Suggestions:</p><ul><li>Connect WireCloud with a new marketplace.</li><li>Go to the my resources view instead</li></ul>");notifyError.call(this,msg);}};onGetMarketsSuccess=function onGetMarketsSuccess(response){var market_key,old_views,view_element,view_constructor,i,p;this.loading=false;this.loadtask=null;old_views=this.viewsByName;this.viewsByName={};this.viewList=[];for(i=0;i<response.length;i++){view_element=response[i];market_key=view_element.user+'/'+view_element.name;if(market_key in old_views){this.viewsByName[market_key]=old_views[market_key];delete old_views[market_key];}else{view_constructor=Wirecloud.MarketManager.getMarketViewClass(view_element.type);if(view_constructor==null){continue;}
this.viewsByName[market_key]=this.alternatives.createAlternative({alternative_constructor:view_constructor,containerOptions:{catalogue:this,marketplace_desc:view_element}});Wirecloud.UserInterfaceManager.workspaceviews[market_key]=this.viewsByName[market_key];}
this.viewList.push(this.viewsByName[market_key]);this.number_of_alternatives+=1;}
p=Promise.resolve();for(market_key in old_views){p=p.then(remove_market.bind(this,old_views[market_key]));}
return p.then(()=>{return new Promise((resolve,reject)=>{for(market_key in old_views){old_views[market_key].destroy();}
if(this.isVisible()){if(this.temporalAlternatives.indexOf(this.alternatives.getCurrentAlternative())!==-1){auto_select_initial_market.call(this);}else{Wirecloud.dispatchEvent('viewcontextchanged');}}
resolve();});});};MarketplaceView=function MarketplaceView(id,options){options.id='marketplace';StyledElements.Alternative.call(this,id,options);this.viewsByName={};this.alternatives=new StyledElements.Alternatives();this.emptyAlternative=this.alternatives.createAlternative();this.errorsAlternative=this.alternatives.createAlternative({containerOptions:{'class':'marketplace-error-view'}});this.temporalAlternatives=[this.emptyAlternative,this.errorsAlternative];this.alternatives.addEventListener('postTransition',function(alternatives,out_alternative,in_alternative){Wirecloud.dispatchEvent('viewcontextchanged',this);}.bind(this));this.appendChild(this.alternatives);this.marketMenu=new StyledElements.PopupMenu();this.marketMenu.append(new Wirecloud.ui.MarketplaceViewMenuItems(this));options.parentElement.addEventListener("postTransition",function(alts,outalt,inalt){if(inalt===this&&this.loading===null){this.refreshViewInfo();}}.bind(this));this.addEventListener('show',function(view){if(view.loading===false&&!view.error){if(view.alternatives.getCurrentAlternative()===view.emptyAlternative){auto_select_initial_market.call(view);}else{view.alternatives.getCurrentAlternative().refresh_if_needed();}}});Object.defineProperty(this,'error',{get:function(){return this.alternatives.getCurrentAlternative()===this.errorsAlternative;}});this.myresourcesButton=new StyledElements.Button({iconClass:'fa fa-archive',class:"wc-show-myresources-button",title:utils.gettext('My Resources')});this.myresourcesButton.addEventListener('click',function(){Wirecloud.UserInterfaceManager.changeCurrentView('myresources',{history:"push"});});this.number_of_alternatives=0;this.loading=null;this.callbacks=[];};MarketplaceView.prototype=new StyledElements.Alternative();MarketplaceView.prototype.view_name='marketplace';MarketplaceView.prototype.buildStateData=function buildStateData(){var currentState,data,subview;currentState=Wirecloud.HistoryManager.getCurrentState();data={workspace_owner:currentState.workspace_owner,workspace_name:currentState.workspace_name,view:'marketplace'};if(this.loading===false&&this.error===false&&this.alternatives.getCurrentAlternative()!==this.emptyAlternative){if(this.alternatives.getCurrentAlternative().alternatives!=null){subview=this.alternatives.getCurrentAlternative().alternatives.getCurrentAlternative();if(subview.view_name!=null){data.subview=subview.view_name;if('buildStateData'in subview){subview.buildStateData(data);}}}
data.market=this.alternatives.getCurrentAlternative().market_id;}
return data;};MarketplaceView.prototype.onHistoryChange=function onHistoryChange(state){this.changeCurrentMarket(state.market,{history:"ignore"});if('onHistoryChange'in this.viewsByName[state.market]){this.viewsByName[state.market].onHistoryChange(state);}};MarketplaceView.prototype.goUp=function goUp(){var current_alternative,change=false;current_alternative=this.alternatives.getCurrentAlternative();if(this.temporalAlternatives.indexOf(current_alternative)===-1){change=this.alternatives.getCurrentAlternative().goUp();}
if(!change){Wirecloud.UserInterfaceManager.changeCurrentView('workspace');}};MarketplaceView.prototype.getBreadcrumb=function getBreadcrumb(){var breadcrum,current_alternative,subalternative;current_alternative=this.alternatives.getCurrentAlternative();if(current_alternative===this.emptyAlternative){return[utils.gettext('loading marketplace view...')];}else if(current_alternative===this.errorsAlternative){return[utils.gettext('marketplace list not available')];}else{breadcrum=['marketplace'];breadcrum.push(current_alternative.getLabel());if(current_alternative.alternatives!=null){subalternative=current_alternative.alternatives.getCurrentAlternative();if(subalternative.view_name==='details'&&subalternative.currentEntry!=null){breadcrum.push({label:subalternative.currentEntry.title,'class':'resource_title'});}}
return breadcrum;}};MarketplaceView.prototype.getTitle=function getTitle(){var current_alternative,subalternative,marketname,title;current_alternative=this.alternatives.getCurrentAlternative();if(current_alternative===this.emptyAlternative||current_alternative===this.errorsAlternative){return utils.gettext('Marketplace');}else{marketname=current_alternative.getLabel();title=utils.interpolate(utils.gettext('Marketplace - %(marketname)s'),{marketname:marketname});if(current_alternative.alternatives){subalternative=current_alternative.alternatives.getCurrentAlternative();if(subalternative.view_name==="details"&&subalternative.currentEntry!=null){title+=' - '+subalternative.currentEntry.title;}}
return title;}};MarketplaceView.prototype.getToolbarMenu=function getToolbarMenu(){return this.marketMenu;};MarketplaceView.prototype.getToolbarButtons=function getToolbarButtons(){return[this.myresourcesButton];};var refresh_view_info=function refresh_view_info(){this.loading=true;this.number_of_alternatives=0;Wirecloud.dispatchEvent('viewcontextchanged');this.loadtask=Wirecloud.MarketManager.getMarkets().then(onGetMarketsSuccess.bind(this),(error)=>{this.loading=false;this.errorsAlternative.clear();notifyError.call(this,error);return Promise.reject(error);});};MarketplaceView.prototype.waitMarketListReady=function waitMarketListReady(options){if(options==null||typeof options.onComplete!=='function'){throw new TypeError('missing onComplete callback');}
if(options.include_markets===true){options.onComplete=function(onComplete){var count=Object.keys(this.viewsByName).length;if(count===0){try{onComplete();}catch(e){}
return;}
var listener=function(){if(--count===0){onComplete();}};for(var key in this.viewsByName){this.viewsByName[key].wait_ready(listener);}}.bind(this,options.onComplete);}
if(this.loading===false){utils.callCallback(options.onComplete);return;}
if(this.loading===null){refresh_view_info.call(this);}
this.loadtask.then(options.onComplete);};MarketplaceView.prototype.refreshViewInfo=function refreshViewInfo(){return new Wirecloud.Task("Refreshing marketplace view",function(resolve,reject){if(this.loading===true){return resolve();}
refresh_view_info.call(this);this.loadtask.then(resolve,reject);}.bind(this));};MarketplaceView.prototype.addMarket=function addMarket(market_info){var market_key=market_info.user+'/'+market_info.name;var view_constructor=Wirecloud.MarketManager.getMarketViewClass(market_info.type);market_info.permissions={'delete':true};this.viewsByName[market_key]=this.alternatives.createAlternative({alternative_constructor:view_constructor,containerOptions:{catalogue:this,marketplace_desc:market_info}});Wirecloud.UserInterfaceManager.workspaceviews[market_key]=this.viewsByName[market_key];this.viewList.push(this.viewsByName[market_key]);this.number_of_alternatives+=1;this.changeCurrentMarket(market_key);};MarketplaceView.prototype.changeCurrentMarket=function changeCurrentMarket(market,options){options=utils.merge({history:"push",},options);this.alternatives.showAlternative(this.viewsByName[market],{onComplete:function(){var new_status=this.buildStateData();if(options.history==="push"){Wirecloud.HistoryManager.pushState(new_status);}else if(options.history==="replace"){Wirecloud.HistoryManager.replaceState(new_status);}}.bind(this)});};var remove_market=function remove_market(market_view){return new Promise(function(alt,resolve){delete Wirecloud.UserInterfaceManager.workspaceviews[market_view.market_id];this.alternatives.removeAlternative(alt,{onComplete:resolve});}.bind(this,market_view));};Wirecloud.ui.MarketplaceView=MarketplaceView;})(Wirecloud.Utils);;(function(utils){"use strict";var builder=new StyledElements.GUIBuilder();var initEmptyCatalogueInfoBox=function initEmptyCatalogueInfoBox(title,message){var layer=builder.DEFAULT_OPENING+'<div class="catalogueEmptyBox"><div class="alert alert-info"><h4><t:title/></h4><p><t:message/></p></div></div>'+builder.DEFAULT_CLOSING;this.emptyBox=builder.parse(layer,{title:title,message:message}).elements[0];};var CatalogueSearchView=function CatalogueSearchView(id,options){var context,extra_context,resource_template;options=utils.merge({emptyTitle:utils.gettext("Empty Marketplace!"),emptyMessage:utils.gettext("This marketplace is empty, that is, it does not provide any resource at this time.")},options);options['class']='search_interface loading';this.catalogue=options.catalogue;StyledElements.Alternative.call(this,id,options);if(options.gui_template==null){options.gui_template='wirecloud/catalogue/search_interface';}
this.source=new StyledElements.PaginatedSource({'pageSize':30,'order_by':'-creation_date','keywords':'','scope':'all','requestFunc':this._search.bind(this),'processFunc':function(elements,search_info){var i,msg;this.resource_list.clear();if('corrected_query'in search_info){msg=utils.gettext("<p>Showing results for <b><t:corrected_query/></b></p>");this.resource_list.appendChild(this.resource_painter.paintInfo(msg,{corrected_query:search_info.corrected_query}));}
for(i=0;i<elements.length;i+=1){this.resource_list.appendChild(this.resource_painter.paint(elements[i]));}}.bind(this)});this.source.addEventListener('optionsChanged',function(source,options){if(this.scopeSelect){this.scopeSelect.setValue(options.scope);}
if(this.simple_search_input){this.simple_search_input.setValue(options.keywords);}
update_resetbutton.call(this,options);}.bind(this));this.source.addEventListener('requestStart',this.disable.bind(this));this.source.addEventListener('requestEnd',function(pagination,error){var msg;if(error!=null){this.resource_painter.setError(utils.gettext('Connection error: No resource retrieved.'));}
if(pagination.totalCount===0&&pagination.options.keywords.trim()===""&&pagination.options.scope==='all'){this.resource_list.appendChild(this.emptyBox);}else if(pagination.totalCount===0){msg=utils.gettext("<p>We couldn't find anything for your search - <b>%(keywords)s.</b></p><p>Suggestions:</p><ul><li>Make sure all words are spelled correctly.</li><li>Try different keywords.</li><li>Try more general keywords.</li></ul>");msg=interpolate(msg,{keywords:utils.escapeHTML(pagination.options.keywords.trim())},true);this.resource_painter.setError(new StyledElements.Fragment(msg));}
this.enable();}.bind(this));this.resource_list=new StyledElements.Container({'class':'resource_list'});this.simple_search_input=new StyledElements.TextField({'class':'simple_search_text','placeholder':utils.gettext('Keywords...')});this.simple_search_input.addEventListener('keydown',this._onSearchInputKeyPress.bind(this));this.simple_search_input.addEventListener('change',onSearchInput.bind(this));if('extra_context'in options){extra_context=options.extra_context;}else{extra_context={};}
context=utils.merge(extra_context,{'resourcelist':this.resource_list,'pagination':function(){return new StyledElements.PaginationInterface(this.source);}.bind(this),'reset_button':function(){var button=new StyledElements.Button({text:utils.gettext('Refresh')});button.addEventListener('click',function(){this.source.changeOptions({'correct_query':true,'keywords':'',scope:'all'});}.bind(this));this.view_allbutton=button;return button;}.bind(this),'orderby':function(){var select=new StyledElements.Select({'initialValue':'-creation_date','initialEntries':[{'label':utils.gettext('Creation date'),'value':'-creation_date'},{'label':utils.gettext('Title'),'value':'name'},{'label':utils.gettext('Vendor'),'value':'vendor'}]});select.addEventListener('change',function(select){this.source.changeOptions({'order_by':select.getValue()});}.bind(this));return select;}.bind(this),'scope':function(){var select=new StyledElements.Select({'initialValue':'all','initialEntries':[{'label':utils.gettext('All'),'value':'all'},{'label':utils.gettext('Widgets'),'value':'widget'},{'label':utils.gettext('Mashups'),'value':'mashup'},{'label':utils.gettext('Operators'),'value':'operator'}]});select.addEventListener('change',function(select){this.source.changeOptions({'scope':select.getValue()});}.bind(this));this.scopeSelect=select;return select;}.bind(this),'searchinput':this.simple_search_input});var contents=builder.parse(Wirecloud.currentTheme.templates[options.gui_template],context);this.appendChild(contents);this.timeout=null;this._keywordTimeoutHandler=this._keywordTimeoutHandler.bind(this);this.initialized=false;this._last_search=false;if('resource_template'in options){resource_template=options.resource_template;}else{resource_template='wirecloud/catalogue/resource';}
this.resource_painter=new options.resource_painter(this.catalogue,Wirecloud.currentTheme.templates[resource_template],this.resource_list,options.resource_extra_context);this.catalogue.catalogue.addEventListener('change',this.mark_outdated.bind(this));this.addEventListener('show',this.refresh_if_needed.bind(this));initEmptyCatalogueInfoBox.call(this,options.emptyTitle,options.emptyMessage);};CatalogueSearchView.prototype=new StyledElements.Alternative();CatalogueSearchView.prototype.init=function init(){this.initialized=true;};CatalogueSearchView.prototype.view_name='search';CatalogueSearchView.prototype.mark_outdated=function mark_outdated(){this._last_search=false;};CatalogueSearchView.prototype.refresh_if_needed=function refresh_if_needed(){if(this.initialized&&(this._last_search===false||(this._last_search+(2*60*60*1000))<Date.now())){this.source.refresh();}};CatalogueSearchView.prototype.handleKeydownEvent=function handleKeydownEvent(key,modifiers){if((modifiers.ctrlKey||modifiers.metaKey)&&key=='f'){this.simple_search_input.focus();return true;}};CatalogueSearchView.prototype._search=function _search(page,options,onSuccess,onError){options={'order_by':options.order_by,'search_criteria':options.keywords,'scope':options.scope,'pagenum':page,'maxresults':options.pageSize};if(typeof this.catalogue.getCurrentSearchContext==='function'){options=utils.merge(options,this.catalogue.getCurrentSearchContext());}
this._last_search=Date.now();this.catalogue.search(options).then(search_info=>{onSuccess(search_info.resources,search_info);},onError);};CatalogueSearchView.prototype._keywordTimeoutHandler=function _keywordTimeoutHandler(){this.timeout=null;this.source.changeOptions({'correct_query':true,'keywords':this.simple_search_input.getValue()});};var update_resetbutton=function update_resetbutton(options){var filters_applied;filters_applied=options.keywords!==''||options.scope!=='all';if(filters_applied){this.view_allbutton.setLabel(utils.gettext('Clear filters'));}else{this.view_allbutton.setLabel(utils.gettext('Refresh'));}};var onSearchInput=function onSearchInput(event){if(this.timeout!==null){clearTimeout(this.timeout);}
this.timeout=setTimeout(this._keywordTimeoutHandler,700);};CatalogueSearchView.prototype._onSearchInputKeyPress=function _onSearchInputKeyPress(input,modifiers,key){if(key==="Enter"){if(this.timeout!==null){clearTimeout(this.timeout);}
this._keywordTimeoutHandler();}};window.CatalogueSearchView=CatalogueSearchView;})(Wirecloud.Utils);;(function(utils){"use strict";var CatalogueView=function CatalogueView(id,options){var resource_extra_context;options.class='catalogue';StyledElements.Alternative.call(this,id,options);Object.defineProperty(this,'desc',{value:options.marketplace_desc});this.market_id=this.desc.user+'/'+this.desc.name;this.mainview=options.catalogue;this.catalogue=new Wirecloud.WirecloudCatalogue(options.marketplace_desc);this.alternatives=new StyledElements.Alternatives();this.appendChild(this.alternatives);resource_extra_context={'mainbutton':function(options,context,resource){var button,local_catalogue_view;local_catalogue_view=Wirecloud.UserInterfaceManager.views.myresources;if(Wirecloud.LocalCatalogue.resourceExists(resource)){button=new StyledElements.Button({'class':'btn-danger','text':utils.gettext('Uninstall')});button.addEventListener('click',local_catalogue_view.createUserCommand('uninstall',resource,this.catalogue));}else{button=new StyledElements.Button({'class':'btn-success','text':utils.gettext('Install')});button.addEventListener('click',local_catalogue_view.createUserCommand('install',resource,this.catalogue));}
button.addClassName('mainbutton');return button;}.bind(this)};this.viewsByName={'search':this.alternatives.createAlternative({alternative_constructor:CatalogueSearchView,containerOptions:{catalogue:this,resource_painter:Wirecloud.ui.ResourcePainter,resource_extra_context:resource_extra_context}}),'details':this.alternatives.createAlternative({alternative_constructor:Wirecloud.ui.WirecloudCatalogue.ResourceDetailsView,containerOptions:{catalogue:this}})};this.viewsByName.search.init();this.alternatives.addEventListener('postTransition',function(alternatives,out_alternative){Wirecloud.dispatchEvent('viewcontextchanged');}.bind(this));this.addEventListener('show',this.refresh_if_needed.bind(this));};CatalogueView.prototype=new StyledElements.Alternative();CatalogueView.prototype.getLabel=function getLabel(){return this.catalogue.title;};CatalogueView.prototype.isAllow=function isAllow(action){return this.catalogue.isAllow(action);};CatalogueView.prototype._onShow=function _onShow(){};CatalogueView.prototype.onHistoryChange=function onHistoryChange(state){var details,parts,currentResource;if(state.subview==='search'){this.changeCurrentView(state.subview);}else{parts=state.resource.split('/');details={vendor:parts[0],name:parts[1],version:parts[2]};currentResource=this.viewsByName.details.currentEntry;if(currentResource!=null&&currentResource.vendor===details.vendor&&currentResource.name===details.name){details=currentResource.changeVersion(details.version);}
this.createUserCommand('showDetails',details,{history:"ignore"})();}};CatalogueView.prototype.goUp=function goUp(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){return false;}
this.changeCurrentView('search',{onComplete:push_nav_history.bind(this)});return true;};CatalogueView.prototype.wait_ready=function wait_ready(onComplete){if(typeof onComplete!=='function'){throw new TypeError('missing onComplete callback');}
utils.callCallback(onComplete);};CatalogueView.prototype.search=function search(onSuccess,onError,options){return this.catalogue.search(onSuccess,onError,options);};CatalogueView.prototype.getPublishEndpoints=function getPublishEndpoints(){return null;};CatalogueView.prototype.changeCurrentView=function changeCurrentView(view_name,options){if(!(view_name in this.viewsByName)){throw new TypeError();}
options=options!=null?options:{};this.alternatives.showAlternative(this.viewsByName[view_name],{onComplete:options.onComplete});};CatalogueView.prototype.home=function home(){this.changeCurrentView('search',{onComplete:push_nav_history.bind(this)});};CatalogueView.prototype.createUserCommand=function createUserCommand(command){return this.ui_commands[command].apply(this,Array.prototype.slice.call(arguments,1));};CatalogueView.prototype.ui_commands={};CatalogueView.prototype.ui_commands.install=function install(resource,catalogue_source){return function(){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.addComponent({url:resource.description_url}).then(()=>{this.refresh_search_results();catalogue_source.home();catalogue_source.refresh_search_results();},logerror));}.bind(this);};CatalogueView.prototype.ui_commands.showDetails=function showDetails(resource,options){options=utils.merge({history:"push"},options);return function(){var onSuccess=function(resource_details){this.viewsByName.details.paint(resource_details);this.viewsByName.details.repaint();};var onComplete=function onSuccess(){this.viewsByName.details.enable();if(options.history==="push"){push_nav_history.call(this);}else if(options.history==="replace"){replace_nav_history.call(this);}
utils.callCallback(options.onComplete);};this.viewsByName.details.disable();this.alternatives.showAlternative(this.viewsByName.details);if(resource instanceof Wirecloud.WirecloudCatalogue.ResourceDetails){onSuccess.call(this,resource);onComplete.call(this);}else{this.catalogue.getResourceDetails(resource.vendor,resource.name,{onSuccess:onSuccess.bind(this),onComplete:onComplete.bind(this)});}}.bind(this);};CatalogueView.prototype.ui_commands.delete=function(resource){var doRequest,msg;doRequest=function(){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.deleteResource(resource).then(()=>{this.home();this.refresh_search_results();},logerror));};msg=utils.gettext('Do you really want to remove the "%(name)s" (vendor: "%(vendor)s", version: "%(version)s") component?');msg=utils.interpolate(msg,resource,true);return function(){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(doRequest.bind(this));dialog.show();}.bind(this);};CatalogueView.prototype.refresh_if_needed=function refresh_if_needed(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){this.viewsByName.search.refresh_if_needed();}};CatalogueView.prototype.refresh_search_results=function(){this.viewsByName.search.source.refresh();};var push_nav_history=function push_nav_history(){var new_status=this.mainview.buildStateData();Wirecloud.HistoryManager.pushState(new_status);};var replace_nav_history=function replace_nav_history(){var new_status=this.mainview.buildStateData();Wirecloud.HistoryManager.replaceState(new_status);};var logerror=function logerror(msg){(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(msg);};window.CatalogueView=CatalogueView;})(Wirecloud.Utils);;(function(){"use strict";var WidgetViewDraggable=function WidgetViewDraggable(widget){var context={widget:widget};context._on_mouseenter_tab=on_mouseenter_tab.bind(context);context._on_mouseleave_tab=on_mouseleave_tab.bind(context);Wirecloud.ui.Draggable.call(this,widget.heading,context,WidgetViewDraggable.prototype.ondragstart,WidgetViewDraggable.prototype.ondrag,WidgetViewDraggable.prototype.ondragend,WidgetViewDraggable.prototype.canDrag);this.setXOffset=function(xOffset){context.xOffset=xOffset;};this.setYOffset=function(yOffset){context.yOffset=yOffset;};};WidgetViewDraggable.prototype.canDrag=function canDrag(draggable,context){return context.widget.model.isAllowed('move')&&!(context.widget.layout instanceof Wirecloud.ui.FullDragboardLayout);};WidgetViewDraggable.prototype.ondragstart=function ondragstart(draggable,context){context.layout=context.widget.layout;context.layout.dragboard.raiseToTop(context.widget);context.layout.initializeMove(context.widget,draggable);context.widget.wrapperElement.classList.add('dragging');context.widget.tab.wrapperElement.classList.add('dragging');context.tabs=context.widget.tab.workspace.tabs.filter(function(tab){if(tab.id!==context.widget.tab.id){tab.tabElement.addEventListener('mouseenter',context._on_mouseenter_tab);tab.tabElement.addEventListener('mouseleave',context._on_mouseleave_tab);return true;}});context.y=context.widget.wrapperElement.style.top===""?0:parseInt(context.widget.wrapperElement.style.top,10);context.x=context.widget.wrapperElement.style.left===""?0:parseInt(context.widget.wrapperElement.style.left,10);return{dragboard:context.widget.tab.wrapperElement};};WidgetViewDraggable.prototype.ondrag=function ondrag(event,draggable,context,xDelta,yDelta){var x,y,clientX,clientY;context.widget.wrapperElement.style.left=(context.x+xDelta)+'px';context.widget.wrapperElement.style.top=(context.y+yDelta)+'px';x=context.x+xDelta+context.xOffset;y=context.y+yDelta+context.yOffset;if('touches'in event){clientX=event.touches[0].clientX;clientY=event.touches[0].clientY;}else{clientX=event.clientX;clientY=event.clientY;}
if(context.tab!=null){return;}
var position=context.layout.getCellAt(x,y);if(position.y<0){position.y=0;}
if(position.x<0){position.x=0;}
context.layout.moveTemporally(position.x,position.y);return;};WidgetViewDraggable.prototype.ondragend=function ondragend(draggable,context){var destDragboard,destLayout;context.widget.wrapperElement.classList.remove('dragging');context.widget.tab.wrapperElement.classList.remove('dragging');context.tabs.forEach(function(tab){tab.tabElement.removeEventListener('mouseenter',context._on_mouseenter_tab);tab.tabElement.removeEventListener('mouseleave',context._on_mouseleave_tab);});if(context.tab!=null){context.layout.cancelMove();destDragboard=context.tab.dragboard;if(context.widget.layout===context.widget.tab.dragboard.freeLayout){destLayout=destDragboard.freeLayout;}else{destLayout=destDragboard.baseLayout;}
context.widget.moveToLayout(destLayout);context.tab.tabElement.classList.remove("selected");context.tab=null;}else{context.layout.acceptMove();}};var on_mouseenter_tab=function on_mouseenter_tab(event){var tab=this.widget.tab.workspace.findTab(event.target.getAttribute('data-id'));this.tab=tab;this.tab.tabElement.classList.add("selected");this.layout.disableCursor();};var on_mouseleave_tab=function on_mouseleave_tab(event){var tab=this.widget.tab.workspace.findTab(event.target.getAttribute('data-id'));if(tab===this.tab){this.tab.tabElement.classList.remove("selected");this.tab=null;}};Wirecloud.ui.WidgetViewDraggable=WidgetViewDraggable;})();;(function(){"use strict";var DragboardPosition=function DragboardPosition(x,y){Object.defineProperties(this,{x:{enumerable:true,get:function(){return x;},set:function(newValue){if(typeof newValue!='number'){throw new TypeError('value must be a number');}
x=newValue;}},y:{enumerable:true,get:function(){return y;},set:function(newValue){if(typeof newValue!='number'){throw new TypeError('value must be a number');}
y=newValue;}}});Object.freeze(this);};DragboardPosition.prototype.equals=function equals(other_position){if(other_position==null){return false;}
if(!(other_position instanceof DragboardPosition)){throw new TypeError();}
return this.x===this.other_position&&this.y===this.other_position.y;};DragboardPosition.prototype.clone=function clone(){return new DragboardPosition(this.x,this.y);};Wirecloud.DragboardPosition=DragboardPosition;})();;(function(utils){"use strict";var DragboardCursor=function DragboardCursor(widget){this.refIWidget=widget;this.id='cursor';this.position=widget.position;this.shape=widget.shape;this.layout=widget.layout;var dragboardCursor=document.createElement("div");dragboardCursor.setAttribute("class","dragboardcursor");dragboardCursor.style.height=widget.wrapperElement.offsetHeight+"px";dragboardCursor.style.width=widget.wrapperElement.offsetWidth+"px";dragboardCursor.style.left=(this.layout.getColumnOffset(this.position.x)-2)+"px";dragboardCursor.style.top=(this.layout.getRowOffset(this.position.y)-2)+"px";widget.tab.wrapperElement.insertBefore(dragboardCursor,widget.wrapperElement);this.element=dragboardCursor;};DragboardCursor.prototype.destroy=function destroy(){this.element.remove();};DragboardCursor.prototype.setPosition=function setPosition(position){this.position=position;if(this.element!==null){this.element.style.left=(this.layout.getColumnOffset(position.x)-2)+"px";this.element.style.top=(this.layout.getRowOffset(position.y)-2)+"px";}};Wirecloud.ui.DragboardCursor=DragboardCursor;})(Wirecloud.Utils);;(function(){"use strict";var MultiValuedSize=function MultiValuedSize(inPixels,inLU){Object.defineProperties(this,{inPixels:{value:inPixels},inLU:{value:inLU}});};Wirecloud.ui.MultiValuedSize=MultiValuedSize;})();;(function(utils){"use strict";var DragboardLayout=function DragboardLayout(dragboard){if(arguments.length===0){return;}
this.dragboard=dragboard;this.widgets={};this._on_remove_widget_bound=on_remove_widget.bind(this);};DragboardLayout.prototype._notifyWindowResizeEvent=function _notifyWindowResizeEvent(widthChanged,heightChanged){var iwidget_key,iWidget;for(iwidget_key in this.widgets){iWidget=this.widgets[iwidget_key];iWidget.repaint();}};DragboardLayout.prototype._notifyResizeEvent=function(iWidget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){};DragboardLayout.prototype.getMenubarSize=function getMenubarSize(){var sizeInPixels=18;var sizeInLU=Math.ceil(this.fromPixelsToVCells(sizeInPixels));return new Wirecloud.ui.MultiValuedSize(sizeInPixels,sizeInLU);};DragboardLayout.prototype.getStatusbarSize=function getStatusbarSize(){var sizeInPixels=16;var sizeInLU=Math.ceil(this.fromPixelsToVCells(sizeInPixels));return new Wirecloud.ui.MultiValuedSize(sizeInPixels,sizeInLU);};DragboardLayout.prototype.getExtraSize=function getExtraSize(){var sizeInPixels=this.getMenubarSize().inPixels+
this.getStatusbarSize().inPixels;var sizeInLU=Math.ceil(this.fromPixelsToVCells(sizeInPixels));return new Wirecloud.ui.MultiValuedSize(sizeInPixels,sizeInLU);};var UNIT_RE=/^(\d+(?:\.\d+)?)\s*(px|%|)$/;DragboardLayout.prototype.parseSize=function parseSize(value){var matches;if(typeof value==='number'){return[value,'cells'];}else if(typeof value==='string'){value=value.trim();matches=value.match(UNIT_RE);if(matches[2]!==''){return[Number(matches[1]),matches[2]];}else{return[Number(matches[1]),"cells"];}}else{throw new TypeError();}};DragboardLayout.prototype.adaptColumnOffset=function adaptColumnOffset(pixels){var msg="method \"%(method)s\" must be implemented.";msg=utils.interpolate(msg,{method:"adaptColumnOffset"},true);throw new Error(msg);};DragboardLayout.prototype.adaptRowOffset=function adaptRowOffset(pixels){var msg="method \"%(method)s\" must be implemented.";msg=utils.interpolate(msg,{method:"adaptRowOffset"},true);throw new Error(msg);};DragboardLayout.prototype.adaptHeight=function adaptHeight(size){var parsedSize,pixels,sizeInLU;parsedSize=this.parseSize(size);if(parsedSize[1]==='cells'){sizeInLU=Math.round(parsedSize[0]);}else{if(parsedSize[1]==='%'){pixels=Math.round((parsedSize[0]*this.getHeight())/100);}else{pixels=this.padHeight(parsedSize[0]);}
sizeInLU=Math.round(this.fromPixelsToVCells(pixels));}
return new Wirecloud.ui.MultiValuedSize(this.getHeightInPixels(sizeInLU),sizeInLU);};DragboardLayout.prototype.adaptWidth=function adaptWidth(size){var parsedSize,pixels,sizeInLU;parsedSize=this.parseSize(size);if(parsedSize[1]==='cells'){sizeInLU=Math.round(parsedSize[0]);}else{if(parsedSize[1]==='%'){pixels=Math.round((parsedSize[0]*this.getWidth())/100);}else{pixels=this.padWidth(parsedSize[0]);}
sizeInLU=Math.round(this.fromPixelsToHCells(pixels));}
return new Wirecloud.ui.MultiValuedSize(this.getWidthInPixels(sizeInLU),sizeInLU);};DragboardLayout.prototype.padWidth=function padWidth(width){return width;};DragboardLayout.prototype.padHeight=function padHeight(height){return height;};DragboardLayout.prototype.isInside=function isInside(x,y){return(x>=0)&&(x<this.getWidth())&&(y>=0);};DragboardLayout.prototype.getWidth=function getWidth(){return this.dragboard.getWidth();};DragboardLayout.prototype.getHeight=function getHeight(){return this.dragboard.getHeight();};Object.defineProperty(DragboardLayout.prototype,"dragboardTopMargin",{get:function(){return this.dragboard.topMargin;}});Object.defineProperty(DragboardLayout.prototype,"dragboardLeftMargin",{get:function(){return this.dragboard.leftMargin;}});DragboardLayout.prototype.addWidget=function addWidget(widget,affectsDragboard){if(widget.layout!=null){var msg=utils.gettext("the widget could not be associated with this layout as it already has an associated layout.");throw new Error(msg);}
widget.layout=this;if(affectsDragboard){this.dragboard._addWidget(widget);}
this.widgets[widget.id]=widget;widget.addEventListener('remove',this._on_remove_widget_bound);widget.repaint();};DragboardLayout.prototype._adaptIWidget=function _adaptIWidget(iWidget){if(iWidget.element!==null){this._ensureMinimalSize(iWidget,false);}};DragboardLayout.prototype._ensureMinimalSize=function _ensureMinimalSize(iWidget,persist){var minWidth=Math.ceil(this.fromPixelsToHCells(80));var minHeight=Math.ceil(this.fromPixelsToVCells(80));var sizeChange=false;var newWidth=iWidget.shape.width;var newHeight=iWidget.shape.height;if(newWidth<minWidth){sizeChange=true;newWidth=minWidth;}
if(newHeight<minHeight){sizeChange=true;newHeight=minHeight;}
if(sizeChange){iWidget.setShape({width:newWidth,height:newHeight});}};DragboardLayout.prototype.removeWidget=function removeWidget(widget,affectsDragboard){delete this.widgets[widget.id];if(affectsDragboard){this.dragboard._removeWidget(widget);}
widget.layout=null;widget.removeEventListener('remove',this._on_remove_widget_bound);return false;};DragboardLayout.prototype.moveTo=function moveTo(destLayout){var iwidget_key,iWidget;for(iwidget_key in this.widgets){iWidget=this.widgets[iwidget_key];iWidget.moveToLayout(destLayout);}};DragboardLayout.prototype.initializeMove=function initializeMove(iWidget,draggable){};DragboardLayout.prototype.moveTemporally=function moveTemporally(x,y){};DragboardLayout.prototype.acceptMove=function acceptMove(){};DragboardLayout.prototype.cancelMove=function cancelMove(){};DragboardLayout.prototype.disableCursor=function disableCursor(){};DragboardLayout.prototype.measure=function measure(testElement,units){var res,cssStyle;testElement.style.visibility="hidden";this.dragboard.tab.appendChild(testElement);res=[];cssStyle=document.defaultView.getComputedStyle(testElement,null);res[0]=cssStyle.getPropertyCSSValue("width").getFloatValue(units);res[1]=cssStyle.getPropertyCSSValue("height").getFloatValue(units);testElement.remove();return res;};DragboardLayout.prototype.unitConvert=function unitConvert(value,newUnits){var testDiv=document.createElement("div");testDiv.style.height=value;testDiv.style.width=value;return this.measure(testDiv,newUnits);};var on_remove_widget=function on_remove_widget(widget){this.removeWidget(widget,true);this.dragboard.update();};Wirecloud.ui.DragboardLayout=DragboardLayout;})(Wirecloud.Utils);;(function(utils){"use strict";var FreeLayout=function FreeLayout(dragboard,scrollbarSpace){if(arguments.length===0){return;}
this.initialized=false;this.iwidgetToMove=null;Wirecloud.ui.DragboardLayout.call(this,dragboard,scrollbarSpace);};FreeLayout.prototype=new Wirecloud.ui.DragboardLayout();FreeLayout.prototype.MAX_HLU=1000000;FreeLayout.prototype.fromPixelsToVCells=function fromPixelsToVCells(pixels){return pixels;};FreeLayout.prototype.fromVCellsToPixels=function fromVCellsToPixels(cells){return cells;};FreeLayout.prototype.getWidthInPixels=function getWidthInPixels(cells){return this.fromHCellsToPixels(cells);};FreeLayout.prototype.getHeightInPixels=function getHeightInPixels(cells){return this.fromVCellsToPixels(cells);};FreeLayout.prototype.fromPixelsToHCells=function fromPixelsToHCells(pixels){return(pixels*this.MAX_HLU/this.getWidth());};FreeLayout.prototype.fromHCellsToPixels=function fromHCellsToPixels(cells){return Math.round((this.getWidth()*cells)/this.MAX_HLU);};FreeLayout.prototype.fromHCellsToPercentage=function fromHCellsToPercentage(cells){return cells/(this.MAX_HLU/100);};FreeLayout.prototype.getColumnOffset=function getColumnOffset(column){return this.dragboardLeftMargin+this.fromHCellsToPixels(column);};FreeLayout.prototype.getRowOffset=function getRowOffset(row){return this.dragboardTopMargin+row;};FreeLayout.prototype.adaptColumnOffset=function adaptColumnOffset(size){var offsetInLU,offsetInPixels,pixels,parsedSize;parsedSize=this.parseSize(size);if(parsedSize[1]==='cells'){offsetInLU=Math.round(parsedSize[0]);}else{if(parsedSize[1]==='%'){pixels=Math.round((parsedSize[0]*this.getWidth())/100);}else{pixels=parsedSize[0];}
offsetInLU=Math.round(this.fromPixelsToHCells(pixels));}
offsetInPixels=this.fromHCellsToPixels(offsetInLU);return new Wirecloud.ui.MultiValuedSize(offsetInPixels,offsetInLU);};FreeLayout.prototype.adaptRowOffset=function adaptRowOffset(size){var pixels,parsedSize;parsedSize=this.parseSize(size);switch(parsedSize[1]){case"%":pixels=Math.round((parsedSize[0]*this.getHeight())/100);break;case"cells":case"px":pixels=parsedSize[0];break;}
return new Wirecloud.ui.MultiValuedSize(pixels,pixels);};FreeLayout.prototype.adaptHeight=function adaptHeight(size){var pixels,parsedSize;parsedSize=this.parseSize(size);switch(parsedSize[1]){case"%":pixels=Math.round((parsedSize[0]*this.getHeight())/100);break;case"cells":case"px":pixels=parsedSize[0];break;}
return new Wirecloud.ui.MultiValuedSize(pixels,pixels);};FreeLayout.prototype._notifyWindowResizeEvent=function _notifyWindowResizeEvent(widthChanged,heightChanged){if(widthChanged){Wirecloud.ui.DragboardLayout.prototype._notifyWindowResizeEvent.call(this,widthChanged,heightChanged);}};FreeLayout.prototype._notifyResizeEvent=function _notifyResizeEvent(iWidget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){if(resizeLeftSide){var widthDiff=newWidth-oldWidth;var position=iWidget.position;position.x-=widthDiff;iWidget.setPosition(position);iWidget.repaint();}
if(persist){this.dragboard.update([iWidget.id]);}};FreeLayout.prototype.initialize=function initialize(){var iWidget,key;for(key in this.widgets){iWidget=this.widgets[key];iWidget.repaint();}
this.initialized=true;};FreeLayout.prototype.getCellAt=function getCellAt(x,y){return new Wirecloud.DragboardPosition(((x-this.dragboardLeftMargin)*this.MAX_HLU)/this.getWidth(),y-this.dragboardTopMargin);};FreeLayout.prototype.addWidget=function addWidget(iWidget,affectsDragboard){Wirecloud.ui.DragboardLayout.prototype.addWidget.call(this,iWidget,affectsDragboard);if(!this.initialized){return;}
this._adaptIWidget(iWidget);};FreeLayout.prototype.initializeMove=function initializeMove(iwidget,draggable){var msg;draggable=draggable||null;if(!(iwidget instanceof Wirecloud.ui.WidgetView)){throw new TypeError("widget must be an WidgetView instance");}
if(this.iwidgetToMove!==null){msg="Dragboard: There was a pending move that was cancelled because initializedMove function was called before it was finished.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);this.cancelMove();}
this.iwidgetToMove=iwidget;this.newPosition=iwidget.position;if(draggable){draggable.setXOffset(0);draggable.setYOffset(0);}};FreeLayout.prototype.moveTemporally=function moveTemporally(x,y){if(this.iwidgetToMove==null){var msg="Dragboard: You must call initializeMove function before calling to this function (moveTemporally).";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this.newPosition.x=x;this.newPosition.y=y;};FreeLayout.prototype.acceptMove=function acceptMove(){if(this.iwidgetToMove==null){var msg="Dragboard: Function acceptMove called when there is not an started iwidget move.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
if(this.newPosition.x>(this.MAX_HLU-1)){this.newPosition.x=(this.MAX_HLU-1);}
if(this.newPosition.y<0){this.newPosition.y=0;}
this.iwidgetToMove.setPosition(this.newPosition);this.dragboard.update([this.iwidgetToMove.id]);this.iwidgetToMove=null;this.newPosition=null;};FreeLayout.prototype.cancelMove=function cancelMove(){var msg;if(this.iwidgetToMove==null){msg="Trying to cancel an inexistant temporal move.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this.iwidgetToMove.repaint();this.iwidgetToMove=null;this.newPosition=null;};Wirecloud.ui.FreeLayout=FreeLayout;})(Wirecloud.Utils);;(function(){"use strict";var FullDragboardLayout=function FullDragboardLayout(dragboard,scrollbarSpace){if(arguments.length===0){return;}
this.initialized=false;Wirecloud.ui.DragboardLayout.call(this,dragboard,scrollbarSpace);};FullDragboardLayout.prototype=new Wirecloud.ui.DragboardLayout();FullDragboardLayout.prototype.fromPixelsToVCells=function fromPixelsToVCells(pixels){return 1;};FullDragboardLayout.prototype.fromVCellsToPixels=function fromVCellsToPixels(cells){return this.getHeight();};FullDragboardLayout.prototype.getWidthInPixels=function getWidthInPixels(cells){return this.getWidth();};FullDragboardLayout.prototype.getHeightInPixels=function getHeightInPixels(cells){return this.getHeight();};FullDragboardLayout.prototype.fromPixelsToHCells=function fromPixelsToHCells(pixels){return 1;};FullDragboardLayout.prototype.fromHCellsToPixels=function fromHCellsToPixels(cells){return this.getWidth();};FullDragboardLayout.prototype.fromHCellsToPercentage=function fromHCellsToPercentage(cells){return this.getHeight();};FullDragboardLayout.prototype.getColumnOffset=function getColumnOffset(column){return this.dragboard.tab.wrapperElement.getBoundingClientRect().left+this.dragboardLeftMargin;};FullDragboardLayout.prototype.getRowOffset=function getRowOffset(row){return this.dragboard.tab.wrapperElement.getBoundingClientRect().top;};FullDragboardLayout.prototype.adaptColumnOffset=function adaptColumnOffset(size){return new Wirecloud.ui.MultiValuedSize(this.dragboard.tab.wrapperElement.getBoundingClientRect().left,0);};FullDragboardLayout.prototype.adaptRowOffset=function adaptRowOffset(size){return new Wirecloud.ui.MultiValuedSize(this.dragboard.tab.wrapperElement.getBoundingClientRect().top,0);};FullDragboardLayout.prototype.adaptHeight=function adaptHeight(size){return new Wirecloud.ui.MultiValuedSize(this.getHeight(),1);};FullDragboardLayout.prototype.adaptWidth=function adaptWidth(size){return new Wirecloud.ui.MultiValuedSize(this.getWidth(),1);};FullDragboardLayout.prototype.initialize=function initialize(){var iWidget,key;for(key in this.iWidgets){iWidget=this.iWidgets[key];iWidget.paint(true);}
this.initialized=true;};FullDragboardLayout.prototype.getCellAt=function getCellAt(x,y){return new Wirecloud.DragboardPosition(0,0);};FullDragboardLayout.prototype.addWidget=function addWidget(iWidget,affectsDragboard){iWidget.wrapperElement.classList.add('wc-widget-fulldragboard');Wirecloud.ui.DragboardLayout.prototype.addWidget.call(this,iWidget,affectsDragboard);if(!this.initialized){return;}
iWidget.setPosition(new Wirecloud.DragboardPosition(0,0));};FullDragboardLayout.prototype.removeWidget=function removeWidget(iWidget,affectsDragboard){iWidget.wrapperElement.classList.remove('wc-widget-fulldragboard');Wirecloud.ui.DragboardLayout.prototype.removeWidget.call(this,iWidget,affectsDragboard);};Wirecloud.ui.FullDragboardLayout=FullDragboardLayout;})();;(function(utils){"use strict";var ColumnLayout=function ColumnLayout(dragboard,columns,cellHeight,verticalMargin,horizontalMargin,scrollbarSpace){if(arguments.length===0){return;}
this.initialized=false;this._buffers={"base":{}};this.columns=columns;this.cellHeight=cellHeight;if((verticalMargin%2)===0){this.topMargin=verticalMargin/2;this.bottomMargin=verticalMargin/2;}else{this.topMargin=Math.floor(verticalMargin/2);this.bottomMargin=Math.floor(verticalMargin/2)+1;}
if((horizontalMargin%2)===0){this.leftMargin=horizontalMargin/2;this.rightMargin=horizontalMargin/2;}else{this.leftMargin=Math.floor(horizontalMargin/2);this.rightMargin=Math.floor(horizontalMargin/2)+1;}
this._clearMatrix();this._buffers.base={matrix:this.matrix,};this.dragboardCursor=null;this.iwidgetToMove=null;Wirecloud.ui.DragboardLayout.call(this,dragboard,scrollbarSpace);};ColumnLayout.prototype=new Wirecloud.ui.DragboardLayout();ColumnLayout.prototype.getColumns=function(){return this.columns;};ColumnLayout.prototype.getRows=function(){var x,rows=0;for(x=0;x<this.columns;x+=1){rows=Math.max(rows,this.matrix[x].length);}
return rows;};ColumnLayout.prototype.getCellHeight=function(){return this.cellHeight;};ColumnLayout.prototype.fromPixelsToVCells=function(pixels){return pixels>0?(pixels/this.cellHeight):0;};ColumnLayout.prototype.fromVCellsToPixels=function(cells){return(cells*this.cellHeight);};ColumnLayout.prototype.getWidthInPixels=function(cells){return this.fromHCellsToPixels(cells)-this.leftMargin-this.rightMargin;};ColumnLayout.prototype.getHeightInPixels=function(cells){return this.fromVCellsToPixels(cells)-this.topMargin-this.bottomMargin;};ColumnLayout.prototype.fromPixelsToHCells=function(pixels){var cells=pixels/this.fromHCellsToPixels(1);var truncatedCells=Math.floor(cells);if(Math.ceil(this.fromHCellsToPixels(truncatedCells))===pixels){return truncatedCells;}else{return cells;}};ColumnLayout.prototype.fromHCellsToPixels=function(cells){return(this.getWidth()*this.fromHCellsToPercentage(cells))/100;};ColumnLayout.prototype.fromHCellsToPercentage=function(cells){return cells*(100/this.columns);};ColumnLayout.prototype.adaptColumnOffset=function adaptColumnOffset(size){var offsetInLU,pixels,parsedSize;parsedSize=this.parseSize(size);if(parsedSize[1]==='cells'){offsetInLU=Math.round(parsedSize[0]);}else{if(parsedSize[1]==='%'){pixels=Math.round((parsedSize[0]*this.getWidth())/100);}else{pixels=parsedSize[0];}
offsetInLU=Math.round(this.fromPixelsToHCells(pixels-this.leftMargin));}
return new Wirecloud.ui.MultiValuedSize(this.getColumnOffset(offsetInLU),offsetInLU);};ColumnLayout.prototype.adaptRowOffset=function adaptRowOffset(size){var offsetInLU,pixels,parsedSize;parsedSize=this.parseSize(size);if(parsedSize[1]==='cells'){offsetInLU=Math.round(parsedSize[0]);}else{if(parsedSize[1]==='%'){pixels=Math.round((parsedSize[0]*this.getWidth())/100);}else{pixels=parsedSize[0];}
offsetInLU=Math.round(this.fromPixelsToVCells(pixels-this.topMargin));}
return new Wirecloud.ui.MultiValuedSize(this.getRowOffset(offsetInLU),offsetInLU);};ColumnLayout.prototype.padWidth=function(width){return width+this.leftMargin+this.rightMargin;};ColumnLayout.prototype.padHeight=function(height){return height+this.topMargin+this.bottomMargin;};ColumnLayout.prototype.getColumnOffset=function(column){var tmp=Math.floor((this.getWidth()*this.fromHCellsToPercentage(column))/100);tmp+=this.leftMargin+this.dragboardLeftMargin;return tmp;};ColumnLayout.prototype.getRowOffset=function(row){return this.dragboardTopMargin+this.fromVCellsToPixels(row)+this.topMargin;};ColumnLayout.prototype._getPositionOn=function _getPositionOn(buffer,widget){if(buffer===this.matrix||buffer==="base"){return widget.position;}else{return this._buffers[buffer].positions[widget.id];}};ColumnLayout.prototype._setPositionOn=function _setPositionOn(buffer,widget,position){if(buffer===this.matrix||buffer==="base"){widget.setPosition(position);}else{this._buffers[buffer].positions[widget.id]=position;}};ColumnLayout.prototype._clearMatrix=function(){this.matrix=[];this._buffers.base.matrix=this.matrix;for(var x=0;x<this.getColumns();x++){this.matrix[x]=[];}};ColumnLayout.prototype._hasSpaceFor=function(_matrix,positionX,positionY,width,height){var x,y;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){if(_matrix[positionX+x][positionY+y]!=null){return false;}}}
return true;};ColumnLayout.prototype._reserveSpace=function(_matrix,widget){var x,y;var position=this._getPositionOn(_matrix,widget);var width=widget.shape.width;var height=widget.shape.height;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[position.x+x][position.y+y]=widget;}}};ColumnLayout.prototype._clearSpace=function(_matrix,widget){var x,y;var position=this._getPositionOn(_matrix,widget);var width=widget.shape.width;var height=widget.shape.height;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[position.x+x][position.y+y];}}
this._compressColumns(_matrix,position.x,width);};ColumnLayout.prototype._compressColumns=function _compressColumns(_matrix,x,width){var i,y;for(i=0;i<width;i++){for(y=_matrix[x+i].length-1;y>=0;y--){if(_matrix[x+i][y]!=null){break;}
_matrix[x+i].pop();}}};ColumnLayout.prototype._searchInsertPoint=function _searchInsertPoint(_matrix,x,y,width,height){return y;};ColumnLayout.prototype._moveSpaceDown=function _moveSpaceDown(buffer,widget,offsetY){var affectedIWidgets,position,finalPosition,edgeY,curwidget,x,y,key,matrix;affectedIWidgets={};matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,widget);finalPosition=new Wirecloud.DragboardPosition(position.x,position.y+offsetY);edgeY=position.y+widget.shape.height;for(x=0;x<widget.shape.width;x++){for(y=0;y<offsetY;y++){curwidget=matrix[position.x+x][edgeY+y];if(curwidget!=null){affectedIWidgets[curwidget.id]=offsetY-y;break;}}}
for(key in affectedIWidgets){curwidget=this.widgets[key];this._moveSpaceDown(buffer,curwidget,affectedIWidgets[key]);}
this._clearSpace(buffer,widget);this._setPositionOn(buffer,widget,finalPosition);this._reserveSpace(buffer,widget);};ColumnLayout.prototype._moveSpaceUp=function(buffer,widget){var position,edgeY,offsetY,affectedIWidgets,finalPosition,curWidget,x,y,columnsize,key,matrix;matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,widget);edgeY=position.y+widget.shape.height;offsetY=1;while(((position.y-offsetY)>=0)&&this._hasSpaceFor(matrix,position.x,position.y-offsetY,widget.shape.width,1)){offsetY+=1;}
offsetY-=1;if(offsetY>0){affectedIWidgets={};finalPosition=new Wirecloud.DragboardPosition(position.x,position.y-offsetY);for(x=0;x<widget.shape.width;x++){columnsize=matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){curWidget=matrix[position.x+x][y];if(curWidget!=null){affectedIWidgets[curWidget.id]=curWidget;break;}}}
this._clearSpace(buffer,widget);this._setPositionOn(buffer,widget,finalPosition);this._reserveSpace(buffer,widget);for(key in affectedIWidgets){this._moveSpaceUp(buffer,affectedIWidgets[key]);}
return true;}
return false;};ColumnLayout.prototype._removeFromMatrix=function(_matrix,widget){this._clearSpace(_matrix,widget);return false;};ColumnLayout.prototype._reserveSpace2=function(_matrix,widget,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[positionX+x][positionY+y]=widget;}}};ColumnLayout.prototype._clearSpace2=function(_matrix,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[positionX+x][positionY+y];}}
this._compressColumns(_matrix,positionX,width);};ColumnLayout.prototype._notifyResizeEvent=function(widget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){var x,y;var step2Width=oldWidth;var position=widget.position;var step2X,iWidgetToMove,finalYPos,widthDiff;step2X=position.x;if(newWidth>oldWidth){step2Width=oldWidth;finalYPos=position.y+newHeight;if(resizeLeftSide){widthDiff=newWidth-oldWidth;for(x=position.x-widthDiff;x<position.x;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
position.x-=widthDiff;widget.setPosition(position);this._reserveSpace2(this.matrix,widget,position.x,position.y,widthDiff,newHeight);}else{for(x=position.x+oldWidth;x<position.x+newWidth;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
this._reserveSpace2(this.matrix,widget,position.x+oldWidth,position.y,newWidth-oldWidth,newHeight);}}else if(newWidth<oldWidth){step2Width=newWidth;widthDiff=oldWidth-newWidth;if(resizeLeftSide){this._clearSpace2(this.matrix,position.x,position.y,widthDiff,oldHeight);position.x+=widthDiff;widget.setPosition(position);step2X=position.x;}else{this._clearSpace2(this.matrix,position.x+newWidth,position.y,widthDiff,oldHeight);}}
if(newHeight>oldHeight){var limitY=position.y+newHeight;var limitX=step2X+step2Width;for(y=position.y+oldHeight;y<limitY;y++){for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceDown("base",this.matrix[x][y],limitY-y);}}}
this._reserveSpace2(this.matrix,widget,step2X,position.y+oldHeight,step2Width,newHeight-oldHeight);}else if(newHeight<oldHeight){this._clearSpace2(this.matrix,step2X,position.y+newHeight,step2Width,oldHeight-newHeight);}
this._notifyWindowResizeEvent(true,true);if(persist){this.dragboard.update();}};ColumnLayout.prototype._insertAt=function _insertAt(widget,x,y,buffer){var newPosition=new Wirecloud.DragboardPosition(x>0?x:0,y>0?y:0);var affectedwidget,offset,affectedY,matrix;var affectedWidgets=false;var lastX=newPosition.x+widget.shape.width;var lastY=newPosition.y+widget.shape.height;if(buffer==null){buffer="base";}
matrix=this._buffers[buffer].matrix;for(x=newPosition.x;x<lastX;x++){for(y=newPosition.y;y<lastY;y++){affectedwidget=matrix[x][y];if(affectedwidget!=null){affectedY=this._getPositionOn(buffer,affectedwidget).y;offset=lastY-affectedY;this._moveSpaceDown(buffer,affectedwidget,offset);affectedWidgets=true;break;}}}
this._setPositionOn(buffer,widget,newPosition);this._reserveSpace(buffer,widget);return affectedWidgets;};ColumnLayout.prototype._searchFreeSpace=function(width,height){var positionX=0,positionY=0;var maxX=this.columns-width;for(positionY=0;true;positionY++){for(positionX=0;positionX<=maxX;positionX++){if(this._hasSpaceFor(this.matrix,positionX,positionY,width,height)){return new Wirecloud.DragboardPosition(positionX,positionY);}}}};ColumnLayout.prototype.initialize=function(){var widget,i,key,position,iWidgetsToReinsert=[];this._clearMatrix();for(key in this.widgets){widget=this.widgets[key];position=widget.position;widget.repaint();if(widget.shape.width>this.getColumns()){widget.contentWidth=this.getColumns();}
if(widget.shape.width+position.x>this.getColumns()){iWidgetsToReinsert.push(widget);}else if(this._hasSpaceFor(this.matrix,position.x,position.y,widget.shape.width,widget.shape.height)){this._reserveSpace(this.matrix,widget);}else{iWidgetsToReinsert.push(widget);}}
var modified=false;if(iWidgetsToReinsert.length>0){for(i=0;i<iWidgetsToReinsert.length;i++){position=this._searchFreeSpace(iWidgetsToReinsert[i].shape.width,iWidgetsToReinsert[i].shape.height);iWidgetsToReinsert[i].setPosition(position);this._reserveSpace(this.matrix,iWidgetsToReinsert[i]);}
modified=true;}
this.initialized=true;return modified;};ColumnLayout.prototype.getCellAt=function(x,y){var columnWidth=this.getWidth()/this.getColumns();return new Wirecloud.DragboardPosition(Math.floor(x/columnWidth),Math.floor(y/this.getCellHeight()));};ColumnLayout.prototype.addWidget=function addWidget(widget,affectsDragboard){var affectedWidgets=false;Wirecloud.ui.DragboardLayout.prototype.addWidget.call(this,widget,affectsDragboard);if(!this.initialized){return;}
if(widget.shape.width>this.getColumns()){widget.setShape({width:this.getColumns()});}
var position=widget.position;if(position){var diff=widget.shape.width+position.x-this.getColumns();if(diff>0){position.x-=diff;}
affectedWidgets=this._insertAt(widget,position.x,position.y,"base");}else{position=this._searchFreeSpace(widget.shape.width,widget.shape.height);widget.setPosition(position);this._reserveSpace(this.matrix,widget);}
this._adaptIWidget(widget);return affectedWidgets;};ColumnLayout.prototype.removeWidget=function removeWidget(widget,affectsDragboard){var affectedWidgets;affectedWidgets=this._removeFromMatrix("base",widget);Wirecloud.ui.DragboardLayout.prototype.removeWidget.call(this,widget,affectsDragboard);return affectedWidgets;};ColumnLayout.prototype.moveTo=function(destLayout){var movedWidgets,orderedWidgets,x,y,i,columns,rows,widget;this._removeFromMatrix=ColumnLayout.prototype._removeFromMatrix;movedWidgets={};orderedWidgets=[];columns=this.getColumns();rows=this.getRows();for(y=0;y<rows;y+=1){for(x=0;x<columns;x+=1){widget=this.matrix[x][y];if(widget!=null&&!(widget.id in movedWidgets)){orderedWidgets.push(widget);movedWidgets[widget.id]=true;}}}
for(i=0;i<orderedWidgets.length;i+=1){widget=orderedWidgets[i];widget.moveToLayout(destLayout);}
delete this._removeFromMatrix;};ColumnLayout.prototype._cloneMatrix=function _cloneMatrix(matrix){var i,cloned_matrix=[];for(i=0;i<this.columns;i++){cloned_matrix[i]=Wirecloud.Utils.clone(matrix[i]);}
return cloned_matrix;};ColumnLayout.prototype._clonePositions=function _clonePositions(buffer){var key,positions={};for(key in this.widgets){positions[key]=utils.clone(this._getPositionOn(buffer,this.widgets[key]));}
return positions;};ColumnLayout.prototype.initializeMove=function(widget,draggable){var msg,i,lastWidget,lastY,tmp;draggable=draggable||null;if(!(widget instanceof Wirecloud.ui.WidgetView)){throw new TypeError("widget must be an WidgetView instance");}
if(this.iwidgetToMove!=null){msg="Dragboard: There was a pending move that was cancelled because initializedMove function was called before it was finished.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);this.cancelMove();}
this.iwidgetToMove=widget;this._buffers.backup={};this._buffers.backup.positions=this._clonePositions(this.matrix);this._buffers.shadow={"matrix":this.matrix};lastY=0;this._buffers.backup.matrix=this._cloneMatrix(this.matrix);this._removeFromMatrix("backup",widget);this.searchInsertPointCache=[];for(i=0;i<this.columns;i++){this.searchInsertPointCache[i]=[];lastWidget=this.matrix[i][this.matrix[i].length-1];if(!lastWidget){continue;}
tmp=lastWidget.position.y+lastWidget.shape.height;if(tmp>lastY){lastY=tmp;}}
this.searchInsertPointYLimit=lastY+1;this.dragboardCursor=new Wirecloud.ui.DragboardCursor(widget);if(draggable){draggable.setXOffset(this.fromHCellsToPixels(1)/2);draggable.setYOffset(this.getCellHeight());}};ColumnLayout.prototype._destroyCursor=function _destroyCursor(){if(this.dragboardCursor!==null){this.dragboardCursor.destroy();this.dragboardCursor=null;}};ColumnLayout.prototype.disableCursor=function(){this._destroyCursor();};ColumnLayout.prototype._setPositions=function _setPositions(){var key,curIWidget;for(key in this.widgets){curIWidget=this.widgets[key];if(curIWidget!==this.iwidgetToMove){curIWidget.setPosition(this._getPositionOn("shadow",curIWidget));}}
this.dragboardCursor.setPosition(this._getPositionOn("shadow",this.dragboardCursor));};ColumnLayout.prototype.moveTemporally=function moveTemporally(x,y){if(this.iwidgetToMove==null){var msg="Dragboard: You must call initializeMove function before calling to this function (moveTemporally).";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var maxX=this.getColumns()-this.iwidgetToMove.shape.width;if(x>maxX){x=maxX;}
if(this.dragboardCursor!=null){var cursorpos=this.dragboardCursor.position;if((cursorpos.y!==y)||(cursorpos.x!==x)){this._buffers.shadow.positions=this._clonePositions("backup");this._buffers.shadow.matrix=this._cloneMatrix(this._buffers.backup.matrix);this._insertAt(this.dragboardCursor,x,y,"shadow");this._setPositions();}}else{this._buffers.shadow.positions=this._clonePositions("backup");this._buffers.shadow.matrix=this._cloneMatrix(this._buffers.backup.matrix);this.dragboardCursor=new Wirecloud.ui.DragboardCursor(this.iwidgetToMove);this._insertAt(this.dragboardCursor,x,y,"shadow");}};ColumnLayout.prototype.cancelMove=function(){if(this.iwidgetToMove==null){var msg="Dragboard: Trying to cancel an inexistant temporal move.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this._destroyCursor();for(var key in this.widgets){this.widgets[key].setPosition(this.widgets[key].position);}
this.iwidgetToMove=null;this.dragboardCursor=null;};ColumnLayout.prototype.acceptMove=function(){if(this.iwidgetToMove==null){var msg="Dragboard: Function acceptMove called when there is not an started widget move.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var oldposition=this.iwidgetToMove.position;var newposition=this.dragboardCursor.position;this._destroyCursor();this.iwidgetToMove.setPosition(newposition);if(oldposition.y!==newposition.y||oldposition.x!==newposition.x){this.matrix=this._buffers.shadow.matrix;this._buffers.base.matrix=this.matrix;this._reserveSpace("base",this.iwidgetToMove);this.dragboard.update();}
this.dragboard._notifyWindowResizeEvent();this.iwidgetToMove=null;this.dragboardCursor=null;};Wirecloud.ui.ColumnLayout=ColumnLayout;})(Wirecloud.Utils);;(function(){"use strict";var SmartColumnLayout=function SmartColumnLayout(dragboard,columns,cellHeight,verticalMargin,horizontalMargin,scrollbarSpace){Wirecloud.ui.ColumnLayout.call(this,dragboard,columns,cellHeight,verticalMargin,horizontalMargin,scrollbarSpace);};SmartColumnLayout.prototype=new Wirecloud.ui.ColumnLayout();SmartColumnLayout.prototype._realSearchInsertPoint=function(_matrix,x,y,width,height){var widthDiff,lastY,offsetX;if(y===0){return 0;}else if((_matrix[x][y-1]!=null)&&(_matrix[x][y-1]!=_matrix[x][y])){return y;}else if(_matrix[x][y]){widthDiff=_matrix[x][y].shape.width-width;widthDiff-=x-this._getPositionOn(_matrix,_matrix[x][y]).x;if(widthDiff>0){y=this._getPositionOn(_matrix,_matrix[x][y]).y-1;while((y>=0)&&(this._hasSpaceFor(_matrix,x,y,width,1))){y--;}
return++y;}else if(widthDiff!==0){for(;y>1;y--){for(offsetX=0;offsetX<width;offsetX++){if(_matrix[x+offsetX][y]!=_matrix[x+offsetX][y-1]){if(_matrix[x+offsetX][y-1]){return y;}}}}
return 0;}else{return this._getPositionOn(_matrix,_matrix[x][y]).y;}}
lastY=y;while((y>=0)&&(this._hasSpaceFor(_matrix,x,y,width,1))){y--;}
if(y!=lastY){y++;}else{for(;y>1;y--){for(offsetX=0;offsetX<width;offsetX++){if(_matrix[x+offsetX][y]!=_matrix[x+offsetX][y-1]){if(_matrix[x+offsetX][y-1]){return y;}}}}
return 0;}
return y;};SmartColumnLayout.prototype._searchInsertPoint=function(_matrix,x,y,width,height){if(y>this.searchInsertPointYLimit){y=this.searchInsertPointYLimit;}
if(!this.searchInsertPointCache[x][y]){this.searchInsertPointCache[x][y]=this._realSearchInsertPoint(_matrix,x,y,width,height);}
return this.searchInsertPointCache[x][y];};SmartColumnLayout.prototype.initialize=function(){var modified=Wirecloud.ui.ColumnLayout.prototype.initialize.call(this);var widget,key,keys=[];for(key in this.widgets){keys.push(key);widget=this.widgets[key];modified=modified||this._moveSpaceUp("base",widget);}
if(modified){this.dragboard.update(keys);}};SmartColumnLayout.prototype._notifyWindowResizeEvent=function(widthChanged,heightChanged){if(widthChanged){Wirecloud.ui.DragboardLayout.prototype._notifyWindowResizeEvent.call(this,widthChanged,heightChanged);}};SmartColumnLayout.prototype._notifyResizeEvent=function(widget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){var x,y;var step2Width=oldWidth;var position=widget.position;var step2X,finalYPos,widthDiff,iWidgetToMove,limitX,limitY;step2X=position.x;if(newWidth>oldWidth){step2Width=oldWidth;finalYPos=position.y+newHeight;if(resizeLeftSide){widthDiff=newWidth-oldWidth;for(x=position.x-widthDiff;x<position.x;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
position.x-=widthDiff;widget.setPosition(position);this._reserveSpace2(this.matrix,widget,position.x,position.y,widthDiff,newHeight);}else{for(x=position.x+oldWidth;x<position.x+newWidth;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
this._reserveSpace2(this.matrix,widget,position.x+oldWidth,position.y,newWidth-oldWidth,newHeight);}}else if(newWidth<oldWidth){step2Width=newWidth;widthDiff=oldWidth-newWidth;if(resizeLeftSide){this._clearSpace2(this.matrix,position.x,position.y,widthDiff,oldHeight);y=position.y+oldHeight;limitX=position.x+widthDiff;for(x=position.x;x<limitX;++x){if(this.matrix[x][y]!=null){this._moveSpaceUp("base",this.matrix[x][y]);}}
position.x+=widthDiff;widget.setPosition(position);step2X=position.x;}else{this._clearSpace2(this.matrix,position.x+newWidth,position.y,widthDiff,oldHeight);y=position.y+oldHeight;limitX=position.x+oldWidth;for(x=position.x+newWidth;x<limitX;++x){if(this.matrix[x][y]!=null){this._moveSpaceUp("base",this.matrix[x][y]);}}}}
if(newHeight>oldHeight){limitY=position.y+newHeight;limitX=step2X+step2Width;for(y=position.y+oldHeight;y<limitY;y++){for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceDown("base",this.matrix[x][y],limitY-y);}}}
this._reserveSpace2(this.matrix,widget,step2X,position.y+oldHeight,step2Width,newHeight-oldHeight);}else if(newHeight<oldHeight){this._clearSpace2(this.matrix,step2X,position.y+newHeight,step2Width,oldHeight-newHeight);y=position.y+oldHeight;limitX=step2X+step2Width;for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceUp("base",this.matrix[x][y]);}}}
this._notifyWindowResizeEvent(true,true);if(persist){this._moveSpaceUp("base",widget);this.dragboard.update();}};SmartColumnLayout.prototype._insertAt=function(widget,x,y,buffer){var affectedWidgets=Wirecloud.ui.ColumnLayout.prototype._insertAt.call(this,widget,x,y,buffer);this._moveSpaceUp(buffer,widget);return affectedWidgets;};SmartColumnLayout.prototype._removeFromMatrix=function(buffer,widget){this._clearSpace(buffer,widget);var modified=false,affectedIWidgets={};var affectedwidget,x,y,columnsize;var position=this._getPositionOn(buffer,widget);var edgeY=position.y+widget.shape.height;var _matrix=this._buffers[buffer].matrix;for(x=0;x<widget.shape.width;x++){columnsize=_matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){affectedwidget=_matrix[position.x+x][y];if((affectedwidget!=null)&&(typeof affectedIWidgets[affectedwidget.id]!==true)){affectedIWidgets[affectedwidget.id]=true;modified=true;this._moveSpaceUp(buffer,affectedwidget);break;}}}
return modified;};Wirecloud.ui.SmartColumnLayout=SmartColumnLayout;})();;(function(utils){"use strict";var GridLayout=function GridLayout(dragboard,columns,rows,verticalMargin,horizontalMargin){if(arguments.length===0){return;}
this.initialized=false;this._buffers={"base":{}};Object.defineProperties(this,{'columns':{value:columns},'rows':{value:rows}});if((verticalMargin%2)===0){this.topMargin=verticalMargin/2;this.bottomMargin=verticalMargin/2;}else{this.topMargin=Math.floor(verticalMargin/2);this.bottomMargin=Math.floor(verticalMargin/2)+1;}
if((horizontalMargin%2)===0){this.leftMargin=horizontalMargin/2;this.rightMargin=horizontalMargin/2;}else{this.leftMargin=Math.floor(horizontalMargin/2);this.rightMargin=Math.floor(horizontalMargin/2)+1;}
clearMatrix.call(this);this._buffers.base={matrix:this.matrix,};this.dragboardCursor=null;this.iwidgetToMove=null;Wirecloud.ui.DragboardLayout.call(this,dragboard);};GridLayout.prototype=new Wirecloud.ui.DragboardLayout();GridLayout.prototype.fromPixelsToVCells=function fromPixelsToVCells(pixels){var cells=pixels/this.fromVCellsToPixels(1);var truncatedCells=Math.floor(cells);if(Math.ceil(this.fromVCellsToPixels(truncatedCells))===pixels){return truncatedCells;}else{return cells;}};GridLayout.prototype.fromVCellsToPixels=function fromVCellsToPixels(rows){return(this.getHeight()*this.fromVCellsToPercentage(rows))/100;};GridLayout.prototype.fromVCellsToPercentage=function fromVCellsToPercentage(rows){return rows*(100/this.rows);};GridLayout.prototype.getWidthInPixels=function getWidthInPixels(cells){return this.fromHCellsToPixels(cells)-this.leftMargin-this.rightMargin;};GridLayout.prototype.getHeightInPixels=function getHeightInPixels(cells){return this.fromVCellsToPixels(cells)-this.topMargin-this.bottomMargin;};GridLayout.prototype.fromPixelsToHCells=function fromPixelsToHCells(pixels){var cells=pixels/this.fromHCellsToPixels(1);var truncatedCells=Math.floor(cells);if(Math.ceil(this.fromHCellsToPixels(truncatedCells))===pixels){return truncatedCells;}else{return cells;}};GridLayout.prototype.fromHCellsToPixels=function fromHCellsToPixels(columns){return(this.getWidth()*this.fromHCellsToPercentage(columns))/100;};GridLayout.prototype.fromHCellsToPercentage=function fromHCellsToPercentage(columns){return columns*(100/this.columns);};GridLayout.prototype.adaptColumnOffset=function adaptColumnOffset(size){var offsetInLU,pixels,parsedSize;parsedSize=this.parseSize(size);if(parsedSize[1]==='cells'){offsetInLU=Math.round(parsedSize[0]);}else{if(parsedSize[1]==='%'){pixels=Math.round((parsedSize[0]*this.getWidth())/100);}else{pixels=parsedSize[0];}
offsetInLU=Math.round(this.fromPixelsToHCells(pixels-this.leftMargin));}
return new Wirecloud.ui.MultiValuedSize(this.getColumnOffset(offsetInLU),offsetInLU);};GridLayout.prototype.adaptRowOffset=function adaptRowOffset(size){var offsetInLU,pixels,parsedSize;parsedSize=this.parseSize(size);if(parsedSize[1]==='cells'){offsetInLU=Math.round(parsedSize[0]);}else{if(parsedSize[1]==='%'){pixels=Math.round((parsedSize[0]*this.getWidth())/100);}else{pixels=parsedSize[0];}
offsetInLU=Math.round(this.fromPixelsToVCells(pixels-this.topMargin));}
return new Wirecloud.ui.MultiValuedSize(this.getRowOffset(offsetInLU),offsetInLU);};GridLayout.prototype.padWidth=function(width){return width+this.leftMargin+this.rightMargin;};GridLayout.prototype.padHeight=function(height){return height+this.topMargin+this.bottomMargin;};GridLayout.prototype.getColumnOffset=function(column){var tmp=Math.floor((this.getWidth()*this.fromHCellsToPercentage(column))/100);tmp+=this.leftMargin+this.dragboardLeftMargin;return tmp;};GridLayout.prototype.getRowOffset=function(row){return this.dragboardTopMargin+this.fromVCellsToPixels(row)+this.topMargin;};GridLayout.prototype._getPositionOn=function _getPositionOn(buffer,widget){if(buffer===this.matrix||buffer==="base"){return widget.position;}else{return this._buffers[buffer].positions[widget.id];}};GridLayout.prototype._setPositionOn=function _setPositionOn(buffer,widget,position){if(buffer===this.matrix||buffer==="base"){widget.setPosition(position);}else{this._buffers[buffer].positions[widget.id]=position;}};var clearMatrix=function clearMatrix(){this.matrix=[];this._buffers.base.matrix=this.matrix;for(var x=0;x<this.columns;x++){this.matrix[x]=[];}};GridLayout.prototype._hasSpaceFor=function(_matrix,positionX,positionY,width,height){var x,y;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){if(_matrix[positionX+x][positionY+y]!=null){return false;}}}
return true;};GridLayout.prototype._reserveSpace=function(_matrix,widget){var x,y;var position=this._getPositionOn(_matrix,widget);var width=widget.shape.width;var height=widget.shape.height;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[position.x+x][position.y+y]=widget;}}};GridLayout.prototype._clearSpace=function(_matrix,widget){var x,y;var position=this._getPositionOn(_matrix,widget);var width=widget.shape.width;var height=widget.shape.height;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[position.x+x][position.y+y];}}
this._compressColumns(_matrix,position.x,width);};GridLayout.prototype._compressColumns=function _compressColumns(_matrix,x,width){var i,y;for(i=0;i<width;i++){for(y=_matrix[x+i].length-1;y>=0;y--){if(_matrix[x+i][y]!=null){break;}
_matrix[x+i].pop();}}};GridLayout.prototype._searchInsertPoint=function _searchInsertPoint(_matrix,x,y,width,height){return y;};GridLayout.prototype._moveSpaceDown=function _moveSpaceDown(buffer,widget,offsetY){var affectedIWidgets,position,finalPosition,edgeY,iwidget,x,y,key,matrix;affectedIWidgets={};matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,widget);finalPosition=new Wirecloud.DragboardPosition(position.x,position.y+offsetY);edgeY=position.y+widget.shape.height;for(x=0;x<widget.shape.width;x++){for(y=0;y<offsetY;y++){iwidget=matrix[position.x+x][edgeY+y];if(iwidget!=null){affectedIWidgets[iwidget.id]=offsetY-y;break;}}}
for(key in affectedIWidgets){iwidget=this.widgets[key];this._moveSpaceDown(buffer,iwidget,affectedIWidgets[key]);}
this._clearSpace(buffer,widget);this._setPositionOn(buffer,widget,finalPosition);this._reserveSpace(buffer,widget);};GridLayout.prototype._moveSpaceUp=function(buffer,widget){var position,edgeY,offsetY,affectedIWidgets,finalPosition,iwidget,x,y,columnsize,key,matrix;matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,widget);edgeY=position.y+widget.shape.height;offsetY=1;while(((position.y-offsetY)>=0)&&this._hasSpaceFor(matrix,position.x,position.y-offsetY,widget.width,1)){offsetY+=1;}
offsetY-=1;if(offsetY>0){affectedIWidgets={};finalPosition=new Wirecloud.DragboardPosition(position.x,position.y-offsetY);for(x=0;x<widget.shape.width;x++){columnsize=matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){iwidget=matrix[position.x+x][y];if(iwidget!=null){affectedIWidgets[iwidget.id]=iwidget;break;}}}
this._clearSpace(buffer,widget);this._setPositionOn(buffer,widget,finalPosition);this._reserveSpace(buffer,widget);for(key in affectedIWidgets){this._moveSpaceUp(buffer,affectedIWidgets[key]);}
return true;}
return false;};GridLayout.prototype._removeFromMatrix=function(_matrix,widget){this._clearSpace(_matrix,widget);return false;};GridLayout.prototype._reserveSpace2=function(_matrix,widget,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[positionX+x][positionY+y]=widget;}}};GridLayout.prototype._clearSpace2=function(_matrix,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[positionX+x][positionY+y];}}
this._compressColumns(_matrix,positionX,width);};GridLayout.prototype._notifyResizeEvent=function(widget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){var x,y;var step2Width=oldWidth;var position=widget.position;var step2X,iWidgetToMove,finalYPos,widthDiff;step2X=position.x;if(newWidth>oldWidth){step2Width=oldWidth;finalYPos=position.y+newHeight;if(resizeLeftSide){widthDiff=newWidth-oldWidth;for(x=position.x-widthDiff;x<position.x;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
position.x-=widthDiff;widget.setPosition(position);this._reserveSpace2(this.matrix,widget,position.x,position.y,widthDiff,newHeight);}else{for(x=position.x+oldWidth;x<position.x+newWidth;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
this._reserveSpace2(this.matrix,widget,position.x+oldWidth,position.y,newWidth-oldWidth,newHeight);}}else if(newWidth<oldWidth){step2Width=newWidth;widthDiff=oldWidth-newWidth;if(resizeLeftSide){this._clearSpace2(this.matrix,position.x,position.y,widthDiff,oldHeight);position.x+=widthDiff;widget.setPosition(position);step2X=position.x;}else{this._clearSpace2(this.matrix,position.x+newWidth,position.y,widthDiff,oldHeight);}}
if(newHeight>oldHeight){var limitY=position.y+newHeight;var limitX=step2X+step2Width;for(y=position.y+oldHeight;y<limitY;y++){for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceDown("base",this.matrix[x][y],limitY-y);}}}
this._reserveSpace2(this.matrix,widget,step2X,position.y+oldHeight,step2Width,newHeight-oldHeight);}else if(newHeight<oldHeight){this._clearSpace2(this.matrix,step2X,position.y+newHeight,step2Width,oldHeight-newHeight);}
this._notifyWindowResizeEvent(true,true);if(persist){this.dragboard.update();}};GridLayout.prototype._insertAt=function _insertAt(widget,x,y,buffer){var newPosition=new Wirecloud.DragboardPosition(x>0?x:0,y>0?y:0);var affectedwidget,offset,affectedY,matrix;var affectedWidgets=false;var lastX=newPosition.x+widget.shape.width;var lastY=newPosition.y+widget.shape.height;if(buffer==null){buffer="base";}
matrix=this._buffers[buffer].matrix;for(x=newPosition.x;x<lastX;x++){for(y=newPosition.y;y<lastY;y++){affectedwidget=matrix[x][y];if(affectedwidget!=null){affectedY=this._getPositionOn(buffer,affectedwidget).y;offset=lastY-affectedY;this._moveSpaceDown(buffer,affectedwidget,offset);affectedWidgets=true;break;}}}
this._setPositionOn(buffer,widget,newPosition);this._reserveSpace(buffer,widget);return affectedWidgets;};GridLayout.prototype._searchFreeSpace=function(width,height){var positionX=0,positionY=0;var maxX=this.columns-width;for(positionY=0;true;positionY++){for(positionX=0;positionX<=maxX;positionX++){if(this._hasSpaceFor(this.matrix,positionX,positionY,width,height)){return new Wirecloud.DragboardPosition(positionX,positionY);}}}};GridLayout.prototype.initialize=function(){var widget,i,key,position,iWidgetsToReinsert=[];clearMatrix.call(this);for(key in this.widgets){widget=this.widgets[key];position=widget.position;widget.model.load();if(widget.shape.width>this.columns){widget.change({width:this.columns});}
if(widget.shape.width+position.x>this.columns){iWidgetsToReinsert.push(widget);}else if(this._hasSpaceFor(this.matrix,position.x,position.y,widget.shape.width,widget.shape.height)){this._reserveSpace(this.matrix,widget);}else{iWidgetsToReinsert.push(widget);}}
var modified=false;if(iWidgetsToReinsert.length>0){for(i=0;i<iWidgetsToReinsert.length;i++){position=this._searchFreeSpace(iWidgetsToReinsert[i].shape.width,iWidgetsToReinsert[i].shape.height);iWidgetsToReinsert[i].setPosition(position);this._reserveSpace(this.matrix,iWidgetsToReinsert[i]);}
modified=true;}
this.initialized=true;return modified;};GridLayout.prototype.getCellAt=function getCellAt(x,y){var columnWidth=this.getWidth()/this.columns;var rowHeight=this.getHeight()/this.rows;return new Wirecloud.DragboardPosition(Math.floor(x/columnWidth),Math.floor(y/rowHeight));};GridLayout.prototype.addWidget=function addWidget(widget,affectsDragboard){var affectedWidgets=false;Wirecloud.ui.DragboardLayout.prototype.addWidget.call(this,widget,affectsDragboard);if(!this.initialized){return;}
if(widget.width>this.columns){widget.setShape({width:this.columns});}
var position=widget.position;if(position){var diff=widget.shape.width+position.x-this.columns;if(diff>0){position.x-=diff;}
affectedWidgets=this._insertAt(widget,position.x,position.y,"base");}else{position=this._searchFreeSpace(widget.shape.width,widget.shape.height);widget.setPosition(position);this._reserveSpace(this.matrix,widget);}
this._adaptIWidget(widget);return affectedWidgets;};GridLayout.prototype.removeWidget=function removeWidget(widget,affectsDragboard){var affectedWidgets;affectedWidgets=this._removeFromMatrix("base",widget);Wirecloud.ui.DragboardLayout.prototype.removeWidget.call(this,widget,affectsDragboard);return affectedWidgets;};GridLayout.prototype.moveTo=function(destLayout){var movedWidgets,orderedWidgets,x,y,i,widget;this._removeFromMatrix=GridLayout.prototype._removeFromMatrix;movedWidgets={};orderedWidgets=[];for(y=0;y<this.rows;y+=1){for(x=0;x<this.columns;x+=1){var iwidget=this.matrix[x][y];if(iwidget!=null&&!(iwidget.id in movedWidgets)){orderedWidgets.push(iwidget);movedWidgets[iwidget.id]=true;}}}
for(i=0;i<orderedWidgets.length;i+=1){widget=orderedWidgets[i];widget.moveToLayout(destLayout);}
delete this._removeFromMatrix;};GridLayout.prototype._cloneMatrix=function _cloneMatrix(matrix){var i,cloned_matrix=[];for(i=0;i<this.columns;i++){cloned_matrix[i]=Wirecloud.Utils.clone(matrix[i]);}
return cloned_matrix;};GridLayout.prototype._clonePositions=function _clonePositions(buffer){var key,positions={};for(key in this.widgets){positions[key]=utils.clone(this._getPositionOn(buffer,this.widgets[key]));}
return positions;};GridLayout.prototype.initializeMove=function(widget,draggable){var msg,i,lastWidget,lastY,tmp;draggable=draggable||null;if(!(widget instanceof Wirecloud.ui.WidgetView)){throw new TypeError("widget must be an WidgetView instance");}
if(this.iwidgetToMove!==null){msg="Dragboard: There was a pending move that was cancelled because initializedMove function was called before it was finished.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);this.cancelMove();}
this.iwidgetToMove=widget;this._buffers.backup={};this._buffers.backup.positions=this._clonePositions(this.matrix);this._buffers.shadow={"matrix":this.matrix};lastY=0;this._buffers.backup.matrix=this._cloneMatrix(this.matrix);this._removeFromMatrix("backup",widget);this.searchInsertPointCache=[];for(i=0;i<this.columns;i++){this.searchInsertPointCache[i]=[];lastWidget=this.matrix[i][this.matrix[i].length-1];if(!lastWidget){continue;}
tmp=lastWidget.position.y+lastWidget.shape.height;if(tmp>lastY){lastY=tmp;}}
this.searchInsertPointYLimit=lastY+1;this.dragboardCursor=new Wirecloud.ui.DragboardCursor(widget);if(draggable){draggable.setXOffset(this.fromHCellsToPixels(1)/2);draggable.setYOffset(this.fromVCellsToPixels(1)/2);}};GridLayout.prototype._destroyCursor=function _destroyCursor(){if(this.dragboardCursor!==null){this.dragboardCursor.destroy();this.dragboardCursor=null;}};GridLayout.prototype.disableCursor=function(){this._destroyCursor();};GridLayout.prototype._setPositions=function _setPositions(){var key,curIWidget;for(key in this.widgets){curIWidget=this.widgets[key];if(curIWidget!==this.iwidgetToMove){curIWidget.setPosition(this._getPositionOn("shadow",curIWidget));}}
this.dragboardCursor.setPosition(this._getPositionOn("shadow",this.dragboardCursor));};GridLayout.prototype.moveTemporally=function moveTemporally(x,y){if(this.iwidgetToMove==null){var msg="Dragboard: You must call initializeMove function before calling to this function (moveTemporally).";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var maxX=this.columns-this.iwidgetToMove.shape.width;if(x>maxX){x=maxX;}
if(this.dragboardCursor!=null){var cursorpos=this.dragboardCursor.position;if((cursorpos.y!==y)||(cursorpos.x!==x)){this._buffers.shadow.positions=this._clonePositions("backup");this._buffers.shadow.matrix=this._cloneMatrix(this._buffers.backup.matrix);this._insertAt(this.dragboardCursor,x,y,"shadow");this._setPositions();}}else{this._buffers.shadow.positions=this._clonePositions("backup");this._buffers.shadow.matrix=this._cloneMatrix(this._buffers.backup.matrix);this.dragboardCursor=new Wirecloud.ui.DragboardCursor(this.iwidgetToMove);this._insertAt(this.dragboardCursor,x,y,"shadow");}};GridLayout.prototype.cancelMove=function(){if(this.iwidgetToMove==null){var msg="Dragboard: Trying to cancel an inexistant temporal move.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this._destroyCursor();for(var key in this.widgets){this.widgets[key].setPosition(this.widgets[key].position);}
this.iwidgetToMove=null;this.dragboardCursor=null;};GridLayout.prototype.acceptMove=function(){if(this.iwidgetToMove==null){var msg="Dragboard: Function acceptMove called when there is not an started iwidget move.";Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var oldposition=this.iwidgetToMove.position;var newposition=this.dragboardCursor.position;this._destroyCursor();this.iwidgetToMove.setPosition(newposition);if(oldposition.y!==newposition.y||oldposition.x!==newposition.x){this.matrix=this._buffers.shadow.matrix;this._buffers.base.matrix=this.matrix;this._reserveSpace("base",this.iwidgetToMove);this.dragboard.update();}
this.iwidgetToMove=null;this.dragboardCursor=null;};Wirecloud.ui.GridLayout=GridLayout;})(Wirecloud.Utils);;(function(utils){"use strict";var market_types,MarketManager;market_types={'wirecloud':{label:'Wirecloud',view_class:CatalogueView}};MarketManager={};MarketManager.getMarkets=function getMarkets(){return Wirecloud.io.makeRequest(Wirecloud.URLs.MARKET_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'}}).then(function(response){if([200,401,403,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if(response.status!==200){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
var raw_data=JSON.parse(response.responseText);for(var key in raw_data){if(raw_data[key].url==null){delete raw_data[key];}}
return Promise.resolve(raw_data);}).toTask("Requesting available marketplaces");};MarketManager.deleteMarket=function deleteMarket(marketplace){return new Wirecloud.Task("Deleting marketplace",function(resolve,reject){var url=Wirecloud.URLs.MARKET_ENTRY.evaluate({user:marketplace.user,market:marketplace.name});Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'}}).then((response)=>{if([204,401,403,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if(response.status!==204){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
return Promise.resolve(marketplace);}).then(resolve,reject);});};MarketManager.addMarket=function addMarket(market_info){return Wirecloud.io.makeRequest(Wirecloud.URLs.MARKET_COLLECTION,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(market_info)}).then((response)=>{if([201,401,403,409,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if(response.status!==201){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
return Promise.resolve(market_info);}).toTask(utils.gettext("Adding marketplace"));};MarketManager.addMarketType=function addMarketType(type,label,view_class){market_types[type]={label:label,view_class:view_class};return this;};MarketManager.getMarketViewClass=function getMarketplaceViewClass(type){if(type in market_types){return market_types[type].view_class;}else{return null;}};MarketManager.getMarketTypes=function getMarketTypes(){var key,market_type,types=[];for(key in market_types){market_type=market_types[key];types.push({label:market_type.label,value:key});}
return types;};Wirecloud.MarketManager=MarketManager;})(Wirecloud.Utils);;(function(se,utils){"use strict";var MarketplaceViewMenuItems;MarketplaceViewMenuItems=function MarketplaceViewMenuItems(marketplace_view){this.market=marketplace_view;StyledElements.DynamicMenuItems.call(this);this._click_callback=function _click_callback(menu_context,menu_item_context){marketplace_view.changeCurrentMarket(menu_item_context);};};MarketplaceViewMenuItems.prototype=new StyledElements.DynamicMenuItems();MarketplaceViewMenuItems.prototype.build=function build(context){var current_catalogue,catalogue,items=[],item,i;current_catalogue=this.market.alternatives.getCurrentAlternative();if(this.market.number_of_alternatives>0){for(i=0;i<this.market.viewList.length;i++){catalogue=this.market.viewList[i];items.push(new StyledElements.MenuItem(catalogue.getLabel(),this._click_callback,catalogue.market_id));}
items.push(new StyledElements.Separator());if(typeof current_catalogue.show_upload_view==='function'){items.push(new StyledElements.MenuItem(utils.gettext('Upload'),function(){this.show_upload_view();}.bind(current_catalogue)));}}
if(!this.loading&&!this.error){item=new StyledElements.MenuItem(utils.gettext('Add new marketplace'),function(){var menu,fields;fields={'title':{'type':'text','label':utils.gettext('Name'),'required':true},'url':{'type':'text','label':utils.gettext('URL'),'required':true,'initialValue':'http://'},'type':{'type':'select','initialEntries':Wirecloud.MarketManager.getMarketTypes(),'label':utils.gettext('Type'),'required':true}};if(Wirecloud.contextManager.get('issuperuser')){fields.public={'type':'boolean','label':utils.gettext('Public')};}
menu=new Wirecloud.ui.FormWindowMenu(fields,utils.gettext('Add marketplace'),'wc-add-external-catalogue-modal');menu.executeOperation=(data)=>{data.name=URLify(data.title);data.user=Wirecloud.contextManager.get("username");var task=Wirecloud.MarketManager.addMarket(data);task.then(()=>{this.market.addMarket(data);});return task;};menu.show();}.bind(this));item.addIconClass('fa fa-plus');items.push(item);item=new StyledElements.MenuItem(utils.gettext('Delete marketplace'),function(){var msg=utils.gettext('Do you really want to remove the marketplace "%(marketName)s"?');msg=utils.interpolate(msg,{'marketName':this.market.alternatives.getCurrentAlternative().getLabel()});var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(function(){Wirecloud.UserInterfaceManager.monitorTask(Wirecloud.MarketManager.deleteMarket(this.market.alternatives.getCurrentAlternative().desc).then(this.market.refreshViewInfo.bind(this.market)).catch(function(error){(new Wirecloud.ui.MessageWindowMenu(error,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(error);}));}.bind(this));dialog.show();}.bind(this));item.addIconClass('fa fa-trash');item.setDisabled(current_catalogue==null||current_catalogue.isAllow==null||!current_catalogue.isAllow('delete'));items.push(item);}
return items;};Wirecloud.ui.MarketplaceViewMenuItems=MarketplaceViewMenuItems;})(StyledElements,Wirecloud.Utils);;(function(se,utils){"use strict";var ResourcePainter=function ResourcePainter(catalogue_view,resource_template,container,extra_context){if(arguments.length===0){return;}
this.builder=new se.GUIBuilder();this.catalogue_view=catalogue_view;this.structure_template=resource_template;this.error_template=this.builder.DEFAULT_OPENING+'<div class="alert alert-error"><t:message/></div>'+this.builder.DEFAULT_CLOSING;this.info_template=this.builder.DEFAULT_OPENING+'<div class="alert alert-info"><t:message/></div>'+this.builder.DEFAULT_CLOSING;this.container=container;if(extra_context!=null&&(typeof extra_context==='object'||typeof extra_context==='function')){this.extra_context=extra_context;}else{this.extra_context={};}};ResourcePainter.prototype.paintInfo=function paintError(message,context){if(context!=null){message=this.builder.parse(this.builder.DEFAULT_OPENING+message+this.builder.DEFAULT_CLOSING,context);}
return this.builder.parse(this.info_template,{'message':message});};ResourcePainter.prototype.paintError=function paintError(message){return this.builder.parse(this.error_template,{'message':message});};ResourcePainter.prototype.setError=function setError(message){this.container.clear();this.container.appendChild(this.paintError(message));};ResourcePainter.prototype.paint=function paint(resource){var extra_context,i,context,resource_element,license_text;if(typeof this.extra_context==='function'){extra_context=this.extra_context(resource);}else{extra_context=utils.clone(this.extra_context);}
if(resource.license!=null&&resource.license!==''){license_text=resource.license;}else{license_text='N/A';}
context=utils.merge(extra_context,{'title':resource.title,'name':resource.name,'internalname':resource.uri,'vendor':resource.vendor,'version':resource.version,'authors':this.get_people_list.bind(null,resource.authors),'contributors':this.get_people_list.bind(null,resource.contributors),'description':resource.description,'longdescription':function(){return new se.Fragment(resource.longdescription);},'type':function(){var label=document.createElement('div');label.textContent=resource.type;label.className='label';switch(resource.type){case'widget':label.classList.add('label-success');break;case'operator':label.classList.add('label-warning');break;case'mashup':label.classList.add('label-important');break;case'pack':label.classList.add('label-info');break;}
return label;},'lastupdate':function(){return moment(resource.date).fromNow();},'home':function(){var button;button=new se.Button({plain:true,class:'fa fa-home',title:utils.gettext('Home page')});if(resource.homepage!=null&&resource.homepage!==''){button.addEventListener('click',function(){window.open(resource.homepage,'_blank');});}else{button.disable();}
return button;},'issuetracker':function(){var button;button=new se.Button({plain:true,class:'fa fa-bug',title:utils.gettext('Issue tracker')});if(resource.issuetracker!=null&&resource.issuetracker!==''){button.addEventListener('click',function(){window.open(resource.issuetracker,'_blank');});}else{button.disable();}
return button;},'license':license_text,'license_home':function(){var button;button=new se.Button({plain:true,class:'fa fa-legal',title:utils.gettext('License details')});if(resource.licenseurl!=null&&resource.licenseurl!==''){button.addEventListener('click',function(){window.open(resource.licenseurl,'_blank');});}else{button.disable();}
return button;},'rating':this.get_popularity_html.bind(this,resource.rating),'image':function(){var image=document.createElement('img');image.className='wc-resource-img';if(resource.image){image.onerror=onImageError;setTimeout(()=>{image.src=resource.image;});}else{setTimeout(onImageError.bind(null,{target:image}),0);}
return image;},'tags':function(options){return this.painter.renderTagList(this.resource,options.max);}.bind({painter:this,resource:resource}),'advancedops':this.renderAdvancedOperations.bind(this,resource),'size':utils.formatSize.bind(this,resource.size),'versions':function(){var versions=resource.getAllVersions().map(function(version){return'v'+version.text;});return versions.join(', ');}});resource_element=this.builder.parse(this.structure_template,context,resource);for(i=0;i<resource_element.elements.length;i+=1){if(!(resource_element.elements[i]instanceof Element)){continue;}
if(this.catalogue_view){this.create_simple_command(resource_element.elements[i],'.click_for_details','click',this.catalogue_view.createUserCommand('showDetails',resource));}
var title_element=resource_element.elements[i].querySelector('.title-tooltip');if(title_element!=null){var tooltip=new se.Tooltip({content:resource.title,placement:['top','bottom','right','left']});tooltip.bind(title_element);}}
return resource_element;};ResourcePainter.prototype.renderAdvancedOperations=function renderAdvancedOperations(resource){var button,fragment=new se.Fragment();button=new se.Button({'text':utils.gettext('Download')});button.addEventListener('click',function(){window.open(resource.description_url,'_blank');});fragment.appendChild(button);if(resource.type==='widget'){button=new se.Button({'text':utils.gettext('Add to workspace')});button.addEventListener('click',function(){Wirecloud.UserInterfaceManager.changeCurrentView('workspace');var local_widget=Wirecloud.LocalCatalogue.getResource(resource.vendor,resource.name,resource.version);Wirecloud.activeWorkspace.view.activeTab.createWidget(local_widget);});fragment.appendChild(button);}
if(this.catalogue_view.catalogue===Wirecloud.LocalCatalogue){button=new se.Button({'text':utils.gettext('Publish')});button.addEventListener('click',this.catalogue_view.createUserCommand('publishOtherMarket',resource));fragment.appendChild(button);}
if(Wirecloud.LocalCatalogue.resourceExists(resource)&&resource.isAllow('uninstall')){var local_catalogue_view=Wirecloud.UserInterfaceManager.views.myresources;button=new se.Button({'class':'btn-danger','text':utils.gettext('Uninstall')});button.addEventListener('click',local_catalogue_view.createUserCommand('uninstall',resource,this.catalogue_view));fragment.appendChild(button);}
if((resource.getAllVersions().length>1)&&resource.isAllow('uninstall-all')){button=new se.Button({'class':'btn-danger','text':utils.gettext('Uninstall all versions')});button.addEventListener('click',this.catalogue_view.createUserCommand('uninstallall',resource,this.catalogue_view));fragment.appendChild(button);}
if(resource.isAllow('delete')){button=new se.Button({'class':'btn-danger','text':utils.gettext('Delete')});button.addEventListener('click',this.catalogue_view.createUserCommand('delete',resource));fragment.appendChild(button);}
if((resource.getAllVersions().length>1)&&resource.isAllow('delete-all')){button=new se.Button({'class':'btn-danger','text':utils.gettext('Delete all versions')});button.addEventListener('click',this.catalogue_view.createUserCommand('deleteall',resource));fragment.appendChild(button);}
return fragment;};ResourcePainter.prototype.renderTagList=function renderTagList(resource,listener,max){var i,fragment,tags,tag,tag_element,len;fragment=new se.Fragment();tags=resource.tags.slice();tags=tags.sort(function(a,b){return b.apparences-a.apparences;});if(typeof max==='undefined'){max=tags.length;}
len=Math.min(max,tags.length);for(i=0;i<len;i+=1){tag=tags[i];tag_element=document.createElement('a');tag_element.textContent=tag.value;fragment.appendChild(tag_element);}
return fragment;};ResourcePainter.prototype.create_simple_command=function(element,selector,_event,handler,required){var i,elements,root_matches;elements=element.querySelectorAll(selector);root_matches=element.matches(selector);if(required&&elements.length<1&&!root_matches){throw new Error();}
if(root_matches){element.addEventListener(_event,handler);}
for(i=0;i<elements.length;i+=1){elements[i].addEventListener(_event,handler);}};ResourcePainter.prototype.get_people_list=function get_people_list(people,options){var i,fragment,dd;if(people.length===0){dd=document.createElement('dd');if(options.class){dd.className=options.class;}
dd.textContent=utils.gettext('N/A');return dd;}
fragment=new se.Fragment();for(i=0;i<people.length;i++){dd=document.createElement('dd');if(options.class){dd.className=options.class;}
dd.textContent=people[i].name;fragment.appendChild(dd);}
return fragment;};ResourcePainter.prototype.get_popularity_html=function get_popularity_html(popularity){var on_stars,md_star,off_stars,stars,star,i;if(popularity==null||popularity<1){popularity=0;}
on_stars=Math.floor(popularity);md_star=popularity-on_stars;off_stars=5-popularity;stars=document.createElement('div');stars.className='rating';if(popularity===0){stars.classList.add('disabled');}
for(i=0;i<on_stars;i+=1){star=document.createElement('span');star.className='on star';stars.appendChild(star);}
if(md_star){star=document.createElement('span');star.className='middle star';stars.appendChild(star);}
for(i=0;i<Math.floor(off_stars);i+=1){star=document.createElement('span');star.className='off star';stars.appendChild(star);}
return stars;};var onImageError=function onImageError(event){event.target.parentElement.classList.add('se-thumbnail-missing');event.target.parentElement.textContent=utils.gettext('No image available');};Wirecloud.ui.ResourcePainter=ResourcePainter;})(StyledElements,Wirecloud.Utils);;(function(utils){"use strict";var builder=new StyledElements.GUIBuilder();var WindowMenu=function WindowMenu(title,extra_class,events){var ui_fragment,i,element;privates.set(this,{parent:null,child:null,insert:insert.bind(this)});StyledElements.ObjectWithEvents.call(this,events||[]);this._closeListener=this._closeListener.bind(this);ui_fragment=builder.parse(Wirecloud.currentTheme.templates['wirecloud/modals/base'],{'title':function(options){this.titleElement=document.createElement('h3');return this.titleElement;}.bind(this),'body':function(options){this.windowContent=document.createElement('div');if(options&&typeof options.class==='string'){this.windowContent.className=options.class;}
return this.windowContent;}.bind(this),'closebutton':function(options){var button=new StyledElements.Button({plain:true,class:'fa fa-remove',title:utils.gettext("Close")});button.addEventListener('click',this._closeListener);return button;}.bind(this),'footer':function(options){this.windowBottom=document.createElement('div');if(options&&typeof options.class==='string'){this.windowBottom.className=options.class;}
return this.windowBottom;}.bind(this)});for(i=0;i<ui_fragment.elements.length;i+=1){element=ui_fragment.elements[i];if(element instanceof Element){this.htmlElement=element;break;}}
this.htmlElement.classList.add('window_menu');if(extra_class!=null){this.htmlElement.classList.add(extra_class);}
this.windowHeader=this.htmlElement.querySelector('.window_top');this.setTitle(title);makeDraggable.call(this,this.titleElement);};WindowMenu.prototype=new StyledElements.ObjectWithEvents();WindowMenu.prototype.setPosition=function setPosition(coordinates){this.htmlElement.style.left=coordinates.posX+'px';this.htmlElement.style.top=coordinates.posY+'px';};WindowMenu.prototype.getStylePosition=function getStylePosition(){return{posX:parseInt(this.htmlElement.style.left,10),posY:parseInt(this.htmlElement.style.top,10)};};WindowMenu.prototype.setTitle=function setTitle(title){this.titleElement.textContent=title;};WindowMenu.prototype._closeListener=function _closeListener(e){this.hide();};WindowMenu.prototype.calculatePosition=function calculatePosition(){if(this.htmlElement.parentNode==null){return;}
var priv=privates.get(this);var coordenates=[];var windowHeight=window.innerHeight;var windowWidth=window.innerWidth;this.htmlElement.style.maxHeight='';this.htmlElement.style.maxWidth='';this.windowContent.style.maxHeight='';var menuWidth=this.htmlElement.offsetWidth;if(menuWidth>windowWidth){menuWidth=windowWidth;this.htmlElement.style.maxWidth=menuWidth+'px';}
var menuHeight=this.htmlElement.offsetHeight;coordenates[1]=(windowHeight-menuHeight)/2;coordenates[0]=(windowWidth-menuWidth)/2;if(windowHeight<menuHeight){this.htmlElement.style.maxHeight=windowHeight+'px';this.htmlElement.style.top='0px';this.windowContent.style.maxHeight=(windowHeight-this.windowHeader.offsetHeight-this.windowBottom.offsetHeight)+'px';}else{this.htmlElement.style.top=coordenates[1]+"px";}
this.htmlElement.style.left=coordenates[0]+"px";if(priv.child!=null){priv.child.calculatePosition();}};WindowMenu.prototype.show=function show(parentWindow){if(parentWindow!=null){addChildWindow(parentWindow,this);Wirecloud.UserInterfaceManager._registerPopup(this);}else{Wirecloud.UserInterfaceManager._registerRootWindowMenu(this);}
var priv=privates.get(this);priv.insert();utils.onFullscreenChange(document.body,priv.insert);this.htmlElement.style.display="block";this.setFocus();};WindowMenu.prototype.hide=function hide(){var priv=privates.get(this);if(this.htmlElement.parentElement==null){return;}
this.htmlElement.parentNode.removeChild(this.htmlElement);if(this.msgElement!=null){this.msgElement.textContent='';}
utils.removeFullscreenChangeCallback(document.body,priv.insert);if(this.child!=null){this.child.hide();}
if(priv.parent!=null){removeChildWindow(priv.parent,this);Wirecloud.UserInterfaceManager._unregisterPopup(this);}else{Wirecloud.UserInterfaceManager._unregisterRootWindowMenu(this);}};var addChildWindow=function addChildWindow(parent,child){var priv_parent=privates.get(parent);var priv_child=privates.get(child);if(priv_parent.child!=null){throw new TypeError('Parent modal already has a child modal');}else if(priv_child.parent!=null){throw new TypeError('Modal already has a parent modal');}
if(parent===child){throw new TypeError('Modals cannot descend themselves');}
var currentmodal=priv_parent.parent;while(currentmodal!=null){if(currentmodal===child){throw new TypeError('Modals cannot descend themselves');}
currentmodal=privates.get(currentmodal).parent;}
priv_parent.child=child;priv_child.parent=parent;};var removeChildWindow=function removeChildWindow(parent,child){var priv_parent=privates.get(parent);if(priv_parent.child===child){var priv_child=privates.get(child);priv_parent.child=null;priv_child.parent=null;}};WindowMenu.prototype.setFocus=function setFocus(){};WindowMenu.prototype.destroy=function destroy(){this.hide();this._closeListener=null;};var privates=new WeakMap();var makeDraggable=function makeDraggable(handler){this.draggable=new Wirecloud.ui.Draggable(handler,{window_menu:this},function onStart(draggable,context){context.y=context.window_menu.htmlElement.style.top===""?0:parseInt(context.window_menu.htmlElement.style.top,10);context.x=context.window_menu.htmlElement.style.left===""?0:parseInt(context.window_menu.htmlElement.style.left,10);},function onDrag(e,draggable,context,xDelta,yDelta){context.window_menu.setPosition({posX:context.x+xDelta,posY:context.y+yDelta});},function onFinish(draggable,context){var position=context.window_menu.getStylePosition();if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
context.window_menu.setPosition(position);},function(){return true;});};var insert=function insert(){var baseelement=utils.getFullscreenElement()||document.body;baseelement.appendChild(this.htmlElement);this.calculatePosition();};Wirecloud.ui.WindowMenu=WindowMenu;})(Wirecloud.Utils);;(function(se,utils){"use strict";var UploadWindowMenu,upload_wgt_files,acceptListener,updateEmptyStatus,onUploadFailure;onUploadFailure=function onUploadFailure(file_entry,msg){this.failures.push({'file':file_entry.name,'msg':msg});};upload_wgt_files=function upload_wgt_files(){var entries=this.fileTable.source.getElements();this.failures=[];var task=new Wirecloud.Task(utils.gettext("Uploading packaged components"),entries.map(function(entry){var task=this.catalogue.addComponent({file:entry.file,force_create:true});task.catch(onUploadFailure.bind(this,entry));return task;},this));task.catch(function(){return new Promise(function(resolve,reject){var msg=document.createElement('p');msg.textContent=utils.gettext('Error uploading the following components:');var details=document.createElement('ul');for(var i=0;i<this.failures.length;i++){var item=document.createElement('li');var file_name=document.createElement('b');file_name.textContent=this.failures[i].file;item.appendChild(file_name);var error_description=document.createTextNode(": "+this.failures[i].msg);item.appendChild(error_description);details.appendChild(item);}
msg=new se.Fragment([msg,details]);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();resolve();}.bind(this));}.bind(this)).then(function(){this.mainview.viewsByName.search.refresh_if_needed();}.bind(this));Wirecloud.UserInterfaceManager.monitorTask(task);this.fileTable.source.changeElements([]);updateEmptyStatus.call(this);};acceptListener=function acceptListener(){upload_wgt_files.call(this);this.hide();};updateEmptyStatus=function updateEmptyStatus(){var empty=this.fileTable.source.length===0;this.acceptButton.setDisabled(empty);if(empty){this.htmlElement.classList.add('wc-upload-mac-modal-empty');this.fileButton.focus();}else{this.htmlElement.classList.remove('wc-upload-mac-modal-empty');this.acceptButton.focus();}};UploadWindowMenu=function UploadWindowMenu(options){this.catalogue=options.catalogue;this.mainview=options.mainview;Wirecloud.ui.WindowMenu.call(this,utils.gettext("Upload mashable application components"),'wc-upload-mac-modal');var builder=new se.GUIBuilder();var contents=builder.parse(Wirecloud.currentTheme.templates['wirecloud/catalogue/modals/upload'],{'uploadfilebutton':function(){var button=new se.FileButton({text:utils.gettext('Select files from your computer')});button.addEventListener('fileselect',function(button,files){for(var i=0;i<files.length;i++){this.addFile(files[i]);}}.bind(this));this.fileButton=button;return button;}.bind(this)});contents.insertInto(this.windowContent);this.fileTable=new se.ModelTable([{"field":"name","label":utils.gettext("Name")},{"field":"size","type":"number","label":utils.gettext("Size"),"width":"css","class":"wc-upload-mac-size-column","contentBuilder":function(file){return utils.formatSize(file.size);}},{"label":"","width":"css","class":"wc-upload-mac-button-column","sortable":false,"contentBuilder":function(entry){var button=new se.Button({iconClass:"fa fa-remove",plain:true,title:utils.gettext("Remove this file")});button.addEventListener("click",this.removeFile.bind(this,entry.file));return button;}.bind(this)}],{pageSize:0});var addMoreButton=new se.FileButton({text:utils.gettext('Add more files')});addMoreButton.addEventListener('fileselect',function(button,files){for(var i=0;i<files.length;i++){this.addFile(files[i]);}}.bind(this));this.fileTable.statusBar.appendChild(addMoreButton);this.fileTable.insertInto(this.windowContent);this.acceptButton=new se.Button({text:utils.gettext("Upload"),'class':'btn-primary btn-accept'});this.acceptButton.addEventListener("click",acceptListener.bind(this));this.acceptButton.insertInto(this.windowBottom);this.acceptButton.disable();var border=document.createElement("div");border.className="wc-upload-mac-border";this.windowContent.appendChild(border);this.cancelButton=new se.Button({text:utils.gettext("Cancel"),'class':'btn-default btn-cancel'});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);var drop_listener=function drop_listener(e){e.preventDefault();deactivate();};var dragleave_listener=function dragleave_listener(e){e.stopPropagation();deactivate();};var deactivate=function deactivate(e){this.htmlElement.classList.remove('drag-hover');document.removeEventListener('drop',drop_listener,true);document.removeEventListener('dragleave',dragleave_listener,false);document.removeEventListener('dragover',utils.preventDefaultListener,true);this.htmlElement.addEventListener('dragover',activate_listener,true);}.bind(this);var activate_listener=function activate_listener(e){var has_files;e.preventDefault();if(e.dataTransfer.types.contains){has_files=e.dataTransfer.types.contains('Files');}else{has_files=e.dataTransfer.types.indexOf('Files')!=-1;}
if(has_files){var effectAllowed=e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect=('move'===effectAllowed||'linkMove'===effectAllowed)?'move':'copy';this.htmlElement.classList.add('drag-hover');this.htmlElement.removeEventListener('dragover',activate_listener,true);document.addEventListener('dragover',utils.preventDefaultListener,true);document.addEventListener('dragleave',dragleave_listener,false);document.addEventListener('drop',drop_listener,true);}}.bind(this);this.htmlElement.addEventListener('dragover',activate_listener,true);this.windowContent.addEventListener('drop',function(e){var i;e.stopPropagation();e.preventDefault();this.windowContent.classList.remove('on');for(i=0;i<e.dataTransfer.files.length;i++){this.addFile(e.dataTransfer.files[i]);}}.bind(this),true);};utils.inherit(UploadWindowMenu,Wirecloud.ui.WindowMenu);UploadWindowMenu.prototype.addFile=function addFile(file){var entry={name:file.name,size:file.size,file:file};this.fileTable.source.addElement(entry);this.htmlElement.classList.remove('wc-upload-mac-modal-empty');this.acceptButton.enable().focus();};UploadWindowMenu.prototype.removeFile=function removeFile(file){var entries=this.fileTable.source.getElements();for(var i=0;i<entries.length;i++){var entry=entries[i];if(entry.file===file){entries.splice(i,1);this.fileTable.source.changeElements(entries);updateEmptyStatus.call(this);break;}}};UploadWindowMenu.prototype.setFocus=function setFocus(){this.fileButton.focus();};UploadWindowMenu.prototype.show=function show(){Wirecloud.ui.WindowMenu.prototype.show.apply(this,arguments);this.fileTable.repaint();updateEmptyStatus.call(this);};UploadWindowMenu.prototype._closeListener=function _closeListener(){this.fileTable.source.changeElements([]);updateEmptyStatus.call(this);Wirecloud.ui.WindowMenu.prototype._closeListener.call(this);};Wirecloud.ui.WirecloudCatalogue={};Wirecloud.ui.WirecloudCatalogue.UploadWindowMenu=UploadWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(){"use strict";var ResourceDetailsView=function ResourceDetailsView(id,options){var extra_context;this.mainview=options.catalogue;options['class']='details_interface loading';StyledElements.Alternative.call(this,id,options);extra_context=function(resource){return{'details':function(options,context){var details,i,entries,versions;details=new StyledElements.Notebook();details.addEventListener('changed',function(notebook,oldTab,newTab,context){if(context==null||context.init!==true){var new_status=this.mainview.buildStateData();Wirecloud.HistoryManager.pushState(new_status);}
Wirecloud.dispatchEvent('viewcontextchanged');}.bind(this));var select=new StyledElements.Select({'class':'versions'});entries=[];versions=resource.getAllVersions();for(i=0;i<versions.length;i++){entries.push({'label':'v'+versions[i].text,'value':versions[i].text});}
select.addEntries(entries);details.addButton(select,'left');select.setDisabled(versions.length===1);select.setValue(resource.version.text);select.addEventListener('change',function(select){resource.changeVersion(select.getValue());this.mainview.createUserCommand('showDetails',resource)();}.bind(this));var main_description=details.createTab({label:gettext('Main Info'),closable:false});main_description.appendChild(this.main_details_painter.paint(resource));if(resource.doc){var documentation=details.createTab({label:gettext('Documentation'),containerOptions:{class:'documentation loading'},closable:false});documentation.addEventListener('show',function(tab){tab.disable();var doc_url=resource.catalogue.RESOURCE_USERGUIDE_ENTRY.evaluate(resource);Wirecloud.io.makeRequest(doc_url,{method:'GET',onSuccess:function(response){var article=document.createElement('article');article.className='markdown-body';article.innerHTML=response.responseText;documentation.clear();documentation.appendChild(article);}.bind(this),onComplete:function(){tab.enable();}});}.bind(this));}
if(resource.changelog){var changelog=details.createTab({label:gettext('Change Log'),containerOptions:{class:'changelog loading'},closable:false});changelog.addEventListener('show',function(tab){tab.disable();Wirecloud.io.makeRequest(this.mainview.catalogue.RESOURCE_CHANGELOG_ENTRY.evaluate(resource),{method:'GET',onSuccess:function(response){var article=document.createElement('article');article.className='markdown-body';article.innerHTML=response.responseText;changelog.clear();changelog.appendChild(article);}.bind(this),onComplete:function(){tab.enable();}});}.bind(this));}
this.currentNotebook=details;return details;}.bind(this)};}.bind(this);this.main_details_painter=new Wirecloud.ui.ResourcePainter(this.mainview,Wirecloud.currentTheme.templates['wirecloud/catalogue/main_resource_details'],this);this.resource_details_painter=new Wirecloud.ui.ResourcePainter(this.mainview,Wirecloud.currentTheme.templates['wirecloud/catalogue/resource_details'],this,extra_context);};ResourceDetailsView.prototype=new StyledElements.Alternative();ResourceDetailsView.prototype.view_name='details';ResourceDetailsView.prototype.buildStateData=function buildStateData(data){if(this.currentEntry!=null){data.resource=this.currentEntry.uri;if(this.currentNotebook){data.tab=this.currentNotebook.getVisibleTab().label;}}};ResourceDetailsView.prototype.paint=function paint(resource,options){if(options==null){options={};}
this.currentEntry=resource;this.clear();this.appendChild(this.resource_details_painter.paint(resource));if(options.tab!=null){this.currentNotebook.goToTab(this.currentNotebook.getTabByLabel(options.tab),{context:{init:true}});}
Wirecloud.dispatchEvent('viewcontextchanged');};Wirecloud.ui.WirecloudCatalogue.ResourceDetailsView=ResourceDetailsView;})();;(function(se,utils){"use strict";var AlertWindowMenu=function AlertWindowMenu(options){Wirecloud.ui.WindowMenu.call(this,utils.gettext('Warning'),'wc-alert-modal');this.msgElement=document.createElement('div');this.msgElement.className="msg";this.windowContent.appendChild(this.msgElement);options=utils.merge({acceptLabel:utils.gettext('Yes'),cancelLabel:utils.gettext('No')},options);this.acceptButton=new se.Button({text:options.acceptLabel,state:'danger',class:"btn-accept"});this._acceptListener=this._acceptListener.bind(this);this.acceptButton.addEventListener("click",this._acceptListener);this.acceptButton.insertInto(this.windowBottom);this.cancelButton=new se.Button({text:options.cancelLabel,state:'primary',class:"btn-cancel"});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);this.acceptHandler=null;this.cancelHandler=null;};utils.inherit(AlertWindowMenu,Wirecloud.ui.WindowMenu);AlertWindowMenu.prototype.setMsg=function setMsg(msg){if(msg instanceof se.StyledElement){this.msgElement.innerHTML='';msg.insertInto(this.msgElement);}else{this.msgElement.textContent=msg;}
this.calculatePosition();};AlertWindowMenu.prototype.setHTMLMsg=function setHTMLMsg(msg){this.msgElement.innerHTML=msg;if(this.htmlElement.parentElement!=null){this.calculatePosition();}};AlertWindowMenu.prototype._acceptListener=function _acceptListener(e){this.acceptHandler();this.hide();};AlertWindowMenu.prototype._closeListener=function _closeListener(e){Wirecloud.ui.WindowMenu.prototype._closeListener.call(this,e);if(this.cancelHandler){this.cancelHandler();}};AlertWindowMenu.prototype.setHandler=function setHandler(acceptHandler,cancelHandler){this.acceptHandler=acceptHandler;this.cancelHandler=cancelHandler;};AlertWindowMenu.prototype.setFocus=function setFocus(){this.cancelButton.focus();};Wirecloud.ui.AlertWindowMenu=AlertWindowMenu;})(StyledElements,StyledElements.Utils);;(function(utils){"use strict";var detect_close_finish,open_external_window;detect_close_finish=function detect_close(){if(this.external_window.closed){this.external_window=null;clearInterval(this.interval);this.interval=null;this.start_button.enable();this.start_button.focus();}else if('href'in this.external_window.location&&this.options.return_uri(this.external_window.location.href)){if(typeof this.options.onSuccess==='function'){try{this.options.onSuccess(this.external_window.location.href);}catch(e){}}
this.hide();}};open_external_window=function open_external_window(url){this.external_window=window.open(url,'_blank');this.interval=setInterval(detect_close_finish.bind(this),200);};var ExternalProcessWindowMenu=function ExternalProcessWindowMenu(title,url,msg,options){if(options!=null){this.options=options;}else{this.options={};}
Wirecloud.ui.WindowMenu.call(this,title,this.options.class);this.url=url;this.msgElement=document.createElement('div');this.msgElement.className="msg";this.msgElement.textContent=msg;this.windowContent.appendChild(this.msgElement);if(this.options.return_uri==null){this.options.return_uri=function return_uri(uri){return uri!=='about:blank';};}else if(typeof this.options.return_uri!=='function'){var base_uri=this.options.return_uri;this.options.return_uri=function return_uri(uri){return uri.startsWith(base_uri);};}
this.start_button=new StyledElements.Button({class:'btn-primary btn-accept',text:utils.gettext('Start')});this.start_button.insertInto(this.windowBottom);this.start_button.addEventListener("click",function(){this.start_button.disable();this.cancel_button.focus();open_external_window.call(this,this.url);}.bind(this));this.cancel_button=new StyledElements.Button({class:'btn-danger btn-cancel',text:utils.gettext('Cancel')});this.cancel_button.insertInto(this.windowBottom);this.cancel_button.addEventListener("click",this._closeListener);};utils.inherit(ExternalProcessWindowMenu,Wirecloud.ui.WindowMenu);ExternalProcessWindowMenu.prototype.setFocus=function setFocus(){this.start_button.focus();};ExternalProcessWindowMenu.prototype._closeListener=function _closeListener(){if(typeof this.options.onCancel==='function'){try{this.options.onCancel();}catch(e){}}
Wirecloud.ui.WindowMenu.prototype._closeListener.call(this);};ExternalProcessWindowMenu.prototype.hide=function hide(){Wirecloud.ui.WindowMenu.prototype.hide.call(this);if(this.external_window){this.external_window.close();this.external_window=null;}
if(this.interval){clearInterval(this.interval);this.interval=null;}};ExternalProcessWindowMenu.prototype.show=function show(parentWindow){Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};Wirecloud.ui.ExternalProcessWindowMenu=ExternalProcessWindowMenu;})(Wirecloud.Utils);;(function(se,utils){"use strict";var HTMLWindowMenu=function HTMLWindowMenu(url,title,extra_class,options){if(arguments.length===0){return;}
this.url=url;if(extra_class!=null){extra_class='wc-html-window-menu '+extra_class;}else{extra_class='wc-html-window-menu';}
Wirecloud.ui.WindowMenu.call(this,title,extra_class);this.button=new se.Button({text:utils.gettext('Close'),'class':'btn-primary'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);};utils.inherit(HTMLWindowMenu,Wirecloud.ui.WindowMenu);HTMLWindowMenu.prototype.show=function show(){this.windowContent.innerHTML='';this.windowContent.classList.add('disabled');Wirecloud.ui.WindowMenu.prototype.show.apply(this,arguments);Wirecloud.io.makeRequest(this.url,{method:'GET',onSuccess:function(response){this.windowContent.innerHTML=response.responseText;this.calculatePosition();}.bind(this),onFailure:function(response){this.windowContent.innerHTML='<div class="alert alert-danger">Error processing resource documentation</div>';},onComplete:function(){this.windowContent.classList.remove('disabled');}.bind(this)});};Wirecloud.ui.HTMLWindowMenu=HTMLWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(se,utils){"use strict";var PreferencesWindowMenu=function PreferencesWindowMenu(){Wirecloud.ui.WindowMenu.call(this,utils.gettext("Settings"),'wc-component-preferences-modal');};utils.inherit(PreferencesWindowMenu,Wirecloud.ui.WindowMenu);PreferencesWindowMenu.prototype._savePrefs=function _savePrefs(form,new_values){var oldValue,newValue,varName;for(varName in new_values){oldValue=this.widgetModel.preferences[varName].value;newValue=new_values[varName];if(newValue!==oldValue){if(this.widgetModel.preferences[varName].meta.secure&&newValue!==""){this.widgetModel.preferences[varName].value="********";}else{this.widgetModel.preferences[varName].value=newValue;}}else{delete new_values[varName];}}
this.hide();if(!this.widgetModel.volatile){Wirecloud.io.makeRequest(Wirecloud.URLs.IWIDGET_PREFERENCES.evaluate({workspace_id:this.widgetModel.tab.workspace.id,tab_id:this.widgetModel.tab.id,iwidget_id:this.widgetModel.id}),{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(new_values),onSuccess:widgetCallback.call(this,new_values)});}};var widgetCallback=function widgetCallback(new_values){if(typeof this.widgetModel.prefCallback==='function'){try{for(var varName in new_values){if(this.widgetModel.preferences[varName].meta.secure&&this.widgetModel.preferences[varName].value!==""){new_values[varName]="********";}}
this.widgetModel.prefCallback(new_values);}catch(error){var details=this.widgetModel.logManager.formatException(error);this.widgetModel.logManager.log(utils.gettext('Exception catched while processing preference changes'),{details:details});}}};PreferencesWindowMenu.prototype.show=function show(widgetModel,parentWindow){var i,prefs,pref,fields;fields={};prefs=widgetModel.preferenceList;for(i=0;i<prefs.length;i++){pref=prefs[i];if(!pref.hidden){fields[pref.meta.name]=pref.getInterfaceDescription();}}
this.widgetModel=widgetModel;this.form=new se.Form(fields,{setdefaultsButton:true,buttonArea:this.windowBottom});this.form.insertInto(this.windowContent);this.form.acceptButton.addClassName('btn-accept');this.form.addEventListener('submit',this._savePrefs.bind(this));this.form.addEventListener('cancel',this.hide.bind(this));Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};Wirecloud.Widget.PreferencesWindowMenu=PreferencesWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(se,utils){"use strict";var onContinue=function onContinue(next){};var MissingDependenciesWindowMenu=function MissingDependenciesWindowMenu(next,details){var list,i,item;Wirecloud.ui.WindowMenu.call(this,utils.gettext('Missing dependencies'),'wc-missing-dependencies-modal');this.msg1Element=document.createElement('p');this.windowContent.appendChild(this.msg1Element);this.msg1Element.textContent=utils.gettext('The following dependencies are missing:');list=document.createElement('ul');for(i=0;i<details.missingDependencies.length;i++){item=document.createElement('li');item.textContent=details.missingDependencies[i];list.appendChild(item);}
this.windowContent.appendChild(list);this.msg2Element=document.createElement('p');this.windowContent.appendChild(this.msg2Element);this.msg2Element.textContent=utils.gettext('You will be able to continue after installing all the required dependencies.');this.continueButton=new se.Button({class:'btn-accept',text:utils.gettext('Continue'),});this.continueButton.addEventListener("click",onContinue.bind(this,next));this.continueButton.insertInto(this.windowBottom);this.continueButton.disable();this.cancelButton=new se.Button({class:'btn-cancel btn-primary',text:utils.gettext('Cancel')});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);};utils.inherit(MissingDependenciesWindowMenu,Wirecloud.ui.WindowMenu);MissingDependenciesWindowMenu.prototype.setFocus=function setFocus(){this.continueButton.focus();};MissingDependenciesWindowMenu.prototype.destroy=function destroy(){this.hide();this.continueButton.destroy();this.cancelButton.destroy();};Wirecloud.ui.MissingDependenciesWindowMenu=MissingDependenciesWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(se,utils){"use strict";var FormWindowMenu=function FormWindowMenu(fields,title,extra_class,options){if(arguments.length===0){return;}
Wirecloud.ui.WindowMenu.call(this,title,extra_class);options=Wirecloud.Utils.merge({factory:Wirecloud.ui.InputInterfaceFactory,autoHide:true},options);options.buttonArea=this.windowBottom;this.form=new se.Form(fields,options);this.form.insertInto(this.windowContent);this.form.acceptButton.addClassName('btn-accept');this.form.cancelButton.addClassName('btn-cancel');this.form.addEventListener('submit',function(form,data){this.form.acceptButton.disable();this.form.cancelButton.disable();try{var operation=this.executeOperation(data);}catch(e){}
if(operation!=null&&typeof operation.then==="function"){this.form.acceptButton.addClassName('busy');operation.then(function(){this.hide();}.bind(this),function(error){this.form.displayMessage(error);this.form.acceptButton.removeClassName('busy');this.form.acceptButton.enable();this.form.cancelButton.enable();}.bind(this));}else if(options.autoHide===true){this.hide();}}.bind(this));this.form.addEventListener('cancel',this._closeListener);};utils.inherit(FormWindowMenu,Wirecloud.ui.WindowMenu);FormWindowMenu.prototype.setValue=function setValue(newValue){this.form.setData(newValue);};FormWindowMenu.prototype.setFocus=function setFocus(){this.form.focus();};FormWindowMenu.prototype.show=function show(parentWindow){this.form.reset();this.form.acceptButton.enable();this.form.cancelButton.enable();Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);this.form.repaint();};Wirecloud.ui.FormWindowMenu=FormWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(ns,se,utils){"use strict";var LogWindowMenu=function LogWindowMenu(logManager,options){var priv={fadeTimeout:null,on_fade:on_fade.bind(this),on_newentry:on_newentry.bind(this)};options=utils.update({title:utils.gettext("Logs")},options);ns.WindowMenu.call(this,options.title,'logwindowmenu');privates.set(this,priv);Object.defineProperties(this,{logManager:{value:logManager}});this.button=new se.Button({text:utils.gettext("Close"),class:"btn-primary btn-accept"});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);};utils.inherit(LogWindowMenu,Wirecloud.ui.WindowMenu,{hide:function hide(parentWindow){var priv=privates.get(this);this.windowContent.innerHTML="";this.logManager.removeEventListener("newentry",priv.on_newentry);ns.WindowMenu.prototype.hide.call(this,parentWindow);return this;},show:function show(parentWindow){var priv=privates.get(this);this.logManager.entries.forEach(appendEntry,this);this.logManager.previouscycles.forEach(function(entries,i){this.windowContent.appendChild(document.createElement("hr"));entries.forEach(appendEntry,this);},this);this.logManager.addEventListener("newentry",priv.on_newentry);ns.WindowMenu.prototype.show.call(this,parentWindow);return this;},setFocus:function setFocus(){this.button.focus();return this;}});var privates=new WeakMap();var LEVEL_CLASS=['alert-error','alert-warning','alert-info'];var buildEntry=function buildEntry(entry){var entry_element,dateElement,expander,titleElement;if(entry.level===Wirecloud.constants.LOGGING.DEBUG_MSG){return;}
entry_element=document.createElement('div');entry_element.className='fade alert '+LEVEL_CLASS[entry.level-1];dateElement=document.createElement('strong');dateElement.className="wc-log-date";dateElement.textContent=moment(entry.date).fromNow();entry_element.appendChild(dateElement);titleElement=document.createElement('span');titleElement.className="wc-log-title";titleElement.appendChild(document.createTextNode(entry.msg));entry_element.appendChild(titleElement);if(entry.details!=null){expander=new se.Expander({title:utils.gettext('Details')});expander.insertInto(entry_element);if(typeof entry.details==='string'){expander.appendChild(new se.Fragment(entry.details));}else{expander.appendChild(entry.details);}}
return entry_element;};var appendEntry=function appendEntry(entry){var entry_element=buildEntry.call(this,entry);if(entry_element==null){return;}
this.windowContent.appendChild(entry_element);var priv=privates.get(this);if(priv.fadeTimeout!=null){clearTimeout(priv.fadeTimeout);}
priv.fadeTimeout=setTimeout(priv.on_fade,200);};var on_fade=function on_fade(){privates.get(this).fadeTimeout=null;for(var i=0;i<this.windowContent.childNodes.length;i++){var classList=this.windowContent.childNodes[i].classList;if(classList.contains('in')){break;}
classList.add('in');}};var on_newentry=function on_newentry(logManager,entry){var entry_element=buildEntry.call(this,entry);if(entry_element==null){return;}
this.windowContent.insertBefore(entry_element,this.windowContent.firstChild);var priv=privates.get(this);if(priv.fadeTimeout!=null){clearTimeout(priv.fadeTimeout);}
priv.fadeTimeout=setTimeout(priv.on_fade,200);};ns.LogWindowMenu=LogWindowMenu;})(Wirecloud.ui,StyledElements,Wirecloud.Utils);;(function(se,utils){"use strict";var builder=new se.GUIBuilder();var EmbedCodeWindowMenu=function EmbedCodeWindowMenu(title,workspace){Wirecloud.ui.WindowMenu.call(this,title,'wc-embed-code-modal');this.workspace=workspace;this.theme=new se.Select({initialEntries:Wirecloud.constants.AVAILABLE_THEMES});this.theme.setValue(Wirecloud.currentTheme.name);this.code=new se.TextArea();var contents=builder.parse(Wirecloud.currentTheme.templates['wirecloud/modals/embed_code'],{'themeselect':this.theme,'code':this.code});contents.appendTo(this.windowContent);this.theme.addEventListener('change',build_embed_code.bind(this));build_embed_code.call(this);this.button=new se.Button({text:utils.gettext('Accept'),class:'btn-primary btn-accept btn-cancel'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);};utils.inherit(EmbedCodeWindowMenu,Wirecloud.ui.WindowMenu);EmbedCodeWindowMenu.prototype.setFocus=function setFocus(){this.code.select();};Wirecloud.ui.EmbedCodeWindowMenu=EmbedCodeWindowMenu;var build_embed_code=function build_embed_code(){var workspace_url=this.workspace.model.url+'?mode=embedded&theme='+encodeURIComponent(this.theme.getValue());var code='<iframe src="'+workspace_url+'" style="width: 100%; height: 450px; border: 0px none;" frameborder="0" allowfullscreen></iframe>';this.code.setValue(code);this.calculatePosition();};})(StyledElements,Wirecloud.Utils);;(function(ns,se,utils){"use strict";ns.SharingWindowMenu=function SharingWindowMenu(workspace){var builder,i,options,subtitle1,subtitle2,template;ns.WindowMenu.call(this,utils.gettext("Sharing settings"),'wc-dashboard-share-modal');this.workspace=workspace;builder=new se.GUIBuilder();subtitle1=document.createElement('h4');subtitle1.textContent=utils.gettext("Visibility options");this.windowContent.appendChild(subtitle1);options=[{name:'public',iconClass:"fa fa-globe",title:utils.gettext("Public"),description:utils.gettext("Anyone on the Internet can find and access this dashboard.")},{name:'private',iconClass:"fa fa-lock",title:utils.gettext("Private"),description:utils.gettext("Shared with specific people and organizations.")}];this.visibilityOptions=new se.ButtonsGroup('visibility');template=Wirecloud.currentTheme.templates['wirecloud/workspace/visibility_option'];for(i=0;i<options.length;i++){appendOption.call(this,options[i],builder,template);}
subtitle2=document.createElement('h4');subtitle2.textContent=utils.gettext("Users and groups with access");this.windowContent.appendChild(subtitle2);this.inputSearch=new se.TextField({placeholder:utils.gettext("Add a person or an organization"),class:"wc-dashboard-share-input"});this.inputSearch.appendTo(this.windowContent);this.inputSearchTypeahead=new Wirecloud.ui.UserTypeahead({autocomplete:false});this.inputSearchTypeahead.bind(this.inputSearch);this.inputSearchTypeahead.addEventListener('select',menuitem_onselect.bind(this));this.userGroup=new se.Container({class:"wc-dashboard-share-list"});this.userGroup.appendTo(this.windowContent);this.sharingUsers=[];template=Wirecloud.currentTheme.templates['wirecloud/workspace/sharing_user'];for(i=0;i<workspace.model.users.length;i++){appendUser.call(this,workspace.model.users[i],builder,template);}
this.btnAccept=new se.Button({text:utils.gettext("Save"),state:"primary",class:'btn-accept'});this.btnAccept.appendTo(this.windowBottom);this.btnAccept.addEventListener('click',accept.bind(this));this.btnCancel=new se.Button({text:utils.gettext("Cancel"),class:'btn-cancel'});this.btnCancel.appendTo(this.windowBottom);this.btnCancel.addEventListener('click',this._closeListener);this.visibilityOptions.setValue(workspace.model.preferences.get('public')?'public':'private');this.visibilityOptions.addEventListener('change',on_visibility_option_change.bind(this));on_visibility_option_change.call(this);};utils.inherit(ns.SharingWindowMenu,Wirecloud.ui.WindowMenu);var on_visibility_option_change=function on_visibility_option_change(){this.inputSearch.setDisabled(this.visibilityOptions.value==='public');this.userGroup.setDisabled(this.visibilityOptions.value==='public');};var accept=function accept(){var username,sharelist=[];for(username in this.sharingUsers){sharelist.push({type:'user',name:username});}
this.btnAccept.disable();this.workspace.model.preferences.set({public:{value:this.visibilityOptions.value==="public"},sharelist:{value:sharelist}},{onSuccess:function(){this.workspace.model.users.length=0;for(username in this.sharingUsers){this.workspace.model.users.push(this.sharingUsers[username]);}
this._closeListener();}.bind(this),onFailure:function(){this.btnAccept.enable();}.bind(this)});};var appendOption=function appendOption(data,builder,template){builder.parse(template,{radiobutton:function(){return new se.RadioButton({group:this.visibilityOptions,value:data.name});}.bind(this),image:function(){var icon=document.createElement('span');icon.className=data.iconClass;return icon;}.bind(this),title:data.title,description:data.description}).appendTo(this.windowContent);return this;};var appendUser=function appendUser(data,builder,template){var createdElement;if(data.username in this.sharingUsers){return this;}
createdElement=builder.parse(template,{fullname:data.fullname+(data.username===Wirecloud.contextManager.get('username')?" "+utils.gettext("(You)"):""),icon:function(){var icon=document.createElement('i');icon.className=data.organization?"fa fa-building fa-stack-1x":"fa fa-user fa-stack-1x";return icon;},username:data.username,permission:function(){var span=document.createElement('span');if(data.accesslevel==='owner'){span.textContent=utils.gettext("Owner");}else{span.textContent=utils.gettext("Can view");}
return span;},btndelete:function(){var button=new se.Button({class:"btn-remove-user",plain:true,iconClass:"fa fa-remove",title:utils.gettext("Remove")});this.sharingUsers[data.username]=data;if(data.accesslevel==='owner'){button.disable();}else{button.addEventListener('click',function(){this.userGroup.removeChild(createdElement);delete this.sharingUsers[data.username];}.bind(this));}
return button;}.bind(this)}).elements[1];this.userGroup.appendChild(createdElement);return this;};var menuitem_onselect=function menuitem_onselect(typeahead,menuItem){var context=menuItem.context;var builder=new se.GUIBuilder();var template=Wirecloud.currentTheme.templates['wirecloud/workspace/sharing_user'];appendUser.call(this,context,builder,template);};})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(se,utils){"use strict";var MACSelectionWindowMenu=function MACSelectionWindowMenu(title,options){Wirecloud.ui.WindowMenu.call(this,title,'mac_selection_dialog',['select']);this.macsearch=new Wirecloud.ui.MACSearch({scope:options.scope,resourceButtonIconClass:'fa fa-check',resourceButtonTooltip:utils.gettext('Select'),resourceButtonListener:function(resource){this._closeListener();this.dispatchEvent('select',resource);}.bind(this)});this.macsearch.insertInto(this.windowContent);this.button=new se.Button({text:utils.gettext('Close'),class:'btn-primary'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);};utils.inherit(MACSelectionWindowMenu,Wirecloud.ui.WindowMenu);MACSelectionWindowMenu.prototype.addEventListener=se.ObjectWithEvents.prototype.addEventListener;MACSelectionWindowMenu.prototype.removeEventListener=se.ObjectWithEvents.prototype.removeEventListener;MACSelectionWindowMenu.prototype.setFocus=function setFocus(){this.macsearch.focus();};MACSelectionWindowMenu.prototype.show=function show(parentWindow){this.macsearch.refresh();Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};Wirecloud.ui.MACSelectionWindowMenu=MACSelectionWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(se,utils){"use strict";var titles=['',utils.gettext('Error'),utils.gettext('Warning'),utils.gettext('Info')];var MessageWindowMenu=function MessageWindowMenu(message,type){Wirecloud.ui.WindowMenu.call(this,'','message');this.msgElement=document.createElement('div');this.msgElement.className="msg";this.windowContent.appendChild(this.msgElement);this.button=new se.Button({text:utils.gettext('Accept'),state:'primary',class:'btn-accept btn-cancel'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);this.setMsg(message);this.setType(type);};utils.inherit(MessageWindowMenu,Wirecloud.ui.WindowMenu);MessageWindowMenu.prototype.setMsg=function setMsg(msg){if(msg instanceof se.StyledElement){this.msgElement.innerHTML='';msg.insertInto(this.msgElement);}else{this.msgElement.textContent=msg;}
this.calculatePosition();};MessageWindowMenu.prototype.setFocus=function setFocus(){this.button.focus();};MessageWindowMenu.prototype.setType=function setType(type){this.setTitle(titles[type]);};Wirecloud.ui.MessageWindowMenu=MessageWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(utils){"use strict";var retry=function retry(data){Wirecloud.UserInterfaceManager.monitorTask(Wirecloud.createWorkspace({title:data.title,mashup:data.mashup}).then(function(workspace){Wirecloud.changeActiveWorkspace(workspace);},function(msg,details){var dialog=new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG);dialog.show();}));};var NewWorkspaceWindowMenu=function NewWorkspaceWindowMenu(){var fields={'title':{label:utils.gettext('Name'),type:'text'},'mashup':{label:utils.gettext('Template'),type:'mac',scope:'mashup',dialog_title:utils.gettext('Select a mashup template'),required:false,parent_dialog:this}};Wirecloud.ui.FormWindowMenu.call(this,fields,utils.gettext('Create Workspace'),'wc-new-workspace-modal');};NewWorkspaceWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();NewWorkspaceWindowMenu.prototype.executeOperation=function executeOperation(data){var task_title;if(data.name){if(data.mashup){task_title=utils.gettext("Creating a %(owner)s/%(name)s workspace using %(mashup)s as template");}else{task_title=utils.gettext("Creating a %(owner)s/%(name)s workspace");}}else{task_title=utils.gettext("Creating a new workspace using %(mashup)s as template");}
task_title=utils.interpolate(task_title,{owner:Wirecloud.contextManager.get('username'),name:data.name,mashup:data.mashup});Wirecloud.UserInterfaceManager.monitorTask(Wirecloud.createWorkspace({title:data.title,mashup:data.mashup}).then(function(workspace){return Wirecloud.changeActiveWorkspace(workspace);},function(error){var dialog;if(error.details!=null&&'missingDependencies'in error.details){dialog=new Wirecloud.ui.MissingDependenciesWindowMenu(retry.bind(null,data),error.details);}else{dialog=new Wirecloud.ui.MessageWindowMenu(error,Wirecloud.constants.LOGGING.ERROR_MSG);}
dialog.show();}).toTask(task_title));};Wirecloud.ui.NewWorkspaceWindowMenu=NewWorkspaceWindowMenu;})(Wirecloud.Utils);;(function(utils){"use strict";var ParametrizeWindowMenu=function ParametrizeWindowMenu(inputInterface){var fields,sourceOptions,statusOptions;statusOptions=[{label:utils.gettext('Normal'),value:'normal'},{label:utils.gettext('Read Only'),value:'readonly'}];if(inputInterface.canBeHidden){statusOptions.push({label:utils.gettext('Hidden'),value:'hidden'});}
sourceOptions=[{label:utils.gettext('Current value'),value:'current'},{label:utils.gettext('Default value'),value:'default'},{label:utils.gettext('Parametrized value'),value:'custom'}];fields={'status':{label:utils.gettext('Status'),type:'select',initialEntries:statusOptions,required:true},'source':{label:utils.gettext('Value source'),type:'select',initialEntries:sourceOptions,required:true},'separator':{type:'separator'},'value':{label:utils.gettext('Value'),type:'parametrizedText',variable:inputInterface.variable}};Wirecloud.ui.FormWindowMenu.call(this,fields,utils.gettext('Parametrization'),'variable_parametrization');this.inputInterface=inputInterface;var valueInput=this.form.fieldInterfaces.value;var sourceInput=this.form.fieldInterfaces.source.inputElement;var updateFunc=function(){this.valueInput.setDisabled(this.sourceInput.getValue()!=='custom');}.bind({valueInput:valueInput,sourceInput:sourceInput});valueInput.update=updateFunc;sourceInput.inputElement.addEventListener('change',updateFunc);};ParametrizeWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();ParametrizeWindowMenu.prototype.setFocus=function setFocus(){this.form.fieldInterfaces.status.focus();};ParametrizeWindowMenu.prototype.executeOperation=function executeOperation(newValue){this.inputInterface.setValue(newValue);};Wirecloud.ui.ParametrizeWindowMenu=ParametrizeWindowMenu;})(Wirecloud.Utils);;(function(se,utils){"use strict";var build_pref_label=function build_pref_label(preference){var label=document.createElement("label");label.appendChild(document.createTextNode(preference.label));if(typeof preference.description==='string'&&preference.description.trim()!==''){var tooltip=new se.Tooltip({content:preference.description,placement:['right','bottom','top','left']});tooltip.bind(label);}
return label;};var build_inherit_input=function build_inherit_input(preference){return Wirecloud.ui.InputInterfaceFactory.createInterface('inherit-'+preference.name,{'type':'boolean'});};var build_pref_input=function build_pref_input(preference){return Wirecloud.ui.InputInterfaceFactory.createInterface(preference.name,preference.options);};var build_form=function build_form(){var columnLabel,columnValue;var table=document.createElement('table');table.classList.add('styled_form');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');var tbody=document.createElement('tbody');table.appendChild(tbody);Object.defineProperty(this,'interfaces',{value:{}});for(var key in this.manager.meta.preferences){var preference=this.manager.meta.preferences[key];if(preference.hidden){continue;}
var input_interface=build_pref_input(preference);this.interfaces[preference.name]={'base':input_interface};if(!preference.inheritable){var row=tbody.insertRow(-1);columnLabel=row.insertCell(-1);columnLabel.className="label-cell";columnValue=row.insertCell(-1);columnLabel.appendChild(build_pref_label(preference));input_interface.insertInto(columnValue);}else{var complexRow=tbody.insertRow(-1);var complexCell=complexRow.insertCell(-1);complexCell.style.padding="0";complexCell.colSpan="2";var complexTable=document.createElement('table');complexTable.classList.add('complexTable');complexTable.setAttribute('cellspacing','0');complexTable.setAttribute('cellpadding','0');complexCell.appendChild(complexTable);var complexTBody=document.createElement('tbody');complexTable.appendChild(complexTBody);var labelRow=complexTBody.insertRow(-1);columnLabel=labelRow.insertCell(-1);columnLabel.className="label-cell";columnLabel.colSpan="2";var prefRow=complexTBody.insertRow(-1);var inheritCell=prefRow.insertCell(-1);inheritCell.classList.add('inheritCell');var inheritInput=build_inherit_input(preference);this.interfaces[preference.name].inherit=inheritInput;inheritInput.insertInto(inheritCell);inheritCell.appendChild(document.createTextNode(utils.gettext('Inherit')));inheritInput.inputElement.addEventListener('change',function(){this.input_interface.setDisabled(this.inherit_interface.getValue());}.bind({input_interface:input_interface,inherit_interface:inheritInput}));columnValue=prefRow.insertCell(-1);columnLabel.appendChild(build_pref_label(preference));input_interface.insertInto(columnValue);}}
this.windowContent.insertBefore(table,this.msgElement);};var save_preferences=function save_preferences(){var modifiedValues={};var newInheritanceSetting;for(var pref_name in this.interfaces){var preference=this.manager.preferences[pref_name];var inputs=this.interfaces[pref_name];var inheritSettingChange=false;if('inherit'in inputs){newInheritanceSetting=inputs.inherit.getValue();inheritSettingChange=newInheritanceSetting!=preference.inherit;}
var newValue=inputs.base.getValue();var valueChange=preference.value!=newValue;if(!inheritSettingChange&&!valueChange){continue;}
var changes={};if(inheritSettingChange){changes.inherit=newInheritanceSetting;}
if(newInheritanceSetting===false||valueChange){changes.value=newValue;}
modifiedValues[pref_name]=changes;}
this.manager.set(modifiedValues);};var _executeOperation=function _executeOperation(){var validationManager=new StyledElements.ValidationErrorManager();for(var pref_name in this.interfaces){validationManager.validate(this.interfaces[pref_name].base);}
var errorMsg=validationManager.toHTML();if(errorMsg.length!==0){this.setMsg(errorMsg[0]);}else{save_preferences.call(this);this.hide();}};var PreferencesWindowMenu=function PreferencesWindowMenu(scope,manager){Wirecloud.ui.WindowMenu.call(this,'','wc-'+scope+'-preferences-modal');Object.defineProperty(this,'manager',{value:manager});this.resetButton=new se.Button({text:utils.gettext('Set Defaults'),});this.resetButton.addEventListener("click",function(){var pref_name,preference;for(pref_name in this.interfaces){preference=this.manager.preferences[pref_name].meta;this.interfaces[pref_name].base.setValue(preference.default);if('inherit'in this.interfaces[pref_name]){this.interfaces[pref_name].inherit.setValue(preference.inheritByDefault);this.interfaces[pref_name].base.setDisabled(preference.inheritByDefault);}}}.bind(this));this.resetButton.insertInto(this.windowBottom);this.acceptButton=new se.Button({class:'btn-accept btn-primary',text:utils.gettext('Save')});this.acceptButton.addEventListener("click",_executeOperation.bind(this));this.acceptButton.insertInto(this.windowBottom);this.cancelButton=new se.Button({class:'btn-cancel',text:utils.gettext('Cancel')});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);};utils.inherit(PreferencesWindowMenu,Wirecloud.ui.WindowMenu);PreferencesWindowMenu.prototype.setCancelable=function setCancelable(cancelable){this.cancelButton.setDisabled(!cancelable);};PreferencesWindowMenu.prototype.show=function show(parentWindow){var pref_name;this.setTitle(this.manager.buildTitle());if(!('interfaces'in this)){build_form.call(this);}
for(pref_name in this.manager.preferences){if(this.manager.preferences[pref_name].meta.hidden===true){continue;}
this.interfaces[pref_name].base.setValue(this.manager.preferences[pref_name].value);if('inherit'in this.interfaces[pref_name]){this.interfaces[pref_name].inherit.setValue(this.manager.preferences[pref_name].inherit);this.interfaces[pref_name].base.setDisabled(this.manager.preferences[pref_name].inherit);}}
Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);for(pref_name in this.interfaces){this.interfaces[pref_name].base.repaint();}};PreferencesWindowMenu.prototype.destroy=function destroy(){this.acceptButton.destroy();this.cancelButton.destroy();Wirecloud.ui.WindowMenu.prototype.destroy.call(this);};Wirecloud.ui.PreferencesWindowMenu=PreferencesWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(se,utils){"use strict";var OperatorPreferencesWindowMenu=function OperatorPreferencesWindowMenu(){Wirecloud.ui.WindowMenu.call(this,utils.gettext('Operator Settings'),'wc-component-preferences-modal');};utils.inherit(OperatorPreferencesWindowMenu,Wirecloud.ui.WindowMenu);OperatorPreferencesWindowMenu.prototype._savePrefs=function _savePrefs(form,new_values){var key;var requestBody=[];for(key in new_values){if(this._current_ioperator.preferences[key].value!==new_values[key]){if(this._current_ioperator.preferences[key].meta.secure&&new_values[key]!==""){this._current_ioperator.preferences[key].value="********";}else{this._current_ioperator.preferences[key].value=new_values[key];}
requestBody.push({op:"replace",path:"/operators/"+this._current_ioperator.id+"/preferences/"+key+"/value",value:new_values[key],});}else{delete new_values[key];}}
this.hide();if(!this._current_ioperator.volatile){Wirecloud.io.makeRequest(Wirecloud.URLs.WIRING_ENTRY.evaluate({workspace_id:this._current_ioperator.wiring.workspace.id,}),{method:'PATCH',contentType:'application/json-patch+json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(requestBody),onSuccess:operatorCallback.call(this,new_values)});}};var operatorCallback=function operatorCallback(new_values){if(typeof this._current_ioperator.prefCallback==='function'){try{for(var varName in new_values){if(this._current_ioperator.preferences[varName].meta.secure&&this._current_ioperator.preferences[varName].value!==""){new_values[varName]="********";}}
this._current_ioperator.prefCallback(new_values);}catch(error){var details=this._current_ioperator.logManager.formatException(error);this._current_ioperator.logManager.log(utils.gettext('Exception catched while processing preference changes'),{details:details});}}};OperatorPreferencesWindowMenu.prototype.show=function show(ioperator,parentWindow){var i,prefs,pref,fields;fields={};prefs=ioperator.preferenceList;for(i=0;i<prefs.length;i++){pref=prefs[i];if(!pref.hidden){fields[pref.meta.name]=pref.getInterfaceDescription();}}
this._current_ioperator=ioperator;this.form=new se.Form(fields,{setdefaultsButton:true,buttonArea:this.windowBottom});this.form.insertInto(this.windowContent);this.form.acceptButton.addClassName('btn-accept');this.form.addEventListener('submit',this._savePrefs.bind(this));this.form.addEventListener('cancel',this.hide.bind(this));Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};Wirecloud.ui.OperatorPreferencesWindowMenu=OperatorPreferencesWindowMenu;})(StyledElements,Wirecloud.Utils);;(function(utils){"use strict";var PublishWorkspaceWindowMenu=function PublishWorkspaceWindowMenu(workspace){var fields,user_name;user_name=Wirecloud.contextManager.get('fullname').trim()!==''?Wirecloud.contextManager.get('fullname'):Wirecloud.contextManager.get('username');fields=[{'type':'group','shortTitle':utils.gettext('General info'),'fields':[{name:'title',label:utils.gettext('Mashup Title'),description:utils.gettext("Title to display on the catalogue"),type:'text',required:true,initialValue:workspace.title,defaultValue:workspace.title},{name:'vendor',label:utils.gettext('Vendor'),description:utils.gettext("Id of the vendor/distributor of the mashable application component"),type:'text',required:true,initialValue:user_name,defaultValue:user_name},{name:'version',label:utils.gettext('Version'),type:'version',required:true,initialValue:"1.0",defaultValue:"1.0"},{name:'email',label:utils.gettext('Email'),type:'email'},{name:'description',label:utils.gettext('Short Description (plain text)'),type:'longtext'},{name:'longdescription',label:utils.gettext('Detailed description (Markdown)'),type:'longtext'},{name:'homepage',label:utils.gettext('Home page'),type:'url'},{name:'authors',label:utils.gettext('Authors'),type:'text',initialValue:user_name,defaultValue:user_name}]},{'type':'group','shortTitle':utils.gettext('Media'),'fields':[{name:'image',label:utils.gettext('Image shown in catalogue (170x80 px)'),type:'file'}]},{'type':'group','shortTitle':utils.gettext('Advanced'),'fields':[{name:'readOnlyWidgets',label:utils.gettext('Block widgets'),type:'boolean'},{name:'readOnlyConnectables',label:utils.gettext('Block connections'),type:'boolean'},{name:'embedmacs',label:utils.gettext('Embed used widgets/operators'),type:'boolean',initialValue:true}]}];Wirecloud.ui.FormWindowMenu.call(this,fields,utils.gettext('Upload workspace to my resources'),'wc-upload-workspace-modal',{autoHide:false});this.workspace=workspace;var warning=document.createElement('div');warning.className='alert';warning.innerHTML=utils.gettext("<strong>Warning!</strong> Configured and stored data in your workspace (properties and preferences except passwords) will be shared by default!");this.windowContent.insertBefore(warning,this.form.wrapperElement);};PublishWorkspaceWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();PublishWorkspaceWindowMenu.prototype._addVariableParametrization=function _addVariableParametrization(workspace,fields){var tab_field;this.workspace=workspace;this.workspace.tabs.forEach(function(tab){tab_field=this._parseTab(tab);if(tab_field!==null){fields.push(tab_field);}},this);};PublishWorkspaceWindowMenu.prototype._parseTab=function _parseTab(tab){var i,j,iwidget,iwidgets,pref_params,prop_params,var_elements,fields;iwidgets=tab.widgets;fields=[];for(i=0;i<iwidgets.length;i++){iwidget=iwidgets[i];pref_params=[];for(j=0;j<iwidget.preferenceList.length;j+=1){pref_params.push({label:iwidget.preferenceList[j].label,type:'parametrizableValue',variable:iwidget.preferenceList[j],canBeHidden:true,parentWindow:this});}
prop_params=[];for(j=0;j<iwidget.propertyList.length;j+=1){prop_params.push({label:iwidget.preferenceList[i].label,type:'parametrizableValue',variable:iwidget.propertyList[j],parentWindow:this});}
var_elements={};if(pref_params.length!==0){var_elements.pref={label:utils.gettext('Preferences'),type:'fieldset',fields:pref_params};}
if(prop_params.length!==0){var_elements.props={label:utils.gettext('Persistent variables'),type:'fieldset',fields:prop_params.sort(this._sortVariables)};}
if(pref_params.length+prop_params.length!==0){fields.push({name:iwidget.id,label:iwidget.title,type:'fieldset',nested:true,fields:var_elements});}}
if(fields.length>0){return{'shortTitle':tab.title,'fields':fields,'nested':true,'name':'tab-'+tab.title};}else{return null;}};PublishWorkspaceWindowMenu.prototype._sortVariables=function _sortVariables(var1,var2){return var1.variable.vardef.order-var2.variable.vardef.order;};PublishWorkspaceWindowMenu.prototype.setFocus=function setFocus(){this.form.fieldInterfaces.title.focus();};PublishWorkspaceWindowMenu.prototype.executeOperation=function executeOperation(data){var key;data.name=URLify(data.title);data.parametrization={iwidgets:{},ioperators:{}};for(key in data){if(key.startsWith('tab-')){Wirecloud.Utils.merge(data.parametrization.iwidgets,data[key]);delete data[key];}}
this.workspace.publish(data).then(function(){this.form.acceptButton.enable();this.form.cancelButton.enable();this.hide();}.bind(this),function(reason){this.form.acceptButton.enable();this.form.cancelButton.enable();this.form.pSetMsgs([reason]);}.bind(this));};Wirecloud.ui.PublishWorkspaceWindowMenu=PublishWorkspaceWindowMenu;})(Wirecloud.Utils);;(function(utils){"use strict";var PublishResourceWindowMenu=function PublishResourceWindowMenu(resource){this.resource=resource;var fields=this._loadAvailableMarkets();Wirecloud.ui.FormWindowMenu.call(this,fields,utils.gettext('Upload resource'),'publish_resource',{legend:false});};PublishResourceWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();PublishResourceWindowMenu.prototype._loadAvailableMarkets=function _loadAvailableMarkets(){var views=Wirecloud.UserInterfaceManager.views.marketplace.viewsByName;var key,endpoints,secondInput,buttons=[];for(key in views){endpoints=views[key].getPublishEndpoints();if(endpoints!=null){if(endpoints.length>0){endpoints.forEach(assign_endpoint_value,key);secondInput=new StyledElements.Select({initialEntries:endpoints});}else{secondInput=null;}
buttons.push({'label':key,'value':key,'secondInput':secondInput});}}
return[{'name':'marketplaces','type':'buttons','label':utils.gettext('Upload to'),'kind':'checkbox','buttons':buttons}];};PublishResourceWindowMenu.prototype.show=function show(parentWindow){Wirecloud.ui.FormWindowMenu.prototype.show.call(this,parentWindow);};PublishResourceWindowMenu.prototype.setFocus=function setFocus(){this.form.cancelButton.focus();};PublishResourceWindowMenu.prototype.executeOperation=function executeOperation(data){var url=Wirecloud.URLs.PUBLISH_ON_OTHER_MARKETPLACE;data.marketplaces=data.marketplaces.map(function(endpoint){var parts=endpoint.split('#',2);var result={'market':parts[0]};if(parts.length===2){result.store=parts[1];}
return result;});data.resource=this.resource.uri;return Wirecloud.io.makeRequest(url,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(data)}).then((response)=>{if([204,401,403,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
return Promise.resolve();});};var assign_endpoint_value=function assign_endpoint_value(endpoint){endpoint.value=this+'#'+endpoint.value;};Wirecloud.ui.PublishResourceWindowMenu=PublishResourceWindowMenu;})(Wirecloud.Utils);;(function(utils){"use strict";var RenameWindowMenu=function RenameWindowMenu(what,title){var fields={'title':{label:utils.gettext('New Name'),type:'text',required:true,initialValue:what.title}};this.what=what;Wirecloud.ui.FormWindowMenu.call(this,fields,title);};RenameWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();RenameWindowMenu.prototype.setFocus=function setFocus(){this.form.fieldInterfaces.title.focus();};RenameWindowMenu.prototype.executeOperation=function executeOperation(data){return this.what.rename(data.title);};Wirecloud.ui.RenameWindowMenu=RenameWindowMenu;})(Wirecloud.Utils);;(function(se,utils){"use strict";var builder=new se.GUIBuilder();var request_version=function request_version(){var from_version,to_version,version;if(this.current_request!=null){this.current_request.abort();}
this.changelog.disable();this.changelog.removeClassName(['downgrade','upgrade']);this.acceptButton.removeClassName(['btn-success','btn-danger']);version=this.version_selector.getValue();if(this.model.meta.version.compareTo(version)<0){this.acceptButton.setLabel(utils.gettext('Upgrade'));this.acceptButton.addClassName('btn-success');this.changelog.addClassName('upgrade');to_version=version;from_version=this.model.meta.version;}else{this.acceptButton.setLabel(utils.gettext('Downgrade'));this.acceptButton.addClassName('btn-danger');this.changelog.addClassName('downgrade');to_version=this.model.meta.version;from_version=version;}
var resource_info={'vendor':this.model.meta.vendor,'name':this.model.meta.name,'version':to_version};var url=Wirecloud.LocalCatalogue.RESOURCE_CHANGELOG_ENTRY.evaluate(resource_info);this.current_request=Wirecloud.io.makeRequest(url,{method:'GET',parameters:{from:from_version},on404:function(response){this.changelog.removeClassName(['upgrade','downgrade']);var msg=utils.gettext('There is not change information between versions %(from_version)s and %(to_version)s');this.changelog.clear().appendChild(utils.interpolate(msg,{from_version:from_version,to_version:to_version}));}.bind(this),onFailure:function(response){this.changelog.removeClassName(['upgrade','downgrade']);var msg=utils.gettext('Unable to retrieve change log information');this.changelog.clear().appendChild(msg);}.bind(this),onSuccess:function(response){this.changelog.clear().appendChild(new se.Fragment(response.responseText));}.bind(this),onComplete:function(){this.current_request=null;this.changelog.enable();}.bind(this)});};var UpgradeWindowMenu=function UpgradeWindowMenu(model){var versions;Wirecloud.ui.WindowMenu.call(this,utils.gettext("Available versions"),'wc-upgrade-component-modal');this.model=model;versions=Wirecloud.LocalCatalogue.resourceVersions[this.model.meta.group_id].map(function(resource){return resource.version;});versions=versions.filter(function(version){return model.meta.version.compareTo(version)!==0;});versions=versions.sort(function(version1,version2){return-version1.compareTo(version2);});this.version_selector=new se.Select({'name':"version"});this.version_selector.addEventListener('change',request_version.bind(this));this.version_selector.addEntries(versions);this.changelog=new se.Container({class:'markdown-body loading',tagname:'article'});builder.parse(Wirecloud.currentTheme.templates['wirecloud/modals/upgrade_downgrade_component'],{currentversion:this.model.meta.version,versionselect:this.version_selector,changelog:this.changelog}).appendTo(this.windowContent);this.acceptButton=new se.Button({'class':'btn-accept'});this.acceptButton.insertInto(this.windowBottom);this.acceptButton.addEventListener("click",function(button){var new_version=this.version_selector.getValue();var new_resource_id=[this.model.meta.vendor,this.model.meta.name,new_version].join('/');button.disable();model.upgrade(Wirecloud.LocalCatalogue.getResourceId(new_resource_id)).then(function(model){button.enable();this._closeListener();}.bind(this),function(reason){button.enable();});}.bind(this));this.cancelButton=new se.Button({text:utils.gettext('Cancel'),'class':'btn-default btn-cancel'});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);};utils.inherit(UpgradeWindowMenu,Wirecloud.ui.WindowMenu);UpgradeWindowMenu.prototype.show=function show(){Wirecloud.ui.WindowMenu.prototype.show.apply(this,arguments);request_version.call(this);};Wirecloud.ui.UpgradeWindowMenu=UpgradeWindowMenu;})(StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.UserTypeahead=function UserTypeahead(options){options=utils.merge(utils.clone(defaults),options);se.Typeahead.call(this,{autocomplete:options.autocomplete,dataFiltered:true,lookup:searchForUser,build:function build(typeahead,data){return{value:data.username,title:data.fullname,description:data.username,iconClass:data.organization?"fa fa-building":"fa fa-user",context:data};}});};utils.inherit(ns.UserTypeahead,se.Typeahead);var defaults={autocomplete:true};var searchForUser=function searchForUser(querytext,next){return Wirecloud.io.makeRequest(Wirecloud.URLs.SEARCH_SERVICE,{parameters:{namespace:'user',q:querytext},method:'GET',contentType:'application/json',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){next(JSON.parse(response.responseText).results);}});};})(Wirecloud.ui,StyledElements,StyledElements.Utils);;Wirecloud.ui=Wirecloud.ui||{};(function(ns,se,utils){"use strict";ns.WiringEditor=function WiringEditor(id,options){options=utils.merge({},options);options.class="wiring-view wc-workspace-wiring";se.Alternative.call(this,id,options);createAndSetUpLayout.call(this);Wirecloud.addEventListener('loaded',createAndSetUpBehaviourEngine.bind(this));Wirecloud.addEventListener('loaded',createAndSetUpComponentManager.bind(this));createAndSetUpConnectionEngine.call(this);this.suggestionManager=new ns.WiringEditor.KeywordSuggestion();this.selectedComponents={operator:{},widget:{}};this.selectedCount=0;this.orderableComponent=null;};utils.inherit(ns.WiringEditor,se.Alternative,{view_name:"wiring",_onhidden:function _onhidden(hidden){se.Alternative.prototype._onhidden.call(this,hidden);if(hidden){tearDownView.call(this);}else{setUpView.call(this);}
return this;},createComponent:function createComponent(wiringComponent,options){var component;options=utils.merge({commit:true,removecascade_allowed:this.behaviourEngine.enabled},options);component=new ns.WiringEditor.ComponentDraggable(wiringComponent,options);component.addEventListener('endpointadded',component_onendpointadded.bind(this)).addEventListener('endpointremoved',component_onendpointremoved.bind(this)).addEventListener('change',function(){this.behaviourEngine.updateComponent(component,component.toJSON());}.bind(this)).addEventListener('click',component_onclick.bind(this)).addEventListener('dragstart',component_ondragstart.bind(this)).addEventListener('drag',component_ondrag.bind(this)).addEventListener('dragend',component_ondragend.bind(this)).addEventListener('orderstart',component_onorderstart.bind(this)).addEventListener('orderend',component_onorderend.bind(this)).addEventListener('optremove',function(){this.behaviourEngine.removeComponent(component);}.bind(this)).addEventListener('optremovecascade',function(){this.behaviourEngine.removeComponent(component,true);}.bind(this)).addEventListener('optshare',function(){this.behaviourEngine.updateComponent(component,component.toJSON(),true);}.bind(this)).addEventListener('remove',component_onremove.bind(this));component.forEachEndpoint(bindEndpoint.bind(this));this.initialMessage.hide();if(options.commit){this.layout.content.appendChild(component);this.behaviourEngine.updateComponent(component,component.toJSON());disableComponent.call(this,component);}
return component;},buildStateData:function buildStateData(){var currentState=Wirecloud.HistoryManager.getCurrentState();return{workspace_owner:currentState.workspace_owner,workspace_name:currentState.workspace_name,view:this.view_name};},getBreadcrumb:function getBreadcrumb(){var i,workspace_breadcrum=Wirecloud.UserInterfaceManager.views.workspace.getBreadcrumb();for(i=0;i<workspace_breadcrum.length;i+=1){delete workspace_breadcrum[i].menu;}
workspace_breadcrum.push({label:this.view_name});return workspace_breadcrum;},getTitle:function getTitle(){return utils.interpolate(utils.gettext("%(workspace_title)s - Wiring"),{workspace_title:Wirecloud.UserInterfaceManager.views.workspace.getTitle()});},getToolbarButtons:function getToolbarButtons(){return[this.btnFindComponents,this.btnListBehaviours];},goUp:function goUp(){Wirecloud.UserInterfaceManager.changeCurrentView('workspace');return this;},toJSON:function toJSON(){var wiringStatus=Wirecloud.Wiring.normalize();this.connectionEngine.forEachConnection(function(connection){wiringStatus.connections.push(connection._connection);});this.behaviourEngine.forEachComponent(function(component){if(component.type==='operator'){wiringStatus.operators[component.id]=component._component;}});wiringStatus.visualdescription=this.behaviourEngine.toJSON();return wiringStatus;}});var bindEndpoint=function bindEndpoint(endpoint){this.connectionEngine.appendEndpoint(endpoint);this.suggestionManager.appendEndpoint(endpoint);endpoint.addEventListener('mouseenter',function(){if(!this.connectionEngine.temporalConnection){this.suggestionManager.showSuggestions(endpoint);}}.bind(this)).addEventListener('mouseleave',function(){if(!this.connectionEngine.temporalConnection){this.suggestionManager.hideSuggestions(endpoint);}}.bind(this));};var createAndSetUpBehaviourEngine=function createAndSetUpBehaviourEngine(){this.behaviourEngine=new ns.WiringEditor.BehaviourEngine();this.behaviourEngine.addEventListener('activate',behaviour_onactivate.bind(this)).addEventListener('change',behaviour_onchange.bind(this)).addEventListener('enable',behaviourengine_onenable.bind(this));this.layout.appendChild(this.behaviourEngine);return this;};var createAndSetUpComponentManager=function createAndSetUpComponentManager(){this.componentManager=new ns.WiringEditor.ComponentShowcase();this.componentManager.addEventListener('create',function(showcase,group,button){button.disable();if(group.meta.type==='operator'){this.workspace.wiring.createOperator(group.meta).then((operator)=>{button.enable();showcase.addComponent(operator);},(error)=>{button.enable();});}else{this.workspace.view.activeTab.createWidget(group.meta).then(function(widgetView){button.enable();showcase.addComponent(widgetView.model);});}}.bind(this));this.componentManager.addEventListener('add',function(showcase,context){context.layout=this.layout;context.element=this.createComponent(context.component._component,{commit:false});}.bind(this));this.layout.appendChild(this.componentManager);return this;};var createAndSetUpConnectionEngine=function createAndSetUpConnectionEngine(){this.connectionEngine=new ns.WiringEditor.ConnectionEngine(this.layout.content,findWiringEngine.bind(this));this.connectionEngine.addEventListener('click',connection_onclick.bind(this)).addEventListener('dragstart',connection_ondragstart.bind(this)).addEventListener('dragend',connection_ondragend.bind(this)).addEventListener('establish',connection_onestablish.bind(this)).addEventListener('duplicate',connection_onduplicate.bind(this));return this;};var findWiringEngine=function findWiringEngine(){return this.workspace.wiring;};var createAndSetUpLayout=function createAndSetUpLayout(){var centerContainer=new se.Container({class:'se-vl-center-container'});var southContainer=new se.Container({class:'se-vl-south-container'});this.layout=new se.OffCanvasLayout();this.layout.sidebar.addClassName("wiring-sidebar");this.layout.content.addClassName("wiring-diagram");setUpNavbarView.call(this);this.wrapperElement.classList.add('se-vertical-layout');this.appendChild(centerContainer);this.appendChild(southContainer);this.initialMessage=createInitialMessage();this.layout.content.appendChild(this.initialMessage);this.layout.addEventListener('slideOut',function(){this.btnFindComponents.active=false;this.btnListBehaviours.active=false;this.behaviourEngine.stopOrdering();}.bind(this)).addEventListener('slideIn',function(offcanvas,panel){this.btnFindComponents.active=panel.hasClassName("we-panel-components");this.btnListBehaviours.active=panel.hasClassName("we-panel-behaviours");if(this.btnFindComponents.active){this.behaviourEngine.stopOrdering();}}.bind(this));this.legend={title:document.createElement('span'),connections:document.createElement('span'),operators:document.createElement('span'),widgets:document.createElement('span')};Wirecloud.addEventListener('loaded',function(){southContainer.appendChild((new se.GUIBuilder()).parse(Wirecloud.currentTheme.templates['wirecloud/wiring/footer'],{title:this.legend.title,connections:this.legend.connections,operators:this.legend.operators,widgets:this.legend.widgets}).children[1]);}.bind(this));this.layout.content.get().addEventListener('dblclick',layout_ondblclick.bind(this));this._layout_onclick=layout_onclick.bind(this);this.layout.content.get().addEventListener('click',this._layout_onclick);centerContainer.appendChild(this.layout);return this;};var createInitialMessage=function createInitialMessage(){var alert=new se.Alert({title:utils.gettext("Hello, welcome to the Wiring Editor view!"),message:utils.gettext("In this view you can connect all the components of your dashboard in a visual way."),state:'info',alignment:'static-top'});alert.heading.addClassName('text-center');alert.addNote(new StyledElements.Fragment(utils.gettext("Open the sidebar using the <em>Find components</em> button and drag &amp; drop components (operators/widgets) from the sidebar for being able to connect them as you wish.")));return alert;};var setUpNavbarView=function setUpNavbarView(){this.btnFindComponents=new se.ToggleButton({title:utils.gettext("Find components"),class:"we-show-component-sidebar-button",iconClass:"fa fa-archive",stackedIconClass:"fa fa-plus-circle"});this.btnFindComponents.addEventListener('click',function(button){if(button.active){this.componentManager.searchComponents.refresh();}
showSelectedPanel.call(this,button,1);}.bind(this));this.btnListBehaviours=new se.ToggleButton({title:utils.gettext("List behaviours"),class:"we-show-behaviour-sidebar-button",iconClass:"fa fa-sitemap"});this.btnListBehaviours.addEventListener('click',function(button){showSelectedPanel.call(this,button,0);}.bind(this));return this;};var disableComponent=function disableComponent(component){var item=this.componentManager.findComponent(component.type,component.id);if(item!=null){item.used=true;}
return this;};var tearDownView=function tearDownView(){this.workspace.wiring.load(this.toJSON()).save();readyView.call(this);Wirecloud.UserInterfaceManager.rootKeydownHandler=null;return this;};var readyView=function readyView(){this.layout.slideOut();this.behaviourEngine.clear().disable();this.componentManager.clear();this.suggestionManager.enable();this.orderableComponent=null;return this;};var setUpView=function setUpView(){this.workspace=Wirecloud.activeWorkspace;this.errorMessages=[];readyView.call(this);loadWiringStatus.call(this);Wirecloud.UserInterfaceManager.rootKeydownHandler=document_onkeydown.bind(this);return this;};var loadWiringStatus=function loadWiringStatus(){var wiringEngine,visualStatus;wiringEngine=this.workspace.wiring;visualStatus=wiringEngine.visualdescription;loadComponents.call(this,this.workspace.widgets,visualStatus.components.widget);loadComponents.call(this,wiringEngine.operators,visualStatus.components.operator);loadConnections.call(this,wiringEngine.connections,visualStatus.connections);this.behaviourEngine.loadBehaviours(visualStatus.behaviours);return this;};var loadConnections=function loadConnections(connections,vInfo){connections.forEach(function(connection){var i,data;if(connection.volatile){return;}
data={source:findEndpoint.call(this,'source',connection.source.toJSON(),connection.source),target:findEndpoint.call(this,'target',connection.target.toJSON(),connection.target),meta:connection,options:{}};for(i=vInfo.length-1;i>=0;i--){if(connection.source.id===vInfo[i].sourcename&&connection.target.id===vInfo[i].targetname){data.options.sourceHandle=vInfo[i].sourcehandle;data.options.targetHandle=vInfo[i].targethandle;vInfo.splice(i,1);break;}}
this.connectionEngine.connect(data.meta,data.source,data.target,data.options);},this);return this;};var loadComponents=function loadComponents(components,visualInfo){components.forEach(function(component){this.componentManager.addComponent(component);if(component.id in visualInfo){this.createComponent(component,visualInfo[component.id]);}},this);return this;};var component_onendpointadded=function component_onendpointadded(component,endpoint){bindEndpoint.call(this,endpoint);};var component_onendpointremoved=function component_onendpointremoved(component,endpoint){this.connectionEngine.removeEndpoint(endpoint);this.suggestionManager.removeEndpoint(endpoint);};var findEndpoint=function findEndpoint(type,bInfo,wiringEndpoint){var component;component=this.behaviourEngine.components[bInfo.type][bInfo.id];if(!component){component=this.componentManager.findComponent(bInfo.type,bInfo.id);component=this.createComponent(component._component);}
return component.getEndpoint(type,bInfo.endpoint);};var clearComponentSelection=function clearComponentSelection(){var type,id,component;for(type in this.selectedComponents){for(id in this.selectedComponents[type]){component=this.selectedComponents[type][id];component.setUp();delete component.initialPosition;delete this.selectedComponents[type][id];}}
this.selectedCount=0;};var document_onkeydown=function document_onkeydown(key,modifiers){var type,id,component,componentsToRemove=[];switch(key){case'Backspace':case'Delete':if(hasSelectedComponents.call(this)){for(type in this.selectedComponents){for(id in this.selectedComponents[type]){component=this.selectedComponents[type][id];if(component.isRemovable()){componentsToRemove.push(component);}}}
if(componentsToRemove.length){this.behaviourEngine.removeComponentList(componentsToRemove);clearComponentSelection.call(this);}}
return true;}};var hasSelectedComponents=function hasSelectedComponents(){return Object.keys(this.selectedComponents.operator).length>0||Object.keys(this.selectedComponents.widget).length>0;};var behaviourengine_onenable=function behaviourengine_onenable(behaviourEngine,enabled){this.connectionEngine.forEachConnection(function(connection){connection.removeAllowed=true;connection.background=false;this.behaviourEngine.updateConnection(connection,connection.toJSON());}.bind(this));this.behaviourEngine.forEachComponent(function(component){component.removeCascadeAllowed=enabled;component.removeAllowed=true;component.background=false;this.behaviourEngine.updateComponent(component,component.toJSON());}.bind(this));};var behaviour_onactivate=function behaviour_onactivate(behaviourEngine,behaviour,viewpoint){var currentStatus=behaviour.getCurrentStatus();switch(viewpoint){case ns.WiringEditor.BehaviourEngine.GLOBAL:this.connectionEngine.forEachConnection(function(connection){connection.removeAllowed=(behaviourEngine.filterByConnection(connection).length===1);connection.show().background=!behaviour.hasConnection(connection);});this.behaviourEngine.forEachComponent(function(component){component.removeAllowed=(behaviourEngine.filterByComponent(component).length===1);component.removeCascadeAllowed=true;component.background=!behaviour.hasComponent(component);});break;}
behaviour_onchange.call(this,behaviourEngine,currentStatus,true);};var connection_onduplicate=function connection_onduplicate(connectionEngine,connection,connectionBackup){if(connection.background){this.behaviourEngine.updateConnection(connection,connection.toJSON(),true);if(connectionBackup!=null){removeBackupConnection.call(this,connectionBackup);}}};var connection_onestablish=function connection_onestablish(connectionEngine,connection,connectionBackup){this.behaviourEngine.updateConnection(connection,connection.toJSON());connection.addEventListener('change',function(){this.behaviourEngine.updateConnection(connection,connection.toJSON());}.bind(this)).addEventListener('optremove',function(){this.behaviourEngine.removeConnection(connection);}.bind(this)).addEventListener('optshare',function(){this.behaviourEngine.updateConnection(connection,connection.toJSON(),true);}.bind(this));if(connectionBackup!=null){removeBackupConnection.call(this,connectionBackup);}};var removeBackupConnection=function removeBackupConnection(connection){this.behaviourEngine.removeConnection(connection);if(this.behaviourEngine.hasConnection(connection)){showConnectionChangeModal.call(this,connection);}};var showConnectionChangeModal=function showConnectionChangeModal(connection){var modal,message;var builder=new se.GUIBuilder();message=builder.parse(builder.DEFAULT_OPENING+utils.gettext("The connection will also be modified for the rest of behaviours, would you like to continue?")+builder.DEFAULT_CLOSING);modal=new Wirecloud.ui.AlertWindowMenu();modal.setMsg(message);modal.acceptHandler=function(){this.behaviourEngine.removeConnection(connection,true);}.bind(this);modal.show();};var component_onremove=function component_onremove(component){component.forEachEndpoint(function(endpoint){this.connectionEngine.removeEndpoint(endpoint);this.suggestionManager.removeEndpoint(endpoint);}.bind(this));if(component.id in this.selectedComponents[component.type]){delete this.selectedComponents[component.type][component.id];this.selectedCount--;}
if(component.missing){this.componentManager.removeComponent(component.type,component._component);}else{this.componentManager.findComponent(component.type,component.id).used=false;}
if(!this.behaviourEngine.hasComponents()){this.initialMessage.show();}};var connection_onclick=function connection_onclick(connectionEngine,connectionClicked){clearComponentSelection.call(this);if(this.orderableComponent!=null){this.orderableComponent.setUp();this.orderableComponent=null;}};var connection_ondragstart=function connection_ondragstart(connectionEngine,connection,initialEndpoint,realEndpoint){this.collapsedComponents=[];this.behaviourEngine.forEachComponent(function(component){if(component.collapsed){component.collapsed=false;this.collapsedComponents.push(component);}}.bind(this));if(this.connectionEngine._connectionBackup!=null){this.suggestionManager.hideSuggestions(realEndpoint);this.suggestionManager.showSuggestions(initialEndpoint);}
this.layout.content.get().removeEventListener('click',this._layout_onclick);};var connection_ondragend=function connection_ondragend(connectionEngine,connection,initialEndpoint){if(this.collapsedComponents!=null){this.collapsedComponents.forEach(function(component){component.collapsed=true;});delete this.collapsedComponents;}
this.suggestionManager.hideSuggestions(initialEndpoint);setTimeout(function(){this.layout.content.get().addEventListener('click',this._layout_onclick);}.bind(this),0);};var behaviour_onchange=function behaviour_onchange(behaviourEngine,currentStatus,enabled){if(enabled){currentStatus.title="<strong>"+utils.gettext("Behaviour")+":</strong> "+currentStatus.title;}
this.legend.title.innerHTML=currentStatus.title;this.legend.connections.textContent=currentStatus.connections;this.legend.operators.textContent=currentStatus.components.operator;this.legend.widgets.textContent=currentStatus.components.widget;return this;};var layout_onclick=function layout_onclick(){clearComponentSelection.call(this);if(this.orderableComponent!=null){this.orderableComponent.setUp();this.orderableComponent=null;}
this.connectionEngine.setUp();};var layout_ondblclick=function layout_ondblclick(event){event.preventDefault();this.layout.slideOut();};var showSelectedPanel=function showSelectedPanel(button,panelIndex){if(button.active){this.layout.slideIn(panelIndex);}else{this.layout.slideOut();}
return this;};var component_onclick=function component_onclick(component,event){var type,id;if(!component.active&&component.id in this.selectedComponents[component.type]){if(event.ctrlKey||event.metaKey){delete component.initialPosition;delete this.selectedComponents[component.type][component.id];this.selectedCount--;}else{if(this.selectedCount>1){for(type in this.selectedComponents){for(id in this.selectedComponents[type]){this.selectedComponents[type][id].active=false;delete this.selectedComponents[type][id].initialPosition;delete this.selectedComponents[type][id];}}
this.selectedCount=0;component.active=true;}else{delete component.initialPosition;delete this.selectedComponents[component.type][component.id];this.selectedCount=0;}}}
if(component.active&&!(component.id in this.selectedComponents[component.type])){this.selectedComponents[component.type][component.id]=component;this.selectedCount++;}};var component_ondragstart=function component_ondragstart(component,event){var type,id,selectedComponent;if(this.orderableComponent!=null){this.orderableComponent.setUp();this.orderableComponent=null;}
this.connectionEngine.setUp();if(event.ctrlKey||event.metaKey){if(!(component.id in this.selectedComponents[component.type])){this.selectedComponents[component.type][component.id]=component;this.selectedCount++;}}else{if(!(component.id in this.selectedComponents[component.type])){for(type in this.selectedComponents){for(id in this.selectedComponents[type]){this.selectedComponents[type][id].active=false;delete this.selectedComponents[type][id].initialPosition;delete this.selectedComponents[type][id];}}
this.selectedCount=0;}}
if(component.id in this.selectedComponents[component.type]){for(type in this.selectedComponents){for(id in this.selectedComponents[type]){selectedComponent=this.selectedComponents[type][id];selectedComponent.initialPosition=selectedComponent.position();}}}};var component_ondrag=function component_ondrag(component,x,y){var type,id,selectedComponent;for(type in this.selectedComponents){for(id in this.selectedComponents[type]){if(component.type!==type||component.id!==id){selectedComponent=this.selectedComponents[type][id];selectedComponent.position({x:selectedComponent.initialPosition.x+x,y:selectedComponent.initialPosition.y+y});}}}};var component_ondragend=function component_ondragend(component){var type,id,selectedComponent;for(type in this.selectedComponents){for(id in this.selectedComponents[type]){selectedComponent=this.selectedComponents[type][id];selectedComponent.active=true;if(component.type!==type||component.id!==id){selectedComponent.dispatchEvent('change',{position:selectedComponent.position()});}}}};var component_onorderstart=function component_onorderstart(component){if(this.orderableComponent!=null&&!this.orderableComponent.equals(component)){this.orderableComponent.setUp();}
this.orderableComponent=component;this.connectionEngine.enabled=false;this.suggestionManager.disable();};var component_onorderend=function component_onorderend(component){this.connectionEngine.enabled=true;this.suggestionManager.enable();};})(Wirecloud.ui,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.Behaviour=function Behaviour(index,options){var descriptionElement;options=utils.updateObject(ns.Behaviour.JSON_TEMPLATE,options);if(!options.title){options.title=ns.Behaviour.JSON_TEMPLATE.title;}
if(!options.description){options.description=ns.Behaviour.JSON_TEMPLATE.description;}
this.title_tooltip=new se.Tooltip({content:options.title,placement:["top","bottom","right","left"]});this.btnPrefs=new se.PopupButton({title:utils.gettext("Preferences"),class:"we-prefs-btn",iconClass:"fa fa-reorder"});this.btnPrefs.popup_menu.append(new ns.BehaviourPrefs(this));this.btnRemove=new se.Button({title:utils.gettext("Remove"),class:"btn-remove",iconClass:"fa fa-times-circle"});this.btnRemove.addEventListener('click',btnremove_onclick.bind(this));se.Panel.call(this,{events:events,class:"behaviour",title:options.title,selectable:true,buttons:[this.btnPrefs,this.btnRemove]});this.heading.title.addClassName("se-link behaviour-title text-truncate");descriptionElement=document.createElement('p');descriptionElement.className="behaviour-description";descriptionElement.textContent=options.description;this.body.appendChild(descriptionElement);Object.defineProperties(this,{description:{get:function get(){return descriptionElement.textContent;},set:function set(value){descriptionElement.textContent=value?value:ns.Behaviour.JSON_TEMPLATE.description;}},index:{get:function(){return this.get().getAttribute('data-index');},set:function(value){this.get().setAttribute('data-index',value);}},logManager:{value:new Wirecloud.LogManager(Wirecloud.GlobalLogManager)}});this.active=options.active;this.index=index;this.components=options.components;this.connections=options.connections;};ns.Behaviour.JSON_TEMPLATE={title:utils.gettext("New behaviour"),description:utils.gettext("No description provided."),active:false,components:{operator:{},widget:{}},connections:[]};utils.inherit(ns.Behaviour,se.Panel,{_onclick:function _onclick(event){if(!this.active){se.Panel.prototype._onclick.call(this,event);}
return this;},clear:function clear(){this.components={operator:{},widget:{}};this.connections=[];return this.dispatchEvent('change');},setTitle:function setTitle(title){var span;span=document.createElement('span');span.textContent=title;this.title_tooltip.options.content=title;this.title_tooltip.bind(span);return se.Panel.prototype.setTitle.call(this,span);},equals:function equals(behaviour){return(behaviour instanceof ns.Behaviour)&&(this===behaviour);},getConnectionIndex:function getConnectionIndex(connection){var _connection,found,i,index=-1;for(found=false,i=0;!found&&i<this.connections.length;i++){_connection=this.connections[i];if(_connection.sourcename==connection.sourceId&&_connection.targetname==connection.targetId){found=true;index=i;}}
return index;},getCurrentStatus:function getCurrentStatus(){return{title:this.title,connections:this.connections.length,components:{operator:Object.keys(this.components.operator).length,widget:Object.keys(this.components.widget).length}};},hasComponent:function hasComponent(component){return component.id in this.components[component.type];},hasComponentView:function hasComponentView(component){return Object.keys(this.components[component.type][component.id]||{}).length>0;},hasConnection:function hasConnection(connection){return this.connections.some(function(vInfo){return vInfo.sourcename==connection.sourceId&&vInfo.targetname==connection.targetId;});},removeComponent:function removeComponent(component){if(this.hasComponent(component)){delete this.components[component.type][component.id];}
return this.dispatchEvent('change');},removeConnection:function removeConnection(connection){var index=this.getConnectionIndex(connection);if(index!==-1){this.connections.splice(index,1);}
return this.dispatchEvent('change');},showLogs:function showLogs(){var modal=new Wirecloud.ui.LogWindowMenu(this.logManager,{title:utils.interpolate(utils.gettext("%(behaviour_title)s's logs"),{behaviour_title:this.title})});modal.show();return this;},showSettings:function showSettings(){displayUpdateForm.call(this);return this;},toJSON:function toJSON(){return{title:this.title,description:this.description,active:this.active,components:this.components,connections:this.connections};},updateComponent:function updateComponent(component,view){var name;if(!this.hasComponent(component)){this.components[component.type][component.id]={};}
view=view||{};for(name in view){this.components[component.type][component.id][name]=view[name];}
return this.dispatchEvent('change');},updateConnection:function updateConnection(connection,view){var name,index;index=this.getConnectionIndex(connection);if(index<0){index=this.connections.push({sourcename:connection.sourceId,targetname:connection.targetId});}
view=view||{};for(name in view){this.connections[index][name]=view[name];}
return this.dispatchEvent('change');}});var events=['change','optremove'];var btnremove_onclick=function btnremove_onclick(event){var dialog,message;message=utils.gettext("The following operation is irreversible and removes the behaviour completely. Would you like to continue?");dialog=new Wirecloud.ui.AlertWindowMenu({acceptLabel:utils.gettext("Continue"),cancelLabel:utils.gettext("No, thank you")});dialog.setMsg(message);dialog.acceptHandler=function(){this.dispatchEvent('optremove');}.bind(this);dialog.show();};var displayUpdateForm=function displayUpdateForm(){var dialog=new Wirecloud.ui.FormWindowMenu([{name:'title',label:utils.gettext("Title"),type:'text'},{name:'description',label:utils.gettext("Description"),type:'longtext'}],utils.gettext("Behaviour settings"),'behaviour-update-form');dialog.executeOperation=function(data){updateInfo.call(this,data);}.bind(this);dialog.show();dialog.setValue(this);};var updateInfo=function updateInfo(data){this.setTitle(data.title?data.title:ns.Behaviour.JSON_TEMPLATE.title);this.description=data.description;this.dispatchEvent('change');};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.BehaviourPrefs=function BehaviourPrefs(behaviour){this.behaviour=behaviour;};utils.inherit(ns.BehaviourPrefs,se.DynamicMenuItems,{_createMenuItem:function _createMenuItem(title,iconClass,onclick,isEnabled){var item;item=new se.MenuItem(utils.gettext(title),onclick);item.addIconClass('fa fa-'+iconClass);if(isEnabled!=null){item.enabled=isEnabled.call(this.behaviour);}
return item;},build:function build(){return[this._createMenuItem("Logs","tags",function(){this.showLogs();}.bind(this.behaviour)),this._createMenuItem("Settings","gear",function(){this.showSettings();}.bind(this.behaviour))];}});})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.BehaviourEngine=function BehaviourEngine(){var note;se.StyledElement.call(this,events);this.btnEnable=new se.Button({title:utils.gettext("Enable"),class:"btn-enable",iconClass:"fa fa-lock"});this.btnEnable.addEventListener('click',btnenable_onclick.bind(this));this.btnCreate=new se.Button({title:utils.gettext("Create behaviour"),class:"btn-create",iconClass:"fa fa-plus"});this.btnCreate.addEventListener('click',btncreate_onclick.bind(this));this.btnOrder=new se.ToggleButton({title:utils.gettext("Order behaviours"),class:"btn-order",iconClass:"fa fa-sort"});this.btnOrder.addEventListener('click',btnorder_onclick.bind(this));this.btnOrder.disable();this.wrapperElement=(new se.GUIBuilder()).parse(Wirecloud.currentTheme.templates['wirecloud/wiring/behaviour_sidebar'],{enablebutton:this.btnEnable,createbutton:this.btnCreate,orderbutton:this.btnOrder,behaviourlist:behaviour_list_component.bind(this)}).children[1];Object.defineProperties(this,{orderingEnabled:{get:function(){return this.btnOrder.active;}}});this.disabledAlert=new se.Alert({state:'info',title:utils.gettext("New feature"),message:utils.gettext("Enable the behaviours to enjoy with a new way to handle connections.")});note=this.disabledAlert.addNote(utils.gettext("<a>Click here</a> for a quick guide/tutorial on how to use this new feature."));note.firstElementChild.addEventListener('click',function(){Wirecloud.TutorialCatalogue.get('mashup-wiring-design').start();});this.viewpoint=ns.BehaviourEngine.GLOBAL;this.behaviours=[];this.components={operator:{},widget:{}};};ns.BehaviourEngine.GLOBAL=0;ns.BehaviourEngine.INDEPENDENT=1;utils.inherit(ns.BehaviourEngine,se.StyledElement,{_onenabled:function _onenabled(enabled){if(enabled){this.btnEnable.setTitle(utils.gettext("Disable")).replaceIconClassName('fa-lock','fa-unlock');this.btnCreate.show();this.body.removeChild(this.disabledAlert);this.btnCreate.get().parentElement.classList.remove('hidden');}else{this.btnEnable.setTitle(utils.gettext("Enable")).replaceIconClassName('fa-unlock','fa-lock');this.btnCreate.hide();this.body.appendChild(this.disabledAlert);this.btnCreate.get().parentElement.classList.add('hidden');this.stopOrdering();}
onchange_ordering.call(this);return this;},activate:function activate(behaviour,toggleViewpoint){if(!this.enabled){return this;}
desactivateAllExcept.call(this,behaviour);if(toggleViewpoint){this.viewpoint=this.viewpoint===ns.BehaviourEngine.GLOBAL?ns.BehaviourEngine.INDEPENDENT:ns.BehaviourEngine.GLOBAL;}
return this.dispatchEvent('activate',this.behaviour,this.viewpoint);},createBehaviour:function createBehaviour(behaviourInfo){var behaviour;behaviour=(new ns.Behaviour(this.behaviours.length,behaviourInfo)).addEventListener('change',function(){if(this.behaviour.equals(behaviour)){this.dispatchEvent('change',behaviour.getCurrentStatus(),this.enabled);}}.bind(this)).addEventListener('click',function(){if(!this.orderingEnabled){this.activate(behaviour);}}.bind(this)).addEventListener('optremove',function(){this.removeBehaviour(behaviour);}.bind(this));return insertBehaviour.call(this,behaviour);},clear:function clear(){var i;if(this.enabled){for(i=this.behaviours.length-1;i>=0;i--){this.removeBehaviour(this.behaviours[i]);}
this.behaviours.length=0;this.viewpoint=ns.BehaviourEngine.GLOBAL;delete this.behaviour;this.stopOrdering();}else{this.forEachComponent(function(component){this.removeComponent(component);}.bind(this));}
onchange_ordering.call(this);this.description=Wirecloud.Wiring.normalize().visualdescription;return this;},emptyBehaviour:function emptyBehaviour(behaviour){var _behaviour;if(!this.enabled){return this;}
if(behaviour==null){behaviour=this.behaviour;}
if(!this.behaviour.equals(behaviour)){_behaviour=this.behaviour;this.activate(behaviour);}
this.forEachComponent(function(component){if(behaviour.hasComponent(component)){_removeComponent.call(this,component);}}.bind(this));behaviour.clear();if(_behaviour!=null){this.activate(_behaviour);}
return this;},filterByComponent:function filterByComponent(component){return this.behaviours.filter(function(behaviour){return behaviour.hasComponent(component);});},filterByConnection:function filterByConnection(connection){return this.behaviours.filter(function(behaviour){return behaviour.hasConnection(connection);});},forEachComponent:function forEachComponent(callback){var id,type;for(type in this.components){for(id in this.components[type]){callback(this.components[type][id]);}}
return this;},getConnectionIndex:function getConnectionIndex(connection){var _connection,found,i,index=-1;for(found=false,i=0;!found&&i<this.description.connections.length;i++){_connection=this.description.connections[i];if(_connection.sourcename==connection.sourceId&&_connection.targetname==connection.targetId){found=true;index=i;}}
return index;},getCurrentStatus:function getCurrentStatus(){return{title:"",connections:this.description.connections.length,components:{operator:Object.keys(this.description.components.operator).length,widget:Object.keys(this.description.components.widget).length}};},hasComponent:function hasComponent(component){var found;if(this.enabled){found=this.behaviours.some(function(behaviour){return behaviour.hasComponent(component);});}else{found=component.id in this.description.components[component.type];}
return found;},hasComponents:function hasComponents(){return(Object.keys(this.components.operator).length+Object.keys(this.components.widget).length)>0;},hasConnection:function hasConnection(connection){var found;if(this.enabled){found=this.behaviours.some(function(behaviour){return behaviour.hasConnection(connection);});}else{found=this.getConnectionIndex(connection)!==-1;}
return found;},loadBehaviours:function loadBehaviours(behaviours){behaviours.forEach(function(info){var behaviour=this.createBehaviour(info);behaviour.logManager.log(utils.interpolate(utils.gettext("The behaviour (%(title)s) was loaded."),behaviour),Wirecloud.constants.LOGGING.INFO_MSG);},this);if(behaviours.length){this.enabled=true;this.activate();}else{this.dispatchEvent('change',this.getCurrentStatus(),this.enabled);}
return this;},removeBehaviour:function removeBehaviour(behaviour){var i,_behaviour;if(!this.enabled){return this;}
if(this.orderingEnabled){behaviour.draggable.destroy();}
if(this.behaviour.equals(behaviour)){this.behaviours.some(function(existingBehaviour){_behaviour=existingBehaviour;return!behaviour.equals(existingBehaviour);});}else{_behaviour=this.behaviour;}
this.emptyBehaviour(behaviour).activate(_behaviour);this.body.removeChild(behaviour);this.behaviours.splice(this.behaviours.indexOf(behaviour),1);enableToRemoveBehaviour.call(this);onchange_ordering.call(this);for(i=0;i<this.behaviours.length;i++){this.behaviours[i].index=i;}
return this;},removeComponent:function removeComponent(component,cascade){if(this.enabled){if(cascade){showComponentDeleteCascadeModal.call(this,component);}else{if(this.filterByComponent(component).length>1){_removeComponent.call(this,component,false);}else{showComponentRemoveModal.call(this,component);}}}else{disabled_removeComponent.call(this,component);}
return this;},removeComponentList:function removeComponentList(componentList){var i,componentsForModal=[];if(this.enabled){for(i=0;i<componentList.length;i++){if(this.filterByComponent(componentList[i]).length>1){_removeComponent.call(this,componentList[i],false);}else{componentsForModal.push(componentList[i]);}}
if(componentsForModal.length){showComponentListRemoveModal.call(this,componentsForModal);}}else{for(i=0;i<componentList.length;i++){disabled_removeComponent.call(this,componentList[i]);}}
return this;},removeConnection:function removeConnection(connection,cascade){var index=this.getConnectionIndex(connection);if(this.enabled){if(cascade){this.behaviours.forEach(function(behaviour){behaviour.removeConnection(connection);});}else{this.behaviour.removeConnection(connection);if(this.hasConnection(connection)){connection.background=true;return this;}}}
_removeConnection.call(this,index,connection);if(!this.enabled){this.dispatchEvent('change',this.getCurrentStatus(),this.enabled);}
return this;},stopOrdering:function stopOrdering(){if(this.orderingEnabled){this.btnOrder.click();}
return this;},toggleViewpoint:function toggleViewpoint(){return this.activate(this.behaviour,true);},toJSON:function toJSON(){return JSON.parse(JSON.stringify({behaviours:this.behaviours,components:this.description.components,connections:this.description.connections}));},updateComponent:function updateComponent(component,view,beShared){var name;if(this.enabled){switch(this.viewpoint){case ns.BehaviourEngine.GLOBAL:if(!component.background||beShared){this.behaviour.updateComponent(component);component.removeAllowed=(this.filterByComponent(component).length==1);component.background=false;}
break;case ns.BehaviourEngine.INDEPENDENT:return this;}}
if(!(component.id in this.description.components[component.type])){this.description.components[component.type][component.id]={};}
view=view||{};for(name in view){this.description.components[component.type][component.id][name]=view[name];}
this.components[component.type][component.id]=component;if(!this.enabled){this.dispatchEvent('change',this.getCurrentStatus(),this.enabled);}
return this;},updateConnection:function updateConnection(connection,view,beShared){var index=this.getConnectionIndex(connection);if(this.enabled){switch(this.viewpoint){case ns.BehaviourEngine.GLOBAL:if(!connection.background||beShared){this.behaviour.updateConnection(connection);this.updateComponent(connection.sourceComponent,{},true);this.updateComponent(connection.targetComponent,{},true);connection.removeAllowed=(this.filterByConnection(connection).length==1);connection.background=false;}
break;case ns.BehaviourEngine.INDEPENDENT:return this;}}
if(index!==-1){this.description.connections[index]=view;}else{this.description.connections.push(view);}
if(!this.enabled){this.dispatchEvent('change',this.getCurrentStatus(),this.enabled);}
return this;}});var events=['activate','change','enable'];var builder=new se.GUIBuilder();var behaviour_list_component=function behaviour_list_component(options){this.body=new se.Container({class:options.class});return this.body;};var _removeConnection=function _removeConnection(index,connection){this.description.connections.splice(index,1);connection.remove();return this;};var disabled_removeComponent=function disabled_removeComponent(component){delete this.description.components[component.type][component.id];delete this.components[component.type][component.id];removeConnections.call(this,component,true);component.remove();this.dispatchEvent('change',this.getCurrentStatus(),this.enabled);return this;};var desactivateAllExcept=function desactivateAllExcept(behaviour){var i,found;for(found=false,i=0;i<this.behaviours.length;i++){this.behaviours[i].active=false;if(!found&&this.behaviours[i].equals(behaviour)){this.behaviour=this.behaviours[i];found=true;}}
this.behaviour.active=true;return this;};var enableToRemoveBehaviour=function enableToRemoveBehaviour(){var enabled=this.behaviours.length>1;this.behaviours.forEach(function(behaviour){behaviour.btnRemove.enabled=enabled;});return this;};var btncreate_onclick=function btncreate_onclick(){var dialog=new Wirecloud.ui.FormWindowMenu([{name:'title',label:utils.gettext("Title"),type:'text'},{name:'description',label:utils.gettext("Description"),type:'longtext'}],utils.gettext("New behaviour"),'we-new-behaviour-modal');dialog.executeOperation=this.createBehaviour.bind(this);dialog.show();};var btnenable_onclick=function btnenable_onclick(){var dialog,message;if(this.enabled){message=utils.gettext("The behaviours will be removed but the components and connections will still exist, would you like to continue?");dialog=new Wirecloud.ui.AlertWindowMenu({acceptLabel:utils.gettext("Continue"),cancelLabel:utils.gettext("Cancel")});dialog.setMsg(message);dialog.acceptHandler=function(){for(var i=this.behaviours.length-1;i>=0;i--){this.body.removeChild(this.behaviours[i]);}
this.behaviours.length=0;delete this.behaviour;this.enabled=false;this.dispatchEvent('enable',this.enabled);}.bind(this);dialog.show();}else{this.enabled=true;this.createBehaviour();this.dispatchEvent('enable',this.enabled);}};var insertBehaviour=function insertBehaviour(behaviour){this.body.appendChild(behaviour);this.behaviours.push(behaviour);if(behaviour.active||!this.behaviour){desactivateAllExcept.call(this,behaviour);}
enableToRemoveBehaviour.call(this);onchange_ordering.call(this);return behaviour;};var onchange_ordering=function onchange_ordering(){this.btnOrder.setDisabled(!this.enabled||this.behaviours.length<2);if(!this.btnOrder.enabled){this.btnCreate.enable();this.btnOrder.active=false;}};var _removeComponent=function _removeComponent(component,cascade){if(cascade){this.behaviours.forEach(function(behaviour){behaviour.removeComponent(component);});}else{this.behaviour.removeComponent(component);if(this.hasComponent(component)){removeConnections.call(this,component,false);component.background=true;return this;}}
delete this.description.components[component.type][component.id];delete this.components[component.type][component.id];removeConnections.call(this,component,true);component.remove();return this;};var showComponentRemoveModal=function showComponentRemoveModal(component){var modal,message;message=builder.parse(builder.DEFAULT_OPENING+utils.gettext("The <strong><t:title/></strong> <t:type/> will be removed, would you like to continue?")+builder.DEFAULT_CLOSING,{type:component.type,title:component.title});modal=new Wirecloud.ui.AlertWindowMenu();modal.setMsg(message);modal.acceptHandler=_removeComponent.bind(this,component,false);modal.show();return this;};var showComponentListRemoveModal=function showComponentListRemoveModal(componentList){var i,modal,message,components;message=new se.Fragment();components=new se.Fragment();for(i=0;i<componentList.length;i++){components.appendChild(builder.parse(builder.DEFAULT_OPENING+utils.gettext("<li>The <strong><t:title/></strong> <t:type/>.</li>")+builder.DEFAULT_CLOSING,{type:componentList[i].type,title:componentList[i].title}));}
message.appendChild(builder.parse(builder.DEFAULT_OPENING+utils.gettext("<p>These components only exist within the current behaviour <strong><t:title/></strong>:</p><ul><t:components/></ul><p>Would you like to continue?</p>")+builder.DEFAULT_CLOSING,{title:this.behaviour.title,components:components}));modal=new Wirecloud.ui.AlertWindowMenu();modal.setMsg(message);modal.acceptHandler=function(){var i;for(i=0;i<componentList.length;i++){_removeComponent.call(this,componentList[i],false);}}.bind(this);modal.show();return this;};var showComponentDeleteCascadeModal=function showComponentDeleteCascadeModal(component){var modal,message;message=builder.parse(builder.DEFAULT_OPENING+utils.gettext("The <strong><t:title/></strong> <t:type/> will be <strong>definitely</strong> removed, would you like to continue?")+builder.DEFAULT_CLOSING,{type:component.type,title:component.title});modal=new Wirecloud.ui.AlertWindowMenu();modal.setMsg(message);modal.acceptHandler=_removeComponent.bind(this,component,true);modal.show();return this;};var removeConnections=function removeConnections(component,cascade){component.forEachConnection(function(connection){this.removeConnection(connection,cascade);}.bind(this));return this;};var btnorder_onclick=function btnorder_onclick(button){var i;if(button.active){for(i=0;i<this.behaviours.length;i++){this.behaviours[i].btnPrefs.disable();this.behaviours[i].btnRemove.disable();makeBehaviourDraggable.call(this,this.behaviours[i]);}
this.btnCreate.disable();}else{for(i=0;i<this.behaviours.length;i++){this.behaviours[i].draggable.destroy();this.behaviours[i].btnPrefs.enable();this.behaviours[i].btnRemove.enable();}
this.btnCreate.enable();}};var makeBehaviourDraggable=function makeBehaviourDraggable(behaviour){behaviour.draggable=new Wirecloud.ui.Draggable(behaviour.get(),{container:this.body},function dragstart(draggable,context,event){var behaviourBCR,layout,layoutBCR;layout=context.container.get();context.layout=layout;context.tmpBehaviour=behaviour.get().cloneNode(true);context.tmpBehaviour.classList.add("dragging");context.layout.appendChild(context.tmpBehaviour);behaviour.addClassName("temporal");behaviourBCR=behaviour.get().getBoundingClientRect();layoutBCR=context.layout.getBoundingClientRect();context.x=behaviourBCR.left-layoutBCR.left-((behaviour.get().offsetWidth-behaviour.get().clientWidth)/2);context.y=(event.clientY+layout.scrollTop)-(layoutBCR.top+(behaviour.get().offsetHeight/2));context.tmpBehaviour.style.left=context.x+'px';context.tmpBehaviour.style.width=behaviour.get().offsetWidth+'px';context.tmpBehaviour.style.top=context.y+'px';var firstBehaviour=this.behaviours[0].get(),lastBehaviour=this.behaviours[this.behaviours.length-1].get();context.upperLimit=firstBehaviour.offsetTop;context.lowerLimit=lastBehaviour.offsetTop;context.offsetHeight=event.clientY-(behaviourBCR.top+(behaviour.get().offsetHeight/2));context.marginVertical=5;context.refHeigth=behaviourBCR.height+context.marginVertical;context.refHeigthUp=(behaviourBCR.height/2)+context.marginVertical;context.refHeigthDown=context.refHeigthUp;context.canMoveUp=this.behaviours.indexOf(behaviour);context.canMoveDown=this.behaviours.length-(context.canMoveUp+1);}.bind(this),function drag(e,draggable,context,xDelta,yDelta){var offsetTop=Math.round(context.y+yDelta);context.tmpBehaviour.style.width=behaviour.get().offsetWidth+'px';if(offsetTop>=context.upperLimit&&offsetTop<=context.lowerLimit){context.tmpBehaviour.style.top=offsetTop+'px';}
if((context.canMoveUp>0)&&(-(yDelta+context.offsetHeight)>context.refHeigthUp)){context.canMoveUp-=1;context.refHeigthUp+=context.refHeigth;context.canMoveDown+=1;context.refHeigthDown-=context.refHeigth;moveUpBehaviour.call(this,behaviour);}else if((context.canMoveDown>0)&&((yDelta+context.offsetHeight)>context.refHeigthDown)){context.canMoveUp+=1;context.refHeigthUp-=context.refHeigth;context.canMoveDown-=1;context.refHeigthDown+=context.refHeigth;moveDownBehaviour.call(this,behaviour);}}.bind(this),function dragend(draggable,context){behaviour.removeClassName("temporal");context.layout.removeChild(context.tmpBehaviour);},function canDrag(){return true;});return this;};var moveDownBehaviour=function moveDownBehaviour(behaviour){var nextBehaviour,index=this.behaviours.indexOf(behaviour);if(index==(this.behaviours.length-1)){return this;}
nextBehaviour=this.behaviours[index+1];behaviour.parent().insertBefore(behaviour.get(),nextBehaviour.get().nextSibling);behaviour.index=index+1;nextBehaviour.index=index;this.behaviours[index+1]=behaviour;this.behaviours[index]=nextBehaviour;};var moveUpBehaviour=function moveUpBehaviour(behaviour){var previousBehaviour,index=this.behaviours.indexOf(behaviour);if(index===0){return this;}
previousBehaviour=this.behaviours[index-1];behaviour.parent().insertBefore(behaviour.get(),previousBehaviour.get());behaviour.index=index-1;previousBehaviour.index=index;this.behaviours[index-1]=behaviour;this.behaviours[index]=previousBehaviour;};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.Endpoint=function Endpoint(type,wiringEndpoint,component){se.StyledElement.call(this,events);this.wrapperElement=document.createElement('div');this.wrapperElement.className="endpoint";this.titleElement=document.createElement('span');this.titleElement.className="endpoint-title";this.wrapperElement.appendChild(this.titleElement);this.anchorElement=document.createElement('span');this.anchorElement.className="endpoint-anchor";this.wrapperElement.appendChild(this.anchorElement);this._endpoint=wiringEndpoint;this.component=component;this.activeCount=0;this.connections=[];Object.defineProperties(this,{active:{get:function get(){return this.hasClassName('active');},set:function set(value){this.toggleClassName('active',value);}},anchorPosition:{get:function get(){return getAnchorPosition.call(this);}},editableConnection:{get:function get(){return getEditableConnection.call(this);}},id:{value:[component.type,component.id,wiringEndpoint.name].join("/")},index:{get:function get(){return parseInt(this.get().getAttribute('data-index'),10);},set:function set(value){this.get().setAttribute('data-index',value);}},friendcodeList:{value:wiringEndpoint.friendcodeList},missing:{get:function get(){return this.hasClassName('missing');},set:function set(value){this.toggleClassName('missing',value);}},name:{value:wiringEndpoint.name},title:{get:function get(){return this.titleElement.textContent;},set:function set(value){this.titleElement.textContent=value;}},type:{value:type}});this.get().setAttribute('data-name',this._endpoint.name);this.title=wiringEndpoint.label;if(wiringEndpoint.missing){this.missing=true;}
this.rightAnchorPoint=false;this.tooltip=new se.Popover({title:wiringEndpoint.label,content:wiringEndpoint.description!==''?wiringEndpoint.description:utils.gettext("No description provided."),placement:['top','bottom','right','left']});this.tooltip.bind(this.get(),'hover');this.get().addEventListener('mousedown',endpoint_onmousedown.bind(this));this.get().addEventListener('mouseenter',endpoint_onmouseenter.bind(this));this.get().addEventListener('mouseleave',endpoint_onmouseleave.bind(this));this.get().addEventListener('mouseup',endpoint_onmouseup.bind(this));};utils.inherit(ns.Endpoint,se.StyledElement,{activate:function activate(){if(this.activeCount===0){this.active=true;}
this.activeCount++;return this;},activateAll:function activateAll(){return this.forEachConnection(function(connection){connection.activate();});},appendConnection:function appendConnection(connection,updateEndpoint){this.connections.push(connection);if(!!updateEndpoint){connection.refreshEndpoint(this);}
return this.dispatchEvent('connectionadded',connection);},deactivate:function deactivate(){if(this.activeCount===0){return this;}
this.activeCount--;if(this.activeCount===0){this.active=false;}
return this;},deactivateAll:function deactivateAll(){return this.forEachConnection(function(connection){connection.deactivate();});},empty:function empty(){var i;for(i=this.connections.length-1;i>=0;i--){this.connections[i].remove();}
return this;},equals:function equals(endpoint){if(!(endpoint instanceof ns.Endpoint)){return false;}
return this.type===endpoint.type&&this.id===endpoint.id;},forEachConnection:function forEachConnection(callback){for(var i=this.connections.length-1;i>=0;i--){callback(this.connections[i],i);}
return this;},getConnectionTo:function getConnectionTo(endpoint){var connection,i;for(i=this.connections.length-1;connection==null&&i>=0;i--){if(this.connections[i].hasEndpoint(endpoint)){connection=this.connections[i];}}
return connection;},hasConnection:function hasConnection(connection){if(!(connection instanceof ns.Connection)){return false;}
return this.connections.some(function(connectionSaved){return connectionSaved.equals(connection);});},hasConnections:function hasConnections(){return this.connections.length>0;},hasConnectionTo:function hasConnectionTo(endpoint){return this.connections.some(function(connection){return connection.hasEndpoint(endpoint);});},refresh:function refresh(){return this.connections.forEach(function(connection){connection.refresh();});},removeConnection:function removeConnection(connection){var index=this.connections.indexOf(connection);if(index!==-1){this.connections.splice(index,1);this.dispatchEvent('connectionremoved',connection);}
return this;},toggleActive:function toggleActive(active){return active?this.activate():this.deactivate();},toJSON:function toJSON(){return{type:this.component.type,id:this.component.id,endpoint:this.name};}});var events=['click','connectionadded','connectionremoved','mousedown','mouseenter','mouseleave','mouseup'];var endpoint_onmousedown=function endpoint_onmousedown(event){if(this.enabled&&event.button===0){event.stopPropagation();event.preventDefault();this.dispatchEvent('mousedown',event);}};var endpoint_onmouseenter=function endpoint_onmouseenter(event){if(this.enabled){event.stopPropagation();this.dispatchEvent('mouseenter',event);}};var endpoint_onmouseleave=function endpoint_onmouseleave(event){if(this.enabled){event.stopPropagation();this.dispatchEvent('mouseleave',event);}};var endpoint_onmouseup=function endpoint_onmouseup(event){if(this.enabled&&event.button===0){event.stopPropagation();event.preventDefault();this.dispatchEvent('mouseup',event);}};var getAnchorPosition=function getAnchorPosition(){var layout=this.component.parent(),layoutBCR=layout.getBoundingClientRect(),anchorBCR=this.anchorElement.getBoundingClientRect();var anchorPosition={x:Math.round(anchorBCR.left-(layoutBCR.left+1)+layout.scrollLeft),y:Math.round(anchorBCR.top+(this.anchorElement.offsetHeight/2)-(layoutBCR.top+1)+layout.scrollTop)};if(this.rightAnchorPoint){anchorPosition.x=Math.round(anchorPosition.x+this.anchorElement.offsetWidth);}
return anchorPosition;};var getEditableConnection=function getEditableConnection(){var connection,i;for(i=0;connection==null&&i<this.connections.length;i++){if(this.connections[i].editable){connection=this.connections[i];}}
return connection;};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.SourceEndpoint=function SourceEndpoint(wiringEndpoint,component){ns.Endpoint.call(this,'source',wiringEndpoint,component);this.rightAnchorPoint=true;};utils.inherit(ns.SourceEndpoint,ns.Endpoint,{});})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.TargetEndpoint=function TargetEndpoint(wiringEndpoint,component){ns.Endpoint.call(this,'target',wiringEndpoint,component);};utils.inherit(ns.TargetEndpoint,ns.Endpoint,{});})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.EndpointGroup=function EndpointGroup(type,component,EndpointClass){se.Container.call(this,{class:"endpoints"});this.addClassName(type+"-endpoints");this.endpoints={};this.component=component;this.EndpointClass=EndpointClass;this.originalOrder=[];Object.defineProperties(this,{modified:{get:function get(){return this.canBeOrdered()&&!equalsLists(this.originalOrder,this.children.map(function(endpoint){return endpoint.name;}));}},orderable:{get:function get(){return this.hasClassName('orderable');},set:function set(value){this.toggleClassName('orderable',value);}},type:{value:type}});};ns.EndpointGroup.MIN_LENGTH=1;utils.inherit(ns.EndpointGroup,se.Container,{appendEndpoint:function appendEndpoint(wiringEndpoint){var endpoint=new this.EndpointClass(wiringEndpoint,this.component);var missingEndpoint=findFirstMissingEndpoint.call(this);var i;if(!wiringEndpoint.missing){this.originalOrder.push(endpoint.name);}
if(!wiringEndpoint.missing&&missingEndpoint!=null){this.prependChild(endpoint,missingEndpoint);}else{this.appendChild(endpoint);}
this.endpoints[endpoint.name]=endpoint;for(i=0;i<this.children.length;i++){this.children[i].index=i;}
return endpoint;},canBeOrdered:function canBeOrdered(){return this.children.length>ns.EndpointGroup.MIN_LENGTH&&!hasMissingEndpoints.call(this);},getEndpoint:function getEndpoint(name){return this.endpoints[name];},refresh:function refresh(){var name;for(name in this.endpoints){this.endpoints[name].refresh();}
return this;},orderEndpoints:function orderEndpoints(newOrder){if(!this.canBeOrdered()){return this;}
if(newOrder.length<2||equalsLists(this.originalOrder,newOrder)){return this;}
if(!equalsLists(this.originalOrder,newOrder,false)){return this;}
newOrder.forEach(function(name,index){var endpoint=this.endpoints[name];endpoint.index=index;se.Container.prototype.removeChild.call(this,endpoint);this.appendChild(endpoint);},this);return this;},removeChild:function removeChild(endpoint){var index=this.originalOrder.indexOf(endpoint.name);var i;if(index!==-1){this.originalOrder.splice(index,1);}
se.Container.prototype.removeChild.call(this,endpoint);delete this.endpoints[endpoint.name];for(i=0;i<this.children.length;i++){this.children[i].index=i;}
return this;},startOrdering:function startOrdering(){if(!this.canBeOrdered()||this.orderable){return this;}
this.orderable=true;this.children.forEach(function(endpoint){makeEndpointDraggable.call(this,endpoint);},this);return this;},stopOrdering:function stopOrdering(){if(!this.orderable){return this;}
this.orderable=false;this.children.forEach(function(endpoint){endpoint.draggable.destroy();},this);return this;},toJSON:function toJSON(){if(this.modified){return this.children.map(function(endpoint){return endpoint.name;});}
return[];}});var equalsLists=function equalsLists(list1,list2,sorted){if(typeof sorted!=='boolean'){sorted=true;}
list1=list1.slice();list2=list2.slice();if(!sorted){list1=list1.sort();list2=list2.sort();}
return list1.join()===list2.join();};var hasMissingEndpoints=function hasMissingEndpoints(){return this.children.some(function(endpoint){return endpoint.missing;});};var findFirstMissingEndpoint=function findFirstMissingEndpoint(){var i,endpoint=null;for(i=0;i<this.children.length&&endpoint==null;i++){if(this.children[i].missing){endpoint=this.children[i];}}
return endpoint;};var makeEndpointDraggable=function makeEndpointDraggable(endpoint){endpoint.draggable=new Wirecloud.ui.Draggable(endpoint.get(),{group:this},function dragstart(draggable,context,event){var endpointBCR,layout,layoutBCR;context.layout=context.group.component.parentElement;endpointBCR=endpoint.get().getBoundingClientRect();layout=context.layout.get();layoutBCR=layout.getBoundingClientRect();context.x=(event.clientX+layout.scrollLeft)-(layoutBCR.left+(endpoint.get().offsetWidth/2));context.y=(event.clientY+layout.scrollTop)-(layoutBCR.top+(endpointBCR.height/2));context.offsetHeight=event.clientY-(endpointBCR.top+(endpointBCR.height/2));context.clonedEndpoint=endpoint.get().cloneNode(true);context.clonedEndpoint.classList.add(endpoint.type+"-endpoint");context.clonedEndpoint.classList.add("cloned");context.layout.appendChild(context.clonedEndpoint);context.clonedEndpoint.style.left=context.x+'px';context.clonedEndpoint.style.top=context.y+'px';endpoint.addClassName("dragging");context.marginVertical=5;context.refHeigth=endpointBCR.height+context.marginVertical;context.refHeigthUp=(endpointBCR.height/2)+context.marginVertical;context.refHeigthDown=context.refHeigthUp;context.canMoveUp=endpoint.index;context.canMoveDown=context.group.children.length-(context.canMoveUp+1);},function drag(e,draggable,context,xDelta,yDelta){context.clonedEndpoint.style.left=Math.round(context.x+xDelta)+'px';context.clonedEndpoint.style.top=Math.round(context.y+yDelta)+'px';if((context.canMoveUp>0)&&(-(yDelta+context.offsetHeight)>context.refHeigthUp)){context.canMoveUp-=1;context.refHeigthUp+=context.refHeigth;context.canMoveDown+=1;context.refHeigthDown-=context.refHeigth;moveUpEndpoint.call(context.group,endpoint);}else if((context.canMoveDown>0)&&((yDelta+context.offsetHeight)>context.refHeigthDown)){context.canMoveUp+=1;context.refHeigthUp-=context.refHeigth;context.canMoveDown-=1;context.refHeigthDown+=context.refHeigth;moveDownEndpoint.call(context.group,endpoint);}},function dragend(draggable,context){endpoint.removeClassName("dragging");context.layout.removeChild(context.clonedEndpoint);},function canDrag(){return true;});return this;};var moveDownEndpoint=function moveDownEndpoint(endpoint){var nextEndpoint,index=endpoint.index;if(index==(this.children.length-1)){return this;}
nextEndpoint=this.children[index+1];endpoint.parent().insertBefore(endpoint.get(),nextEndpoint.get().nextSibling);endpoint.index=index+1;nextEndpoint.index=index;this.children[index+1]=endpoint;this.children[index]=nextEndpoint;return this.refresh();};var moveUpEndpoint=function moveUpEndpoint(endpoint){var previousEndpoint,index;index=endpoint.index;if(index===0){return this;}
previousEndpoint=this.children[index-1];endpoint.parent().insertBefore(endpoint.get(),previousEndpoint.get());endpoint.index=index-1;previousEndpoint.index=index;this.children[index-1]=endpoint;this.children[index]=previousEndpoint;return this.refresh();};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.Component=function Component(wiringComponent){var used=false;this.title_tooltip=new se.Tooltip({content:wiringComponent.title,placement:["top","bottom","right","left"]});this.btnPrefs=new se.PopupButton({class:"we-prefs-btn",title:utils.gettext("Preferences"),iconClass:"fa fa-reorder"});this.btnPrefs.popup_menu.append(new ns.ComponentPrefs(this));se.Panel.call(this,{state:null,class:"we-component component-"+wiringComponent.meta.type,title:wiringComponent.title,subtitle:"v"+wiringComponent.meta.version,selectable:true,noBody:true,buttons:[this.btnPrefs]});this.heading.title.addClassName('component-title text-truncate');this.heading.subtitle.addClassName("component-version");this.label=document.createElement('span');this._component=wiringComponent;Object.defineProperties(this,{id:{value:wiringComponent.id},type:{value:wiringComponent.meta.type},used:{get:function(){return used;},set:function(value){used=value;update_enable_status.call(this);update_component_label.call(this);}}});this.get().setAttribute('data-id',this.id);this._on_change_model=on_change_model.bind(this);wiringComponent.addEventListener('change',this._on_change_model);update_enable_status.call(this);update_component_label.call(this);};utils.inherit(ns.Component,se.Panel,{hasSettings:function hasSettings(){return this._component.meta.preferenceList.length>0;},setTitle:function setTitle(title){var span;span=document.createElement('span');span.textContent=title;this.title_tooltip.options.content=title;this.title_tooltip.bind(span);return se.Panel.prototype.setTitle.call(this,span);},showLogs:function showLogs(){this._component.showLogs();return this;},showSettings:function showSettings(){this._component.showSettings();return this;}});var update_component_label=function update_component_label(){if(this._component.volatile){this.label.textContent=utils.gettext("volatile");this.label.className="label label-info";}else if(this._component.missing){this.label.textContent=utils.gettext("missing");this.label.className="label label-danger";}else if(this.used){this.label.textContent=utils.gettext("in use");this.label.className="label label-success";}else if(!this._component.hasEndpoints()){this.label.textContent=utils.gettext("no endpoints");this.label.className="label label-warning";}else{if(this.label.parentElement){this.heading.removeChild(this.label);}
return this;}
this.heading.appendChild(this.label);return this;};var update_enable_status=function update_enable_status(){this.enabled=!(this.used||this._component.volatile||this._component.missing||!this._component.hasEndpoints());};var on_change_model=function on_change_model(model,changes){if(changes.indexOf('title')!==-1){this.setTitle(model.title);this.title_tooltip.options.content=model.title;}
if(changes.indexOf('meta')!==-1){this.setTitle(model.title);this.title_tooltip.options.content=model.title;this.setSubtitle("v"+model.meta.version);update_enable_status.call(this);update_component_label.call(this);}};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ComponentPrefs=function ComponentPrefs(component){this.component=component;};utils.inherit(ns.ComponentPrefs,se.DynamicMenuItems,{_createMenuItem:function _createMenuItem(title,iconClass,onclick,isEnabled){var item;item=new se.MenuItem(title,onclick);item.addIconClass('fa fa-'+iconClass);if(isEnabled!=null){item.enabled=isEnabled.call(this);}
return item;},build:function build(){return[this._createMenuItem(utils.gettext("Rename"),"pencil",function(){showRenameModal.call(this);}.bind(this),canRename),this._createMenuItem(utils.gettext("Upgrade/Downgrade"),"retweet",function(){var dialog=new Wirecloud.ui.UpgradeWindowMenu(this.component._component);dialog.show();}.bind(this),canUpgrade),this._createMenuItem(utils.gettext("Logs"),"tags",function(){this.component.showLogs();}.bind(this)),this._createMenuItem(utils.gettext("Settings"),"gear",function(){this.component.showSettings();}.bind(this),canShowSettings)];}});var canRename=function canRename(){return!this.component._component.volatile&&this.component.type=='widget';};var canUpgrade=function canUpgrade(){return this.component._component.isAllowed('upgrade')&&Wirecloud.LocalCatalogue.hasAlternativeVersion(this.component._component.meta);};var canShowSettings=function canShowSettings(){return this.component.hasSettings()&&this.component._component.isAllowed('configure');};var showRenameModal=function showRenameModal(){var dialog=new Wirecloud.ui.FormWindowMenu([{name:'title',label:utils.gettext("Title"),type:'text',placeholder:this.component.title},],utils.interpolate(utils.gettext("Rename %(type)s"),this.component),"wc-component-rename-modal");dialog.executeOperation=function(data){if(data.title){this.component._component.rename(data.title);}}.bind(this);dialog.show();dialog.setValue({title:this.component.title});};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ComponentGroup=function ComponentGroup(resource,title){se.StyledElement.call(this,events);title=title||utils.gettext("Create");this.titleElement=document.createElement('span');this.tooltip=new se.Tooltip();this.tooltip.bind(this.titleElement);this.imageElement=document.createElement('img');this.imageElement.onerror=image_onerror.bind(this);var version=new se.Select({initialValue:resource.version,initialEntries:orderVersions([resource.version].concat(resource.others))});version.addEventListener('change',version_onchange.bind(this));var button=new se.Button({class:'btn-create wc-create-resource-component',title:title,iconClass:'fa fa-plus'});button.addEventListener('click',function(){this.dispatchEvent('btncreate.click',button);}.bind(this));this.descriptionElement=document.createElement('div');this.descriptionElement.className="text-muted";this.wrapperElement=(new se.GUIBuilder()).parse(Wirecloud.currentTheme.templates['wirecloud/wiring/component_group'],{title:this.titleElement,image:this.imageElement,versionselect:version,createbutton:button,vendor:resource.vendor,description:this.descriptionElement}).children[1];this.components={};Object.defineProperties(this,{id:{value:resource.vendor+"/"+resource.name}});this.wrapperElement.setAttribute('data-id',this.id);version_onchange.call(this,version);};utils.inherit(ns.ComponentGroup,se.StyledElement,{addComponent:function addComponent(component){if(!(component.id in this.components)){this.components[component.id]=component.appendTo(this.wrapperElement);}
return this;}});var events=['btncreate.click'];var version_onchange=function version_onchange(element){var version=element.getValue();this.meta=Wirecloud.LocalCatalogue.getResourceId(this.id+"/"+version.text);this.titleElement.textContent=this.meta.title;this.tooltip.options.content=this.meta.title;this.descriptionElement.textContent=this.meta.description?this.meta.description:utils.gettext("No description provided");setImage.call(this,this.meta.image);};var setImage=function setImage(imageURL){var thumbnailElement=this.imageElement.parentElement;thumbnailElement.classList.remove('se-thumbnail-missing');thumbnailElement.innerHTML="";thumbnailElement.appendChild(this.imageElement);this.imageElement.removeAttribute('src');if(imageURL){this.imageElement.src=imageURL;}else{image_onerror.call(this);}};var image_onerror=function image_onerror(){this.imageElement.parentElement.classList.add('se-thumbnail-missing');this.imageElement.parentElement.appendChild(document.createTextNode(utils.gettext("No image available")));};var orderVersions=function orderVersions(versions){versions=versions.sort(function(version1,version2){return-version1.compareTo(version2);});versions[0]={label:utils.interpolate(utils.gettext("%(version)s (latest)"),{version:versions[0]}),value:versions[0]};return versions;};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ComponentShowcase=function ComponentShowcase(){se.StyledElement.call(this,['add','create']);this.components={operator:{},widget:{}};this.groups={};this.operatorButton=new se.ToggleButton({class:'btn-list-operator-group',state:'primary',text:utils.gettext('Operators')});this.operatorButton.addEventListener('click',function(){this.operatorButton.active=true;this.widgetButton.active=false;this.searchComponents.search_scope='operator';this.searchComponents.refresh();}.bind(this));this.widgetButton=new se.ToggleButton({class:'btn-list-widget-group',state:'primary',text:utils.gettext('Widgets')});this.widgetButton.addEventListener('click',function(){this.operatorButton.active=false;this.widgetButton.active=true;this.searchComponents.search_scope='widget';this.searchComponents.refresh();}.bind(this));var resource_painter={paint:function paint(group){var id;group=new ns.ComponentGroup(group);group.addEventListener('btncreate.click',createcomponent_onclick.bind(this));if(this.components.operator[group.id]!=null){for(id in this.components.operator[group.id]){group.addComponent(this.components.operator[group.id][id]);}}
if(this.components.widget[group.id]!=null){for(id in this.components.widget[group.id]){group.addComponent(this.components.widget[group.id][id]);}}
this.groups[group.id]=group;return group;}.bind(this)};this.searchComponents=new Wirecloud.ui.MACSearch({template:'wirecloud/component_sidebar',extra_template_context:{typebuttons:new se.Fragment([this.operatorButton,this.widgetButton])},scope:'widget',resource_painter:resource_painter});this.searchComponents.addEventListener('search',clearAll.bind(this));this.widgetButton.active=true;this.wrapperElement=this.searchComponents.get();};utils.inherit(ns.ComponentShowcase,se.StyledElement,{addComponent:function addComponent(wiringComponent){var group_id=wiringComponent.meta.group_id,type=wiringComponent.meta.type;if(!(group_id in this.components[type])){this.components[type][group_id]={};}
var component=new ns.Component(wiringComponent);component.draggable=new Wirecloud.ui.Draggable(component.get(),{component:component},component_ondragstart.bind(this),component_ondrag.bind(this),component_ondragend.bind(this),function canDrag(){return component.enabled;});this.components[type][group_id][component.id]=component;if(group_id in this.groups){this.groups[group_id].addComponent(component);}
return component;},clear:function clear(){this.searchComponents.clear();this.components={operator:{},widget:{}};return this;},findComponent:function findComponent(type,id){var group_id;for(group_id in this.components[type]){if(id in this.components[type][group_id]){return this.components[type][group_id][id];}}
return null;},forEachComponent:function forEachComponent(callback){var type,id,group_id;for(type in this.components){for(group_id in this.components[type]){for(id in this.components[type][group_id]){callback(this.components[type][group_id][id]);}}}
return this;},removeComponent:function removeComponent(type,component){var group_id=component.meta.group_id;this.components[type][group_id][component.id].remove();delete this.components[type][group_id][component.id];return this;}});var clearAll=function clearAll(){this.groups={};};var component_ondragstart=function component_ondragstart(draggable,context,event){this.dispatchEvent('add',context);var bcr=context.layout.getBoundingClientRect();context.element.appendTo(context.layout.slideOut().parentElement);context.x=event.clientX-bcr.left-(context.element.wrapperElement.offsetWidth/2);context.y=event.clientY-bcr.top-(context.element.heading.wrapperElement.offsetHeight/2);context.component.used=true;context.element.addClassName("cloned dragging").position({x:context.x,y:context.y});};var createcomponent_onclick=function createcomponent_onclick(group,button){this.dispatchEvent('create',group,button);};var component_ondrag=function component_ondrag(event,draggable,context,xDelta,yDelta){var layout;if(!context.layout.content.has(context.element)){layout=context.layout.content.get();context.x+=layout.scrollLeft;context.y+=layout.scrollTop;context.element.remove();context.layout.content.appendChild(context.element);}
context.element.position({x:context.x+xDelta,y:context.y+yDelta});};var component_ondragend=function component_ondragend(draggable,context){if(!context.layout.content.has(context.element)){context.element.remove();context.layout.content.appendChild(context.element);}
context.element.removeClassName("cloned dragging");context.element.dispatchEvent('change',context.element.toJSON());context.layout.slideIn(1);};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ComponentDraggable=function ComponentDraggable(wiringComponent,options){options=utils.updateObject(ns.ComponentDraggable.JSON_TEMPLATE,options);this.title_tooltip=new se.Tooltip({content:wiringComponent.title,placement:["top","bottom","right","left"]});this.btnPrefs=new se.PopupButton({title:utils.gettext("Preferences"),class:"we-prefs-btn",iconClass:"fa fa-reorder"});this.btnPrefs.popup_menu.append(new ns.ComponentDraggablePrefs(this));this.btnRemove=new se.Button({title:utils.gettext("Remove"),class:"btn-remove",iconClass:"fa fa-times-circle"});this.btnRemove.addEventListener('click',btnremove_onclick.bind(this));se.Panel.call(this,{title:wiringComponent.title,events:events,class:"component-draggable component-"+wiringComponent.meta.type,buttons:[this.btnPrefs,this.btnRemove]});this._component=wiringComponent;this.endpoints={source:new ns.EndpointGroup('source',this,ns.SourceEndpoint),target:new ns.EndpointGroup('target',this,ns.TargetEndpoint)};this.body.appendChild(this.endpoints.target).appendChild(this.endpoints.source);var removeAllowed=true;Object.defineProperties(this,{id:{value:wiringComponent.id},background:{get:function get(){return this.hasClassName('background');},set:function set(value){this._onbackground(value);}},collapsed:{get:function get(){return this.hasClassName('collapsed');},set:function set(value){this._oncollapsed(value);}},missing:{get:function get(){return this._component.missing;}},readonly:{get:function get(){return this.hasClassName('readonly');},set:function set(value){this.toggleClassName('readonly',value);}},removeAllowed:{get:function get(){return removeAllowed;},set:function set(value){removeAllowed=!!value;if(!this.background){updateFlagRemoveAllowed.call(this);}}},removeCascadeAllowed:{value:options.removecascade_allowed,writable:true},orderingEndpoints:{get:function get(){return this.endpoints.source.orderable||this.endpoints.target.orderable;}},sources:{get:function get(){return this.endpoints.source.endpoints;}},sourceList:{get:function get(){return this.endpoints.source.children;}},targets:{get:function get(){return this.endpoints.target.endpoints;}},targetList:{get:function get(){return this.endpoints.target.children;}},type:{value:wiringComponent.meta.type}});this.get().setAttribute('data-id',this.id);this.title_tooltip=new se.Tooltip({content:wiringComponent.title,placement:["top","bottom","right","left"]});this.heading.noticeTitle=document.createElement('span');this.heading.noticeTitle.className="label label-danger";this.heading.noticeTitle.addEventListener('mousedown',utils.stopPropagationListener,true);this.heading.noticeTitle.addEventListener('click',noticetitle_onclick.bind(this));this.heading.notice=document.createElement('div');this.heading.notice.className="component-notice";this.heading.notice.appendChild(this.heading.noticeTitle);this._endpoint_onconnectionadded_bound=endpoint_onconnectionadded.bind(this);this._endpoint_onconnectionremoved_bound=endpoint_onconnectionremoved.bind(this);appendEndpoints.call(this,'source',wiringComponent.meta.outputList.map(function(data){return wiringComponent.outputs[data.name];}));appendEndpoints.call(this,'target',wiringComponent.meta.inputList.map(function(data){return wiringComponent.inputs[data.name];}));var name,endpoint;for(name in wiringComponent.outputs){endpoint=wiringComponent.outputs[name];if(endpoint.missing){this.appendEndpoint('source',endpoint);}}
for(name in wiringComponent.inputs){endpoint=wiringComponent.inputs[name];if(endpoint.missing){this.appendEndpoint('target',endpoint);}}
wiringComponent.logManager.addEventListener('newentry',notifyErrors.bind(this));if(!this.missing){this.endpoints.source.orderEndpoints(options.endpoints.source);this.endpoints.target.orderEndpoints(options.endpoints.target);}
if(options.collapsed){this.collapsed=true;}
this.position(options.position);this._on_change_model=on_change_model.bind(this);notifyErrors.call(this);makeDraggable.call(this);this.wrapperElement.addEventListener('dblclick',utils.stopPropagationListener);wiringComponent.addEventListener('change',this._on_change_model);};ns.ComponentDraggable.JSON_TEMPLATE={name:"",position:{x:0,y:0},collapsed:false,endpoints:{source:[],target:[]},removecascade_allowed:false};ns.ComponentDraggable.MINOFFSET_X=20;ns.ComponentDraggable.MINOFFSET_Y=10;utils.inherit(ns.ComponentDraggable,se.Panel,{_onactive:function _onactive(active){if(this.orderingEndpoints){return this;}
return this.forEachEndpoint(function(endpoint){endpoint.forEachConnection(function(connection){connection.highlighted=active;});});},_onbackground:function _onbackground(background){this.toggleClassName('background',background);return background?this._showButtonAdd():updateFlagRemoveAllowed.call(this);},_onclick:function _onclick(event){if(this.orderingEndpoints){return this;}
return se.Panel.prototype._onclick.call(this,event);},_oncollapsed:function _oncollapsed(collapsed){var offsetWidth=this.get().offsetWidth;if(this.collapsed===collapsed){return this;}
this.toggleClassName('collapsed',collapsed);if(collapsed){collapseEndpoints.call(this,offsetWidth);}else{expandEndpoints.call(this,offsetWidth);}
this.refresh().dispatchEvent('change',{collapsed:collapsed,position:this.position()});return this;},_showButtonAdd:function _showButtonAdd(){this.btnRemove.replaceClassName('btn-remove','btn-add').removeIconClassName(['fa-trash','fa-times-circle']).addIconClassName('fa-plus-circle').setTitle(utils.gettext("Add"));return this;},_showButtonDelete:function _showButtonDelete(){this.btnRemove.replaceClassName('btn-add','btn-remove').removeIconClassName(['fa-plus-circle','fa-trash']).addIconClassName('fa-times-circle').setTitle(utils.gettext("Remove"));return this;},_showButtonRemove:function _showButtonRemove(){this.btnRemove.replaceClassName('btn-add','btn-remove').removeIconClassName(['fa-plus-circle','fa-times-circle']).addIconClassName('fa-trash').setTitle(utils.gettext("Remove"));return this;},appendEndpoint:function appendEndpoint(type,wiringEndpoint){var endpoint=this.endpoints[type].appendEndpoint(wiringEndpoint);endpoint.addEventListener('connectionadded',endpoint_onconnectionadded.bind(this));endpoint.addEventListener('connectionremoved',endpoint_onconnectionremoved.bind(this));this.dispatchEvent('endpointadded',endpoint);return this;},equals:function equals(component){if(!(component instanceof ns.ComponentDraggable)){return false;}
return this.type===component.type&&this.id===component.id;},getEndpoint:function getEndpoint(type,name){return this.endpoints[type].getEndpoint(name);},forEachConnection:function forEachConnection(callback){return this.forEachEndpoint(function(endpoint){endpoint.forEachConnection(function(connection){callback(connection);});});},forEachEndpoint:function forEachEndpoint(callback){this.targetList.forEach(function(endpoint,index){callback(endpoint,index);});this.sourceList.forEach(function(endpoint,index){callback(endpoint,index);});return this;},hasConnections:function hasConnections(){var found=false;found=this.targetList.some(function(endpoint){return endpoint.hasConnections();});if(found){return true;}
found=this.sourceList.some(function(endpoint){return endpoint.hasConnections();});return found;},hasEndpoints:function hasEndpoints(){return this.sourceList.length||this.targetList.length;},hasSettings:function hasSettings(){return this._component.meta.preferenceList.length>0;},hasOrderableEndpoints:function hasOrderableEndpoints(){return this.endpoints.source.canBeOrdered()||this.endpoints.target.canBeOrdered();},isRemovable:function isRemovable(){return!this.readonly&&!this.background;},setTitle:function setTitle(title){var span;span=document.createElement('span');span.textContent=title;this.title_tooltip.options.content=title;this.title_tooltip.bind(span);return se.Panel.prototype.setTitle.call(this,span);},showLogs:function showLogs(){this._component.showLogs();return this;},showSettings:function showSettings(){this._component.showSettings();return this;},startOrderingEndpoints:function startOrderingEndpoints(){if(this.orderingEndpoints||!this.hasOrderableEndpoints()){return this;}
this.btnRemove.disable();this.wasActive=this.active;this.draggable.destroy();this.endpoints.target.startOrdering();this.endpoints.source.startOrdering();this.active=true;return this.dispatchEvent('orderstart');},stopOrderingEndpoints:function stopOrderingEndpoints(){if(!this.orderingEndpoints){return this;}
this.btnRemove.enable();this.active=this.wasActive;delete this.wasActive;this.endpoints.target.stopOrdering();this.endpoints.source.stopOrdering();makeDraggable.call(this);this.dispatchEvent('change',{endpoints:{source:this.endpoints.source.toJSON(),target:this.endpoints.target.toJSON()}});return this.dispatchEvent('orderend');},position:function position(offset){if(offset!=null&&(offset.x!==null||offset.y!=null)){if(offset.x!=null){if(offset.x<ns.ComponentDraggable.MINOFFSET_X){offset.x=ns.ComponentDraggable.MINOFFSET_X;}
this.style('left',Math.round(offset.x)+'px');}
if(offset.y!=null){if(offset.y<ns.ComponentDraggable.MINOFFSET_Y){offset.y=ns.ComponentDraggable.MINOFFSET_Y;}
this.style('top',Math.round(offset.y)+'px');}
return this.refresh();}
return{x:this.get().offsetLeft,y:this.get().offsetTop};},refresh:function refresh(){notifyErrors.call(this);return this.forEachEndpoint(function(endpoint){endpoint.refresh();});},remove:function remove(childElement){if(!arguments.length&&!this.hasClassName('cloned')){this._component.removeEventListener('change',this._on_change_model);this.dispatchEvent('remove');}
return se.Panel.prototype.remove.call(this,childElement);},setUp:function setUp(){this.stopOrderingEndpoints();this.active=false;return this;},toFirst:function toFirst(){this.parentElement.appendChild(this);return this;},toJSON:function toJSON(){return{name:this._component.meta.uri,collapsed:this.collapsed,position:this.position(),endpoints:{source:this.endpoints.source.toJSON(),target:this.endpoints.target.toJSON()}};}});var events=['change','dragstart','drag','dragend','endpointadded','endpointremoved','optremove','optremovecascade','optshare','remove','orderstart','orderend'];var updateFlagRemoveAllowed=function updateFlagRemoveAllowed(){return this.removeAllowed?this._showButtonRemove():this._showButtonDelete();};var appendEndpoints=function appendEndpoints(type,endpoints){endpoints.forEach(function(endpoint){this.appendEndpoint(type,endpoint);if(this._missingEndpoints!=null&&endpoint.name in this._missingEndpoints[type]){this._missingEndpoints[type][endpoint.name].forEachConnection(function(connection){this.endpoints[type].endpoints[endpoint.name].appendConnection(connection,true);}.bind(this));delete this._missingEndpoints[type][endpoint.name];}},this);return this;};var btnremove_onclick=function btnremove_onclick(){if(this.background){this.dispatchEvent('optshare');}else{this.dispatchEvent('optremove');}};var collapseEndpoints=function collapseEndpoints(expandedWidth){var offsetWidth;this.body.removeChild(this.endpoints.target).removeChild(this.endpoints.source);this.heading.appendChild(this.endpoints.target).appendChild(this.endpoints.source);offsetWidth=expandedWidth-this.get().offsetWidth;if(offsetWidth>0){this.style('left',Math.round(this.get().offsetLeft+(offsetWidth/2))+'px');}
return this;};var endpoint_onconnectionadded=function endpoint_onconnectionadded(endpoint,connection){if(connection.readonly){this.btnRemove.disable();this.readonly=true;}};var endpoint_onconnectionremoved=function endpoint_onconnectionremoved(endpoint,connection){if(endpoint.missing&&!endpoint.hasConnections()){this.endpoints[endpoint.type].removeChild(endpoint);this.dispatchEvent('endpointremoved',endpoint);this.refresh();}};var expandEndpoints=function expandEndpoints(collapsedWidth){var offsetWidth;this.heading.removeChild(this.endpoints.target).removeChild(this.endpoints.source);this.body.appendChild(this.endpoints.target).appendChild(this.endpoints.source);offsetWidth=this.get().offsetWidth-collapsedWidth;if(offsetWidth>0){this.style('left',Math.round(this.get().offsetLeft-(offsetWidth/2))+'px');}
return this;};var isClick=function isClick(position1,position2){return(position1.x===position2.x)&&(position1.y===position2.y);};var makeDraggable=function makeDraggable(){this.draggable=new Wirecloud.ui.Draggable(this.get(),{component:this},function dragstart(draggable,context,event){context.active=context.component.active;context.component.btnPrefs.getPopupMenu().hide();context.position=context.component.addClassName('dragging').position();if(!context.active){context.component.active=true;}
context.component.dispatchEvent('dragstart',event);},function drag(event,draggable,context,x,y){context.component.position({x:context.position.x+x,y:context.position.y+y}).dispatchEvent('drag',x,y,event);},function dragend(draggable,context,event){var position=context.component.removeClassName('dragging').position();setTimeout(context.component.toFirst.bind(context.component),0);if(isClick(context.position,position)){context.component.active=!context.active;}else{if(!context.active){context.component.active=false;}
context.component.dispatchEvent('change',{position:position}).dispatchEvent('dragend',event);}},function canDrag(){return true;});return this;};var noticetitle_onclick=function noticetitle_onclick(event){event.preventDefault();this.showLogs();event.stopPropagation();};var notifyErrors=function notifyErrors(){var title,label,count;count=this._component.logManager.errorCount;this.toggleClassName('missing',this.missing);if(this.heading.has(this.heading.notice)){this.heading.removeChild(this.heading.notice);}
if(count||this.missing){if(this.missing){title=utils.gettext("Missing");}else{label=utils.ngettext("%(count)s error","%(count)s errors",count);title=utils.interpolate(label,{count:count});}
this.heading.noticeTitle.textContent=title;this.heading.appendChild(this.heading.notice);}};var cleanEndpoints=function cleanEndpoints(){var id;for(id in this.targets){cleanEndpoint.call(this,this.targets[id]);}
for(id in this.sources){cleanEndpoint.call(this,this.sources[id]);}};var cleanEndpoint=function cleanEndpoint(endpoint){if(endpoint.hasConnections()){this._missingEndpoints[endpoint.type][endpoint.name]=endpoint;}
endpoint.removeEventListener('connectionadded',this._endpoint_onconnectionadded_bound);endpoint.removeEventListener('connectionremoved',this._endpoint_onconnectionremoved_bound);this.endpoints[endpoint.type].removeChild(endpoint);this.dispatchEvent('endpointremoved',endpoint);};var on_change_model=function on_change_model(model,changes){if(changes.indexOf('title')!==-1){this.setTitle(model.title).refresh();}
if(changes.indexOf('meta')!==-1){this.setTitle(model.title);this._missingEndpoints={source:{},target:{}};cleanEndpoints.call(this);appendEndpoints.call(this,'source',model.meta.outputList.map(function(data){return model.outputs[data.name];}));appendEndpoints.call(this,'target',model.meta.inputList.map(function(data){return model.inputs[data.name];}));appendMissingEndpoints.call(this,model,'source','outputs');appendMissingEndpoints.call(this,model,'target','inputs');delete this._missingEndpoints;this.refresh();}};var appendMissingConnection=function appendMissingConnection(type,name,connection){this.endpoints[type].endpoints[name].appendConnection(connection,true);};var appendMissingEndpoints=function appendMissingEndpoints(componentUpdated,type,namespace){var name;for(name in componentUpdated[namespace]){if(name in this._missingEndpoints[type]){this.appendEndpoint(type,componentUpdated[namespace][name]);this._missingEndpoints[type][name].forEachConnection(appendMissingConnection.bind(this,type,name));}}};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ComponentDraggablePrefs=function ComponentDraggablePrefs(component){this.component=component;};utils.inherit(ns.ComponentDraggablePrefs,se.DynamicMenuItems,{_createMenuItem:function _createMenuItem(title,iconClass,onclick,isEnabled){var item;item=new se.MenuItem(title,onclick);item.addIconClass('fa fa-'+iconClass);if(isEnabled!=null){item.enabled=isEnabled.call(this.component);}
return item;},build:function build(){var item1=getItemCollapse.call(this.component),item2=getItemOrderEndpoints.call(this.component);var list=[this._createMenuItem(utils.gettext("Rename"),"pencil",function(){showRenameModal.call(this);}.bind(this),canRename),this._createMenuItem(item1.title,item1.icon,function(){this.collapsed=!this.collapsed;}.bind(this.component),canCollapseEndpoints),this._createMenuItem(item2.title,item2.icon,function(){if(this.orderingEndpoints){this.stopOrderingEndpoints();}else{this.startOrderingEndpoints();}}.bind(this.component),canOrderEndpoints),this._createMenuItem(utils.gettext("Upgrade/Downgrade"),"retweet",function(){var dialog=new Wirecloud.ui.UpgradeWindowMenu(this._component);dialog.show();}.bind(this.component),canUpgrade),this._createMenuItem(utils.gettext("Logs"),"tags",function(){this.showLogs();}.bind(this.component)),this._createMenuItem(utils.gettext("Settings"),"gear",function(){this.showSettings();}.bind(this.component),canShowSettings)];if(this.component.removeCascadeAllowed){list=list.concat(this._createMenuItem(utils.gettext("Delete cascade"),"trash",function(){this.dispatchEvent("optremovecascade");}.bind(this.component),canDeleteCascade));}
return list;}});var canRename=function canRename(){return this.type=='widget'&&this._component.isAllowed('rename');};var canUpgrade=function canUpgrade(){return!this.background&&this._component.isAllowed('upgrade')&&Wirecloud.LocalCatalogue.hasAlternativeVersion(this._component.meta);};var canCollapseEndpoints=function canCollapseEndpoints(){return this.hasEndpoints()&&!this.background&&!this.orderingEndpoints;};var canDeleteCascade=function canDeleteCascade(){return this.isRemovable();};var canOrderEndpoints=function canOrderEndpoints(){return this.hasOrderableEndpoints()&&!this.background&&!this.missing&&!this.collapsed;};var canShowSettings=function canShowSettings(){return this.hasSettings()&&this._component.isAllowed('configure');};var getItemCollapse=function getItemCollapse(){if(this.collapsed){return{title:utils.gettext("Expand"),icon:"caret-square-o-down"};}else{return{title:utils.gettext("Collapse"),icon:"caret-square-o-up"};}};var getItemOrderEndpoints=function getItemOrderEndpoints(){if(this.orderingEndpoints){return{title:utils.gettext("Stop ordering"),icon:"sort"};}else{return{title:utils.gettext("Order endpoints"),icon:"sort"};}};var showRenameModal=function showRenameModal(){var dialog=new Wirecloud.ui.FormWindowMenu([{name:'title',label:utils.gettext("Title"),type:'text',placeholder:this.component.title},],utils.interpolate(utils.gettext("Rename %(type)s"),this.component),"wc-component-rename-modal");dialog.executeOperation=function(data){if(data.title){this.component._component.rename(data.title);}}.bind(this);dialog.show();dialog.setValue({title:this.component.title});};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.Connection=function Connection(){se.StyledElement.call(this,events);this.wrapperElement=document.createElementNS(ns.Connection.SVG_NS,'g');this.wrapperElement.setAttribute('class',"connection");this.wrapperElement.addEventListener('click',connection_onclick.bind(this));this.wrapperElement.addEventListener('dblclick',utils.stopPropagationListener,true);this.wrapperElement.addEventListener('mouseenter',connection_onmouseenter.bind(this));this.wrapperElement.addEventListener('mouseleave',connection_onmouseleave.bind(this));this.pathElement=document.createElementNS(ns.Connection.SVG_NS,'path');this.pathElement.setAttribute('class',"connection-path");this.wrapperElement.appendChild(this.pathElement);this.options=new se.Container({class:"connection-options btn-group btn-group-circle btn-group-xs"});this.options.hide();this.btnLogs=new se.Button({title:utils.gettext("Logs"),state:'default',depth:1,class:"btn-show-logs",iconClass:"fa fa-bell"});this.btnLogs.addEventListener('click',btnerrors_onclick.bind(this));this.btnLogs.appendTo(this.options);this.btnRemove=new se.Button({title:utils.gettext("Remove"),state:'danger',depth:1,class:"btn-remove",iconClass:"fa fa-remove"});this.btnRemove.addEventListener('click',btnremove_onclick.bind(this));this.btnRemove.appendTo(this.options);this.btnPrefs=new se.PopupButton({title:utils.gettext("Preferences"),state:'default',depth:1,class:"we-prefs-btn",iconClass:"fa fa-reorder"});this.btnPrefs.popup_menu.append(new ns.ConnectionPrefs(this));this.btnPrefs.appendTo(this.options);this.activeCount=0;this.source={};this.target={};var removeAllowed=true;var active;var highlightedCount;Object.defineProperties(this,{active:{get:function get(){return prop_active_get.call(this,active);},set:function set(isActive){active=prop_active_set.call(this,active,!!isActive);refreshInternally.call(this);}},background:{get:function get(){return this.hasClassName('background');},set:function set(value){this._onbackground(value);}},created:{get:function get(){return this.source.endpoint!=null&&this.target.endpoint!=null;}},established:{get:function get(){return this.created&&this._connection!=null;}},editable:{get:function get(){return this.hasClassName('editable');},set:function set(value){this._oneditable(value);}},highlighted:{get:function get(){return prop_highlighted_get.call(this,highlightedCount);},set:function set(isHighlighted){highlightedCount=prop_highlighted_set.call(this,highlightedCount,!!isHighlighted);}},missing:{get:function get(){return this.created&&(this.source.endpoint.missing||this.target.endpoint.missing);}},removeAllowed:{get:function get(){return removeAllowed;},set:function set(value){removeAllowed=!!value;if(!this.background){updateFlagRemoveAllowed.call(this);}}},sourceComponent:{get:function get(){return this.source.endpoint.component;}},sourceId:{get:function get(){return this.source.endpoint.id;}},targetComponent:{get:function get(){return this.target.endpoint.component;}},targetId:{get:function get(){return this.target.endpoint.id;}}});this.highlighted=false;this.active=false;isCreated.call(this);};ns.Connection.SVG_NS="http://www.w3.org/2000/svg";ns.Connection.JSON_TEMPLATE={sourcename:"",sourcehandle:null,targetname:"",targethandle:null};utils.inherit(ns.Connection,se.StyledElement,{_onbackground:function _onbackground(background){var newDepth=this.active||!background?1:0;this.toggleClassName('background',background);this.btnLogs.depth=newDepth;this.btnPrefs.depth=newDepth;this.btnRemove.depth=newDepth;return background?this._showButtonAdd():updateFlagRemoveAllowed.call(this);},_oneditable:function _oneditable(editable){if(this.editable===editable){return this;}
this.toggleClassName('editable',editable);toggleActiveEndpoints.call(this,editable);if(editable){this.source.handle.appendTo(this.wrapperElement);this.target.handle.appendTo(this.wrapperElement);this.dispatchEvent('customizestart');}else{this.source.handle.remove();this.target.handle.remove();this.dispatchEvent('customizeend');}
return this;},_showButtonAdd:function _showButtonAdd(){this.btnRemove.replaceClassName("btn-remove","btn-add").removeIconClassName(['fa-trash','fa-remove']).addIconClassName('fa-plus').setTitle(utils.gettext("Add"));this.btnRemove.state='info';return this;},_showButtonDelete:function _showButtonDelete(){this.btnRemove.replaceClassName('btn-add','btn-remove').removeIconClassName(['fa-plus','fa-trash']).addIconClassName('fa-remove').setTitle(utils.gettext("Remove"));this.btnRemove.state='danger';return this;},_showButtonRemove:function _showButtonRemove(){this.btnRemove.replaceClassName('btn-add','btn-remove').removeIconClassName(['fa-plus','fa-remove']).addIconClassName('fa-trash').setTitle(utils.gettext("Remove"));this.btnRemove.state='danger';return this;},click:function click(){if(this.enabled&&!this.editable){this.active=!this.active;this.dispatchEvent('click');}
return this;},createAndBind:function createAndBind(readonly,wiringEngine){var source=this.source.endpoint._endpoint,target=this.target.endpoint._endpoint;if(this.established){return this;}
establishConnection.call(this,wiringEngine.createConnection(source,target,{readonly:readonly}));this.refresh();return this;},equals:function equals(connection){if(!(connection instanceof ns.Connection)){return false;}
return this.sourceId===connection.sourceId&&this.targetId===connection.targetId;},hasEndpoint:function hasEndpoint(endpoint){return this[endpoint.type].endpoint.equals(endpoint);},refresh:function refresh(){var sourcePosition,sourceHandle,targetPosition,targetHandle;if(!this.created){return this;}
this.toggleClassName('missing',this.missing);sourcePosition=this.source.endpoint.anchorPosition;targetPosition=this.target.endpoint.anchorPosition;sourceHandle=this.source.handle.updateDistance(targetPosition).position();targetHandle=this.target.handle.updateDistance(sourcePosition,true).position();updateDistance.call(this,sourcePosition,sourceHandle,targetPosition,targetHandle);return this;},refreshEndpoint:function refreshEndpoint(endpoint){if(this.established){this[endpoint.type].endpoint=endpoint;this[endpoint.type].handle.endpoint=endpoint;}
return this;},remove:function remove(childElement){if(childElement==null){if(this.established){this.source.endpoint.removeConnection(this);this.target.endpoint.removeConnection(this);}
this.dispatchEvent('remove');}
return se.StyledElement.prototype.remove.call(this,childElement);},restoreDefaults:function restoreDefaults(){if(this.readonly||this.background){return this;}
if(this.established){this.source.handle.auto=true;this.target.handle.auto=true;this.refresh().dispatchEvent('change',this.toJSON());}
return this;},stickEndpoint:function stickEndpoint(endpoint,options){if(this.established){return this;}
options=utils.merge({establish:true,wiringConnection:null},options);appendEndpoint.call(this,endpoint,options);if(this.created){if(options.establish){establishConnection.call(this,options.wiringConnection);}
this.refresh();}
isCreated.call(this);return this;},showLogs:function showLogs(){var count=this._connection.logManager.errorCount;this.btnLogs.setBadge(count?count:null,'danger');this._connection.showLogs();return this;},toFirst:function toFirst(){var parentElement;if(this.parentElement!=null){this.parentElement.removeChild(this).appendChild(this);}else{parentElement=this.get().parentElement;if(parentElement!=null){parentElement.removeChild(this.get());parentElement.appendChild(this.get());}}
return this;},toggleActive:function toggleActive(active){return active?this.activate():this.deactivate();},toJSON:function toJSON(){return{sourcename:this.sourceId,sourcehandle:this.source.handle.toJSON(),targetname:this.targetId,targethandle:this.target.handle.toJSON()};},unstickEndpoint:function unstickEndpoint(endpoint){if(this.established){return this;}
removeEndpoint.call(this,endpoint);isCreated.call(this);return this;},updateCursorPosition:function updateCursorPosition(position){var source,sourceHandle,target,targetHandle;if(this.created){return this;}
if(this.source.endpoint!=null){source=this.source.endpoint.anchorPosition;target=position;sourceHandle=this.source.handle.updateDistance(target).position();targetHandle=getHandlePosition(target,source,true);}else{source=position;target=this.target.endpoint.anchorPosition;sourceHandle=getHandlePosition(source,target);targetHandle=this.target.handle.updateDistance(source,true).position();}
updateDistance.call(this,source,sourceHandle,target,targetHandle);return this;}});var events=['change','click','customizestart','customizeend','optremove','optshare','remove'];var prop_active_get=function prop_active_get(active){return!!active;};var prop_active_set=function prop_active_set(active,isActive){if(this.enabled){active=isActive;this.toggleClassName('active',active);}
if(active){showButtonGroup.call(this);}else{hideButtonGroup.call(this);}
toggleActiveEndpoints.call(this,active);return active;};var prop_highlighted_get=function prop_highlighted_get(highlightedCount){return!!highlightedCount;};var prop_highlighted_set=function prop_highlighted_set(highlightedCount,isHighlighted){if(highlightedCount==null){highlightedCount=0;}
highlightedCount=highlightedCount+(isHighlighted?1:-1);if(highlightedCount<0){highlightedCount=0;}
this.toggleClassName('highlighted',!!highlightedCount);return highlightedCount;};var refreshInternally=function refreshInternally(){var newDepth=this.active||this.highlighted||!this.background?1:0;this.btnLogs.depth=newDepth;this.btnPrefs.depth=newDepth;this.btnRemove.depth=newDepth;};var updateFlagRemoveAllowed=function updateFlagRemoveAllowed(){return this.removeAllowed?this._showButtonRemove():this._showButtonDelete();};var showButtonGroup=function showButtonGroup(){this.btnPrefs.show();this.btnLogs.show();};var hideButtonGroup=function hideButtonGroup(){this.btnPrefs.hide();if(!this.hasClassName('has-error')&&!this.missing){this.btnLogs.hide();}};var appendEndpoint=function appendEndpoint(endpoint,options){this[endpoint.type]={endpoint:endpoint,handle:new ns.ConnectionHandle(endpoint,options)};return this;};var bindWiringConnection=function bindWiringConnection(wiringConnection){Object.defineProperties(this,{logManager:{value:wiringConnection.logManager},readonly:{value:wiringConnection.readonly}});this._connection=wiringConnection;this._connection.logManager.addEventListener('newentry',notifyErrors.bind(this));this.options.show();notifyErrors.call(this);if(this.readonly){this.addClassName("readonly");this.btnRemove.disable();}
return this;};var notifyErrors=function notifyErrors(){var count=this._connection.logManager.errorCount;this.toggleClassName('has-error',!!count);this.btnLogs.setBadge(count?count:null,'danger',true);if(count){this.btnLogs.show();}else{this.btnLogs.hide();}};var btnerrors_onclick=function btnerrors_onclick(){this.showLogs();};var btnremove_onclick=function btnremove_onclick(event){if(this.background){this.dispatchEvent('optshare',event);}else{if(!this.readonly){this.dispatchEvent('optremove',event);}}};var b1=function b1(t){return t*t*t;};var b2=function b2(t){return 3*t*t*(1-t);};var b3=function b3(t){return 3*t*(1-t)*(1-t);};var b4=function b4(t){return(1-t)*(1-t)*(1-t);};var bezier=function bezier(percent,c1,c2,c3,c4){var x=c1.x*b1(percent)+c2.x*b2(percent)+c3.x*b3(percent)+c4.x*b4(percent);var y=c1.y*b1(percent)+c2.y*b2(percent)+c3.y*b3(percent)+c4.y*b4(percent);return{x:Math.round(x),y:Math.round(y)};};var calculateMiddle=function calculateMiddle(source,sourceHandle,target,targetHandle){return bezier(0.5,source,sourceHandle,targetHandle,target);};var connection_onclick=function connection_onclick(event){event.preventDefault();event.stopPropagation();if(event.button===0){this.click();}};var establishConnection=function establishConnection(wiringConnection){if(wiringConnection==null){return this;}
this.source.handle.addEventListener('drag',handle_ondrag.bind(this));this.source.handle.addEventListener('dragend',handle_ondragend.bind(this));this.target.handle.addEventListener('drag',handle_ondrag.bind(this));this.target.handle.addEventListener('dragend',handle_ondragend.bind(this));bindWiringConnection.call(this,wiringConnection);this.source.endpoint.appendConnection(this);this.target.endpoint.appendConnection(this);this.get().setAttribute('data-sourceid',this.sourceId);this.get().setAttribute('data-targetid',this.targetId);this.options.get().setAttribute('data-sourceid',this.sourceId);this.options.get().setAttribute('data-targetid',this.targetId);return this;};var handle_ondrag=function handle_ondrag(position,handle){return this.refresh();};var handle_ondragend=function handle_ondragend(){return this.dispatchEvent('change',this.toJSON());};var formatDistance=function formatDistance(s,sHandle,t,tHandle){return"M "+s.x+","+s.y+" C "+sHandle.x+","+sHandle.y+" "+tHandle.x+","+tHandle.y+" "+t.x+","+t.y;};var getHandlePosition=function getHandlePosition(start,end,invert){var position=ns.ConnectionHandle.getRelativePosition(start,end,invert);return{x:start.x+position.x,y:start.y+position.y};};var removeEndpoint=function removeEndpoint(endpoint){this[endpoint.type]={};return this;};var isCreated=function isCreated(){this.toggleClassName('incomplete',!this.created);};var toggleActiveEndpoints=function toggleActiveEndpoints(active){if(this.source.endpoint!=null){this.source.endpoint.toggleActive(active);}
if(this.target.endpoint!=null){this.target.endpoint.toggleActive(active);}
return this;};var updateDistance=function updateDistance(source,sourceHandle,target,targetHandle){this.pathElement.setAttribute('d',formatDistance(source,sourceHandle,target,targetHandle));if(this.established){var middlePosition=calculateMiddle(source,sourceHandle,target,targetHandle);this.options.style({top:middlePosition.y+'px',left:middlePosition.x+'px'});}
return this;};var connection_onmouseenter=function connection_onmouseenter(){if(this.established&&!this.editable){this.highlighted=true;toggleActiveEndpoints.call(this,true);}};var connection_onmouseleave=function connection_onmouseleave(){if(this.established&&!this.editable){this.highlighted=false;toggleActiveEndpoints.call(this,false);}};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ConnectionPrefs=function ConnectionPrefs(connection){this.connection=connection;};utils.inherit(ns.ConnectionPrefs,se.DynamicMenuItems,{_createMenuItem:function _createMenuItem(title,iconClass,onclick,isEnabled){var item;item=new se.MenuItem(title,onclick);item.addIconClass('fa fa-'+iconClass);if(isEnabled!=null){item.enabled=isEnabled.call(this.connection);}
return item;},build:function build(){return[this._createMenuItem(getCustomizeTitle.call(this.connection),"magic",function(){this.editable=!this.editable;}.bind(this.connection),canCustomize),this._createMenuItem(utils.gettext("Restore defaults"),"undo",function(){this.restoreDefaults();}.bind(this.connection),canRestore)];}});var canCustomize=function canCustomize(){return!this.readonly&&!this.background;};var canRestore=function canRestore(){return!this.readonly&&!this.background;};var getCustomizeTitle=function getCustomizeTitle(){return this.editable?utils.gettext("Stop customizing"):utils.gettext("Customize");};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ConnectionHandle=function ConnectionHandle(endpoint,options){options=utils.merge({},defaults,options);se.StyledElement.call(this,events.concat(options.events));this.wrapperElement=document.createElementNS(ns.ConnectionHandle.SVG_NS,'g');this.wrapperElement.setAttribute('class',"we-connection-handle");this.addClassName(endpoint.type+"-handle");this.addClassName(options.class);this.lineElement=document.createElementNS(ns.ConnectionHandle.SVG_NS,'path');this.lineElement.setAttribute('class',"we-connection-handle-line");this.wrapperElement.appendChild(this.lineElement);this.ballElement=document.createElementNS(ns.ConnectionHandle.SVG_NS,'circle');this.ballElement.setAttribute('class',"we-connection-handle-ball");this.ballElement.setAttribute('r',options.radius);this.ballElement.addEventListener('click',utils.stopPropagationListener);this.wrapperElement.appendChild(this.ballElement);Object.defineProperties(this,{auto:{get:function get(){return this.hasClassName("auto");},set:function set(value){this.toggleClassName("auto",value);}}});this.endpoint=endpoint;this.tooltip=new se.Tooltip({content:utils.gettext("Drag & Drop"),placement:['top']});this.tooltip.bind(this.ballElement);setRelativePosition.call(this,options.position);startDraggableElement.call(this);};ns.ConnectionHandle.getRelativePosition=function getRelativePosition(startPosition,endPosition,invert){var offsetX=Math.abs(startPosition.x-endPosition.x);if(offsetX>ns.ConnectionHandle.MAXOFFSET_X){offsetX=ns.ConnectionHandle.MAXOFFSET_X;}
if(offsetX<ns.ConnectionHandle.MINOFFSET_X){offsetX=ns.ConnectionHandle.MINOFFSET_X;}
if(invert){offsetX*=-1;}
return{x:offsetX,y:0};};ns.ConnectionHandle.MAXOFFSET_X=90;ns.ConnectionHandle.MINOFFSET_X=20;ns.ConnectionHandle.SVG_NS="http://www.w3.org/2000/svg";utils.inherit(ns.ConnectionHandle,se.StyledElement,{position:function position(relativePosition){var anchorPosition=this.endpoint.anchorPosition;if(relativePosition!=null){this.relativePosition=relativePosition;var offsetPosition={x:anchorPosition.x+this.relativePosition.x,y:anchorPosition.y+this.relativePosition.y};this.lineElement.setAttribute('d',formatDistance(anchorPosition,offsetPosition));this.ballElement.setAttribute('cx',offsetPosition.x);this.ballElement.setAttribute('cy',offsetPosition.y);return this;}
return{x:this.ballElement.getAttribute('cx'),y:this.ballElement.getAttribute('cy')};},toJSON:function toJSON(){return this.auto?"auto":this.relativePosition;},updateDistance:function updateDistance(endPosition,invert){var startPosition=this.endpoint.anchorPosition;if(this.auto){this.relativePosition=ns.ConnectionHandle.getRelativePosition(startPosition,endPosition,invert);}
var offsetPosition={x:startPosition.x+this.relativePosition.x,y:startPosition.y+this.relativePosition.y};this.lineElement.setAttribute('d',formatDistance(startPosition,offsetPosition));this.ballElement.setAttribute('cx',offsetPosition.x);this.ballElement.setAttribute('cy',offsetPosition.y);return this;}});var defaults={events:[],class:"",radius:"6px",position:null};var events=['dragstart','drag','dragend'];var formatDistance=function formatDistance(endpoint,handle){return"M "+endpoint.x+","+endpoint.y+" "+handle.x+","+handle.y;};var is2DPosition=function is2DPosition(position){return utils.isPlainObject(position)&&Number.isInteger(position.x)&&Number.isInteger(position.y);};var setRelativePosition=function setRelativePosition(position){if(is2DPosition(position)){this.relativePosition=position;this.auto=false;}else{this.auto=true;}
return this;};var startDraggableElement=function startDraggableElement(){this.draggable=new Wirecloud.ui.Draggable(this.ballElement,{handle:this},function ondragstart(draggable,context){context.initialPosition=context.handle.relativePosition;context.handle.auto=false;context.handle.dispatchEvent('dragstart');},function ondrag(event,draggable,context,offsetX,offsetY){var newPosition={x:context.initialPosition.x+offsetX,y:context.initialPosition.y+offsetY};context.handle.position(newPosition).dispatchEvent('drag',newPosition);},function ondragend(draggable,context){context.handle.dispatchEvent('dragend');},function canDrag(){return true;});return this;};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.ConnectionEngine=function ConnectionEngine(container,findWiringEngine){se.StyledElement.call(this,events);this.wrapperElement=document.createElementNS(ns.ConnectionEngine.SVG_NS,'svg');this.wrapperElement.setAttribute('class',"we-connections-layer");this.connections=[];this.connectionsElement=document.createElementNS(ns.ConnectionEngine.SVG_NS,'g');this.wrapperElement.appendChild(this.connectionsElement);this.optionsElement=document.createElement('div');this.endpoints={source:[],target:[]};this.container=container;this.container.appendChild(this.wrapperElement);this.container.appendChild(this.optionsElement);this.container.get().addEventListener('scroll',container_onscroll.bind(this));this._ondrag=connection_ondrag.bind(this);this._ondragend=connection_ondragend.bind(this);Object.defineProperties(this,{wiringEngine:{get:function get(){return findWiringEngine();}}});this.endpoint_ondragstart=endpoint_ondragstart.bind(this);this.endpoint_onmouseenter=endpoint_onmouseenter.bind(this);this.endpoint_onmouseleave=endpoint_onmouseleave.bind(this);this.endpoint_ondragend=endpoint_ondragend.bind(this);};ns.ConnectionEngine.CONNECTION_INVALID=-1;ns.ConnectionEngine.CONNECTION_ESTABLISHED=0;ns.ConnectionEngine.CONNECTION_DUPLICATE=1,ns.ConnectionEngine.SVG_NS="http://www.w3.org/2000/svg";utils.inherit(ns.ConnectionEngine,se.StyledElement,{appendEndpoint:function appendEndpoint(endpoint){this.endpoints[endpoint.type].push(endpoint);endpoint.addEventListener('mousedown',this.endpoint_ondragstart).addEventListener('mouseenter',this.endpoint_onmouseenter).addEventListener('mouseleave',this.endpoint_onmouseleave).addEventListener('mouseup',this.endpoint_ondragend);return this;},connect:function connect(wiringConnection,source,target,options){var connection;options=options||{};connection=new ns.Connection();connection.stickEndpoint(source,{position:options.sourceHandle}).stickEndpoint(target,{position:options.targetHandle,wiringConnection:wiringConnection}).appendTo(this.connectionsElement);appendConnection.call(this,connection);return this;},deactivateAll:function deactivateAll(){if(this.hasActiveConnection()){this.activeConnection.click();}
return this;},clear:function clear(){var i;this.setUp();for(i=this.connections.length-1;i>=0;i--){this.connections[i].remove();}
this.connections.length=0;return this;},forEachConnection:function forEachConnection(callback){this.connections.forEach(function(connection,index){callback(connection,index);});return this;},getConnection:function getConnection(sourceId,targetId){var i,connection;for(i=0;i<this.connections.length&&!connection;i++){if(this.connections[i].sourceId==sourceId&&this.connections[i].targetId==targetId){connection=this.connections[i];}}
return connection;},hasActiveConnection:function hasActiveConnection(){return this.activeConnection!=null;},removeEndpoint:function removeEndpoint(endpoint){var index=this.endpoints[endpoint.type].indexOf(endpoint);if(index!=-1){endpoint.removeEventListener('mousedown',this.endpoint_ondragstart).removeEventListener('mouseenter',this.endpoint_onmouseenter).removeEventListener('mouseleave',this.endpoint_onmouseleave).removeEventListener('mouseup',this.endpoint_ondragend);this.endpoints[endpoint.type].splice(index,1);}
return this;},setUp:function setUp(){stopCustomizing.call(this);this.deactivateAll();return this;}});var events=['click','cancel','dragstart','dragend','duplicate','establish'];var opposites={source:'target',target:'source'};var appendConnection=function appendConnection(connection,backupConnection){this.connections.push(connection);connection.options.appendTo(this.optionsElement);connection.addEventListener('click',connection_onclick.bind(this)).addEventListener('customizestart',connection_oncustomizestart.bind(this)).addEventListener('remove',connection_onremove.bind(this));return this.dispatchEvent('establish',connection,backupConnection);};var connection_onclick=function connection_onclick(connection){if(!connection.editable){if(!connection.equals(this.editableConnection)){stopCustomizing.call(this);}
if(connection.active){if(this.hasActiveConnection()&&!connection.equals(this.activeConnection)){this.activeConnection.click();}
this.activeConnection=connection;this.dispatchEvent('click',connection);}else{delete this.activeConnection;}}};var connection_onremove=function connection_onremove(connection){var index=this.connections.indexOf(connection);if(index!=-1){if(connection.equals(this.activeConnection)){this.deactivateAll();}
this.optionsElement.removeChild(connection.options.get());this.connections.splice(index,1);}};var stopCustomizing=function stopCustomizing(){if(this.editableConnection!=null){this.editableConnection.editable=false;delete this.editableConnection;}};var connection_oncustomizestart=function connection_oncustomizestart(connection){this.setUp();this.editableConnection=connection;};var endpoint_ondragstart=function endpoint_ondragstart(endpoint){var connection=new ns.Connection();var initialEndpoint;if(!this.enabled){return;}
if(endpoint.hasConnection(this.activeConnection)){if(this.activeConnection.background){this.activeConnection.click();initialEndpoint=endpoint;}else{this.activeConnection.addClassName('temporal');initialEndpoint=this.activeConnection[opposites[endpoint.type]].endpoint;this._connectionBackup=this.activeConnection;}}else{initialEndpoint=endpoint;}
this.setUp();disableEndpoints.call(this,initialEndpoint.type);this.wrapperElement.classList.add('dragging');connection.stickEndpoint(initialEndpoint).appendTo(this.connectionsElement);document.addEventListener('mousemove',this._ondrag);document.addEventListener('mouseup',this._ondragend);this.dispatchEvent('dragstart',connection,initialEndpoint,endpoint);this.temporalInitialEndpoint=initialEndpoint;this.temporalConnection=connection;};var connection_ondrag=function connection_ondrag(event){var parent=this.container.get(),parentBCR=parent.getBoundingClientRect();this.temporalConnection.updateCursorPosition({x:event.clientX+parent.scrollLeft-parentBCR.left,y:event.clientY+parent.scrollTop-parentBCR.top});};var connection_ondragend=function connection_ondragend(event){event.preventDefault();event.stopPropagation();endpoint_ondragend.call(this);};var endpoint_ondragend=function endpoint_ondragend(finalEndpoint){if(!this.enabled||!this.temporalConnection){return;}
this.wrapperElement.classList.remove('dragging');enableEndpoints.call(this,this.temporalInitialEndpoint.type);if(this._connectionBackup!=null){this._connectionBackup.removeClassName('temporal');}
switch(validateConnection(this.temporalInitialEndpoint,finalEndpoint)){case ns.ConnectionEngine.CONNECTION_ESTABLISHED:this.temporalConnection.stickEndpoint(finalEndpoint).createAndBind(false,this.wiringEngine);appendConnection.call(this,this.temporalConnection,this._connectionBackup);if(this._connectionBackup!=null){this.temporalConnection.click();}
break;case ns.ConnectionEngine.CONNECTION_DUPLICATE:this.temporalConnection.remove();this.dispatchEvent('duplicate',this.temporalInitialEndpoint.getConnectionTo(finalEndpoint).click(),this._connectionBackup);break;default:if(this._connectionBackup!=null){this._connectionBackup.click();}
this.temporalConnection.remove();this.dispatchEvent('cancel');}
document.removeEventListener('mousemove',this._ondrag);document.removeEventListener('mouseup',this._ondragend);this.dispatchEvent('dragend',this.temporalConnection,this.temporalInitialEndpoint);delete this.temporalInitialEndpoint;delete this._connectionBackup;delete this.temporalConnection;};var container_onscroll=function container_onscroll(event){var parent=this.container.get(),scrollX=parent.scrollLeft,scrollY=parent.scrollTop;this.connectionsElement.setAttribute('transform',"translate("+(-scrollX)+" "+(-scrollY)+")");this.wrapperElement.style.top=scrollY+'px';this.wrapperElement.style.left=scrollX+'px';};var disableEndpoints=function disableEndpoints(type){this.endpoints[type].forEach(function(endpoint){endpoint.disable();});return this;};var enableEndpoints=function enableEndpoints(type){this.endpoints[type].forEach(function(endpoint){endpoint.enable();});return this;};var endpoint_onmouseenter=function endpoint_onmouseenter(endpoint){if(this.temporalConnection!=null){endpoint.activate();this.temporalConnection.stickEndpoint(endpoint,{establish:false});document.removeEventListener('mousemove',this._ondrag);}};var endpoint_onmouseleave=function endpoint_onmouseleave(endpoint){if(this.temporalConnection!=null){endpoint.deactivate();this.temporalConnection.unstickEndpoint(endpoint);document.addEventListener('mousemove',this._ondrag);document.addEventListener('touchmove',this._ondrag);}};var validateConnection=function validateConnection(initialEndpoint,finalEndpoint){if(initialEndpoint==null||finalEndpoint==null){return ns.ConnectionEngine.CONNECTION_INVALID;}
if(initialEndpoint.type===finalEndpoint.type){return ns.ConnectionEngine.CONNECTION_INVALID;}
if(initialEndpoint.component.equals(finalEndpoint.component)){return ns.ConnectionEngine.CONNECTION_INVALID;}
if(initialEndpoint.hasConnectionTo(finalEndpoint)){return ns.ConnectionEngine.CONNECTION_DUPLICATE;}
return ns.ConnectionEngine.CONNECTION_ESTABLISHED;};})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(ns,se,utils){"use strict";ns.KeywordSuggestion=function KeywordSuggestion(){Wirecloud.wiring.KeywordSuggestion.call(this);this.enabled=true;};utils.inherit(ns.KeywordSuggestion,Wirecloud.wiring.KeywordSuggestion,{disable:function disable(){this.enabled=false;return this;},enable:function enable(){this.enabled=true;return this;},hideSuggestions:function hideSuggestions(endpoint){if(!this.enabled){return this;}
endpoint.deactivate();return this.forEachSuggestion(endpoint,function(foundEndpoint){foundEndpoint.deactivate();});},showSuggestions:function showSuggestions(endpoint){if(!this.enabled){return this;}
endpoint.activate();return this.forEachSuggestion(endpoint,function(foundEndpoint){foundEndpoint.activate();});}});})(Wirecloud.ui.WiringEditor,StyledElements,StyledElements.Utils);;(function(){"use strict";var Tutorial=function Tutorial(label,instructions){this.label=label;this.stepActive=null;this.steps=[];this.controlLayer=document.createElement("div");this.controlLayerUp=document.createElement("div");this.controlLayerDown=document.createElement("div");this.controlLayerLeft=document.createElement("div");this.controlLayerRight=document.createElement("div");this.controlLayerCenter=document.createElement("div");this.controlLayer.className="controlLayer";this.controlLayerUp.className="controlLayerUp";this.controlLayerDown.className="controlLayerDown";this.controlLayerLeft.className="controlLayerLeft";this.controlLayerRight.className="controlLayerRight";this.controlLayerCenter.className="controlLayerCenter";this.controlLayer.appendChild(this.controlLayerUp);this.controlLayer.appendChild(this.controlLayerDown);this.controlLayer.appendChild(this.controlLayerLeft);this.controlLayer.appendChild(this.controlLayerRight);this.controlLayer.appendChild(this.controlLayerCenter);this.instructions=instructions;};Tutorial.prototype.start=function start(){var i;var mapping={'simpleDescription':Wirecloud.ui.Tutorial.SimpleDescription,'userAction':Wirecloud.ui.Tutorial.UserAction,'formAction':Wirecloud.ui.Tutorial.FormAction,'autoAction':Wirecloud.ui.Tutorial.AutoAction};document.body.appendChild(this.controlLayer);this.resetControlLayer(true);this.msgLayer=document.createElement("div");this.msgLayer.classList.add("msgLayer");document.body.appendChild(this.msgLayer);for(i=0;i<this.instructions.length;i++){var Constructor=mapping[this.instructions[i].type];this.steps[i]=new Constructor(this,this.instructions[i]);if(i==(this.instructions.length-1)){this.steps[i].setLast();}else{this.steps[i].setNext();}}
this.stepActive=this.steps[0];this.steps[0].activate();};Tutorial.prototype.nextStep=function nextStep(){var current_step_index=this.steps.indexOf(this.stepActive);if(current_step_index<(this.steps.length-1)){this.stepActive.destroy();this.stepActive=this.steps[current_step_index+1];setTimeout(this.stepActive.activate.bind(this.stepActive),200);}else{this.destroy();}};Tutorial.prototype.resetControlLayer=function resetControlLayer(isTransparent){this.controlLayer.classList.remove("hidden");if(isTransparent===true){this.controlLayer.classList.add('transparent');}else if(isTransparent===false){this.controlLayer.classList.remove('transparent');}
this.controlLayerUp.style.height='50%';this.controlLayerUp.style.width='100%';this.controlLayerUp.style.top='0';this.controlLayerUp.style.left='0';this.controlLayerDown.style.height='50%';this.controlLayerDown.style.width='100%';this.controlLayerDown.style.top='50%';this.controlLayerDown.style.left='0';this.controlLayerRight.style.height='0';this.controlLayerRight.style.width='50%';this.controlLayerRight.style.top='50%';this.controlLayerRight.style.left='50%';this.controlLayerLeft.style.height='0';this.controlLayerLeft.style.width='50%';this.controlLayerLeft.style.top='50%';this.controlLayerLeft.style.left='0';this.controlLayerCenter.style.height='0';this.controlLayerCenter.style.width='0';this.controlLayerCenter.style.top='50%';this.controlLayerCenter.style.left='50%';};Tutorial.prototype.setControlLayer=function setControlLayer(element,disable_center){var pos;if(typeof element!=='object'){return;}
this.controlLayer.classList.remove("hidden");this.controlLayer.classList.remove('transparent');pos=element.getBoundingClientRect();this.controlLayerUp.style.height=pos.top+'px';this.controlLayerUp.style.width='100%';this.controlLayerDown.style.top=(pos.top+pos.height)+'px';this.controlLayerDown.style.width='100%';this.controlLayerDown.style.height='100%';this.controlLayerRight.style.left=(pos.left+pos.width)+'px';this.controlLayerRight.style.top=pos.top+'px';this.controlLayerRight.style.height=pos.height+'px';this.controlLayerRight.style.width='100%';this.controlLayerLeft.style.width=pos.left+'px';this.controlLayerLeft.style.height=pos.height+'px';this.controlLayerLeft.style.top=pos.top+'px';if(disable_center===true){this.controlLayerCenter.style.left=pos.left+'px';this.controlLayerCenter.style.top=pos.top+'px';this.controlLayerCenter.style.height=pos.height+'px';this.controlLayerCenter.style.width=pos.width+'px';this.controlLayerCenter.style.display='block';}else{this.controlLayerCenter.style.display='none';}};Tutorial.prototype.deactivateLayer=function deactivateLayer(){this.controlLayer.classList.add("hidden");};Tutorial.prototype.findElementByTextContent=function findElementByTextContent(nodes,text){var i;for(i=0;i<nodes.length;i++){if(nodes[i].textContent.toLowerCase()==text.toLowerCase()){return nodes[i];}}
return null;};Tutorial.prototype.destroy=function destroy(){var stepActivePos,i;stepActivePos=this.steps.indexOf(this.stepActive);for(i=stepActivePos;i<this.steps.length;i++){this.steps[i].destroy();}
document.body.removeChild(this.controlLayer);document.body.removeChild(this.msgLayer);this.msgLayer=null;this.steps=[];};Wirecloud.ui.Tutorial=Tutorial;})();;(function(){"use strict";var anchor_element=document.createElement('a');anchor_element.href=Wirecloud.URLs.LOCAL_REPOSITORY;var base_url=anchor_element.href;if(base_url[base_url.length-1]!=='/'){base_url+='/';}
base_url+='static/';var build_static_url=function build_static_url(path){return base_url+path;};var append_character=function append_character(element,character){element.value+=character;};var fill_input=function fill_input(element,new_value){element.value=new_value;};var findElementByTextContent=function findElementByTextContent(nodes,text){var i;for(i=0;i<nodes.length;i++){if(nodes[i].textContent.trim().toLowerCase()==text.toLowerCase()){return nodes[i];}}
return null;};var Utils={basic_actions:{sleep:function sleep(milliseconds){return function(autoAction,element){setTimeout(function(){autoAction.nextHandler();},milliseconds);};},click:function click(milliseconds){return function(autoAction,element){setTimeout(function(){element.click();autoAction.nextHandler();},milliseconds);};},create_workspace:function create_workspace(options){return function(autoAction,element){options=Wirecloud.Utils.merge({allow_renaming:true},options);Wirecloud.createWorkspace(options).then((workspace)=>{Wirecloud.changeActiveWorkspace(workspace).then(autoAction.nextHandler,autoAction.errorHandler);},autoAction.errorHandler);};},input:function input(text,options){options=Wirecloud.Utils.merge({timeout:4000,step:200,send:false,padding:1300},options);return function(autoAction,element){var timeout,i;if(['input','textarea'].indexOf(element.tagName)===-1){element=element.querySelector('input, textarea');}
element.value="";timeout=0;for(i=0;i<text.length&&((timeout+options.step)<options.timeout);i++){timeout+=options.step;setTimeout(append_character.bind(null,element,text[i]),timeout);}
if(i!=text.length){setTimeout(fill_input.bind(null,element,text),options.timeout);timeout=options.timeout;}
if(options.send){setTimeout(function(){element.dispatchEvent(new KeyboardEvent("keydown",{altKey:false,ctrlKey:false,key:"Enter",keyCode:13,metaKey:false,shiftKey:false}));},timeout);timeout+=options.step;}
timeout+=options.padding;setTimeout(function(){autoAction.nextHandler();},timeout);};},scrollIntoView:function scrollIntoView(selector){return function(autoAction){var element=selector();element.scrollIntoView();autoAction.nextHandler();};},switch_view:function switch_view(view){return function(autoAction){Wirecloud.UserInterfaceManager.changeCurrentView(view);autoAction.nextHandler();};},uploadComponent:function uploadComponent(id){return function(autoAction,element){if(!Wirecloud.LocalCatalogue.resourceExistsId(id)){Wirecloud.LocalCatalogue.addComponent({url:build_static_url('tutorial-data/'+id.split('/').join('_')+'.wgt')}).then(autoAction.nextHandler,autoAction.errorHandler);}else{autoAction.nextHandler();}};},wait_transitions:function wait_transitions(){return function(autoAction,element){var interval=setInterval(function(){var element=document.querySelector(".se-on-transition");if(element==null){clearInterval(interval);autoAction.nextHandler();}},200);}},editorView:{wait_mac_wallet_ready:function wait_mac_wallet_ready(){return function(autoAction,element){var interval=setInterval(function(){var widget_list=document.querySelector(".wc-workspace .wc-resource-results:not(.disabled)");if(widget_list){clearInterval(interval);autoAction.nextHandler();}},200);};},},wiringView:{open_component_sidebar:function open_component_sidebar(type){return function(autoAction,element){var sidebar_button=Utils.basic_selectors.toolbar_button('we-show-component-sidebar-button')();if(!sidebar_button.classList.contains('active')){sidebar_button.click();}
var component_type_button=Utils.basic_selectors.button('.wiring-sidebar .btn-list-'+type+'-group')();if(!component_type_button.classList.contains('active')){component_type_button.click();}
autoAction.nextHandler();};},wait_sidebar_ready:function wait_sidebar_ready(){return function(autoAction,element){var interval=setInterval(function(){var widget_list=document.querySelector(".we-panel-components .wc-resource-results:not(.disabled)");if(widget_list){clearInterval(interval);autoAction.nextHandler();}},200);};},}},basic_selectors:{back_button:function back_button(){return Utils.basic_selectors.button("#wirecloud_header .wc-back-button");},button:function button(selector){return function(){var element=document.querySelector(selector);if(element!=null){if(element.classList.contains('se-btn')){return element;}else{return element.parentElement;}}
return null;};},element:function element(selector){return function(){return document.querySelector(selector);};},form_field:function form_field(fieldName){return function(){var currentWindowMenu=Wirecloud.UserInterfaceManager.currentWindowMenu;return currentWindowMenu.form.fieldInterfaces[fieldName].inputElement.inputElement;};},mac_wallet_input:function mac_wallet_input(){return Utils.basic_selectors.element('.wc-workspace .wc-resource-list .se-field-search');},mac_wallet_resource:function mac_wallet_resource(resource_title){return function(){var resources,widget;resources=document.querySelectorAll('.wc-workspace .we-component-meta .panel-heading');widget=findElementByTextContent(resources,resource_title);return widget.parentNode;};},mac_wallet_resource_mainbutton:function mac_wallet_resource_mainbutton(resource_title){return function(){var widget=Utils.basic_selectors.mac_wallet_resource(resource_title)();return widget.querySelector(".panel-body .wc-create-resource-component");};},menu_item:function menu_item(title){return function(){var i,items=document.querySelectorAll(".se-popup-menu-item");for(i=items.length-1;i>=0;i--){if(items[i].textContent==title){return items[i];}}
return null;};},toolbar_button:function toolbar_button(button_class){return Utils.basic_selectors.button("#wirecloud_header .wc-toolbar ."+button_class);},workspaceView:{widget_by_title:function widget_by_title(title){return function(){var i,widgetList;widgetList=document.querySelectorAll('.wc-workspace .wc-widget');for(i=0;i<widgetList.length;i++){if(widgetList[i].querySelector('.wc-widget-heading span').textContent===title){return widgetList[i];}}
return null;};},widget_element:function widget_element(index,selector){return function(){var widget=Wirecloud.activeWorkspace.widgets[index];var element=widget.wrapperElement.contentDocument.querySelector(selector);return new Wirecloud.ui.Tutorial.WidgetElement(widget,element);};}},wiringView:{create_behaviour_button:function create_behaviour_button(){return Utils.basic_selectors.button(".we-panel-behaviours .panel-heading .btn-create");},enable_behaviours_button:function enable_behaviours_button(){return Utils.basic_selectors.button(".we-panel-behaviours .panel-heading .btn-enable");},show_behaviours_button:function show_behaviours_button(){return Utils.basic_selectors.button(".wc-toolbar .we-show-behaviour-sidebar-button");},behaviour_engine:function behaviour_engine(){return function(){return Wirecloud.UserInterfaceManager.views.wiring.behaviourEngine;};},component_by_id:function component_by_id(type,id_){return function(){var query,id;id=""+id_;if(type==='widget'){id=""+Wirecloud.activeWorkspace.widgets[id_].id;}
query=Wirecloud.Utils.interpolate('.wiring-diagram .component-%(type)s[data-id="%(id)s"]',{type:type,id:id});return document.querySelector(query);};},connection_engine:function connection_engine(){return function(){return Wirecloud.UserInterfaceManager.views.wiring.connectionEngine;};},endpoint_by_name:function endpoint_by_name(component_type,component_id,endpoint_type,endpoint_name){return function(){var component=Utils.basic_selectors.wiringView.component_by_id(component_type,component_id)();if(component!=null){var endpoints=component.querySelectorAll('.'+endpoint_type+'-endpoints .endpoint');for(var i=0;i<endpoints.length;i++){if(endpoints[i].getAttribute('data-name')===endpoint_name){return endpoints[i].querySelector('.endpoint-anchor');}}}
return null;};},show_behaviour_prefs_button:function show_behaviour_prefs_button(behaviourId){return function(){var behaviour=document.querySelectorAll(".we-panel-behaviours .behaviour")[behaviourId];return behaviour.querySelector(".we-prefs-btn");};},sidebar_input:function sidebar_input(){return Utils.basic_selectors.element('.wc-workspace-wiring .we-panel-components .se-field-search');},sidebarcomponentgroup_by_id:function sidecomponentgroup(id){return function(){var query=Wirecloud.Utils.interpolate('.wc-workspace-wiring .we-panel-components .we-component-group[data-id="%(id)s"]',{id:id});return document.querySelector(query);};},sidebarcomponent_by_id:function sidebarcomponent_by_id(component_meta_id,component_id){return function(){var componentgroup,components;componentgroup=Utils.basic_selectors.wiringView.sidebarcomponentgroup_by_id(component_meta_id)();if(componentgroup!=null){components=componentgroup.querySelectorAll('.we-component');return components[component_id];}
return null;};}}}};Wirecloud.ui.Tutorial.Utils=Utils;})();;(function(utils){"use strict";var tutorials=[];var tutorialsById={};var TutorialCatalogue={};TutorialCatalogue.add=function add(id,tutorial){if(!(tutorial instanceof Wirecloud.ui.Tutorial)){throw new TypeError('tutorial must be an instance of Wirecloud.ui.Tutorial');}
tutorials.push(tutorial);tutorialsById[id]=tutorial;};Object.defineProperty(TutorialCatalogue,'tutorials',{get:function(){return tutorials;}});Object.defineProperty(TutorialCatalogue,'get',{value:function get(id){return tutorialsById[id];}});Object.defineProperty(TutorialCatalogue,'buildTutorialReferences',{value:function buildTutorialReferences(tutorial_list){var description=document.createElement('p');description.textContent=utils.gettext('If you prefer, you can follow some of these tutorials:');var list=document.createElement('ul');for(var i=0;i<tutorial_list.length;i++){var tutorial=this.get(tutorial_list[i]);var item=document.createElement('li');var link=document.createElement('a');link.textContent=tutorial.label;link.addEventListener('click',function(e){e.stopPropagation();e.preventDefault();this.start();}.bind(tutorial));item.appendChild(link);list.appendChild(item);}
return new StyledElements.Fragment([description,list]);}});Object.freeze(TutorialCatalogue);Wirecloud.TutorialCatalogue=TutorialCatalogue;})(Wirecloud.Utils);;(function(utils){"use strict";var TutorialSubMenu=function TutorialSubMenu(){var i,tutorial;StyledElements.SubMenuItem.call(this,utils.gettext('Tutorials'));this.menuItem.addIconClass('fa fa-map-o');for(i=0;i<Wirecloud.TutorialCatalogue.tutorials.length;i++){tutorial=Wirecloud.TutorialCatalogue.tutorials[i];this.append(new StyledElements.MenuItem(tutorial.label,tutorial.start.bind(tutorial)));}};TutorialSubMenu.prototype=new StyledElements.SubMenuItem();Wirecloud.ui.TutorialSubMenu=TutorialSubMenu;})(Wirecloud.Utils);;(function(){"use strict";var PopUp=function PopUp(element,options){StyledElements.ObjectWithEvents.call(this,['close']);this.element=element;this.options=options;if(options.highlight===true){if(element instanceof StyledElements.StyledElement){element.addClassName('tuto_highlight');}else{element.classList.add('tuto_highlight');}}
this.wrapperElement=document.createElement('div');this.wrapperElement.className='pop-up alert';if(options.user){this.wrapperElement.classList.add('alert-warning');}else{this.wrapperElement.classList.add('alert-info');}
if(options.closable){this.cancelButton=new StyledElements.Button({class:'pop-up-close',iconClass:'fa fa-remove',plain:true});this.cancelButton.addEventListener('click',function(){this.destroy();this.dispatchEvent('close');}.bind(this));this.cancelButton.insertInto(this.wrapperElement);}
this.textElement=document.createElement('span');this.textElement.className='pop-up-message';if(options.msg==null){this.wrapperElement.classList.add("empty");}else{this.textElement.innerHTML=options.msg;}
this.warningIco=document.createElement("span");this.warningIco.className='warningIco fa fa-warning';this.wrapperElement.appendChild(this.warningIco);this.wrapperElement.appendChild(this.textElement);this.arrow=document.createElement('span');this.arrow.className="pop-up-arrow fa fa-external-link-square";this.wrapperElement.appendChild(this.arrow);this.arrow.classList.add(options.position);};PopUp.prototype=new StyledElements.ObjectWithEvents();PopUp.prototype.repaint=function repaint(){var pos=this.element.getBoundingClientRect();var wrapperPos=this.wrapperElement.getBoundingClientRect();switch(this.options.position){default:case'downRight':this.wrapperElement.style.top=(pos.top+pos.height+13)+'px';this.wrapperElement.style.left=(pos.left+(pos.width/4)*3)+'px';break;case'downLeft':this.wrapperElement.style.top=(pos.top+pos.height+13)+'px';this.wrapperElement.style.left=(pos.left-wrapperPos.width+(pos.width/4)*1)+'px';break;case'topRight':this.wrapperElement.style.top=(pos.top-wrapperPos.height-13)+'px';this.wrapperElement.style.left=(pos.left+(pos.width/4)*3)+'px';break;case'topLeft':this.wrapperElement.style.top=(pos.top-wrapperPos.height-13)+'px';this.wrapperElement.style.left=(pos.left-wrapperPos.width+(pos.width/4)*1)+'px';break;}};PopUp.prototype.destroy=function destroy(){if(this.wrapperElement==null){return;}
if(this.options.highlight){if(this.element instanceof StyledElements.StyledElement){this.element.removeClassName('tuto_highlight');}else{this.element.classList.remove('tuto_highlight');}}
if(this.wrapperElement.parentNode){this.wrapperElement.parentNode.removeChild(this.wrapperElement);}
this.wrapperElement=null;this.textElement=null;this.arrow=null;};Wirecloud.ui.Tutorial.PopUp=PopUp;var WidgetElement=function WidgetElement(widget,element){this.widget=widget;this.element=element;this.classList={'add':function(){this.add.apply(this,arguments);}.bind(this.element.classList),'remove':function(){this.remove.apply(this,arguments);}.bind(this.element.classList)};Object.freeze(this.classList);Object.freeze(this);};WidgetElement.prototype.getBoundingClientRect=function getBoundingClientRect(){var widget_box=this.widget.wrapperElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();return{'left':widget_box.left+element_box.left,'top':widget_box.top+element_box.top,'width':element_box.width,'height':element_box.height};};WidgetElement.prototype.addEventListener=function(){this.element.addEventListener.apply(this.element,arguments);};WidgetElement.prototype.removeEventListener=function(){this.element.removeEventListener.apply(this.element,arguments);};Wirecloud.ui.Tutorial.WidgetElement=WidgetElement;})();;(function(se,utils){"use strict";var setDialogPosition=function setDialogPosition(ref_pos,pos){switch(pos){case'up':this.htmlElement.style.top=(ref_pos.top-this.htmlElement.offsetHeight-20)+'px';this.htmlElement.style.left=(ref_pos.left+(ref_pos.width-this.htmlElement.offsetWidth)/2)+'px';break;case'right':this.htmlElement.style.top=(ref_pos.top+(ref_pos.height-this.htmlElement.offsetHeight)/2)+'px';this.htmlElement.style.left=(ref_pos.right+20)+'px';break;case'left':this.htmlElement.style.top=(ref_pos.top+(ref_pos.height-this.htmlElement.offsetHeight)/2)+'px';this.htmlElement.style.left=(ref_pos.left-this.htmlElement.offsetWidth-20)+'px';break;case'down':this.htmlElement.style.top=(ref_pos.bottom+20)+'px';this.htmlElement.style.left=(ref_pos.left+(ref_pos.width-this.htmlElement.offsetWidth)/2)+'px';break;}};var standsOut=function standsOut(){var parent_box=document.body.getBoundingClientRect();var element_box=this.htmlElement.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setDialogPosition.call(this,refPosition,position);};var SimpleDescription=function SimpleDescription(tutorial,options){this.options=options;this.element=options.elem;this.tutorial=tutorial;this.layer=tutorial.msgLayer;this.last=false;this.pos=options.pos;this.title=options.title;this.nextButtonText=utils.gettext('Next');if(options.nextButtonText){this.nextButtonText=options.nextButtonText;}
Wirecloud.ui.WindowMenu.call(this,this.title,'simpleDescription');this.windowContent.innerHTML=options.msg;this.nextButton=new se.Button({'class':'nextButton btn-primary','text':utils.gettext(this.nextButtonText),});this.nextButton.insertInto(this.windowBottom);this.cancelButton=new se.Button({'class':'cancelButton','text':utils.gettext("Cancel"),});this.cancelButton.insertInto(this.windowBottom);this.cancelButton.addEventListener('click',this._closeListener);this.layer.appendChild(this.htmlElement);this.wrapperElement=this.htmlElement;};utils.inherit(SimpleDescription,Wirecloud.ui.WindowMenu);SimpleDescription.prototype._closeListener=function _closeListener(e){Wirecloud.ui.WindowMenu.prototype._closeListener.call(this,e);this.tutorial.destroy();};SimpleDescription.prototype.getStylePosition=function getStylePosition(){var coordinates;coordinates={posX:parseInt(this.htmlElement.style.left,10),posY:parseInt(this.htmlElement.style.top,10)};return coordinates;};SimpleDescription.prototype.setPosition=function setPosition(coordinates){this.htmlElement.style.left=coordinates.posX+'px';this.htmlElement.style.top=coordinates.posY+'px';};SimpleDescription.prototype.setLast=function setLast(buttonLabel,optionalHandler){this.last=true;this.nextButton.remove();if(buttonLabel==null){buttonLabel=utils.gettext('Close');}
this.cancelButton.setLabel(utils.gettext(buttonLabel));if(optionalHandler!=null){this.cancelButton.removeEventListener('click',this._closeListener);this.cancelButton.addEventListener('click',optionalHandler.bind(this));}};SimpleDescription.prototype.setNext=function setNext(){this.nextButton.addEventListener('click',function(){if(this.currentElement!=null){this.currentElement.classList.remove('tuto_highlight');}
this.tutorial.nextStep();}.bind(this));};var _activate=function _activate(){var i=0,ref_pos,weights,positions;this.htmlElement.classList.add("activeStep");if(typeof this.element==='function'){this.currentElement=this.element();this.tutorial.setControlLayer(this.currentElement,true);this.currentElement.classList.add('tuto_highlight');}else{this.tutorial.resetControlLayer(false);}
if(this.currentElement!=null){ref_pos=this.currentElement.getBoundingClientRect();weights=[];positions=['down','left','top','right'];do{setDialogPosition.call(this,ref_pos,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,ref_pos,weights,positions);}}else{this.htmlElement.style.top=((window.innerHeight/2)-(this.htmlElement.offsetHeight/2))+'px';this.htmlElement.style.left=((window.innerWidth/2)-(this.htmlElement.offsetWidth/2))+'px';}
this.nextButton.focus();};SimpleDescription.prototype.activate=function activate(){if(this.options.asynchronous){this.element(_activate.bind(this));}else{_activate.call(this);}};Wirecloud.ui.Tutorial.SimpleDescription=SimpleDescription;})(StyledElements,Wirecloud.Utils);;(function(){"use strict";var build_disable_elements_list=function build_disable_elements_list(list){var i,elements,result=[];for(i=0;i<list.length;i++){if(typeof list[i]==='object'){result.push(list[i]);}else if(typeof list[i]==='function'){elements=list[i]();if(elements instanceof NodeList){result=result.concat([].slice.call(elements));}else if(Array.isArray(elements)){result=result.concat(elements);}else{result.push(elements);}}}
return result;};var get_simple_element=function get_simple_element(element,fallback){if(element==null){element=fallback;}
if(typeof element==='function'){return element();}else{return element;}};var configure_next_step_phase=function configure_next_step_phase(){var msg,targetElement;if(this.popup){this.popup.destroy();}
this.next_element=get_simple_element(this.options.elemToApplyNextStepEvent,this.element);this.next_element.addEventListener(this.event,this.nextHandler,this.options.eventCapture);if(this.start_element!=null){this.tutorial.deactivateLayer();}else{this.tutorial.setControlLayer(this.next_element);}
if(this.start_element!=null&&this.options.nextStepMsg){msg=this.options.nextStepMsg;}else if(this.start_element==null&&this.options.msg){msg=this.options.msg;}
if(msg){if(this.options.targetElement!=null){targetElement=get_simple_element(this.options.targetElement);}else{targetElement=this.next_element;}
this.popup=new Wirecloud.ui.Tutorial.PopUp(targetElement,{highlight:true,user:true,msg:msg,position:this.nextPosition,closable:true});this.layer.appendChild(this.popup.wrapperElement);this.popup.repaint();this.popup.addEventListener('close',this.tutorial.destroy.bind(this.tutorial));}};var configure_start_phase=function configure_start_phase(){if(this.popup){this.popup.destroy();}
this.start_element=get_simple_element(this.options.elemToApplyDeactivateLayerEvent,this.element);this.start_element.addEventListener(this.eventToDeactivateLayer,this.deactivateLayer,true);this.isWaitingForDeactivateLayerEvent=true;this.tutorial.setControlLayer(this.start_element);this.popup=new Wirecloud.ui.Tutorial.PopUp(this.start_element,{highlight:true,user:true,msg:this.options.msg,position:this.position,closable:true});this.layer.appendChild(this.popup.wrapperElement);this.popup.repaint();this.popup.addEventListener('close',this.tutorial.destroy.bind(this.tutorial));};var clear_restart_handlers=function clear_restart_handlers(){var i,restart_handler;for(i=0;i<this.restart_handlers.length;i++){restart_handler=this.restart_handlers[i];restart_handler.element.removeEventListener(restart_handler.event,restart_handler.func,true);}
this.restart_handlers=[];};var restartStep=function restartStep(){var i;this.next_element.removeEventListener(this.event,this.nextHandler,this.options.eventCapture);this.next_element=null;for(i=0;i<this.disableLayer.length;i++){this.layer.removeChild(this.disableLayer[i]);}
this.disableLayer=[];clear_restart_handlers.call(this);configure_start_phase.call(this);};var UserAction=function UserAction(tutorial,options){this.options=options;this.options.asynchronous=!!this.options.asynchronous;this.layer=tutorial.msgLayer;this.last=false;this.tutorial=tutorial;this.element=options.elem;this.position=options.pos;this.nextPosition=options.secondPos?options.secondPos:this.position;if(options.event){this.event=options.event;}else{this.event='click';}
this.activeLayer=true;this.deactivateLayer=this.deactivateLayer.bind(this);this.restartStep=restartStep.bind(this);this.disableElems=options.disableElems;if(this.disableElems==null){this.disableElems=[];}
this.restart_handlers=[];this.disableLayer=[];if(options.eventCapture!=null){options.eventCapture=!!options.eventCapture;}else{options.eventCapture=true;}
if(!Array.isArray(options.restartHandlers)){options.restartHandlers=[];}
this.eventToDeactivateLayer=options.eventToDeactivateLayer;this.isWaitingForDeactivateLayerEvent=false;if(typeof this.options.eventFilterFunction!=='function'){this.options.eventFilterFunction=function(){return true;};}
this.nextHandler=function(){if(this.options.eventFilterFunction.apply(null,arguments)){this.tutorial.destroy();}}.bind(this);};UserAction.prototype.setLast=function setLast(){this.last=true;};UserAction.prototype.setNext=function setNext(){this.nextHandler=function(){if(this.options.eventFilterFunction.apply(null,arguments)){nextHandler.call(this);}}.bind(this);};UserAction.prototype.deactivateLayer=function deactivateLayer(){var i,restart_handler,element;this.isWaitingForDeactivateLayerEvent=false;this.start_element.removeEventListener(this.eventToDeactivateLayer,this.deactivateLayer,true);for(i=0;i<this.options.restartHandlers.length;i++){restart_handler=this.options.restartHandlers[i];element=get_simple_element(restart_handler.element);element.addEventListener(restart_handler.event,this.restartStep,true);this.restart_handlers.push({'element':element,'event':restart_handler.event,'func':this.restartStep});}
var disableElems=build_disable_elements_list(this.disableElems);for(i=0;i<disableElems.length;i++){this.disableLayer[i]=this.disable(disableElems[i]);}
configure_next_step_phase.call(this);};UserAction.prototype.disable=function disable(elem){var pos,disableLayer;pos=elem.getBoundingClientRect();disableLayer=document.createElement("div");disableLayer.className='disableLayer';disableLayer.style.top=pos.top+'px';disableLayer.style.left=pos.left+'px';disableLayer.style.width=pos.width+'px';disableLayer.style.height=pos.height+'px';this.layer.appendChild(disableLayer);return disableLayer;};var nextHandler=function nextHandler(){if(this.isWaitingForDeactivateLayerEvent){return;}
this.next_element.removeEventListener(this.event,this.nextHandler,this.options.eventCapture);this.next_element=null;this.tutorial.nextStep();};var _activate=function _activate(element){if(element!=null){this.start_element=element;}
if(this.options.eventToDeactivateLayer!=null){configure_start_phase.call(this);}else{configure_next_step_phase.call(this);}};UserAction.prototype.activate=function activate(){if(this.options.asynchronous){this.element(_activate.bind(this));}else{_activate.call(this,null);}};UserAction.prototype.destroy=function destroy(){var i;if(this.start_element){this.start_element.removeEventListener(this.eventToDeactivateLayer,this.deactivateLayer,true);this.start_element=null;}
if(this.next_element){this.next_element.removeEventListener(this.event,this.nextHandler,this.options.eventCapture);this.next_element=null;}
for(i=0;i<this.disableLayer.length;i++){this.layer.removeChild(this.disableLayer[i]);}
this.disableLayer=null;clear_restart_handlers.call(this);if(this.popup!=null){this.popup.destroy();}
this.textElement=null;this.arrow=null;};Wirecloud.ui.Tutorial.UserAction=UserAction;})();;(function(utils){"use strict";var FormAction=function FormAction(tutorial,options){this.options=options;this.options.asynchronous=!!this.options.asynchronous;this.layer=tutorial.msgLayer;this.last=false;this.tutorial=tutorial;this.mainTitle=options.mainTitle;this.mainMsg=options.mainMsg;this.mainPos=options.mainPos;this.actionElements=options.actionElements;this.actionElementsPos=options.actionElementsPos;this.actionElementsValidators=options.actionElementsValidators;this.actionMsgs=options.actionMsgs;this.disableElems=options.disableElems;this.endElement=options.endElement;this.endElementMsg=options.endElementMsg;this.endElementPos=options.endElementPos;this.form=options.form;this.mainPos=options.mainPos;this.subSteps=[];this.disableLayer=[];this.invalidcounter=0;if(!Array.isArray(this.disableElems)){this.disableElems=[];}
if(this.mainMsg){this.mainStep=new Wirecloud.ui.Tutorial.SimpleDescription(tutorial,{'type':'simpleDescription','title':utils.gettext(this.mainTitle),'msg':utils.gettext(this.mainMsg),'elem':null});this.mainStep.setLast();}};FormAction.prototype.setLast=function setLast(){this.last=true;};FormAction.prototype.setNext=function setNext(){this.nextHandler=nextHandler.bind(this);};var nextHandler=function nextHandler(){this.tutorial.nextStep();};var _activate=function _activate(form){var pos,i,tempElem;this.element=form;if(this.mainStep){this.mainStep.wrapperElement.classList.add("activeStep");pos=form.getBoundingClientRect();switch(this.mainPos){case'up':this.mainStep.wrapperElement.style.top=(pos.top-this.mainStep.wrapperElement.offsetHeight-20)+'px';break;case'right':this.mainStep.wrapperElement.style.left=(pos.right+20)+'px';break;case'left':this.mainStep.wrapperElement.style.left=(pos.left-this.mainStep.wrapperElement.offsetWidth-20)+'px';break;case'down':this.mainStep.wrapperElement.style.top=(pos.bottom+20)+'px';break;default:break;}}
this.endAction=new Wirecloud.ui.Tutorial.UserAction(this.tutorial,{'type':'userAction','msg':this.endElementMsg,'elem':form.acceptButton,'pos':this.endElementPos});this.endAction.setNext();this.endAction.activate();var activateSubFormAction=function(index){this.subSteps[index].wrapperElement.classList.add('activate');validateInput.call(this,index);};var deActivateSubFormAction=function(index){this.subSteps[index].wrapperElement.classList.remove('activate');};var validateInput=function(index){if(!this.actionElementsValidators[index](this.actionElements[index]())&&!this.subSteps[index].wrapperElement.classList.contains('invalid')){this.subSteps[index].wrapperElement.classList.add('invalid');this.form.acceptButton.disable();this.invalidcounter++;}else if(this.actionElementsValidators[index](this.actionElements[index]())&&this.subSteps[index].wrapperElement.classList.contains('invalid')){this.subSteps[index].wrapperElement.classList.remove('invalid');this.invalidcounter--;if(this.invalidcounter===0){this.form.acceptButton.enable();}}};for(i=0;i<this.actionElements.length;i++){this.subSteps[i]=new Wirecloud.ui.Tutorial.PopUp(this.actionElements[i](),{highlight:false,msg:this.actionMsgs[i],position:this.actionElementsPos[i],user:true,closable:false});this.layer.appendChild(this.subSteps[i].wrapperElement);this.subSteps[i].wrapperElement.classList.add('subFormAction');this.subSteps[i].repaint();tempElem=this.actionElements[i]();tempElem.addEventListener('keyup',validateInput.bind(this,i),true);tempElem.addEventListener('focus',activateSubFormAction.bind(this,i),true);tempElem.addEventListener('blur',deActivateSubFormAction.bind(this,i),true);}
if(this.actionElements!=null){activateSubFormAction.call(this,0);}
for(i=0;i<this.disableElems.length;i++){this.disableLayer[i]=this.disable(this.disableElems[i]());}
form.cancelButton.disable();this.tutorial.resetControlLayer();this.tutorial.deactivateLayer();};FormAction.prototype.activate=function activate(){if(this.options.asynchronous){this.form(_activate.bind(this));}else{_activate.call(this,this.form());}};FormAction.prototype.disable=function disable(elem){var pos,disableLayer;pos=elem.getBoundingClientRect();disableLayer=document.createElement("div");disableLayer.classList.add('disableLayer');disableLayer.style.top=pos.top+'px';disableLayer.style.left=pos.left+'px';disableLayer.style.width=pos.width+'px';disableLayer.style.height=pos.height+'px';this.layer.appendChild(disableLayer);return disableLayer;};FormAction.prototype.destroy=function destroy(){var i;for(i=0;i<this.disableLayer.length;i++){this.layer.removeChild(this.disableLayer[i]);}
for(i=0;i<this.subSteps.length;i++){this.subSteps[i].destroy();}
if(this.mainStep!=null){this.mainStep.destroy();this.mainStep=null;}
if(this.endAction!=null){this.endAction.destroy();this.endAction=null;}};Wirecloud.ui.Tutorial.FormAction=FormAction;})(Wirecloud.Utils);;(function(){"use strict";var AutoAction=function AutoAction(tutorial,options){this.options=options;this.options.asynchronous=!!this.options.asynchronous;this.layer=tutorial.msgLayer;this.last=false;this.tutorial=tutorial;this.element=options.elem;this.position=options.pos;this.event=options.event;this.action=options.action;};AutoAction.prototype.setLast=function setLast(){this.last=true;};AutoAction.prototype.setNext=function setNext(){this.nextHandler=nextHandler.bind(this);};var nextHandler=function nextHandler(){if(this.element!=null){this.element.classList.remove('tuto_highlight');}
this.tutorial.nextStep();};var _activate=function _activate(element){if(element!=null){this.element=element;}
if(element!=null){if(this.options.msg){this.popup=new Wirecloud.ui.Tutorial.PopUp(this.element,{highlight:true,msg:this.options.msg,position:this.position,closable:true});this.layer.appendChild(this.popup.wrapperElement);this.popup.repaint();this.popup.addEventListener('close',this.tutorial.destroy.bind(this.tutorial,true));}
this.tutorial.setControlLayer(element,true);}else{this.tutorial.resetControlLayer();}
this.action(this,this.element);};AutoAction.prototype.activate=function activate(){if(this.element==null){_activate.call(this,null);}else if(this.options.asynchronous){this.element(_activate.bind(this));}else{_activate.call(this,this.element());}};AutoAction.prototype.destroy=function destroy(){if(typeof this.element==='function'){this.element=null;}else if(this.element!=null){this.element.removeEventListener('click',this.nextHandler,true);}
if(this.popup){this.popup.destroy();}
this.textElement=null;this.arrow=null;};Wirecloud.ui.Tutorial.AutoAction=AutoAction;})();;(function(utils){"use strict";var BS=Wirecloud.ui.Tutorial.Utils.basic_selectors;var BA=Wirecloud.ui.Tutorial.Utils.basic_actions;var widget_title=function(index){var widget=Wirecloud.activeWorkspace.view.widgets[index];return widget.wrapperElement.getElementsByClassName("wc-widget-heading")[0].getElementsByTagName('span')[0];};var get_menubar=function get_menubar(){return document.querySelector(".wiring-sidebar .we-panel-components");};var widget_menu=function widget_menu(index){var widget=Wirecloud.activeWorkspace.view.widgets[index];return widget.wrapperElement.getElementsByClassName('wc-menu-button')[0];};var enter_keypress=function(e){return e.keyCode===13;};var windowForm=function(callback){var interval;interval=setInterval(function(){var currentWindowMenu=Wirecloud.UserInterfaceManager.currentWindowMenu;if(currentWindowMenu!=null&&"form"in currentWindowMenu){clearInterval(interval);callback(currentWindowMenu.form);}},200);};var isNotEmpty=function isNotEmpty(input){return input.value!=='';};Wirecloud.TutorialCatalogue.add('basic-concepts',new Wirecloud.ui.Tutorial(utils.gettext('Basic concepts'),[{type:'simpleDescription',title:utils.gettext('WireCloud Basic Tutorial'),msg:utils.gettext("<p>Welcome to WireCloud!!</p><p>This tutorial will show you the basic concepts behind WireCloud.</p>")},{type:'autoAction',action:BA.switch_view('workspace')},{type:'autoAction',action:BA.create_workspace({name:'Basic concepts tutorial'})},{type:'simpleDescription',title:utils.gettext('WireCloud Basic Tutorial'),msg:utils.gettext('<p>This is the <em>Editor</em> view. In this view, you can use and modify your workspaces. Currently you are in a newly created workspace: <em>Basic concepts tutorial</em>. This workspace is empty, so the first step is to add some widgets.</p><div class="alert alert-info"><p>In next steps we need some widgets, so we are going to install them for you. You can safely uninstall these widgets after finishing the tutorial.</p></div>')},{'type':'autoAction','action':BA.uploadComponent('CoNWeT/input-box/1.0')},{'type':'autoAction','action':BA.uploadComponent('CoNWeT/youtube-browser/3.0')},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("<p>Ok, widgets have been installed successfuly.</p><p>Next step is to add the <em>YouTube Browser</em> widget to the workspace.</p>")},{'type':'userAction','msg':utils.gettext("Click the <em>Add components</em> button"),'elem':BS.toolbar_button('wc-show-component-sidebar-button'),'pos':'downLeft'},{'type':'autoAction','elem':BS.toolbar_button('wc-show-component-sidebar-button'),'action':BA.sleep(500)},{'type':'autoAction','msg':utils.gettext('By typing "browser" we can filter widgets that contains in their name or description these words'),'elem':BS.mac_wallet_input(),'pos':'downRight','action':BA.input('browser',{send:true})},{'type':'autoAction','elem':BS.mac_wallet_input(),'action':BA.editorView.wait_mac_wallet_ready()},{'type':'autoAction','elem':BS.mac_wallet_input(),'action':BA.scrollIntoView(BS.mac_wallet_resource("YouTube Browser"))},{'type':'userAction','msg':utils.gettext("Once you have the results, you can add the widget. So click <em>Add to workspace</em>"),'elem':BS.mac_wallet_resource_mainbutton("YouTube Browser"),'pos':'downRight'},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("<p><span class=\"label label-success\">Great!</span> That was easy, wasn't it?.</p><p>Let's continue adding the <em>Input Box</em> widget.</p>"),'elem':null},{'type':'autoAction','msg':utils.gettext('Typing <em>input box</em>...'),'elem':BS.mac_wallet_input(),'pos':'downRight','action':BA.input('input box',{send:true})},{'type':'autoAction','elem':BS.mac_wallet_input(),'action':BA.editorView.wait_mac_wallet_ready()},{'type':'autoAction','elem':BS.mac_wallet_input(),'action':BA.scrollIntoView(BS.mac_wallet_resource("Input Box"))},{'type':'userAction','msg':utils.gettext("Click <em>Add to workspace</em>"),'elem':BS.mac_wallet_resource_mainbutton("Input Box"),'pos':'downRight'},{'type':'userAction','msg':utils.gettext("Close the component sidebar"),'elem':BS.toolbar_button('wc-show-component-sidebar-button'),'pos':'downRight'},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("<p>One of the main features of WireCloud is that you can edit your workspaces' layout not only by adding and removing widgets, but also moving, resizing, renaming, etc.</p>"),'elem':null},{'type':'userAction','msg':utils.gettext("Drag &amp; drop to resize the widget"),'elem':BS.element(".wc-bottom-right-resize-handle"),'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':document},{'type':'userAction','msg':utils.gettext("Drag &amp; drop to move the widget"),'elem':widget_title.bind(null,1),'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':document},{'type':'userAction','msg':utils.gettext("Open <em>Input Box</em> menu"),'elem':widget_menu.bind(null,1),'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':document},{'type':'userAction','msg':utils.gettext("Click <em>Rename</em>"),'elem':BS.menu_item(utils.gettext('Rename')),'pos':'downRight','event':'click'},{'type':'userAction','msg':utils.gettext("Enter a new name for the widget (e.g <em>Search</em>) and press <kbd>Enter</kbd> or click outside the title"),'elem':widget_title.bind(null,1),'pos':'downRight','event':'blur'},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("<p>Also, some widgets can be parameterized through settings giving you the chance to use them for very general purporses.</p>"),'elem':null},{'type':'userAction','msg':utils.gettext("Open <em>Input Box</em> menu"),'elem':widget_menu.bind(null,1),'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':document},{'type':'userAction','msg':utils.gettext("Click <em>Settings</em>"),'elem':BS.menu_item(utils.gettext('Settings')),'pos':'downRight','event':'click'},{'type':'formAction','form':windowForm,'actionElements':[BS.form_field('input_label_pref'),BS.form_field('input_placeholder_pref'),BS.form_field('button_label_pref')],'actionElementsValidators':[isNotEmpty,isNotEmpty,isNotEmpty],'actionMsgs':[utils.gettext("Write a label for the input, e.g. <em>Multimedia</em>."),utils.gettext("Write a better placeholder text for the input, e.g. <em>Keywords</em>"),utils.gettext("Write a better label for the button, e.g <em>Search</em>.")],'actionElementsPos':['topRight','topRight','topRight'],'endElementMsg':utils.gettext("Click here to submit"),'endElementPos':'topLeft','asynchronous':true},{'type':'userAction','msg':utils.gettext("Click <em>Wiring</em> to continue"),'elem':BS.toolbar_button('wc-show-wiring-button'),'pos':'downLeft'},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("<p>This is the <em>Wiring Editor</em> view.</p><p>Here you can wire widgets and operators together turning your workspace into and <em>application mashup</em>.</p>")},{'type':'userAction','msg':utils.gettext("Click <em>Find components</em> to open the sidebar"),'elem':BS.toolbar_button('we-show-component-sidebar-button'),'pos':'downLeft'},{'type':'autoAction','elem':BS.toolbar_button('we-show-component-sidebar-button'),'action':BA.sleep(250)},{'type':'userAction','msg':utils.gettext("Click <em>Widgets</em>"),'elem':BS.button('.wiring-sidebar .btn-list-widget-group'),'pos':'downLeft'},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("<p>In this sidebar you can find all the available widgets. In our example, we are interested in the widgets added to the workspace: the <em>YouTube Browser</em> and the <em>Input Box</em> (This last will be listed using the new name given in previous step).</p><p>You can also find <em>operators</em>. These components can act as source, transformators or data targets as well as a combination of these behaviours.</p>"),'elem':get_menubar},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("<p>In the next steps, we are going to connect the <em>Input Box</em> and <em>YouTube Browser</em> widgets together. This will allow you to perform searches in the <em>YouTube Browser</em> through the <em>Input Box</em> widget.</p>"),'elem':get_menubar},{'type':'autoAction','elem':BS.wiringView.sidebar_input(),'action':BA.input('Input Box',{send:true,timeout:0,padding:0})},{'type':'autoAction','elem':BS.wiringView.sidebar_input(),'action':BA.wiringView.wait_sidebar_ready()},{'type':'autoAction','elem':BS.wiringView.sidebar_input(),'action':BA.scrollIntoView(BS.wiringView.sidebarcomponentgroup_by_id("CoNWeT/input-box"))},{'type':'userAction','msg':utils.gettext("Drag &amp; drop the <em>Input Box</em> widget"),'elem':BS.wiringView.sidebarcomponent_by_id("CoNWeT/input-box",0),'pos':'downRight','event':'change','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':BS.wiringView.behaviour_engine(),},{'type':'autoAction','action':BA.sleep(200)},{'type':'autoAction','elem':BS.wiringView.sidebar_input(),'action':BA.input('YouTube Browser',{send:true,timeout:0,padding:0})},{'type':'autoAction','elem':BS.wiringView.sidebar_input(),'action':BA.wiringView.wait_sidebar_ready()},{'type':'autoAction','elem':BS.wiringView.sidebar_input(),'action':BA.scrollIntoView(BS.wiringView.sidebarcomponentgroup_by_id("CoNWeT/youtube-browser"))},{'type':'userAction','msg':utils.gettext("Drag &amp; drop the <em>YouTube Browser</em> widget"),'elem':BS.wiringView.sidebarcomponent_by_id("CoNWeT/youtube-browser",0),'pos':'downRight','event':'change','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':BS.wiringView.behaviour_engine(),},{'type':'userAction','msg':utils.gettext("Click <em>Find components</em> to close the sidebar"),'elem':BS.toolbar_button('we-show-component-sidebar-button'),'pos':'downLeft'},{'type':'autoAction','elem':BS.toolbar_button('we-show-component-sidebar-button'),'action':BA.sleep(250)},{'type':'userAction','msg':utils.gettext("Drag &amp; drop a new connection from <em>Search Box</em>'s <em>keyword</em> endpoint ..."),'elem':BS.wiringView.endpoint_by_name('widget',1,'source','outputKeyword'),'eventToDeactivateLayer':'mousedown','pos':'downLeft','restartHandlers':[{'element':BS.wiringView.connection_engine(),'event':'cancel'}],'nextStepMsg':utils.gettext("... to <em>YouTube Browser</em>'s <em>keyword</em> endpoint"),'elemToApplyNextStepEvent':BS.wiringView.connection_engine(),'event':'establish','targetElement':BS.wiringView.endpoint_by_name('widget',0,'target','keyword'),'secondPos':'downLeft'},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext("Now it's time to test our creation.")},{'type':'userAction','msg':utils.gettext("Click <em>Back</em>"),'elem':BS.back_button(),'pos':'downRight'},{'type':'autoAction','action':BA.wait_transitions()},{'type':'userAction','msg':utils.gettext("Enter a search keyword and press <kbd>Enter</kbd>"),'elem':BS.workspaceView.widget_element(1,'input'),'pos':'downLeft','event':'keypress','eventFilterFunction':enter_keypress},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext('<p><span class="label label-success">Congratulations!</span> you have finished your first <em>application mashup</em>.</p><p>As you can see, the <em>YouTube Browser</em> widget has been updated successfuly.</p>'),'elem':BS.workspaceView.widget_by_title('YouTube Browser')},{'type':'autoAction','action':BA.click(100),'elem':BS.button('#wirecloud_header .arrow-down-settings, #wirecloud_header .btn-success')},{'type':'simpleDescription','title':utils.gettext('WireCloud Basic Tutorial'),'msg':utils.gettext('<p>This is the end of this tutorial. Remember that you can always go to the Tutorial menu for others.</p>'),'elem':BS.menu_item(utils.gettext('Tutorials'))}]));})(Wirecloud.Utils);;(function(ns,se,utils){"use strict";var BS=Wirecloud.ui.Tutorial.Utils.basic_selectors;var BA=Wirecloud.ui.Tutorial.Utils.basic_actions;var wiringView={auto_create_behaviour:function auto_create_behaviour(title,description,connections){return function(){var behaviourEngine,behaviour;behaviourEngine=BS.wiringView.behaviour_engine()();behaviour=behaviourEngine.createBehaviour({title:title,description:description});behaviourEngine.activate(behaviour);connections.forEach(function(context){var connection=findConnection(context.source,context.target);behaviourEngine.updateConnection(connection,connection.toJSON(),true);});return behaviour.get();};},accept_form:function accept_form(formSelector){return function(){return document.querySelector(formSelector).querySelector('.btn-accept');};},behaviour_title_by_id:function behaviour_by_id(behaviourId){return function(){var behaviour=document.querySelectorAll(".we-panel-behaviours .behaviour")[behaviourId];return behaviour.querySelector(".behaviour-title");};},component_button_by_title:function component_button_by_title(type,title,name){return function(){var i,components=document.querySelectorAll(".component-draggable.component-"+type);for(i=components.length-1;i>=0;i--){if(components[i].querySelector(".panel-title").textContent==title){return components[i].querySelector(".btn-"+name);}}
return null;};},cancel_alert:function cancel_alert(){return function(){var windowMenu=document.querySelector(".wc-alert-modal");return windowMenu.querySelector(".btn-primary");};},connection_button_by_id:function connection_button_by_id(source,target,buttonName){return function(){var connections=document.querySelectorAll(".connection-options"),components=document.querySelectorAll(".component-draggable");var i,element;for(i=components.length-1;i>=0;i--){element=components[i];if(element.classList.contains("component-"+source.type)&&element.querySelector(".panel-title").textContent==source.title){source.id=source.type+"/"+element.getAttribute("data-id")+"/"+source.endpoint;continue;}
if(element.classList.contains("component-"+target.type)&&element.querySelector(".panel-title").textContent==target.title){target.id=target.type+"/"+element.getAttribute("data-id")+"/"+target.endpoint;continue;}}
for(i=connections.length-1;i>=0;i--){element=connections[i];if(element.getAttribute('data-sourceid')==source.id&&element.getAttribute('data-targetid')==target.id){return element.querySelector(".btn-"+buttonName);}}
return null;};},'openBehaviourRegistrationForm':function openBehaviourRegistrationForm(){return document.querySelector('.wiring-sidebar .behaviour-panel .btn-create-behaviour');},'getOperatorByName':function getOperatorByName(operatorName){document.querySelector('.wiring-sidebar .btn-display-operator-group').click();var operators=document.querySelectorAll('.wiring-sidebar .component-panel .component-operator');for(var i=0;i<operators.length;i++){if(operators[i].querySelector('.component-title').textContent==operatorName){return operators[i];}}
return null;},'enableBehaviours':function enableBehaviours(){return document.querySelector('.wiring-sidebar .behaviour-panel .btn-enable-behaviours');},'getBehaviour':function getBehaviour(index){return document.querySelectorAll('.wiring-sidebar .behaviour-panel .behaviour')[index];},'activateBehaviour':function activateBehaviour(index){return document.querySelectorAll('.wiring-sidebar .behaviour-panel .behaviour')[index].querySelector('.btn-activate');},'getBehaviourTitle':function getBehaviourTitle(index){return document.querySelectorAll('.wiring-sidebar .behaviour-panel .behaviour')[index].querySelector('.behaviour-title');},openBehaviourSettings:function openBehaviourSettings(index){return document.querySelectorAll('.wiring-sidebar .behaviour-panel .behaviour')[index].querySelector('.btn-show-settings');},'getBehaviourDescription':function getBehaviourDescription(index){return document.querySelectorAll('.wiring-sidebar .behaviour-panel .behaviour')[index].querySelector('.behaviour-description');}};var findConnection=function findConnection(source,target){var behaviourEngine,foundConnection;behaviourEngine=BS.wiringView.behaviour_engine()();foundConnection=null;behaviourEngine.forEachComponent(function(component){if(component.type==source.type&&component.title==source.title){component.getEndpoint('source',source.endpoint).forEachConnection(function(connection){if(foundConnection==null&&connection.targetComponent.type==target.type&&connection.targetComponent.title==target.title&&connection.target.endpoint.name==target.endpoint){foundConnection=connection;}});}});return foundConnection;};ns.TutorialCatalogue.add('mashup-wiring-design',new Wirecloud.ui.Tutorial(utils.gettext("Behaviour Oriented Wiring"),[{type:'simpleDescription',title:utils.gettext("Behaviour Oriented Wiring Tutorial"),msg:utils.gettext("<p>Welcome to this Step-by-Step Interactive Tutorial!</p><p>In this tutorial you will learn how to build a <strong>behaviour oriented</strong> wiring configuration, a new feature added in WireCloud v0.8.0.</p><p>To do so, we are going to convert an application mashup created using a wiring configuration that doesn't use the behaviour engine to one that does.</p>")},{type:'autoAction',action:BA.uploadComponent('CoNWeT/BOW-Tutorial/0.0.3')},{type:'autoAction',action:BA.switch_view('workspace')},{type:'autoAction',action:BA.create_workspace({name:utils.gettext("BOW Tutorial"),mashup:'CoNWeT/BOW-Tutorial/0.0.3'})},{type:'simpleDescription',title:utils.gettext("Behaviour Oriented Wiring Tutorial"),msg:utils.gettext('<p><span class="label label-success">Great!</span> We are now ready to start. Let\'s start by identifying the behaviours we want to model.</p><div class="alert alert-info">We have installed a mashup into your account (<strong>BOW-Tutorial</strong>), you can remove it safely.</div>')},{type:'simpleDescription',title:utils.gettext("Step 1: Identify the behaviours"),msg:utils.gettext("<p>Our <strong>first behaviour (1 of 4)</strong> is going to be: Allow technician searches</p>")},{type:'autoAction',msg:utils.gettext("We want to be able to <strong>type the name of a technician</strong> ..."),elem:BS.workspaceView.widget_by_title("Search For"),pos:'topRight',action:BA.sleep(4000)},{type:'autoAction',msg:utils.gettext("... and <strong>find him</strong> in the technician list."),elem:BS.workspaceView.widget_by_title("Technician List"),pos:'topRight',action:BA.sleep(4000)},{type:'simpleDescription',title:utils.gettext("Step 1: Identify the behaviours"),msg:utils.gettext("<p>Our <strong>second behaviour (2 of 4)</strong> is going to be: Display techinican profiles.</p>")},{type:'autoAction',msg:utils.gettext("When we <strong>select a technician</strong> ..."),elem:BS.workspaceView.widget_by_title("Technician List"),pos:'topRight',action:BA.sleep(4000)},{type:'autoAction',msg:utils.gettext("... <strong>the profile of the technician should appear</strong> in the <em>Technician Profile</em> widget."),elem:BS.workspaceView.widget_by_title("Technician Profile"),pos:'topRight',action:BA.sleep(4000)},{type:'simpleDescription',title:utils.gettext("Step 1: Identify the behaviours"),msg:utils.gettext("<p>Our <strong>third behaviour (3 of 4)</strong> is going to be: Locate technicians.</p>")},{type:'autoAction',msg:utils.gettext("When we <strong>select a technician</strong> ..."),elem:BS.workspaceView.widget_by_title("Technician List"),pos:'topRight',action:BA.sleep(4000)},{type:'autoAction',msg:utils.gettext("... <strong>his location should appear</strong> in the <em>Technician Location</em> widget."),elem:BS.workspaceView.widget_by_title("Technician Location"),pos:'topLeft',action:BA.sleep(4000)},{type:'simpleDescription',title:utils.gettext("Step 1: Identify the behaviours"),msg:utils.gettext("<p>Our <strong>fourth and last behaviour (4 of 4)</strong> is going to be: Allow videocalls with the technicians.</p>")},{type:'autoAction',msg:utils.gettext("After <strong>selecting a technician</strong> ..."),elem:BS.workspaceView.widget_by_title("Technician List"),pos:'topRight',action:BA.sleep(4000)},{type:'autoAction',msg:utils.gettext("... we want to be able to <strong>call him</strong> using the <em>Technician VideoCall</em> widget."),elem:BS.workspaceView.widget_by_title("Technician VideoCall"),pos:'topLeft',action:BA.sleep(4000)},{type:'simpleDescription',title:utils.gettext("Behaviour Oriented Wiring Tutorial"),msg:utils.gettext("<p>Once identified the desired behaviours, we're going to create them in the Wiring Editor view.</p>")},{type:'userAction',msg:utils.gettext("Click <em>Wiring</em>"),elem:BS.toolbar_button('wc-show-wiring-button'),pos:'downRight'},{type:'simpleDescription',title:utils.gettext("Behaviour Oriented Wiring Tutorial"),msg:utils.gettext("<p>As you can see, we already have all the connections and components needed for implementing all the identified behaviours. The first step for converting this wiring configuration into a behaviour oriented configuration is enabling the behaviour engine.</p>")},{type:'userAction',msg:utils.gettext("Click <em>List Behaviours</em>"),elem:BS.wiringView.show_behaviours_button(),pos:'downRight'},{type:'autoAction',elem:BS.wiringView.show_behaviours_button(),action:BA.sleep(300)},{type:'userAction',msg:utils.gettext("Enable the behaviour engine"),elem:BS.wiringView.enable_behaviours_button(),pos:'topRight'},{type:'simpleDescription',title:utils.gettext("Step 2: Design the behaviours"),msg:utils.gettext("<p>When you enable the behaviour engine, a default behaviour will be created with all existing components and connections.</p><p>Let's continue <strong>creating the second behaviour</strong> (Display technician profiles).</p>")},{type:'userAction',msg:utils.gettext("Click <em>Create behaviour</em>"),elem:BS.wiringView.create_behaviour_button(),pos:'topRight'},{type:'autoAction',msg:utils.gettext("We fill the <strong>title</strong> ..."),elem:BS.form_field("title"),pos:'downRight',action:BA.input(utils.gettext("Display technician profiles"),{step:100})},{type:'autoAction',msg:utils.gettext("... and the <strong>description</strong>."),elem:BS.form_field("description"),pos:'downRight',action:BA.input(utils.gettext("Display technician profiles when they are selected in other widgets, e.g. in the technician list widget."),{step:100})},{type:'userAction',msg:utils.gettext("Click <em>Accept</em>"),elem:wiringView.accept_form(".we-new-behaviour-modal"),pos:'topRight'},{type:'userAction',msg:utils.gettext("Active the second behaviour"),elem:wiringView.behaviour_title_by_id(1),pos:'topRight'},{type:'simpleDescription',title:utils.gettext("Step 2: Design the behaviours"),msg:utils.gettext("<p>Now, we are going to add the components and the connections needed for implementing this behaviour taking them from the behaviour created by default.</p>")},{type:'userAction',msg:utils.gettext("Click <em>Add</em>"),elem:wiringView.connection_button_by_id({type:"operator",title:"Technical Service",endpoint:"technician"},{type:"widget",title:"Technician List",endpoint:"technician"},"add"),pos:'topRight'},{type:'userAction',msg:utils.gettext("Click <em>Add</em>"),elem:wiringView.connection_button_by_id({type:"widget",title:"Technician List",endpoint:"technician-profile"},{type:"widget",title:"Technician Profile",endpoint:"technician"},"add"),pos:'topRight'},{type:'simpleDescription',title:utils.gettext("Step 2: Design the behaviours"),msg:utils.gettext("<p><span class=\"label label-success\">Great!</span> We have finished our first behaviour. Have you noticed that when we added the connections also the affected components were added? That saved us some steps :).</p><p>Anyway, you can also directly add components in a similar way clicking on theirs <em>Add</em> button (take into account that associated connections are no added automatically in that case)</p><div class=\"alert alert-info\">The third and the fourth behaviour can be created the same way, so we are going to create them for you.</div>")},{type:'autoAction',msg:utils.gettext("The <strong>third behaviour</strong> was created."),elem:wiringView.auto_create_behaviour(utils.gettext("Locate technicians"),utils.gettext("Show the current location of the selected technician."),[{source:{type:"operator",title:"Technical Service",endpoint:"technician"},target:{type:"widget",title:"Technician List",endpoint:"technician"}},{source:{type:"widget",title:"Technician List",endpoint:"technician-location"},target:{type:"widget",title:"Technician Location",endpoint:"poiInputCenter"}}]),pos:'topRight',action:BA.sleep(2000)},{type:'autoAction',msg:utils.gettext("The <strong>fourth behaviour</strong> was created."),elem:wiringView.auto_create_behaviour(utils.gettext("Allow videocalls with the technicians"),utils.gettext("Allow to stablish a videocall with the selected technician."),[{source:{type:"operator",title:"Technical Service",endpoint:"technician"},target:{type:"widget",title:"Technician List",endpoint:"technician"}},{source:{type:"widget",title:"Technician List",endpoint:"technician-username"},target:{type:"widget",title:"Technician VideoCall",endpoint:"call-user"}}]),pos:'topRight',action:BA.sleep(2000)},{type:'simpleDescription',title:utils.gettext("Step 2: Design the behaviours"),msg:utils.gettext("<p>The last step is cleaning up our first behaviour as it currently contains all the components and connections of the wiring configuration. We have to convert it into our real first behaviour: Allow techinican searches.</p><p>We're going to start by updating the behaviour's details.</p>")},{type:'userAction',msg:utils.gettext("Active the first behaviour"),elem:wiringView.behaviour_title_by_id(0),pos:'topRight'},{type:'userAction',msg:utils.gettext("Click <em>Preferences</em>"),elem:BS.wiringView.show_behaviour_prefs_button(0),pos:'topRight'},{type:'userAction',msg:utils.gettext("Click <em>Settings</em>"),elem:BS.menu_item(utils.gettext("Settings")),pos:'topRight'},{type:'autoAction',msg:utils.gettext("We have to change the <strong>title</strong> ..."),elem:BS.form_field("title"),pos:'downRight',action:BA.input(utils.gettext("Allow technician searches"),{step:100})},{type:'autoAction',msg:utils.gettext("... and the <strong>description</strong>."),elem:BS.form_field("description"),pos:'downRight',action:BA.input(utils.gettext("Find a technician by a name at the technician list."),{step:100})},{type:'userAction',msg:utils.gettext("Click <em>Accept</em>"),elem:wiringView.accept_form(".behaviour-update-form"),pos:'topRight'},{type:'simpleDescription',title:utils.gettext("Step 2: Design the behaviours"),msg:utils.gettext("<p>In this case there are components and connections that are not part of this behaviour. Let's remove them.</p>")},{type:'userAction',msg:utils.gettext("Click <em>Remove</em>"),elem:wiringView.component_button_by_title("widget","Technician VideoCall","remove"),pos:'topRight'},{type:'userAction',msg:utils.gettext("Click <em>Remove</em>"),elem:wiringView.component_button_by_title("widget","Technician Profile","remove"),pos:'topRight'},{type:'userAction',msg:utils.gettext("Click <em>Remove</em>"),elem:wiringView.component_button_by_title("widget","Technician Location","remove"),pos:'topRight'},{type:'simpleDescription',title:utils.gettext("Step 2: Design the behaviours"),msg:utils.gettext("<p><span class=\"label label-success\">Great!</span> We have cleaned up this behaviour successfully. Have you noticed that when we removed the components also the affected connections were removed? That saved us, again, some steps :).</p><p>Anyway, you can also directly remove connections in a similar way clicking on their <em>Remove</em> button (take into account that associated components are no removed automatically in that case)</p>")},{type:'userAction',msg:utils.gettext("Click <em>Back</em>"),elem:BS.back_button(),pos:'downRight'},{type:'simpleDescription',title:utils.gettext("Try It Yourself"),msg:utils.gettext('<p><span class="label label-success">Congratulations!</span> you have finished your first <em>behaviour oriented</em> wiring configuration.</p><p>This is the end of this tutorial, but you can play with the example dashboard and check if it follow the described behaviours.</p>')}]));})(Wirecloud,StyledElements,StyledElements.Utils);;(function(se,utils){"use strict";var builder=new StyledElements.GUIBuilder();var WirecloudHeader=function WirecloudHeader(){this.wrapperElement=document.getElementById('wirecloud_header');this.app_bar=this.wrapperElement.querySelector('.wirecloud_app_bar');this.breadcrum=document.getElementById('wirecloud_breadcrum');this.backButton=new StyledElements.Button({class:'btn-large wc-back-button',iconClass:'fa fa-caret-left'});this.backButton.addEventListener('click',function(){this.currentView.goUp();}.bind(this));this.backButton.disable();this.backButton.insertInto(this.breadcrum.parentNode,this.breadcrum);this.menuButton=new StyledElements.PopupButton({class:'btn-large wc-menu-button',iconClass:'fa fa-reorder'});this.menuButton.disable();this.menuButton.insertInto(this.breadcrum.parentNode);this.toolbar=document.createElement('div');this.toolbar.className='btn-group wc-toolbar';this.app_bar.appendChild(this.toolbar);this.currentView=null;Wirecloud.addEventListener("contextloaded",this._initUserMenu.bind(this));Wirecloud.addEventListener("viewcontextchanged",this.refresh.bind(this));};WirecloudHeader.prototype._initUserMenu=function _initUserMenu(){var user_name,user_menu,wrapper,item;wrapper=document.querySelector('#wc-user-menu');if(wrapper==null){return;}else if(Wirecloud.contextManager.get('isanonymous')){var template=Wirecloud.currentTheme.templates['wirecloud/signin'];builder.parse(template,{username:user_name,avatar:avatar}).appendTo(wrapper);document.querySelectorAll(".wc-signin-button").forEach((button)=>{button.addEventListener('click',()=>{var login_url=Wirecloud.URLs.LOGIN_VIEW;var next_url=window.location.pathname+window.location.search+window.location.hash;if(next_url!=='/'){login_url+='?next='+encodeURIComponent(next_url);}
window.location=login_url;});});}else{user_name=Wirecloud.contextManager.get('username');var avatar=document.createElement('img');avatar.className="avatar";avatar.src=Wirecloud.contextManager.get('avatar');var template=Wirecloud.currentTheme.templates['wirecloud/user_menu'];builder.parse(template,{username:user_name,avatar:avatar,usermenu:(options)=>{this.user_button=new StyledElements.PopupButton(options);return this.user_button;}}).appendTo(wrapper);user_menu=this.user_button.getPopupMenu();item=new StyledElements.MenuItem(utils.gettext('Settings'),function(){var dialog=new Wirecloud.ui.PreferencesWindowMenu('platform',Wirecloud.preferences);dialog.show();});item.addIconClass('fa fa-gear');user_menu.append(item);if(Wirecloud.contextManager.get('isstaff')===true&&'DJANGO_ADMIN'in Wirecloud.URLs){item=new StyledElements.MenuItem(utils.gettext('Django Admin panel'),function(){window.open(Wirecloud.URLs.DJANGO_ADMIN,'_blank');});item.addIconClass('fa fa-tasks');user_menu.append(item);}
if(Wirecloud.contextManager.get('issuperuser')===true){item=new StyledElements.MenuItem(utils.gettext('Switch User'),function(){var dialog=new Wirecloud.ui.FormWindowMenu([{name:'username',label:utils.gettext('User'),type:'text',required:true}],utils.gettext('Switch User'),'wc-switch-user');var typeahead=new Wirecloud.ui.UserTypeahead({autocomplete:true});typeahead.bind(dialog.form.fieldInterfaces.username.inputElement);dialog.executeOperation=function(data){Wirecloud.io.makeRequest(Wirecloud.URLs.SWITCH_USER_SERVICE,{method:'POST',contentType:'application/json',postBody:JSON.stringify({username:data.username}),onSuccess:function(){document.location.assign(Wirecloud.URLs.ROOT_URL);}});}.bind(this);dialog.show();});item.addIconClass('fa fa-exchange');user_menu.append(item);}
item=new Wirecloud.ui.TutorialSubMenu();user_menu.append(item);item=new StyledElements.MenuItem(utils.gettext('Sign out'),Wirecloud.logout);item.addIconClass('fa fa-sign-out');user_menu.append(item);}};var paint_breadcrum_entry=function paint_breadcrum_entry(i,breadcrum_entry){var breadcrum_part,breadcrum_levels=['first_level','second_level','third_level'];if(typeof breadcrum_entry==='string'){breadcrum_entry={label:breadcrum_entry};}
breadcrum_part=document.createElement('span');breadcrum_part.textContent=breadcrum_entry.label;breadcrum_part.className=breadcrum_levels[i];if('class'in breadcrum_entry){breadcrum_part.classList.add(breadcrum_entry.class);}
this.breadcrum.appendChild(breadcrum_part);};WirecloudHeader.prototype._paintBreadcrumb=function _paintBreadcrumb(newView){var i,breadcrum;this.breadcrum.innerHTML='';if(newView!=null&&'getBreadcrumb'in newView){breadcrum=newView.getBreadcrumb();}else{return;}
if(breadcrum.length===0){return;}
paint_breadcrum_entry.call(this,0,breadcrum[0]);for(i=1;i<breadcrum.length;i+=1){this.breadcrum.appendChild(document.createTextNode('/'));paint_breadcrum_entry.call(this,i,breadcrum[i]);}};WirecloudHeader.prototype._paintToolbar=function _paintToolbar(newView){var buttons,i;this.toolbar.innerHTML="";if(newView==null||!('getToolbarButtons'in newView)){return;}
var btn_group=document.createElement('div');btn_group.className='btn-group';this.breadcrum.appendChild(btn_group);buttons=newView.getToolbarButtons();for(i=0;i<buttons.length;i++){buttons[i].addClassName('btn-large');buttons[i].addClassName('btn-primary');buttons[i].addIconClassName('fa-fw');buttons[i].insertInto(this.toolbar);}};WirecloudHeader.prototype._replaceMenu=function _replaceMenu(newView){var menu;if(newView!=null&&('getToolbarMenu'in newView)){menu=newView.getToolbarMenu();}
this.menuButton.replacePopupMenu(menu);this.menuButton.setDisabled(menu==null);};WirecloudHeader.prototype._notifyViewChange=function _notifyViewChange(newView){if(newView==null){this.backButton.disable();this.menuButton.disable();}else{this.currentView=newView;this.refresh();}};WirecloudHeader.prototype.refresh=function refresh(){this._paintBreadcrumb(this.currentView);this._paintToolbar(this.currentView);this._replaceMenu(this.currentView);var canGoUp=this.currentView!=null&&'goUp'in this.currentView;if(canGoUp&&typeof this.currentView.canGoUp==='function'){canGoUp=this.currentView.canGoUp();}
this.backButton.enabled=canGoUp;};Wirecloud.ui.WirecloudHeader=WirecloudHeader;})(StyledElements,Wirecloud.Utils);;!function(){"use strict";var a,b=new WeakMap;if("function"==typeof require&&null!=typeof exports){a=exports;var c=require("whatwg-url").URL}else{a={};var c=window.URL}a.endpoints={REGISTER_CONTEXT:"v1/registry/registerContext",DISCOVER_CONTEXT_AVAILABILITY:"v1/registry/discoverContextAvailability",SUBSCRIBE_CONTEXT_AVAILABILITY:"v1/registry/subscribeContextAvailability",UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION:"v1/registry/updateContextAvailabilitySubscription",UNSUBSCRIBE_CONTEXT_AVAILABILITY:"v1/registry/unsubscribeContextAvailability",QUERY_CONTEXT:"v1/queryContext",UPDATE_CONTEXT:"v1/updateContext",SUBSCRIBE_CONTEXT:"v1/subscribeContext",UPDATE_CONTEXT_SUBSCRIPTION:"v1/updateContextSubscription",UNSUBSCRIBE_CONTEXT:"v1/unsubscribeContext",CONTEXT_TYPES:"v1/contextTypes",v2:{BATCH_QUERY_OP:"v2/op/query",BATCH_UPDATE_OP:"v2/op/update",ENTITY_ATTRS_COLLECTION:"v2/entities/%(entityId)s/attrs",ENTITY_ATTR_ENTRY:"v2/entities/%(entityId)s/attrs/%(attribute)s",ENTITY_ATTR_VALUE_ENTRY:"v2/entities/%(entityId)s/attrs/%(attribute)s/value",ENTITY_COLLECTION:"v2/entities",ENTITY_ENTRY:"v2/entities/%(entityId)s",SUBSCRIPTION_COLLECTION:"v2/subscriptions",SUBSCRIPTION_ENTRY:"v2/subscriptions/%(subscriptionId)s",TYPE_COLLECTION:"v2/types",TYPE_ENTRY:"v2/types/%(typeId)s"}},a.proxy_endpoints={EVENTSOURCE_COLLECTION:"eventsource",CALLBACK_COLLECTION:"callbacks"};var d=function(a,b){return a.replace(/%\(\w+\)s/g,function(a){return String(b[a.slice(2,-2)])})},e=function(b,c,d,e,f){var g,h=null,i=null;null!=c&&(i="application/json",h=JSON.stringify(c)),g=JSON.parse(JSON.stringify(this.request_headers)),g.Accept="application/json",this.makeRequest(b,{method:null!=h?"POST":"GET",contentType:i,requestHeaders:g,parameters:f,postBody:h}).then(function(b){var c;if(200!==b.status)"function"==typeof e.onFailure&&(c=b instanceof a.ConnectionError?b:[0,502,504].indexOf(b.status)!==-1?new a.ConnectionError("Connection Error"):new a.InvalidResponseError("Unexpected error code: "+b.status),e.onFailure(c));else if("function"==typeof e.onSuccess){var f;try{try{f=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}f=d(f,e)}catch(a){return"function"==typeof e.onFailure&&e.onFailure(a),void("function"==typeof e.onComplete&&e.onComplete())}e.onSuccess.apply(null,f)}"function"==typeof e.onComplete&&e.onComplete()},function(b){if("function"==typeof e.onFailure){b instanceof a.ConnectionError||(b=new a.ConnectionError);try{e.onFailure(b)}catch(a){}}"function"==typeof e.onComplete&&e.onComplete()})},f=function(a,b){var c=a.trim().toLowerCase(),d=Object.keys(b),e=d.map(function(a){return a.trim().toLowerCase()}).indexOf(c);e!==-1&&delete b[d[e]]},g=function(b,c){null!=c.postBody&&(c.contentType="application/json",c.postBody=JSON.stringify(c.postBody));var d=JSON.parse(JSON.stringify(this.request_headers));d.Accept="application/json";for(var e in c.requestHeaders)null!=c.requestHeaders[e]&&(f(e,d),d[e]=c.requestHeaders[e]);return c.requestHeaders=d,this.makeRequest(b,c).then(function(b){return[0,502,504].indexOf(b.status)!==-1?Promise.reject(new a.ConnectionError):Promise.resolve(b)},function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})},h=function(a){var b,c;return c="string"==typeof a.isPattern&&"true"===a.isPattern.trim().toLowerCase()||a.isPattern===!0,b={id:""+a.id,isPattern:""+c},null!=a.type&&(b.type=""+a.type),b},i=function(a){var b,c,d;if("polygon"in a.value){for(b={polygon:{vertices:[]}},c=0;c<a.value.polygon.vertices.length;c++)d=a.value.polygon.vertices[c],b.polygon.vertices.push({latitude:""+d.latitude,longitude:""+d.longitude});a.value.polygon.inverted&&(b.polygon.inverted="true")}else"circle"in a.value&&(b={circle:{centerLatitude:""+a.value.circle.centerLatitude,centerLongitude:""+a.value.circle.centerLongitude,radius:a.value.circle.radius}},a.value.circle.inverted&&(b.circle.inverted="true"));return b},j=function(a){var b,c;if(b={scopes:[]},Array.isArray(a.scopes))for(c=0;c<a.scopes.length;c++)b.scopes.push({type:a.scopes[c].type,value:i(a.scopes[c])});return b},k=function(a){var b,c;for(b=[],c=0;c<a.length;c++)b.push({name:""+a[c].name,type:""+a[c].type,value:""+a[c].value});return b},l=function(a,b,c,d,e){var f,g,i,j;for(f={contextRegistrations:[{entities:[],attributes:[],providingApplication:d}],duration:""+c},g=0;g<a.length;g+=1)f.contextRegistrations[0].entities.push(h(a[g]));for(g=0;g<b.length;g+=1)i=b[g],j={name:i.name,isDomain:"false"},null!=i.type&&(j.type=""+i.type),f.contextRegistrations[0].attributes.push(j);return null!=e&&(f.registrationId=""+e),f},m=function(a,b,c){var d,e;for(d={entities:[]},e=0;e<a.length;e+=1)d.entities.push(h(a[e]));if(Array.isArray(b)&&b.length>0)for(d.attributes=[],e=0;e<b.length;e+=1)d.attributes.push(""+b[e]);return null!=c&&(d.restriction=j(c)),d},n=function(a,b){var c,d,e,f,g,i,j,l,m;for(c={contextElements:[],updateAction:a},d=0;d<b.length;d+=1){if(f=h(b[d].entity),i=b[d].attributes,null!=i)for(g=f.attributes=[],e=0;e<i.length;e+=1)j=i[e],l={name:""+j.name},null!=j.type&&(l.type=""+j.type),"DELETE"!==a&&(m=null!=j.value?j.value:null!=j.contextValue?j.contextValue:null,l.value=m),Array.isArray(j.metadata)&&j.metadata.length>0&&(l.metadatas=k(j.metadata)),g.push(l);c.contextElements.push(f)}return c},o=function(a,b){var c,d;for(c={entities:[],attributes:b},d=0;d<a.length;d+=1)c.entities.push(h(a[d]));return c},p=function(a,b,c,d,e,f){var g,i;for(g=e?{entities:[],subscriptionId:e}:{entities:[],reference:f},i=0;i<a.length;i+=1)g.entities.push(h(a[i]));return Array.isArray(b)&&b.length>0&&(g.attributes=b),null!=c&&(g.duration=""+c),null!=d&&(g.restriction=j(d)),g},q=function(a){return{subscriptionId:a}},r=function(a,b,c,d,e,f,g){var i,j,k,l;if(a)i={subscriptionId:a};else{for(i={entities:[],reference:g},j=0;j<b.length;j+=1)i.entities.push(h(b[j]));Array.isArray(c)&&(i.attributes=c)}if(null!=d&&(i.duration=""+d),Array.isArray(f))for(i.notifyConditions=[],j=0;j<f.length;j+=1)k=f[j],l={type:k.type},i.notifyConditions.push(l),Array.isArray(k.condValues)&&(l.condValues=k.condValues);return null!=e&&(i.throttling=""+e),i},s=function(a){return{subscriptionId:a}},t=function(a,b,c){return null!=a.type&&(c.type=a.type,delete a.type),b.keyValues===!0&&(c.options="keyValues"),delete a.id,a},u=function(b){if(D(b),"object"!=typeof b||"string"!=typeof b.registrationId||"string"!=typeof b.duration)throw new a.InvalidResponseError("The server returned an invalid json structure");return[b]},v=function(a){var b,c,d,e=[];for(d=0;d<a.length;d+=1)b=a[d].contextRegistration,c={entities:[],attributes:[],providingApplication:b.providingApplication},null!=b.entities&&(c.entities=b.entities),null!=b.attributes&&(c.attributes=b.attributes),e.push(c);return e},w=function(b){if("object"!=typeof b||Array.isArray(b))throw new a.InvalidResponseError("The server returned an invalid json structure");if(D(b),!Array.isArray(b.contextRegistrationResponses))throw new a.InvalidResponseError("The server returned an invalid json structure");return[v(b.contextRegistrationResponses)]},x=function(b){if(D(b),"string"!=typeof b.subscriptionId)throw new a.InvalidResponseError("The server returned an invalid json structure");if("duration"in b&&"string"!=typeof b.duration)throw new a.InvalidResponseError("The server returned an invalid json structure");return[b]},y=function(b){if("object"!=typeof b||Array.isArray(b)||!("subscriptionId"in b))throw new a.InvalidResponseError("The server returned an invalid json structure");return[{subscriptionId:b.subscriptionId,statusCode:C(b)}]},z=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;for(f=!!c.flat,j=f?{}:[],n=[],b&&(i=""),g=0;g<a.length;g+=1){if(d=a[g].contextElement,m=C(a[g]),e=f?{}:{entity:null,attributes:[]},200===m.code&&f?(e.id=d.id,e.type=d.type):e.entity={id:d.id,type:d.type},null!=d.attributes)for(h=0;h<d.attributes.length;h+=1)k=d.attributes[h],b||(i=k.value),f?e[k.name]=i:(l={name:k.name,type:k.type},b||(l.value=i),null!=k.metadatas&&(l.metadata=k.metadatas),e.attributes.push(l));200===m.code?f?j[d.id]=e:j.push(e):(b&&(e.statusCode=m),n.push(e))}return[j,n]},A=function(b,c){var d,e,f;if(e=C(b),404===e.code){if("string"==typeof e.details&&(d=e.details.match(F),d&&(f=e.details={text:e.details,matches:parseInt(d[1]),offset:parseInt(d[2])})),c.details&&(f={count:0}),0!==c.offset)throw e;return[[],f]}if(200!==e.code)throw new a.InvalidResponseError("Unexpected error code");return"string"==typeof e.details&&(d=e.details.match(E),d&&(f={count:parseInt(d[1],10)})),[b.types,f]},B=function(b){var c;if("object"!=typeof b||Array.isArray(b))throw new a.InvalidResponseError("The server returned an invalid json structure");if(c=C(b),404===c.code)throw new a.NotFoundError({details:b,message:c.reasonPhrase});if(200!==c.code)throw new a.InvalidResponseError("Unexpected error code");return delete b.statusCode,[b]},C=function(b){if(!("statusCode"in b))throw new a.InvalidResponseError("missing response status code info");return b.statusCode.code=parseInt(b.statusCode.code,10),b.statusCode},D=function(b){if("errorCode"in b)throw new a.InvalidRequestError(parseInt(b.errorCode.code,10),b.errorCode.reasonPhrase,b.errorCode.details)},E=new RegExp("Count: (\\d+)"),F=new RegExp("Number of matching entities: (\\d+). Offset is (\\d+)"),G=function(b,c){var d,e,f;if("object"!=typeof b||Array.isArray(b))throw new a.InvalidResponseError("The server returned an invalid json structure");try{D(b)}catch(a){switch(a.code){case 200:e=a.details.match(E),e&&(d={count:parseInt(e[1],10)});break;case 404:if(f=c.flat?{}:[],e=a.details.match(F),e?d=a.details={text:a.details,matches:parseInt(e[1]),offset:parseInt(e[2])}:c.details===!0&&0===c.offset&&(d=a.details={count:0}),0!==c.offset)throw a;return[f,d];default:throw a}}if(!Array.isArray(b.contextResponses))throw new a.InvalidResponseError("The server returned an invalid json structure");return[z(b.contextResponses,!1,c)[0],d]},H=function(a,b){return D(a),z(a.contextResponses,!0,b)},I=function(b){if(D(b),"string"!=typeof b.subscriptionId)throw new a.InvalidResponseError("The server returned an invalid json structure");if("duration"in b&&"string"!=typeof b.duration)throw new a.InvalidResponseError("The server returned an invalid json structure");if("throttling"in b&&"string"!=typeof b.throttling)throw new a.InvalidResponseError("The server returned an invalid json structure");return b},J=function(b){if(D(b),"object"!=typeof b||"object"!=typeof b.subscribeResponse)throw new a.InvalidResponseError("The server returned an invalid json structure");return[I(b.subscribeResponse)]},K=function(b){if(D(b),"object"!=typeof b||"object"!=typeof b.subscribeResponse)throw new a.InvalidResponseError("The server returned an invalid json structure");return[I(b.subscribeResponse)]},L=function(b){if(D(b),"object"!=typeof b||"string"!=typeof b.subscriptionId)throw new a.InvalidResponseError("The server returned an invalid json structure");return b.statusCode=C(b),[b]},M=function(b,c){if("object"!=typeof b||Array.isArray(b)||!Array.isArray(b.contextRegistrationResponses))throw new a.InvalidResponseError("The server returned an invalid json structure");return[v(b.contextRegistrationResponses)]},N=function(a,b){var c={};if(null!=a.limit){if("number"!=typeof a.limit||a.limit<20)throw new TypeError("invalid value for the limit option");c.limit=a.limit}if(null!=a.offset){if("number"!=typeof a.offset||a.offset<0)throw new TypeError("invalid value for the offset option");c.offset=a.offset}else a.offset=0;if(null!=b)if(null!=a.details){if("boolean"!=typeof a.details)throw new TypeError("invalid value for the details option");a.details?c.details="on":c.details="off"}else c.details=b,a.details="on"===b;return c},O=function(a,b){var c={};if(null!=a.limit){if("number"!=typeof a.limit||!Number.isInteger(a.limit)||a.limit<1)throw new TypeError("invalid value for the limit option");c.limit=a.limit}else a.limit=20;if(null!=a.offset){if("number"!=typeof a.offset||!Number.isInteger(a.offset)||a.offset<0)throw new TypeError("invalid value for the offset option");c.offset=a.offset}else a.offset=0;if(null!=a.count){if("boolean"!=typeof a.count)throw new TypeError("invalid value for the count option");b.push("count")}return c},P=function(a){if("application/json"!==a.getHeader("Content-Type"))throw new TypeError("Unexpected response mimetype");return JSON.parse(a.responseText)};a.parseNotifyContextRequest=function(a,b){return{elements:z(a.contextResponses,!1,b)[0],subscriptionId:a.subscriptionId,originator:a.originator}};var Q=function(){return this.makeRequest(new c(a.proxy_endpoints.EVENTSOURCE_COLLECTION,this.url),{supportsAccessControl:!0,method:"POST"}).then(function(c){if([0,502,504].indexOf(c.status)!==-1)return b.get(this).promise=null,Promise.reject(new a.ConnectionError);if(201!==c.status)return b.get(this).promise=null,Promise.reject(new a.InvalidResponseError("Unexpected error code: "+c.status));var d=b.get(this);return d.source_url=c.getHeader("Location"),null==d.source_url?Promise.reject(new a.InvalidResponseError("Missing Location Header")):R.call(this)}.bind(this),function(c){return b.get(this).promise=null,c instanceof a.ConnectionError||(c=new a.ConnectionError),Promise.reject(c)}.bind(this))},R=function(){return new Promise(function(c,d){var e,f=null,g=b.get(this),h=function(a){var b=JSON.parse(a.data);clearTimeout(e),g.promise=null,g.connection_id=b.id,g.source.removeEventListener("init",f,!0),g.source.addEventListener("notification",function(a){var b=JSON.parse(a.data);g.callbacks[b.callback_id].method(b.payload,b.headers)}.bind(this),!0),c()};f=h.bind(this),g.source=new EventSource(g.source_url),g.source.addEventListener("init",f,!0),e=setTimeout(function(){g.promise=null,g.source.close(),g.source=null,d(new a.ConnectionError("Connection timeout"))}.bind(this),3e4)}.bind(this))},S=function(){var a={},c=b.get(this).callbacks;for(var d in c)a[d]=c[d].subscription;return a},T=function(){var a=b.get(this);return null!=a.source&&null!=a.connection_id},U=function(){return null!==b.get(this).promise},V=function(){return b.get(this).connection_id},W=function(){var a={},c=b.get(this).callbacksBySubscriptionId;for(var d in c)a[d]=c[d].callback_id;return a};a.ProxyConnection=function(a,d){try{a=new c(a)}catch(a){throw new TypeError("invalid url parameter")}if("http:"!==a.protocol&&"https:"!==a.protocol)throw new TypeError("unsupported protocol: "+a.protocol.substr(0,a.protocol.length-1));"/"!==a.pathname[a.pathname.length-1]&&(a.pathname+="/"),this.makeRequest=d,b.set(this,{callbacks:{},callbacksBySubscriptionId:{},connected:!1,connection_id:null,promise:null,source:null}),Object.defineProperties(this,{callbackSubscriptions:{get:S},connected:{get:T},connecting:{get:U},connection_id:{get:V},subscriptionCallbacks:{get:W},url:{value:a}})},a.ProxyConnection.prototype.connect=function(){if(this.connected===!0)return Promise.resolve();var a=b.get(this);return null===a.promise&&(a.promise=Q.call(this)),a.promise},a.ProxyConnection.prototype.requestCallback=function(c){if("function"!=typeof c)throw new TypeError("callback parameter must be a function");return this.connect().then(function(){return this.makeRequest(this.url+a.proxy_endpoints.CALLBACK_COLLECTION,{supportsAccessControl:!0,method:"POST",contentType:"application/json",postBody:JSON.stringify({connection_id:this.connection_id})}).then(function(d){if([200,201].indexOf(d.status)===-1)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+d.status));var e=JSON.parse(d.responseText),f=b.get(this);return f.callbacks[e.callback_id]={callback_id:e.callback_id,method:c,subscription:null},Promise.resolve(e)}.bind(this),function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})}.bind(this))},a.ProxyConnection.prototype.close=function(){if(this.connected===!1)return Promise.resolve();var c=b.get(this);return this.makeRequest(c.source_url,{supportsAccessControl:!0,method:"DELETE"}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):(c.source.close(),c.source=null,c.connection_id=null,c.callbacks={},void(c.callbacksBySubscriptionId={}))}.bind(this),function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})},a.ProxyConnection.prototype.closeCallback=function(b){return this.makeRequest(this.url+a.proxy_endpoints.CALLBACK_COLLECTION+"/"+b,{supportsAccessControl:!0,method:"DELETE"}).then(function(c){return 204!==c.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+c.status)):void this.purgeCallback(b)}.bind(this),function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})},a.ProxyConnection.prototype.associateSubscriptionId=function(a,c){var d=b.get(this);if(!(a in d.callbacks))return this;if(null!=d.callbacks[a].subscription)throw new TypeError("Already associated callback");return d.callbacksBySubscriptionId[c]=d.callbacks[a],d.callbacks[a].subscription=c,this},a.ProxyConnection.prototype.closeSubscriptionCallback=function(a){var c=b.get(this);return a in c.callbacksBySubscriptionId?this.closeCallback(c.callbacksBySubscriptionId[a].callback_id):Promise.resolve()},a.ProxyConnection.prototype.purgeCallback=function(a){var c=b.get(this);if(a in c.callbacks){var d=c.callbacks[a].subscription;null!=d&&delete c.callbacksBySubscriptionId[d],delete c.callbacks[a]}},a.ConnectionError=function(a){this.name="ConnectionError",this.message=a||"Connection Error"},a.ConnectionError.prototype=new Error,a.ConnectionError.prototype.constructor=a.ConnectionError,a.InvalidRequestError=function(a,b,c){this.name="InvalidRequest",this.code=a,this.message=b||"",this.details=c||""},a.InvalidRequestError.prototype=new Error,a.InvalidRequestError.prototype.constructor=a.InvalidRequestError,a.InvalidResponseError=function(a,b){this.name="InvalidResponse",this.message=a||"",this.correlator=b},a.InvalidResponseError.prototype=new Error,a.InvalidResponseError.prototype.constructor=a.InvalidResponseError,a.NotFoundError=function(a){this.name="NotFound",this.message=a.message||"",this.details=a.details||"",this.correlator=a.correlator||null},a.NotFoundError.prototype=new Error,a.NotFoundError.prototype.constructor=a.NotFoundError,a.ProxyConnectionError=function(a){this.name="ProxyConnectionError",this.cause=a},a.ProxyConnectionError.prototype=new Error,a.ProxyConnectionError.prototype.constructor=a.ProxyConnectionError,a.Connection=function(b,d){try{b=new c(b)}catch(a){throw new TypeError("invalid url parameter")}if("http:"!==b.protocol&&"https:"!==b.protocol)throw new TypeError("unsupported protocol: "+b.protocol.substr(0,b.protocol.length-1));"/"!==b.pathname[b.pathname.length-1]&&(b.pathname+="/"),null==d&&(d={}),null!=d.request_headers?this.request_headers=d.request_headers:this.request_headers={},null!=d.service&&(f("FIWARE-Service",this.request_headers),this.request_headers["FIWARE-Service"]=d.service),null!=d.servicepath&&(f("FIWARE-ServicePath",this.request_headers),this.request_headers["FIWARE-ServicePath"]=d.servicepath),"function"==typeof d.requestFunction&&(this.makeRequest=d.requestFunction),d.ngsi_proxy_connection instanceof a.ProxyConnection?this.ngsi_proxy=d.ngsi_proxy_connection:"string"==typeof d.ngsi_proxy_url&&(this.ngsi_proxy=new a.ProxyConnection(d.ngsi_proxy_url,this.makeRequest)),Object.defineProperties(this,{url:{value:b},v1:{value:this},v2:{value:new a.Connection.V2(this)}})},a.Connection.prototype.createRegistration=function(b,d,f,g,h){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=d&&!Array.isArray(d))throw new TypeError("attributes parameter must be an array or null");null==d&&(d=[]),null==h&&(h={});var i=l(b,d,f,g),j=new c(a.endpoints.REGISTER_CONTEXT,this.url);e.call(this,j,i,u,h)},a.Connection.prototype.updateRegistration=function(b,d,f,g,h,i){if(!Array.isArray(d)||0===d.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=f&&!Array.isArray(f))throw new TypeError("attributes parameter must be an array or null");null==f&&(f=[]),null==i&&(i={});var j=l(d,f,g,h,b),k=new c(a.endpoints.REGISTER_CONTEXT,this.url);return e.call(this,k,j,u,i)},a.Connection.prototype.cancelRegistration=function(a,b){if(null==a)throw new TypeError("regId parameter cannot be null");this.updateRegistration(a,[{id:"canceled registration"}],[],"PT0H","http://canceled.registration.com",b)},a.Connection.prototype.discoverAvailability=function(b,d,f){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=d&&!Array.isArray(d))throw new TypeError("attributeNames parameter must be an array or null");null==d&&(d=[]),null==f&&(f={});var g=o(b,d),h=new c(a.endpoints.DISCOVER_CONTEXT_AVAILABILITY,this.url);e.call(this,h,g,w,f)},a.Connection.prototype.createAvailabilitySubscription=function(b,d,f,g,h){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=d&&!Array.isArray(d))throw new TypeError("attributeNames parameter must be an array or null");if(null==h)throw new TypeError("Missing options parameter");if("string"!=typeof h.onNotify&&"function"!=typeof h.onNotify)throw new TypeError("Invalid onNotify callback");if("function"==typeof h.onNotify&&null==this.ngsi_proxy)throw new TypeError("A ngsi-proxy is needed for using local onNotify callbacks");var i=new c(a.endpoints.SUBSCRIBE_CONTEXT_AVAILABILITY,this.url);if("function"==typeof h.onNotify&&null!=this.ngsi_proxy){var j=function(a){var b=JSON.parse(a),c=M(b,h);h.onNotify(c)};this.ngsi_proxy.requestCallback(j).then(function(a){var c=p(b,d,f,g,null,a.url),j=h.onFailure;h.onFailure=function(){this.ngsi_proxy.closeCallback(a.callback_id),"function"==typeof j&&j.apply(this,arguments)}.bind(this);var k=h.onSuccess;h.onSuccess=function(b){this.ngsi_proxy.associateSubscriptionId(a.callback_id,b.subscriptionId),"function"==typeof k&&k(b)}.bind(this),e.call(this,i,c,x,h)}.bind(this),function(){"function"==typeof h.onFailure&&h.onFailure()})}else{var k=p(b,d,f,g,null,h.onNotify);e.call(this,i,k,x,h)}},a.Connection.prototype.updateAvailabilitySubscription=function(b,d,f,g,h,i){if(null==b)throw new TypeError("subId parameter cannot be null");if(!Array.isArray(d)||0===d.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=f&&!Array.isArray(f))throw new TypeError("attributeNames parameter must be an array or null");null==i&&(i={});var j=p(d,f,g,h,b),k=new c(a.endpoints.UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION,this.url);e.call(this,k,j,x,i)},a.Connection.prototype.cancelAvailabilitySubscription=function(b,d){if(null==b)throw new TypeError("subId parameter cannot be null");null==d&&(d={});var f=q(b),g=new c(a.endpoints.UNSUBSCRIBE_CONTEXT_AVAILABILITY,this.url);e.call(this,g,f,y,d)},a.Connection.prototype.query=function(b,d,f){var g,h,i;if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=d&&!Array.isArray(d))throw new TypeError("attributesName must be null or an array");null==d&&(d=[]),null==f&&(f={}),h=N(f,"off"),g=new c(a.endpoints.QUERY_CONTEXT,this.url),i=m(b,d,f.restriction),e.call(this,g,i,G,f,h)},a.Connection.prototype.updateAttributes=function(b,d){if(!Array.isArray(b)||0===b.length)throw new TypeError("update parameter must be a non-empty array");null==d&&(d={});var f=n("UPDATE",b),g=new c(a.endpoints.UPDATE_CONTEXT,this.url);e.call(this,g,f,H,d)},a.Connection.prototype.addAttributes=function(b,d){if(!Array.isArray(b)||0===b.length)throw new TypeError("toAdd parameter must be a non-empty array");null==d&&(d={});var f=n("APPEND",b),g=new c(a.endpoints.UPDATE_CONTEXT,this.url);e.call(this,g,f,H,d)},a.Connection.prototype.deleteAttributes=function(b,d){if(!Array.isArray(b)||0===b.length)throw new TypeError("toDelete parameter must be a non-empty array");null==d&&(d={});var f=n("DELETE",b),g=new c(a.endpoints.UPDATE_CONTEXT,this.url);e.call(this,g,f,H,d)},a.Connection.prototype.createSubscription=function(b,d,f,g,h,i){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=d&&!Array.isArray(d))throw new TypeError("attributeNames parameter must be an array or null");if(null==i)throw new TypeError("Missing options parameter");if("string"!=typeof i.onNotify&&"function"!=typeof i.onNotify)throw new TypeError("Invalid onNotify callback");if("function"==typeof i.onNotify&&null==this.ngsi_proxy)throw new TypeError("A ngsi-proxy is needed for using local onNotify callbacks");var j=new c(a.endpoints.SUBSCRIBE_CONTEXT,this.url);if("function"==typeof i.onNotify&&null!=this.ngsi_proxy){var k=function(b){var c=JSON.parse(b),d=a.parseNotifyContextRequest(c,i);i.onNotify(d)};this.ngsi_proxy.requestCallback(k).then(function(a){var c=r(null,b,d,f,g,h,a.url),k=i.onFailure;i.onFailure=function(){this.ngsi_proxy.closeCallback(a.callback_id),"function"==typeof k&&k.apply(this,arguments)}.bind(this);var l=i.onSuccess;i.onSuccess=function(b){this.ngsi_proxy.associateSubscriptionId(a.callback_id,b.subscriptionId),"function"==typeof l&&l(b)}.bind(this),e.call(this,j,c,J,i)}.bind(this),function(b){if("function"==typeof i.onFailure){var c=new a.ProxyConnectionError(b);try{i.onFailure(c)}catch(a){}}if("function"==typeof i.onComplete)try{i.onComplete()}catch(a){}})}else{var l=r(null,b,d,f,g,h,i.onNotify);e.call(this,j,l,J,i)}},a.Connection.prototype.updateSubscription=function(b,d,f,g,h){if(null==b)throw new TypeError("subId parameter cannot be null");null==h&&(h={});var i=r(b,null,null,d,f,g),j=new c(a.endpoints.UPDATE_CONTEXT_SUBSCRIPTION,this.url);e.call(this,j,i,K,h)},a.Connection.prototype.cancelSubscription=function(b,d){if(null==b)throw new TypeError("subId parameter cannot be null");if(null==d&&(d={}),this.ngsi_proxy){var f=d.onSuccess;d.onSuccess=function(a){this.ngsi_proxy.closeSubscriptionCallback(a.subscriptionId),"function"==typeof f&&f(a)}.bind(this)}var g=s(b),h=new c(a.endpoints.UNSUBSCRIBE_CONTEXT,this.url);e.call(this,h,g,L,d)},a.Connection.prototype.getAvailableTypes=function(b){var d=new c(a.endpoints.CONTEXT_TYPES,this.url),f=N(b,"on");e.call(this,d,null,A,b,f)},a.Connection.prototype.getTypeInfo=function(b,d){if(null==b)throw new TypeError("Invalid type parameter");var f=new c(a.endpoints.CONTEXT_TYPES+"/"+encodeURIComponent(b),this.url);e.call(this,f,null,B,d)},a.Connection.V2=function(a){b.set(this,a)},a.Connection.V2.prototype.listEntities=function(d){if(null==d&&(d={}),null!=d.id&&null!=d.idPattern)throw new TypeError("id and idPattern options cannot be used at the same time");if(null!=d.type&&null!=d.typePattern)throw new TypeError("type and typePattern options cannot be used at the same time");var e=b.get(this),f=new c(a.endpoints.v2.ENTITY_COLLECTION,e.url),h=[],i=O(d,h);return d.keyValues===!0&&h.push("keyValues"),d.values===!0&&h.push("values"),d.unique===!0&&h.push("unique"),0!==h.length&&(i.options=h.join(",")),i.attrs=d.attrs,i.id=d.id,i.idPattern=d.idPattern,i.orderBy=d.orderBy,i.metadata=d.metadata,i.mq=d.mq,i.q=d.q,i.type=d.type,i.typePattern=d.typePattern,i.georel=d.georel,i.geometry=d.geometry,i.coords=d.coords,g.call(e,f,{method:"GET",parameters:i,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));try{var e=JSON.parse(b.responseText)}catch(b){return Promise.reject(new a.InvalidResponseError("Server returned invalid JSON content",c))}var f={results:e,limit:d.limit,offset:d.offset,correlator:c};return d.count===!0&&(f.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(f)})},a.Connection.V2.prototype.createEntity=function(d,e){null==e&&(e={});var f=b.get(this),h={};e.keyValues===!0&&(h.options="keyValues");var i=new c(a.endpoints.v2.ENTITY_COLLECTION,f.url);return g.call(f,i,{method:"POST",postBody:d,parameters:h,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");return 201!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c,entity:d,location:b.getHeader("Location")})})},a.Connection.V2.prototype.getEntity=function(e){if(null==e)throw new TypeError("missing options parameter");"string"==typeof e&&(e={id:e});var f=b.get(this),h=new c(d(a.endpoints.v2.ENTITY_ENTRY,{entityId:encodeURIComponent(e.id)}),f.url),i={};return null!=e.type&&(i.type=e.type),e.keyValues===!0&&(i.options="keyValues"),g.call(f,h,{method:"GET",parameters:i,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));try{var d=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content",c)}return Promise.resolve({correlator:c,entity:d})})},a.Connection.V2.prototype.getEntityAttributes=function(e){if(null==e)throw new TypeError("missing options parameter");"string"==typeof e&&(e={id:e});var f=b.get(this),h=new c(d(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(e.id)}),f.url),i={};return null!=e.type&&(i.type=e.type),e.keyValues===!0&&(i.options="keyValues"),g.call(f,h,{method:"GET",parameters:i,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));try{var d=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content",c)}return Promise.resolve({attributes:d,correlator:c})})},a.Connection.V2.prototype.appendEntityAttributes=function(e,f){null==f&&(f={});var h=b.get(this),i=new c(d(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(e.id)}),h.url),j={},k=[];return delete e.id,null!=e.type&&(j.type=e.type,delete e.type),f.strict===!0&&k.push("append"),f.keyValues===!0&&k.push("keyValues"),k.length>0&&(j.options=k.join(",")),g.call(h,i,{method:"POST",parameters:j,postBody:e,requestHeaders:{"FIWARE-Correlator":f.correlator,"FIWARE-Service":f.service,"FIWARE-ServicePath":f.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c})})},a.Connection.V2.prototype.updateEntityAttributes=function(e,f){if(null==f&&(f={}),null==e)throw new TypeError("missing changes parameter");var h=b.get(this),i=new c(d(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(e.id)}),h.url),j={};return delete e.id,null!=e.type&&(j.type=e.type,delete e.type),f.keyValues===!0&&(j.options="keyValues"),g.call(h,i,{method:"PATCH",parameters:j,postBody:e,requestHeaders:{"FIWARE-Correlator":f.correlator,"FIWARE-Service":f.service,"FIWARE-ServicePath":f.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c})})},a.Connection.V2.prototype.replaceEntityAttributes=function(e,f){null==f&&(f={});var h=b.get(this),i=new c(d(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(e.id)}),h.url),j={},k=t(e,f,j);return g.call(h,i,{method:"PUT",postBody:k,parameters:j,requestHeaders:{"FIWARE-Correlator":f.correlator,"FIWARE-Service":f.service,"FIWARE-ServicePath":f.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c,entity:e})})},a.Connection.V2.prototype.deleteEntity=function(e){if(null==e)throw new TypeError("missing options parameter");"string"==typeof e&&(e={id:e});var f=b.get(this),h=new c(d(a.endpoints.v2.ENTITY_ENTRY,{entityId:encodeURIComponent(e.id)}),f.url),i={};return null!=e.type&&(i.type=e.type),g.call(f,h,{method:"DELETE",parameters:i,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(404===b.status){try{var d=P(b)}catch(b){return Promise.reject(new a.InvalidResponseError(null,c))}return Promise.reject(new a.NotFoundError({message:d.description,correlator:c}))}return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c})})},a.Connection.V2.prototype.getEntityAttribute=function(c){if(null==c)throw new TypeError("missing options parameter");if(null==c.id)throw new TypeError("missing id option");if(null==c.attribute)throw new TypeError("missing attribute option");var e=b.get(this),f=e.url+d(a.endpoints.v2.ENTITY_ATTR_ENTRY,{entityId:encodeURIComponent(c.id),attribute:encodeURIComponent(c.attribute)}),h={};return null!=c.type&&(h.type=c.type),g.call(e,f,{method:"GET",parameters:h,requestHeaders:{"FIWARE-Correlator":c.correlator,"FIWARE-Service":c.service,"FIWARE-ServicePath":c.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status),c);try{var d=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content",c)}return Promise.resolve({correlator:c,attribute:d})})},a.Connection.V2.prototype.replaceEntityAttribute=function(c,e){if(null==c)throw new TypeError("missing changes parameter");if(null==e&&(e={attribute:c.attribute,correlator:c.correlator,id:c.id,service:c.service,servicepath:c.servicepath,type:c.type}),null==e.id)throw new TypeError("missing id option");if(null==e.attribute)throw new TypeError("missing attribute option");var f={value:c.value,metadata:c.metadata},h=b.get(this),i=h.url+d(a.endpoints.v2.ENTITY_ATTR_ENTRY,{entityId:encodeURIComponent(e.id),attribute:encodeURIComponent(e.attribute)}),j={};return null!=e.type&&(j.type=e.type),g.call(h,i,{method:"PUT",parameters:j,postBody:f,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c,attribute:f})})},a.Connection.V2.prototype.deleteEntityAttribute=function(c){if(null==c)throw new TypeError("missing options parameter");if(null==c.id)throw new TypeError("missing id option");if(null==c.attribute)throw new TypeError("missing attribute option");var e=b.get(this),f=e.url+d(a.endpoints.v2.ENTITY_ATTR_ENTRY,{entityId:encodeURIComponent(c.id),attribute:encodeURIComponent(c.attribute)}),h={};return null!=c.type&&(h.type=c.type),g.call(e,f,{method:"DELETE",parameters:h,requestHeaders:{"FIWARE-Correlator":c.correlator,"FIWARE-Service":c.service,"FIWARE-ServicePath":c.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(404===b.status){try{var d=P(b)}catch(b){return Promise.reject(new a.InvalidResponseError(null,c))}return Promise.reject(new a.NotFoundError({message:d.description,correlator:c}))}return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c})})},a.Connection.V2.prototype.getEntityAttributeValue=function(c){if(null==c)throw new TypeError("missing options parameter");if(null==c.id)throw new TypeError("missing id option");if(null==c.attribute)throw new TypeError("missing attribute option");var e=b.get(this),f=e.url+d(a.endpoints.v2.ENTITY_ATTR_VALUE_ENTRY,{entityId:encodeURIComponent(c.id),attribute:encodeURIComponent(c.attribute)}),h={};return null!=c.type&&(h.type=c.type),g.call(e,f,{method:"GET",parameters:h,requestHeaders:{Accept:"application/json, text/plain","FIWARE-Correlator":c.correlator,"FIWARE-Service":c.service,"FIWARE-ServicePath":c.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));try{var d=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content",c)}return Promise.resolve({correlator:c,value:d})})},a.Connection.V2.prototype.replaceEntityAttributeValue=function(c){if(null==c)throw new TypeError("missing options parameter");if(null==c.id)throw new TypeError("missing id option");if(null==c.attribute)throw new TypeError("missing attribute option");if("undefined"==typeof c.value)throw new TypeError("missing value option");var e=b.get(this),f=e.url+d(a.endpoints.v2.ENTITY_ATTR_VALUE_ENTRY,{entityId:encodeURIComponent(c.id),attribute:encodeURIComponent(c.attribute)}),h={};return null!=c.type&&(h.type=c.type),g.call(e,f,{method:"PUT",parameters:h,postBody:c.value,requestHeaders:{"FIWARE-Correlator":c.correlator,"FIWARE-Service":c.service,"FIWARE-ServicePath":c.servicepath}}).then(function(b){var d=b.getHeader("Fiware-correlator");return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,d)):Promise.resolve({correlator:d,value:c.value})})},a.Connection.V2.prototype.listTypes=function(d){null==d&&(d={});var e=b.get(this),f=new c(a.endpoints.v2.TYPE_COLLECTION,e.url),h=[],i=O(d,h);return d.values===!0&&h.push("values"),0!==h.length&&(i.options=h.join(",")),g.call(e,f,{method:"GET",parameters:i,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));var e={correlator:c,limit:d.limit,offset:d.offset,results:JSON.parse(b.responseText)};return d.count===!0&&(e.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(e)})},a.Connection.V2.prototype.getType=function(e){if(null==e)throw new TypeError("missing options parameter");"string"==typeof e&&(e={id:e});var f=b.get(this),h=new c(d(a.endpoints.v2.TYPE_ENTRY,{typeId:encodeURIComponent(e.id)}),f.url);return g.call(f,h,{method:"GET",requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));try{var d=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content",c)}return Promise.resolve({correlator:c,type:d})})},a.Connection.V2.prototype.listSubscriptions=function(d){null==d&&(d={});var e=b.get(this),f=new c(a.endpoints.v2.SUBSCRIPTION_COLLECTION,e.url),h=[],i=O(d,h);return 0!==h.length&&(i.options=h.join(",")),g.call(e,f,{method:"GET",parameters:i,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));var e={correlator:c,limit:d.limit,offset:d.offset,results:JSON.parse(b.responseText)};return d.count===!0&&(e.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(e)})},a.Connection.V2.prototype.createSubscription=function(d,e){var f,h,i=b.get(this);if(null==e&&(e={}),"object"!=typeof d)throw new TypeError("invalid subscription parameter");if("callback"in d.notification){if("function"!=typeof d.notification.callback)throw new TypeError("invalid callback configuration");var j=function(a,b){var c=JSON.parse(a);c.attrsformat=b["ngsiv2-attrsformat"],this(c)}.bind(d.notification.callback);f=i.ngsi_proxy.requestCallback(j).then(function(a){h=a,delete d.notification.callback,d.notification.http={url:h.url}})}else f=Promise.resolve();var k=new c(a.endpoints.v2.SUBSCRIPTION_COLLECTION,i.url);return f.then(function(){return g.call(i,k,{method:"POST",postBody:d,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}})}).then(function(b){var c=b.getHeader("Fiware-correlator");if(201!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));var e=b.getHeader("Location"),f=e.split("/").pop();return d.id=f,h&&this.ngsi_proxy.associateSubscriptionId(h.callback_id,f),Promise.resolve({correlator:c,subscription:d,location:e})}.bind(i),function(a){return h&&this.ngsi_proxy.closeCallback(h.callback_id),Promise.reject(a)}.bind(i))},a.Connection.V2.prototype.getSubscription=function(e){if(null==e)throw new TypeError("missing options parameter");"string"==typeof e&&(e={id:e});var f=b.get(this),h=new c(d(a.endpoints.v2.SUBSCRIPTION_ENTRY,{subscriptionId:encodeURIComponent(e.id)}),f.url);return g.call(f,h,{method:"GET",requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));try{var d=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content",c)}return Promise.resolve({correlator:c,subscription:d})})},a.Connection.V2.prototype.updateSubscription=function(e,f){null==f&&(f={});var h=b.get(this),i=new c(d(a.endpoints.v2.SUBSCRIPTION_ENTRY,{subscriptionId:encodeURIComponent(e.id)}),h.url);return delete e.id,g.call(h,i,{method:"PATCH",postBody:e,requestHeaders:{"FIWARE-Correlator":f.correlator,"FIWARE-Service":f.service,"FIWARE-ServicePath":f.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c})})},a.Connection.V2.prototype.deleteSubscription=function(e){if(null==e)throw new TypeError("missing options parameter");"string"==typeof e&&(e={id:e});var f=b.get(this),h=new c(d(a.endpoints.v2.SUBSCRIPTION_ENTRY,{subscriptionId:encodeURIComponent(e.id)}),f.url);return g.call(f,h,{method:"DELETE",requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(404===b.status){try{var d=P(b)}catch(b){return Promise.reject(new a.InvalidResponseError(null,c))}return Promise.reject(new a.NotFoundError({message:d.description,correlator:c}))}return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c})})},a.Connection.V2.prototype.batchUpdate=function(e,f){if(null==f&&(f={}),null==e)throw new TypeError("missing changes parameter");var h=b.get(this),i=new c(d(a.endpoints.v2.BATCH_UPDATE_OP),h.url),j={};return f.keyValues===!0&&(j.options="keyValues"),g.call(h,i,{method:"POST",parameters:j,postBody:e,requestHeaders:{"FIWARE-Correlator":f.correlator,"FIWARE-Service":f.service,"FIWARE-ServicePath":f.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c)):Promise.resolve({correlator:c})})},a.Connection.V2.prototype.batchQuery=function(d,e){if(null==e&&(e={}),null==d)throw new TypeError("missing query parameter");var f=b.get(this),h=new c(a.endpoints.v2.BATCH_QUERY_OP,f.url),i=[],j=O(e,i);return e.keyValues===!0&&i.push("keyValues"),e.values===!0&&i.push("values"),e.unique===!0&&i.push("unique"),i.length>0&&(j.options=i.join(",")),j.orderBy=e.orderBy,g.call(f,h,{method:"POST",parameters:j,postBody:d,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){var c=b.getHeader("Fiware-correlator");if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status,c));try{var d=JSON.parse(b.responseText)}catch(b){return Promise.reject(new a.InvalidResponseError("Server returned invalid JSON content",c))}var f={correlator:c,limit:e.limit,offset:e.offset,results:d};return e.count===!0&&(f.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(f)})},"undefined"!=typeof window&&(window.NGSI=a)}();;(function(){var parseUri=function(str){var o={key:['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','anchor'],q:{name:'queryKey',parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser.strict.exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||'';uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};var CONNECTING=0,OPEN=1,CLOSED=2;window.EventSource=function EventSource(resource){var that=(this===window)?{}:this,retry=1000,offset=0,boundary="\n",lastEventId=null,xhr=null,resourceLocation=null,rest='',reconnectTimeout=null,data='',name='message',eventManager=document.createElement('div');that.readyState=CONNECTING;that.toString=function(){return'[object EventSource]'};that.addEventListener=function(type,listener,useCapture){eventManager.addEventListener(type,listener,useCapture);};that.removeEventListener=function(type,listener,useCapture){eventManager.removeEventListener(type,listener,useCapture);};that.dispatchEvent=function(event){eventManager.dispatchEvent(event);};that.close=function(){that.readyState=CLOSED;if(reconnectTimeout!==null){clearTimeout(reconnectTimeout);}
if(xhr!==null){xhr.abort();}}
resourceLocation=parseUri(resource);that.URL=resourceLocation.source;var openConnectionXHR=function(){xhr=new XMLHttpRequest();xhr.open('GET',that.URL,true);var openEvent=document.createEvent('HTMLEvents');openEvent.initEvent('open',true,true);openEvent.origin=document.domain;openEvent.source=null;that.dispatchEvent(openEvent);if(lastEventId){xhr.setRequestHeader('Last-Event-ID',lastEventId);}
xhr.onreadystatechange=function(){switch(xhr.readyState){case 4:if(that.readyState!==CLOSED){that.readyState=CONNECTING;reOpenConnectionXHR();}
break;case 3:that.readyState=OPEN;processMessageFromXHR();break;}}
xhr.send(null);};var reOpenConnectionXHR=function(){xhr=null;offset=0;data='';name='message';reconnectTimeout=setTimeout(openConnectionXHR,retry);};var processMessageFromXHR=function(){var queue=(rest+xhr.responseText.substr(offset)).split(boundary);offset=xhr.responseText.length;rest=queue.pop();pseudoDispatchEvent(queue);};var pseudoDispatchEvent=function(queue){var i,line,dataIndex,field,value;for(i=0;i<queue.length;i+=1){line=queue[i];if(line===""){if(data.length>0){var fireEvent=document.createEvent('HTMLEvents');fireEvent.initEvent(name,true,true);fireEvent.lastEventId=lastEventId;fireEvent.data=data.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,'');fireEvent.origin=document.domain;fireEvent.source=null;that.dispatchEvent(fireEvent);data='';name='message';}
continue;}
dataIndex=line.indexOf(':');field=null;value='';if(dataIndex===-1){field=line;value='';}else if(dataIndex===0){continue;}else{field=line.slice(0,dataIndex);value=line.slice(dataIndex+1);}
switch(field){case'event':name=value.trim();break;case'id':lastEventId=value;break;case'retry':value=parseInt(value);if(!isNaN(value)){retry=value;}
break;case'data':if(data.length>0){data+="\n";}
data+=value;}}};openConnectionXHR();};})();;(function(NGSI,utils){"use strict";var proxiesByComponent={"widget":{},"operator":{}};var proxy_connections={};var Manager={};var proxy_base_url=new URL(Wirecloud.URLs.PROXY.evaluate({protocol:'x',domain:'x',path:'x'}),Wirecloud.location.base);proxy_base_url=proxy_base_url.toString().slice(0,-"/x/xx".length);var unload_component=function unload_component(component){var proxies=proxiesByComponent[component.meta.type][component.id];proxies.forEach((proxy)=>{var proxy_info=proxy_connections[proxy.url];proxy_info.usages-=1;if(proxy_info.usages===0){proxy_info.proxy.close();delete proxy_connections[proxy.url];}
try{proxy.close();}catch(e){}});proxies.length=0;component.removeEventListener('unload',unload_component);delete proxiesByComponent[component.meta.type][component.id];};var register_component_proxy=function register_component_proxy(component,proxy){var id=component.id;var type=component.meta.type;if(!(id in proxiesByComponent[type])){proxiesByComponent[type][id]=[];component.addEventListener('unload',unload_component);}
proxiesByComponent[type][id].push(proxy);};var make_request=function make_request(url,options){return Wirecloud.io.makeRequest(url,options).then((response)=>{var details,via_header;if(response.request.url.startsWith(proxy_base_url)){via_header=response.getHeader('Via');if(response.status===0){return Promise.reject(new NGSI.ConnectionError(utils.gettext("Error connecting to the WireCloud's proxy")));}else if(via_header==null){switch(response.status){case 403:return Promise.reject(new NGSI.ConnectionError(utils.gettext("You aren't allowed to use the WireCloud's proxy. Have you signed off from WireCloud?")));case 502:case 504:details=JSON.parse(response.responseText);return Promise.reject(new NGSI.ConnectionError(details.description));default:return Promise.reject(new NGSI.ConnectionError(utils.gettext("Unexpected response from WireCloud's proxy")));}}}
return Promise.resolve(response);});};Manager.Connection=function Connection(component,url,options){if(options==null){options={};}
if(typeof options.requestFunction!=='function'){options.requestFunction=make_request;}
if(options.ngsi_proxy_url!=null){var wrapped_proxy=new WirecloudResourceProxy(options.ngsi_proxy_url,this,options.requestFunction);options.ngsi_proxy_connection=wrapped_proxy;register_component_proxy(component,wrapped_proxy);delete options.ngsi_proxy_url;}
if(options.use_user_fiware_token===true){if(options.request_headers==null){options.request_headers={};}
options.request_headers['FIWARE-OAuth-Token']='true';options.request_headers['FIWARE-OAuth-Header-Name']='X-Auth-Token';}
NGSI.Connection.call(this,url,options);};Manager.Connection.prototype=NGSI.Connection.prototype;var privates=new WeakMap();var on_connected_get=function on_connected_get(){return privates.get(this).real_proxy.connected;};var on_connecting_get=function on_connecting_get(){return privates.get(this).real_proxy.connecting;};var on_url_get=function on_url_get(){return privates.get(this).real_proxy.url;};var WirecloudResourceProxy=function WirecloudResourceProxy(url,connection,requestFunction){url=new URL(url);if(url.pathname[url.pathname.length-1]!=='/'){url.pathname+='/';}
if(!(url in proxy_connections)){proxy_connections[url]={proxy:new NGSI.ProxyConnection(url,requestFunction),usages:0};}
var real_proxy=proxy_connections[url].proxy;proxy_connections[url].usages+=1;privates.set(this,{callbacks:[],real_proxy:real_proxy});Object.defineProperties(this,{connection:{value:connection},connected:{get:on_connected_get},connecting:{get:on_connecting_get},url:{get:on_url_get}});};utils.inherit(WirecloudResourceProxy,NGSI.ProxyConnection);WirecloudResourceProxy.prototype.connect=function connect(options){return privates.get(this).real_proxy.connect(options);};WirecloudResourceProxy.prototype.requestCallback=function requestCallback(onNotify){var priv=privates.get(this);return priv.real_proxy.requestCallback(onNotify).then((data)=>{priv.callbacks.push(data.callback_id);return Promise.resolve(data);});};WirecloudResourceProxy.prototype.closeCallback=function closeCallback(callback_id){var priv=privates.get(this);if(priv.callbacks.indexOf(callback_id)===-1){throw new TypeError('unhandled callback: '+callback_id);}
return priv.real_proxy.closeCallback(callback_id).then(()=>{var index=priv.callbacks.indexOf(callback_id);if(index!==-1){priv.callbacks.splice(index,1);}});};WirecloudResourceProxy.prototype.associateSubscriptionId=function associateSubscriptionId(callback_id,subscription_id){privates.get(this).real_proxy.associateSubscriptionId(callback_id,subscription_id);return this;};WirecloudResourceProxy.prototype.closeSubscriptionCallback=function closeSubscriptionCallback(subscription_id){var priv=privates.get(this);if(subscription_id in priv.real_proxy.subscriptionCallbacks){var callback_id=priv.real_proxy.subscriptionCallbacks[subscription_id];if(priv.callbacks.indexOf(callback_id)!==-1){return priv.real_proxy.closeSubscriptionCallback(subscription_id).then(()=>{var index=priv.callbacks.indexOf(callback_id);if(index!==-1){priv.callbacks.splice(index,1);}});}}
return Promise.resolve();};WirecloudResourceProxy.prototype.close=function close(){var priv=privates.get(this);var callbackSubscriptions=priv.real_proxy.callbackSubscriptions;priv.callbacks.forEach((callback)=>{this.closeCallback(callback);if(callbackSubscriptions[callback]!=null){this.connection.cancelSubscription(callbackSubscriptions[callback]);}});priv.callbacks=[];};Manager.NGSI=NGSI;window.NGSIManager=Manager;})(NGSI,Wirecloud.Utils);delete window.NGSI;;(function(utils){"use strict";var openstack_tokens={};var on_get_token_resolve=function on_get_token_resolve(url,response){var token=response.getHeader('X-Subject-Token');openstack_tokens[url].token=token;for(var i=0;i<openstack_tokens[url].resolveListeners.length;i++){utils.callCallback(openstack_tokens[url].resolveListeners[i],token);}
openstack_tokens[url].resolveListeners=null;openstack_tokens[url].rejectListeners=null;};var on_get_token_reject=function on_get_token_reject(url,response){for(var i=0;i<openstack_tokens[url].rejectListeners.length;i++){utils.callCallback(openstack_tokens[url].rejectListeners[i]);}
openstack_tokens[url].resolveListeners=null;openstack_tokens[url].rejectListeners=null;};var get_openstack_token_from_idm_token=function get_openstack_token_from_idm_token(url,resolve,reject){if(openstack_tokens[url]!=null){if(openstack_tokens[url].token!=null){resolve(openstack_tokens[url].token);}else{openstack_tokens[url].resolveListeners.push(resolve);openstack_tokens[url].rejectListeners.push(reject);}}else{openstack_tokens[url]={token:null,resolveListeners:[resolve],rejectListeners:[reject]};var endpoint_url=url+'v3/auth/tokens';Wirecloud.io.makeRequest(endpoint_url,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json','X-FI-WARE-OAuth-Token':'true','X-FI-WARE-OAuth-Token-Body-Pattern':'%idm_token%'},postBody:JSON.stringify({"auth":{"identity":{"methods":["oauth2"],"oauth2":{"access_token_id":'%idm_token%'}}}}),onSuccess:on_get_token_resolve.bind(null,url),onFailure:on_get_token_reject.bind(null,url)});}};window.OpenStackManager={get_openstack_token_from_idm_token:get_openstack_token_from_idm_token};})(Wirecloud.Utils);;Wirecloud.FiWare={};;(function(utils){"use strict";var change_store_filter=function change_store_filter(select){var new_value=select.getValue();if(new_value!==''){this.currentStore=new_value;this.refresh_search_results();}};var update_store_list=function update_store_list(store_info){var i,entries=[];entries.push({label:utils.gettext('All stores'),value:'All stores'});for(i=0;i<store_info.length;i+=1){entries.push({label:store_info[i].name,value:store_info[i].name});}
this.storeSelect.addEntries(entries);};var onBuySuccess=function onBuySuccess(offering,offering_entry){Wirecloud.UserInterfaceManager.monitorTask(this.catalogue.get_offering_info(offering.store,offering.id).then((refreshed_offering)=>{refreshed_offering.install({onResourceSuccess:()=>{Wirecloud.UserInterfaceManager.views.myresources.viewsByName.search.mark_outdated();this.viewsByName.search.mark_outdated();}}).then(()=>{if(this.alternatives.getCurrentAlternative()===this.viewsByName.details){this.createUserCommand('showDetails',refreshed_offering)();}else{this.refresh_search_results();if(offering_entry){offering_entry.update_buttons();}}},(msg)=>{(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();});},this.refresh_search_results.bind(this)));};var FiWareCatalogueView=function(id,options){var search_view_options;options.class='catalogue fiware';StyledElements.Alternative.call(this,id,options);this.mainview=options.catalogue;this.alternatives=new StyledElements.Alternatives();this.appendChild(this.alternatives);this.currentStore='All stores';Object.defineProperty(this,'desc',{value:options.marketplace_desc});Object.defineProperty(this,'market_id',{value:this.desc.user+'/'+this.desc.name});this.catalogue=new Wirecloud.FiWare.Marketplace(this.desc);this.loading=null;this.error=false;this.callbacks=[];this.store_info=[];this.storeSelect=new StyledElements.Select({'class':'store_select'});this.storeSelect.addEventListener('change',change_store_filter.bind(this));search_view_options={catalogue:this,resource_painter:Wirecloud.FiWare.ui.OfferingPainter,resource_template:'wirecloud/fiware/marketplace/resource',gui_template:'wirecloud/fiware/marketplace/search_interface',extra_context:{'store_select':this.storeSelect}};this.viewsByName={'search':this.alternatives.createAlternative({alternative_constructor:CatalogueSearchView,containerOptions:search_view_options}),'details':this.alternatives.createAlternative({alternative_constructor:Wirecloud.FiWare.ui.OfferingDetailsView,containerOptions:{catalogue:this}})};this.viewsByName.search.init();this.number_of_stores=0;this.refresh_store_info();this.alternatives.addEventListener('postTransition',function(alternatives,old_alternative,new_alternative){setTimeout(Wirecloud.dispatchEvent.bind(Wirecloud,'viewcontextchanged'),0);}.bind(this));this.addEventListener('show',this.refresh_if_needed.bind(this));};FiWareCatalogueView.prototype=new StyledElements.Alternative();FiWareCatalogueView.prototype.getLabel=function(){return this.desc.title||this.desc.name;};FiWareCatalogueView.prototype.isAllow=function isAllow(action){return this.catalogue.isAllow(action);};FiWareCatalogueView.prototype.onHistoryChange=function onHistoryChange(state){var offering_info,parts,currentOffering;if(state.subview==='search'){this.changeCurrentView(state.subview);}else{parts=state.offering.split('/');offering_info={store:parts[0],id:parts[1]};currentOffering=this.viewsByName.details.currentEntry;if(currentOffering!=null&&currentOffering.store===offering_info.store&&currentOffering.id===offering_info.id){currentOffering=currentOffering;}
this.createUserCommand('showDetails',offering_info,{history:"replace",tab:state.tab})();}};FiWareCatalogueView.prototype.setCurrentStore=function(store){this.currentStore=store;};FiWareCatalogueView.prototype.getCurrentStore=function(){return this.currentStore;};FiWareCatalogueView.prototype.getCurrentSearchContext=function getCurrentSearchContext(){return{'store':this.currentStore};};FiWareCatalogueView.prototype.goUp=function goUp(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){return false;}
this.changeCurrentView('search',{onComplete:push_nav_history.bind(this)});return true;};FiWareCatalogueView.prototype.search=function search(options){return this.catalogue.search(options);};FiWareCatalogueView.prototype.getPublishEndpoints=function getPublishEndpoints(){var i,stores=[];for(i=0;i<this.store_info.length;i+=1){stores[i]={'label':this.store_info[i].name,'value':this.store_info[i].name};}
return stores;};FiWareCatalogueView.prototype.wait_ready=function wait_ready(onComplete){if(typeof onComplete!=='function'){throw new TypeError('invalid onComplete parameter');}
if(this.loading===false){onComplete();}
this.callbacks.push(onComplete);if(this.loading===null){this.refresh_store_info();}};FiWareCatalogueView.prototype.refresh_store_info=function refresh_store_info(){if(this.loading){return;}
this.loading=true;this.store_info=[];this.number_of_stores=0;this.storeSelect.clear();this.storeSelect.addEntries([{label:utils.gettext('loading...'),value:''}]);this.storeSelect.disable();this.catalogue.getStores({onSuccess:this.addStoreInfo.bind(this),onFailure:this._getStoresErrorCallback.bind(this),onComplete:function(){for(var i=0;i<this.callbacks.length;i++){try{this.callbacks[i]();}catch(e){}}
this.callbacks=[];}.bind(this)});};FiWareCatalogueView.prototype._getStoresErrorCallback=function _getStoresErrorCallback(){this.loading=false;this.error=true;this.storeSelect.clear();this.storeSelect.addEntries([{label:utils.gettext('list not available'),value:''}]);};FiWareCatalogueView.prototype.addStoreInfo=function addStoreInfo(store_info){if(this.isVisible()){this.refresh_if_needed();}
this.store_info=store_info;this.number_of_stores=store_info.length;this.loading=false;this.error=false;this.storeSelect.clear();update_store_list.call(this,store_info);this.storeSelect.enable();};FiWareCatalogueView.prototype.changeCurrentView=function changeCurrentView(view_name,options){if(!(view_name in this.viewsByName)){throw new TypeError();}
this.alternatives.showAlternative(this.viewsByName[view_name],options);};FiWareCatalogueView.prototype.home=function(){this.changeCurrentView('search',{onComplete:push_nav_history.bind(this)});};FiWareCatalogueView.prototype.createUserCommand=function(command){return this.ui_commands[command].apply(this,Array.prototype.slice.call(arguments,1));};FiWareCatalogueView.prototype.ui_commands={};FiWareCatalogueView.prototype.ui_commands.showDetails=function showDetails(offering,options){options=utils.merge({history:"push"},options);return function(){var onSuccess=function onSuccess(offering){this.viewsByName.details.paint(offering,{tab:options.tab});this.viewsByName.details.repaint();};var onComplete=function onComplete(){this.viewsByName.details.enable();if(options.history==="push"){push_nav_history.call(this);}else if(options.history==="replace"){replace_nav_history.call(this);}
utils.callCallback(options.onComplete);};this.viewsByName.details.disable();this.changeCurrentView('details',{onComplete:function(){if(offering instanceof Wirecloud.FiWare.Offering){onSuccess.call(this,offering);onComplete.call(this);}else{this.catalogue.get_offering_info(offering.store,offering.id).then((refreshed_offering)=>{onSuccess.call(this,refreshed_offering);onComplete.call(this);},(error)=>{onComplete.call(this);});}}.bind(this)});}.bind(this);};FiWareCatalogueView.prototype.ui_commands.buy=function(offering,offering_entry){return function(){this.catalogue.start_purchase(offering,{onSuccess:function(data){var dialog=new Wirecloud.ui.ExternalProcessWindowMenu(utils.interpolate(utils.gettext('Buying %(offering)s'),{offering:offering.getDisplayName()},true),data.url,utils.gettext('The buying process will continue in a separate window. This window will be controled by the store where the offering is hosted. After finishing the buying process, the control will return to WireCloud.'),{class:'wc-buy-modal',onSuccess:onBuySuccess.bind(this,offering,offering_entry)});dialog.show();}.bind(this)});}.bind(this);};FiWareCatalogueView.prototype.refresh_if_needed=function refresh_if_needed(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){this.viewsByName.search.refresh_if_needed();}};FiWareCatalogueView.prototype.refresh_search_results=function(){this.viewsByName.search.source.refresh();};var replace_nav_history=function replace_nav_history(){var new_status=this.mainview.buildStateData();Wirecloud.HistoryManager.replaceState(new_status);};var push_nav_history=function push_nav_history(){var new_status=this.mainview.buildStateData();Wirecloud.HistoryManager.pushState(new_status);};Wirecloud.FiWare.FiWareCatalogueView=FiWareCatalogueView;Wirecloud.MarketManager.addMarketType('fiware','FIWARE Marketplace',FiWareCatalogueView);})(Wirecloud.Utils);;(function(utils){"use strict";var BusinessAPIEcosystemView=function BusinessAPIEcosystemView(id,options){options.class='catalogue fiware';Wirecloud.ui.WorkspaceView.call(this,id,options);Object.defineProperty(this,'desc',{value:options.marketplace_desc});Object.defineProperty(this,'market_id',{value:this.desc.user+'/'+this.desc.name});Object.defineProperty(this,'workspaceview',{value:this.desc.user+'/'+this.desc.name});this.addEventListener('show',load.bind(this));this.status="unloaded";};utils.inherit(BusinessAPIEcosystemView,Wirecloud.ui.WorkspaceView);BusinessAPIEcosystemView.prototype.getLabel=function getLabel(){return this.desc.title||this.desc.name;};BusinessAPIEcosystemView.prototype.isAllow=function isAllow(action){return(action in this.desc.permissions)?this.desc.permissions[action]:false;};BusinessAPIEcosystemView.prototype.goUp=function goUp(){return false;};BusinessAPIEcosystemView.prototype.wait_ready=function wait_ready(listener){listener();};BusinessAPIEcosystemView.prototype.getPublishEndpoints=function getPublishEndpoints(){return null;};BusinessAPIEcosystemView.prototype.destroy=function destroy(){if(this.status==="loaded"){this.model.unload();this.status="unloaded";}};Wirecloud.FiWare.BusinessAPIEcosystemView=BusinessAPIEcosystemView;Wirecloud.MarketManager.addMarketType('fiware-bae','FIWARE Business API Ecosystem',BusinessAPIEcosystemView);var load=function load(){if(this.status==="unloaded"){this.status="loading";Wirecloud.loadWorkspace({owner:this.desc.user,name:this.desc.name}).then((workspace)=>{this.loadWorkspace(workspace);this.loaded="loaded";}).catch(()=>{this.status="unloaded";});}};})(Wirecloud.Utils);;(function(utils,se){"use strict";var Marketplace,_onSearchSuccess,_onSearchFailure,_onGetStoresComplete;_onSearchSuccess=function _onSearchSuccess(response){var raw_data=JSON.parse(response.responseText);this.onSuccess(raw_data);};_onSearchFailure=function _onSearchFailure(response){this.onFailure();};_onGetStoresComplete=function _onGetStoresComplete(response){this.onComplete();};Marketplace=function Marketplace(options){se.ObjectWithEvents.call(this,["change","install","uninstall"]);this.market_user=options.user;this.market_name=options.name;Object.defineProperty(this,'permissions',{'value':options.permissions});};utils.inherit(Marketplace,se.ObjectWithEvents);Marketplace.prototype.isAllow=function isAllow(action){if(action in this.permissions){return this.permissions[action];}else{return false;}};Marketplace.prototype.search=function search(options){var url;if(options==null){throw new TypeError();}
if(options.search_criteria===''&&options.store==='All stores'){url=Wirecloud.URLs.FIWARE_RESOURCES_COLLECTION.evaluate({market_user:this.market_user,market_name:this.market_name});}else if(options.search_criteria!==''&&options.store==='All stores'){url=Wirecloud.URLs.FIWARE_FULL_SEARCH.evaluate({market_user:this.market_user,market_name:this.market_name,search_string:options.search_criteria});}else if(options.search_criteria===''&&options.store!=='All stores'){url=Wirecloud.URLs.FIWARE_STORE_RESOURCES_COLLECTION.evaluate({market_user:this.market_user,market_name:this.market_name,store:options.store});}else{url=Wirecloud.URLs.FIWARE_STORE_SEARCH.evaluate({market_user:this.market_user,market_name:this.market_name,store:options.store,search_string:options.search_criteria});}
return Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'}}).then((response)=>{if([200,401,403,500].indexOf(response.status)===-1){return Promise.reject(utils.gettext("Unexpected response from server"));}else if([401,403,500].indexOf(response.status)!==-1){return Promise.reject(Wirecloud.GlobalLogManager.parseErrorResponse(response));}
var response_data=JSON.parse(response.responseText);var offerings=response_data.resources.map((offering)=>{return new Wirecloud.FiWare.Offering(offering,this);});var data={'resources':offerings,'query_results_number':offerings.length,'resources_per_page':10,'current_page':1};return Promise.resolve(data);});};Marketplace.prototype.get_offering_info=function get_offering_info(store,offering_name){var url=Wirecloud.URLs.FIWARE_OFFERING_ENTRY.evaluate({market_user:this.market_user,market_name:this.market_name,store:store,offering_id:offering_name});return Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'}}).then((response)=>{var offering=new Wirecloud.FiWare.Offering(JSON.parse(response.responseText),this);return Promise.resolve(offering);}).toTask(utils.gettext('Retrieving offering info'));};Marketplace.prototype.is_purchased=function is_purchased(offering){return offering.open===true||offering.state==='purchased'||offering.state==='rated';};Marketplace.prototype.start_purchase=function start_purchase(resource,options){if(options==null){options={};}
var url=Wirecloud.URLs.FIWARE_STORE_START_PURCHASE.evaluate({market_user:this.market_user,market_name:this.market_name,store:resource.store});Wirecloud.io.makeRequest(url,{contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({offering_url:resource.usdl_url}),onSuccess:function(transport){var data=JSON.parse(transport.responseText);if(typeof options.onSuccess==='function'){options.onSuccess(data);}}.bind(this),});};Marketplace.prototype.getStores=function getStores(options){var url=Wirecloud.URLs.FIWARE_STORE_COLLECTION.evaluate({market_user:this.market_user,market_name:this.market_name});if(options==null){options={};}
Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:_onSearchSuccess.bind(options),onFailure:_onSearchFailure.bind(options),onComplete:_onGetStoresComplete.bind(options)});};Wirecloud.FiWare.Marketplace=Marketplace;})(Wirecloud.Utils,StyledElements);;(function(utils){"use strict";var MAC_MIMETYPES=['application/x-widget+mashable-application-component','application/x-operator+mashable-application-component','application/x-mashup+mashable-application-component'];var MAC_TYPES=['widget','operator','mashup'];var is_mac_mimetype=function is_mac_mimetype(mimetype){return MAC_MIMETYPES.indexOf(mimetype)!==-1;};var installResource=function installResource(resource,options){var market_id;if(options==null){options={};}
if(this.catalogue.market_user!=='public'){market_id=this.catalogue.market_user+'/'+this.catalogue.market_name;}else{market_id=this.catalogue.market_name;}
return Wirecloud.LocalCatalogue.addComponent({url:resource.url,forceCreate:true,market_info:{name:market_id,store:this.store}});};var installed=function installed(){var i,resource;if(this.wirecloudresources.length===0){return false;}
for(i=0;i<this.wirecloudresources.length;i++){resource=this.wirecloudresources[i];if(!Wirecloud.LocalCatalogue.resourceExistsId(resource.id)){return false;}}
return true;};var Offering=function Offering(resourceJSON_,catalogue){this.getParts=function getParts(){return resourceJSON_.parts;};this.getDisplayName=function getDisplayName(){return resourceJSON_.displayName;};this.getPage=function getPage(){return resourceJSON_.page;};this.getLegal=function getLegal(){return resourceJSON_.legal;};this.isAllow=function isAllow(action){return false;};var publicationdate=null;if(resourceJSON_.publicationdate!=null&&resourceJSON_.publicationdate!==''){publicationdate=new Date(resourceJSON_.publicationdate);}
Object.defineProperties(this,{'catalogue':{value:catalogue},'id':{value:resourceJSON_.id},'owner':{value:resourceJSON_.vendor},'name':{value:resourceJSON_.name},'title':{value:resourceJSON_.name},'version':{value:resourceJSON_.version},'type':{value:resourceJSON_.type},'image':{value:resourceJSON_.uriImage},'abstract':{value:resourceJSON_.shortDescription},'description':{value:resourceJSON_.longDescription},'pricing':{value:resourceJSON_.pricing},'rating':{value:resourceJSON_.rating},'sla':{value:resourceJSON_.sla},'open':{value:!!resourceJSON_.open},'state':{value:resourceJSON_.state},'store':{value:resourceJSON_.store},'usdl_url':{value:resourceJSON_.usdl_url},'resources':{value:resourceJSON_.resources},'wirecloudresources':{value:[]},'publicationdate':{value:publicationdate},'installed':{get:installed}});if(this.open===true||['purchased','rated'].indexOf(this.state)!==-1){for(var i=0;i<this.resources.length;i+=1){var resource=this.resources[i];resource.offering=this;if(is_mac_mimetype(resource.content_type)){resource.type=MAC_TYPES[MAC_MIMETYPES.indexOf(resource.content_type)];try{var parts=resource.id.split('/');resource.uri=resource.id;resource.wirecloud={uri:resource.id,vendor:parts[0],name:parts[1],title:resource.name,type:resource.type,group_id:parts[0]+'/'+parts[1],version:new Wirecloud.Version(parts[2])};resource.install=installResource.bind(this,resource);this.wirecloudresources.push(resource);}catch(error){delete resource.uri;delete resource.wirecloud;}}}}
Object.freeze(this.resources);Object.freeze(this.wirecloudresources);};Offering.prototype.install=function install(options){if(options==null){options={};}
var title=utils.gettext("Importing offering components into local repository");if(this.wirecloudresources.length>0){var subtasks=this.wirecloudresources.map((component)=>{var subtask=component.install();subtask.then(options.onResourceSuccess,options.onResourceFailure);return subtask;});return new Wirecloud.Task(title,subtasks);}else{return new Wirecloud.Task(title,(resolve)=>{resolve();});}};Wirecloud.FiWare.Offering=Offering;})(Wirecloud.Utils);;(function(utils){"use strict";var OfferingDetailsView=function OfferingDetailsView(id,options){var extra_context;this.mainview=options.catalogue;options.class='details_interface loading';StyledElements.Alternative.call(this,id,options);extra_context=function(resource){return{'details':function(options,context,offering_entry){var details,painter,main_description,legal_description,pricing_description,sla_description,offering_resource_description;details=new StyledElements.Notebook();details.addEventListener('change',function(notebook,oldTab,newTab){var new_status=Wirecloud.HistoryManager.getCurrentState();new_status.tab=newTab.label;Wirecloud.HistoryManager.pushState(new_status);});main_description=details.createTab({label:utils.gettext('Main Info'),closable:false});main_description.appendChild(this.main_details_painter.paint(resource));legal_description=details.createTab({label:utils.gettext('Legal'),closable:false});painter=new LegalPainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/legal/legal_template'],legal_description.wrapperElement);painter.paint(resource);pricing_description=details.createTab({label:utils.gettext('Pricing'),closable:false});painter=new PricingPainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/pricing/pricing_template'],pricing_description.wrapperElement);painter.paint(resource);sla_description=details.createTab({label:utils.gettext('Service level agreement'),closable:false});painter=new SlaPainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/sla/service_level_template'],sla_description.wrapperElement);painter.paint(resource);if(Array.isArray(resource.resources)){offering_resource_description=details.createTab({label:utils.gettext('Resources'),closable:false});painter=new Wirecloud.FiWare.ui.OfferingResourcePainter();painter.paint(resource,offering_resource_description,this.mainview,offering_entry);}
return details;}.bind(this)};}.bind(this);this.currentEntry=null;this.main_details_painter=new Wirecloud.FiWare.ui.OfferingPainter(this.mainview,Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/main_resource_details'],this);this.resource_details_painter=new Wirecloud.FiWare.ui.OfferingPainter(this.mainview,Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/resource_details'],this,extra_context);};OfferingDetailsView.prototype=new StyledElements.Alternative();OfferingDetailsView.prototype.view_name='details';OfferingDetailsView.prototype.buildStateData=function buildStateData(data){if(this.currentEntry!=null){data.offering=this.currentEntry.store+'/'+this.currentEntry.id;}};OfferingDetailsView.prototype.paint=function paint(resource,options){if(options==null){options={};}
this.currentEntry=resource;this.clear();this.appendChild(this.resource_details_painter.paint(resource));if(options.tab!=null){this.currentNotebook.goToTab(this.currentNotebook.getTabByLabel(options.tab));}
Wirecloud.dispatchEvent('viewcontextchanged');};if(!('ui'in Wirecloud.FiWare)){Wirecloud.FiWare.ui={};}
Wirecloud.FiWare.ui.OfferingDetailsView=OfferingDetailsView;})(Wirecloud.Utils);;(function(se,utils){"use strict";var CURRENCY_SYMBOL={'EUR':'€','GBP':'£','USD':'$'};var onInstallClick=function onInstallClick(offering,catalogue_view){Wirecloud.UserInterfaceManager.monitorTask(offering.install({onResourceSuccess:function(){var local_catalogue_view=Wirecloud.UserInterfaceManager.views.myresources;local_catalogue_view.viewsByName.search.mark_outdated();}}).then(()=>{this.update_buttons();},(error)=>{this.update_buttons();}));};var onUninstallClick=function onUninstallClick(offering,catalogue_view){var local_catalogue_view=Wirecloud.UserInterfaceManager.views.myresources;var subtasks=offering.wirecloudresources.map((component)=>{return local_catalogue_view.catalogue.uninstallResource(component.wirecloud);});Wirecloud.UserInterfaceManager.monitorTask(new Wirecloud.Task(utils.gettext("Uninstalling offering resources"),subtasks).then(()=>{local_catalogue_view.viewsByName.search.mark_outdated();catalogue_view.viewsByName.search.mark_outdated();this.update_buttons();},(error)=>{this.update_buttons();}));};var is_single_payment=function is_single_payment(offering){var pricing=offering.pricing[0];return pricing.priceComponents.length===1&&pricing.priceComponents[0].unit.toLowerCase()==='single payment';};var OfferingPainter=function OfferingPainter(catalogue_view,offering_template,container,extra_context){if(arguments.length===0){return;}
this.builder=new StyledElements.GUIBuilder();this.catalogue_view=catalogue_view;this.structure_template=offering_template;this.error_template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="alert alert-block alert-error"><t:message/></div></s:styledgui>';this.container=container;this.is_details_view=extra_context!=null;if(extra_context!=null&&(typeof extra_context==='object'||typeof extra_context==='function')){this.extra_context=extra_context;}else{this.extra_context={};}};OfferingPainter.prototype.setError=function setError(message){this.container.clear();var contents=this.builder.parse(this.error_template,{'message':message});this.container.appendChild(contents);};OfferingPainter.prototype.paint=function paint(offering){var extra_context,i,context,offering_element;if(typeof this.extra_context==='function'){extra_context=this.extra_context(offering);}else{extra_context=utils.clone(this.extra_context);}
context=utils.merge(extra_context,{'displayname':offering.getDisplayName(),'name':offering.name,'owner':offering.owner,'store':offering.store,'version':offering.version,'abstract':offering.abstract,'description':offering.description,'type':function(){var label=document.createElement('div');label.textContent=offering.type;label.className='label';switch(offering.type){case'widget':label.classList.add('label-success');break;case'operator':label.classList.add('label-warning');break;case'mashup':label.classList.add('label-important');break;case'pack':label.classList.add('label-info');break;}
return label;},'publicationdate':function(){if(offering.publicationdate!=null){return moment(offering.publicationdate).fromNow();}else{return utils.gettext('N/A');}},'rating':this.get_popularity_html.bind(this,offering.rating),'mainbutton':function(options,context,offering_entry){var button;if(['widget','operator','mashup','pack'].indexOf(offering.type)===-1&&this.is_details_view){return null;}else{button=new StyledElements.Button({text:''});offering_entry.mainbuttons.push(button);}
return button;}.bind(this),'image':function(){var image=document.createElement('img');image.className="wc-resource-img";image.onerror=onImageError;image.src=offering.image;return image;},'tags':function(options){return this.painter.renderTagList(offering,options.max);}.bind({painter:this})});var offering_entry=new OfferingEntry(this,offering);offering_element=this.builder.parse(this.structure_template,context,offering_entry);offering_entry.update_buttons();for(i=0;i<offering_element.elements.length;i+=1){if(!(offering_element.elements[i]instanceof Element)){continue;}
if(this.catalogue_view){this.create_simple_command(offering_element.elements[i],'.click_for_details','click',this.catalogue_view.createUserCommand('showDetails',offering));}
var title_element=offering_element.elements[i].querySelector('.title-tooltip');if(title_element!=null){var tooltip=new se.Tooltip({content:offering.getDisplayName(),placement:['top','bottom','right','left']});tooltip.bind(title_element);}}
return offering_element;};var OfferingEntry=function OfferingEntry(painter,offering){this.painter=painter;this.offering=offering;this.mainbuttons=[];this.resource_buttons={};};OfferingEntry.prototype.update_mainbuttons=function update_mainbuttons(){var i,button;for(i=0;i<this.mainbuttons.length;i++){button=this.mainbuttons[i];button.clearClassName().addClassName('mainbutton');button.clearEventListeners();if(!this.painter.catalogue_view.catalogue.is_purchased(this.offering)&&['widget','operator','mashup','pack'].indexOf(this.offering.type)!==-1){if(this.offering.pricing.length===0||!('priceComponents'in this.offering.pricing[0])){button.addClassName('btn-success').setLabel(utils.gettext('Free'));}else if(is_single_payment(this.offering)){button.addClassName('btn-warning').setLabel(this.offering.pricing[0].priceComponents[0].value+' '+CURRENCY_SYMBOL[this.offering.pricing[0].priceComponents[0].currency]);}else{button.addClassName('btn-warning').setLabel(utils.gettext('Purchase'));}
button.addEventListener('click',this.painter.catalogue_view.createUserCommand('buy',this.offering,this));continue;}
if(this.offering.wirecloudresources.length>0){if(!this.offering.installed){button.addClassName('btn-primary').setLabel(utils.gettext('Install'));button.addEventListener('click',onInstallClick.bind(this,this.offering,this.painter.catalogue_view));}else{button.addClassName('btn-danger').setLabel(utils.gettext('Uninstall'));button.addEventListener('click',onUninstallClick.bind(this,this.offering,this.painter.catalogue_view));}}else{button.addClassName('btn-info').setLabel(utils.gettext('Details'));button.addEventListener('click',this.painter.catalogue_view.createUserCommand('showDetails',this.offering));button.setDisabled(this.painter.is_details_view);}}};OfferingEntry.prototype.update_buttons=function update_buttons(){this.update_mainbuttons();if('update_resource_buttons'in this){this.update_resource_buttons();}};OfferingPainter.prototype.create_simple_command=function(element,selector,_event,handler,required){var i,elements,root_matches;elements=element.querySelectorAll(selector);root_matches=element.matches(selector);if(required&&elements.length<1&&!root_matches){throw new Error();}
if(root_matches){element.addEventListener(_event,handler);}
for(i=0;i<elements.length;i+=1){elements[i].addEventListener(_event,handler);}};OfferingPainter.prototype.get_popularity_html=function(popularity){var on_stars,md_star,off_stars,stars,star,i;if(popularity==null||popularity<1){popularity=0;}
on_stars=Math.floor(popularity);md_star=popularity-on_stars;off_stars=5-popularity;stars=document.createElement('div');stars.className='rating';if(popularity===0){stars.classList.add('disabled');}
for(i=0;i<on_stars;i+=1){star=document.createElement('span');star.className='on star';stars.appendChild(star);}
if(md_star){star=document.createElement('span');star.className='middle star';stars.appendChild(star);}
for(i=0;i<Math.floor(off_stars);i+=1){star=document.createElement('span');star.className='off star';stars.appendChild(star);}
return stars;};var onImageError=function onImageError(event){event.target.parentElement.classList.add('se-thumbnail-missing');event.target.parentElement.textContent=utils.gettext('No image available');};Wirecloud.FiWare.ui.OfferingPainter=OfferingPainter;})(StyledElements,Wirecloud.Utils);;(function(utils){"use strict";var OfferingResourcePainter=function OfferingResourcePainter(){};var onInstallClick=function onInstallClick(resource,catalogue,offering_entry,button){var local_catalogue_view;button.disable();local_catalogue_view=Wirecloud.UserInterfaceManager.views.myresources;Wirecloud.UserInterfaceManager.monitorTask(resource.install().then(()=>{offering_entry.update_buttons();catalogue.viewsByName.search.mark_outdated();local_catalogue_view.viewsByName.search.mark_outdated();button.enable();},(msg)=>{Wirecloud.GlobalLogManager.log(msg);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();button.enable();}));};var onUninstallClick=function onUninstallClick(resource,catalogue,offering_entry,button){button.disable();var local_catalogue_view=Wirecloud.UserInterfaceManager.views.myresources;local_catalogue_view.catalogue.uninstallResource(resource.wirecloud,{onSuccess:function(){offering_entry.update_buttons();catalogue.viewsByName.search.mark_outdated();local_catalogue_view.viewsByName.search.mark_outdated();},onFailure:function(msg){Wirecloud.GlobalLogManager.log(msg);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();},onComplete:function(){button.enable();}});};OfferingResourcePainter.prototype.paint=function paint(offering,dom_element,catalogue,offering_entry){var i,resource,btn_group,button,details_button,resource_entry;offering_entry.resources=new StyledElements.ModelTable([{"field":["resource","name"],"label":utils.gettext('Name'),"contentBuilder":function(entry){var fragment=new StyledElements.Fragment();var title=document.createElement('h5');title.textContent=entry.resource.name;fragment.appendChild(title);if('type'in entry.resource&&!('install'in entry.resource)){var error_label=document.createElement('span');error_label.className='label label-danger';error_label.textContent=utils.gettext('missing WireCloud metadata');title.appendChild(error_label);}else if('type'in entry.resource){var label=document.createElement('span');label.textContent=entry.resource.type;label.className='label';switch(entry.resource.type){case'widget':label.classList.add('label-success');break;case'operator':label.classList.add('label-warning');break;case'mashup':label.classList.add('label-important');break;}
title.appendChild(label);}
var description=document.createTextNode(entry.resource.description);fragment.appendChild(description);return fragment;}},{"label":utils.gettext('Actions'),"width":"css","class":"wc-fiware-offering-resources-buttons-column","sortable":false,"contentBuilder":function(entry){var resource=entry.resource;if(entry.install_button!=null){entry.install_button.clearClassName().clearEventListeners('click');if(Wirecloud.LocalCatalogue.resourceExistsId(resource.id)){entry.install_button.addClassName('btn-danger').setLabel(utils.gettext('Uninstall'));entry.install_button.addEventListener('click',onUninstallClick.bind(null,resource,catalogue,offering_entry));entry.details_button.enable();}else{entry.install_button.addClassName('btn-primary').setLabel(utils.gettext('Install'));entry.install_button.addEventListener('click',onInstallClick.bind(null,resource,catalogue,offering_entry));entry.details_button.disable();}}
return entry.buttons;}}],{pageSize:0,'class':'offering_resource_list'});dom_element.appendChild(offering_entry.resources);offering_entry.update_resource_buttons=function update_resource_buttons(){this.resources.source.refresh();};for(i=0;i<offering.resources.length;i+=1){btn_group=document.createElement('div');btn_group.className='btn-group';resource=offering.resources[i];resource_entry={resource:resource,buttons:btn_group};if('url'in resource){if('install'in resource){button=new StyledElements.Button({text:''});button.insertInto(btn_group);details_button=new StyledElements.Button({text:utils.gettext('Details')});details_button.addEventListener('click',function(){var myresources_view=Wirecloud.UserInterfaceManager.viewsByName.myresources;myresources_view.createUserCommand('showDetails',this,{version:this.version})();}.bind(resource));details_button.insertInto(btn_group);resource_entry.install_button=button;resource_entry.details_button=details_button;}else{button=new StyledElements.Button({'class':'btn-info',text:utils.gettext('Download')});button.insertInto(btn_group);}}
offering_entry.resources.source.addElement(resource_entry);}};Wirecloud.FiWare.ui.OfferingResourcePainter=OfferingResourcePainter;})(Wirecloud.Utils);;"use strict";var LegalPainter=function(legal_structure_element,dom_element){this.legal_template_element=legal_structure_element;this.legal_template=new Wirecloud.Utils.Template(this.legal_template_element);this.dom_element=dom_element;this.paint=function paint(resource){var resource_html,legal,i,legal_element,resource_element,clause_painter;this.dom_element.innerHTML='';legal=resource.getLegal();if(legal.length>0){for(i=0;i<legal.length;i+=1){legal_element=legal[i];resource_html={"title":legal_element.label,"description":legal_element.description};resource_element=document.createElement('div');resource_element.className="legal_resource";resource_element.innerHTML=this.legal_template.evaluate(resource_html);clause_painter=new ClausePainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/legal/legal_clause_template'],resource_element.getElementsByClassName('clause_list')[0]);clause_painter.paint(legal_element.clauses);this.dom_element.appendChild(resource_element);}}else{resource_element=document.createElement('div');resource_element.className="legal_resource";resource_element.innerHTML='<div><h3>Legal Conditions</h3><div class="tab_info">No legal conditions has been defined</div></div>';this.dom_element.appendChild(resource_element);}};};var ClausePainter=function ClausePainter(clause_structure_element,dom_element){this.clause_template_element=clause_structure_element;this.clause_template=new Wirecloud.Utils.Template(this.clause_template_element);this.dom_element=dom_element;this.paint=function paint(resource){var resource_html,i,clause_element,resource_element;this.dom_element.innerHTML='';for(i=0;i<resource.length;i+=1){clause_element=resource[i];resource_html={"name":clause_element.name,"text":clause_element.text};resource_element=document.createElement('div');resource_element.className="clause_resource";resource_element.innerHTML=this.clause_template.evaluate(resource_html);this.dom_element.appendChild(resource_element);}};};var SlaPainter=function(sla_structure_element,dom_element){this.sla_template_element=sla_structure_element;this.sla_template=new Wirecloud.Utils.Template(this.sla_template_element);this.dom_element=dom_element;this.paint=function paint(resource){var resource_html,sla,i,sla_element,resource_element,expresion_painter;this.dom_element.innerHTML='';sla=resource.sla;if(sla.length>0){for(i=0;i<sla.length;i+=1){sla_element=sla[i];resource_html={"type":sla_element.type,"title":sla_element.name,"description":sla_element.description,"obligated":sla_element.obligatedParty};resource_element=document.createElement('div');resource_element.className="sla_resource";resource_element.innerHTML=this.sla_template.evaluate(resource_html);expresion_painter=new ExpresionPainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/sla/sla_expresion_template'],resource_element.getElementsByClassName('expresions_list')[0]);expresion_painter.paint(sla_element.slaExpresions);this.dom_element.appendChild(resource_element);}}else{resource_element=document.createElement('div');resource_element.className="sla_resource";resource_element.innerHTML='<div><h3>Service level agreement</h3><div class="tab_info">No service level agreement has been defined</div></div>';this.dom_element.appendChild(resource_element);}};};var ExpresionPainter=function(expresion_structure_element,dom_element){this.expresion_template_element=expresion_structure_element;this.expresion_template=new Wirecloud.Utils.Template(this.expresion_template_element);this.dom_element=dom_element;this.paint=function paint(resource){var resource_html,slaExpresion,i,slaExpresion_element,resource_element,variable_painter;this.dom_element.innerHTML='';slaExpresion=resource;for(i=0;i<slaExpresion.length;i+=1){slaExpresion_element=slaExpresion[i];resource_html={"title":slaExpresion_element.name,"description":slaExpresion_element.description};resource_element=document.createElement('div');resource_element.className="slaExpresion_resource";resource_element.innerHTML=this.expresion_template.evaluate(resource_html);variable_painter=new VariablePainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/sla/sla_variable_template'],resource_element.getElementsByClassName('variable_list')[0]);if('location'in slaExpresion_element){slaExpresion_element.variables.push({'label':'Centre','value':'UTM X:'+slaExpresion_element.location.coordinates.lat+', UTM Y:'+slaExpresion_element.location.coordinates.long,'type':'','unit':''});}
variable_painter.paint(slaExpresion_element.variables);this.dom_element.appendChild(resource_element);}};};var VariablePainter=function(variable_structure_element,dom_element){this.variable_template_element=variable_structure_element;this.variable_template=new Wirecloud.Utils.Template(this.variable_template_element);this.dom_element=dom_element;this.paint=function paint(resource){var resource_html,i,variable_element,resource_element;this.dom_element.innerHTML='';for(i=0;i<resource.length;i+=1){variable_element=resource[i];resource_html={"title":variable_element.label,"type":variable_element.type,"value":variable_element.value,"unit":variable_element.unit,};resource_element=document.createElement('div');resource_element.className="slaVariable_resource";resource_element.innerHTML=this.variable_template.evaluate(resource_html);this.dom_element.appendChild(resource_element);}};};var PricingPainter=function(pricing_structure_element,dom_element){this.pricing_template_element=pricing_structure_element;this.pricing_template=new Wirecloud.Utils.Template(this.pricing_template_element);this.dom_element=dom_element;this.paint=function paint(resource){var resource_html,i,pricing,pricing_element,resource_element,pricing_component_painter,tax_painter;this.dom_element.innerHTML='';pricing=resource.pricing;if(pricing.length>0){for(i=0;i<pricing.length;i+=1){pricing_element=pricing[i];resource_html={"title":pricing_element.label,"description":pricing_element.description};resource_element=document.createElement('div');resource_element.className="pricing_resource";resource_element.innerHTML=this.pricing_template.evaluate(resource_html);if('priceComponents'in pricing_element&&pricing_element.priceComponents.length>0&&pricing_element.priceComponents[0].title!==''){pricing_component_painter=new PriceElementPainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/pricing/price_component_template'],resource_element.getElementsByClassName('price_components_list')[0]);pricing_component_painter.paint(pricing_element.priceComponents);}
if('taxes'in pricing_element&&pricing_element.taxes.length>0&&pricing_element.taxes[0].title!==''){tax_painter=new PriceElementPainter(Wirecloud.currentTheme.templates['wirecloud/fiware/marketplace/pricing/price_component_template'],resource_element.getElementsByClassName('taxes_list')[0]);tax_painter.paint(pricing_element.taxes);}
this.dom_element.appendChild(resource_element);}}else{resource_element=document.createElement('div');resource_element.className="pricing_resource";resource_element.innerHTML='<div><h3>Price plan</h3><div class="tab_info">No price plan has been defined, the widget is for free</div></div>';this.dom_element.appendChild(resource_element);}};};var PriceElementPainter=function(price_structure_element,dom_element){this.price_template_element=price_structure_element;this.price_template=new Wirecloud.Utils.Template(this.price_template_element);this.dom_element=dom_element;this.paint=function paint(resource){var resource_html,i,price_element,resource_element;this.dom_element.innerHTML='';for(i=0;i<resource.length;i+=1){price_element=resource[i];resource_html={"title":price_element.title,"description":price_element.description,"currency":price_element.currency,"value":price_element.value,"unit":price_element.unit,};resource_element=document.createElement('div');resource_element.className="price_element_resource";resource_element.innerHTML=this.price_template.evaluate(resource_html);this.dom_element.appendChild(resource_element);}};};